/**
 * @license
 * GrapeFruit Game Engine - v0.2.0
 * Copyright Â© 2012-2014, Chad Engler
 * https://github.com/grapefruitjs/grapefruit
 *
 * Compiled: 2014-02-17
 *
 * GrapeFruit Game Engine is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license.php
 */

!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.gf=a()}}(function(){var c;return function d(a,b,c){function e(g,h){if(!b[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=b[g]={exports:{}};a[g][0].call(j.exports,function(b){var c=a[g][1][b];return e(c?c:b)},j,j.exports,d,a,b,c)}return b[g].exports}for(var f="function"==typeof require&&require,g=0;g<c.length;g++)e(c[g]);return e}({1:[function(a,b,c){!function(){Object.create=Object.create||function(a){function b(){}return b.prototype=a,new b};var a;"undefined"==typeof c?(a={},"object"==typeof window&&(window.cp=a)):a=c;var b,d,e=function(a,b){if(!a)throw new Error("Assertion failed: "+b)},f=function(a,b){!a&&console&&console.warn&&(console.warn("ASSERTION FAILED: "+b),console.trace&&console.trace())},g=function(a,b){return b>a?a:b},h=function(a,b){return a>b?a:b};"object"==typeof window&&window.navigator.userAgent.indexOf("Firefox")>-1?(b=Math.min,d=Math.max):(b=g,d=h);var i=function(a,b){return b>a?a+" "+b:b+" "+a},j=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return a[c]=a[a.length-1],void a.length--},k=function(a,b,c){var d=C(b,c),e=t(x(d,C(a,c))/L(d));return B(c,E(d,e))},l=function(a,b,c,d,e,f){var g=c-e,h=d-f,i=t(y(g,h,a-e,b-f)/M(g,h));return new v(e+g*i,f+h*i)},m=(a.momentForCircle=function(a,b,c,d){return a*(.5*(b*b+c*c)+L(d))},a.areaForCircle=function(a,b){return Math.PI*Math.abs(a*a-b*b)},a.momentForSegment=function(a,b,c){var d=E(B(b,c),.5);return a*(S(c,b)/12+L(d))},a.areaForSegment=function(a,b,c){return c*(Math.PI*c+2*R(a,b))},a.momentForPoly=function(a,b,c){for(var d=0,e=0,f=b.length,g=0;f>g;g+=2){var h=b[g]+c.x,i=b[g+1]+c.y,j=b[(g+2)%f]+c.x,k=b[(g+3)%f]+c.y,l=G(j,k,h,i),m=y(h,i,h,i)+y(h,i,j,k)+y(j,k,j,k);d+=l*m,e+=l}return a*d/(6*e)},a.areaForPoly=function(a){for(var b=0,c=0,d=a.length;d>c;c+=2)b+=F(new v(a[c],a[c+1]),new v(a[(c+2)%d],a[(c+3)%d]));return-b/2},a.centroidForPoly=function(a){for(var b=0,c=new v(0,0),d=0,e=a.length;e>d;d+=2){var f=new v(a[d],a[d+1]),g=new v(a[(d+2)%e],a[(d+3)%e]),h=F(f,g);b+=h,c=B(c,E(B(f,g),h))}return E(c,1/(3*b))}),n=(a.recenterPoly=function(a){for(var b=m(a),c=0;c<a.length;c+=2)a[c]-=b.x,a[c+1]-=b.y},a.momentForBox=function(a,b,c){return a*(b*b+c*c)/12}),o=(a.momentForBox2=function(a,b){return width=b.r-b.l,height=b.t-b.b,offset=E([b.l+b.r,b.b+b.t],.5),n(a,width,height)+a*L(offset)},a.loopIndexes=function(a){var b,c,d,e,f=0,g=0;b=d=a[0],c=e=a[1];for(var h=a.length>>1,i=1;h>i;i++){var j=a[2*i],k=a[2*i+1];b>j||j==b&&c>k?(b=j,c=k,f=i):(j>d||j==d&&k>e)&&(d=j,e=k,g=i)}return[f,g]}),p=function(a,b,c){var d=a[2*b];a[2*b]=a[2*c],a[2*c]=d,d=a[2*b+1],a[2*b+1]=a[2*c+1],a[2*c+1]=d},q=function(a,b,c,d,e,f){if(0===c)return 0;for(var g=0,h=b,i=C(e,d),j=f*z(i),k=b,l=b+c-1;l>=k;){var m=new v(a[2*k],a[2*k+1]),n=F(i,C(m,d));n>j?(n>g&&(g=n,h=k),k++):(p(a,k,l),l--)}return h!=b&&p(a,b,h),k-b},r=function(a,b,c,d,e,f,g,h){if(0>d)return 0;if(0==d)return b[2*h]=f.x,b[2*h+1]=f.y,1;var i=q(b,c,d,e,f,a),j=new v(b[2*c],b[2*c+1]),k=r(a,b,c+1,i-1,e,j,f,h),l=h+k++;b[2*l]=f.x,b[2*l+1]=f.y;var m=q(b,c+i,d-i,f,g,a),n=new v(b[2*(c+i)],b[2*(c+i)+1]);return k+r(a,b,c+i+1,m-1,f,n,g,h+k)},s=(a.convexHull=function(a,b,c){if(b)for(var d=0;d<a.length;d++)b[d]=a[d];else b=a;var e=o(a),g=e[0],h=e[1];if(g==h)return b.length=2,b;p(b,0,g),p(b,1,0==h?g:h);var i=new v(b[0],b[1]),j=new v(b[2],b[3]),k=a.length>>1,l=r(c,b,2,k-2,i,j,i,1)+1;return b.length=2*l,f(eb(b),"Internal error: cpConvexHull() and cpPolyValidate() did not agree.Please report this error with as much info as you can."),b},function(a,c,e){return b(d(a,c),e)}),t=function(a){return d(0,b(a,1))},u=0,v=a.Vect=function(a,b){this.x=a,this.y=b,u++};a.v=function(a,b){return new v(a,b)};var w=a.vzero=new v(0,0),x=a.v.dot=function(a,b){return a.x*b.x+a.y*b.y},y=function(a,b,c,d){return a*c+b*d},z=a.v.len=function(a){return Math.sqrt(x(a,a))},A=a.v.len2=function(a,b){return Math.sqrt(a*a+b*b)},B=(a.v.eql=function(a,b){return a.x===b.x&&a.y===b.y},a.v.add=function(a,b){return new v(a.x+b.x,a.y+b.y)});v.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this};var C=a.v.sub=function(a,b){return new v(a.x-b.x,a.y-b.y)};v.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this};var D=a.v.neg=function(a){return new v(-a.x,-a.y)};v.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this};var E=a.v.mult=function(a,b){return new v(a.x*b,a.y*b)};v.prototype.mult=function(a){return this.x*=a,this.y*=a,this};var F=a.v.cross=function(a,b){return a.x*b.y-a.y*b.x},G=function(a,b,c,d){return a*d-b*c},H=a.v.perp=function(a){return new v(-a.y,a.x)},I=(a.v.pvrperp=function(a){return new v(a.y,-a.x)},a.v.project=function(a,b){return E(b,x(a,b)/L(b))});v.prototype.project=function(a){return this.mult(x(this,a)/L(a)),this};var J=a.v.rotate=function(a,b){return new v(a.x*b.x-a.y*b.y,a.x*b.y+a.y*b.x)};v.prototype.rotate=function(a){return this.x=this.x*a.x-this.y*a.y,this.y=this.x*a.y+this.y*a.x,this};var K=a.v.unrotate=function(a,b){return new v(a.x*b.x+a.y*b.y,a.y*b.x-a.x*b.y)},L=a.v.lengthsq=function(a){return x(a,a)},M=a.v.lengthsq2=function(a,b){return a*a+b*b},N=a.v.lerp=function(a,b,c){return B(E(a,1-c),E(b,c))},O=a.v.normalize=function(a){return E(a,1/z(a))},P=a.v.normalize_safe=function(a){return 0===a.x&&0===a.y?w:O(a)},Q=a.v.clamp=function(a,b){return x(a,a)>b*b?E(O(a),b):a},R=(a.v.lerpconst=function(a,b,c){return B(a,Q(C(b,a),c))},a.v.dist=function(a,b){return z(C(a,b))}),S=a.v.distsq=function(a,b){return L(C(a,b))},T=(a.v.near=function(a,b,c){return S(a,b)<c*c},a.v.slerp=function(a,b,c){var d=Math.acos(x(a,b));if(d){var e=1/Math.sin(d);return B(E(a,Math.sin((1-c)*d)*e),E(b,Math.sin(c*d)*e))}return a}),U=(a.v.slerpconst=function(a,c,d){var e=Math.acos(x(a,c));return T(a,c,b(d,e)/e)},a.v.forangle=function(a){return new v(Math.cos(a),Math.sin(a))},a.v.toangle=function(a){return Math.atan2(a.y,a.x)},a.v.str=function(a){return"("+a.x.toFixed(3)+", "+a.y.toFixed(3)+")"},0),V=a.BB=function(a,b,c,d){this.l=a,this.b=b,this.r=c,this.t=d,U++};a.bb=function(a,b,c,d){return new V(a,b,c,d)};var W=function(a,b){return new V(a.x-b,a.y-b,a.x+b,a.y+b)},X=function(a,b,c,d,e){return a.l<=d&&b<=a.r&&a.b<=e&&c<=a.t},Y=0,Z=(a.NO_GROUP=0,a.ALL_LAYERS=-1);a.resetShapeIdCounter=function(){Y=0};var $=a.Shape=function(a){this.body=a,this.bb_l=this.bb_b=this.bb_r=this.bb_t=0,this.hashid=Y++,this.sensor=!1,this.e=0,this.u=0,this.surface_v=w,this.collision_type=0,this.group=0,this.layers=Z,this.space=null,this.collisionCode=this.collisionCode};$.prototype.setElasticity=function(a){this.e=a},$.prototype.setFriction=function(a){this.body.activate(),this.u=a},$.prototype.setLayers=function(a){this.body.activate(),this.layers=a},$.prototype.setSensor=function(a){this.body.activate(),this.sensor=a},$.prototype.setCollisionType=function(a){this.body.activate(),this.collision_type=a},$.prototype.getBody=function(){return this.body},$.prototype.active=function(){return this.body&&-1!==this.body.shapeList.indexOf(this)},$.prototype.setBody=function(a){e(!this.active(),"You cannot change the body on an active shape. You must remove the shape from the space before changing the body."),this.body=a},$.prototype.cacheBB=function(){return this.update(this.body.p,this.body.rot)},$.prototype.update=function(a,b){e(!isNaN(b.x),"Rotation is NaN"),e(!isNaN(a.x),"Position is NaN"),this.cacheData(a,b)},$.prototype.pointQuery=function(a){var b=this.nearestPointQuery(a);return b.d<0?b:void 0},$.prototype.getBB=function(){return new V(this.bb_l,this.bb_b,this.bb_r,this.bb_t)};var _=function(a,b,c){this.shape=a,this.p=b,this.d=c},ab=function(a,b,c){this.shape=a,this.t=b,this.n=c};ab.prototype.hitPoint=function(a,b){return N(a,b,this.t)},ab.prototype.hitDist=function(a,b){return R(a,b)*this.t};var bb=a.CircleShape=function(a,b,c){this.c=this.tc=c,this.r=b,this.type="circle",$.call(this,a)};bb.prototype=Object.create($.prototype),bb.prototype.cacheData=function(a,b){var c=this.tc=J(this.c,b).add(a),d=this.r;this.bb_l=c.x-d,this.bb_b=c.y-d,this.bb_r=c.x+d,this.bb_t=c.y+d},bb.prototype.nearestPointQuery=function(a){var b=a.x-this.tc.x,c=a.y-this.tc.y,d=A(b,c),e=this.r,f=new v(this.tc.x+b*e/d,this.tc.y+c*e/d);return new _(this,f,d-e)};var cb=function(a,b,c,d,e){d=C(d,b),e=C(e,b);var f=x(d,d)-2*x(d,e)+x(e,e),g=-2*x(d,d)+2*x(d,e),h=x(d,d)-c*c,i=g*g-4*f*h;if(i>=0){var j=(-g-Math.sqrt(i))/(2*f);if(j>=0&&1>=j)return new ab(a,j,O(N(d,e,j)))}};bb.prototype.segmentQuery=function(a,b){return cb(this,this.tc,this.r,a,b)};var db=a.SegmentShape=function(a,b,c,d){this.a=b,this.b=c,this.n=H(O(C(c,b))),this.ta=this.tb=this.tn=null,this.r=d,this.a_tangent=w,this.b_tangent=w,this.type="segment",$.call(this,a)};db.prototype=Object.create($.prototype),db.prototype.cacheData=function(a,b){this.ta=B(a,J(this.a,b)),this.tb=B(a,J(this.b,b)),this.tn=J(this.n,b);var c,d,e,f;this.ta.x<this.tb.x?(c=this.ta.x,d=this.tb.x):(c=this.tb.x,d=this.ta.x),this.ta.y<this.tb.y?(e=this.ta.y,f=this.tb.y):(e=this.tb.y,f=this.ta.y);var g=this.r;this.bb_l=c-g,this.bb_b=e-g,this.bb_r=d+g,this.bb_t=f+g},db.prototype.nearestPointQuery=function(a){var b=k(a,this.ta,this.tb),c=a.x-b.x,d=a.y-b.y,e=A(c,d),f=this.r,g=e?B(b,E(new v(c,d),f/e)):b;return new _(this,g,e-f)},db.prototype.segmentQuery=function(a,b){var c=this.tn,d=x(C(this.ta,a),c),e=this.r,f=d>0?D(c):c,g=C(E(f,e),a),h=B(this.ta,g),i=B(this.tb,g),j=C(b,a);if(F(j,h)*F(j,i)<=0){var k=d+(d>0?-e:e),l=-k,m=x(j,c)-k;if(0>l*m)return new ab(this,l/(l-m),f)}else if(0!==e){var n=cb(this,this.ta,this.r,a,b),o=cb(this,this.tb,this.r,a,b);return n?o&&o.t<n.t?o:n:o}},db.prototype.setNeighbors=function(a,b){this.a_tangent=C(a,this.a),this.b_tangent=C(b,this.b)},db.prototype.setEndpoints=function(a,b){this.a=a,this.b=b,this.n=H(O(C(b,a)))};var eb=function(a){for(var b=a.length,c=0;b>c;c+=2){var d=a[c],e=a[c+1],f=a[(c+2)%b],g=a[(c+3)%b],h=a[(c+4)%b],i=a[(c+5)%b];if(G(f-d,g-e,h-f,i-g)>0)return!1}return!0},fb=a.PolyShape=function(a,b,c){this.setVerts(b,c),this.type="poly",$.call(this,a)};fb.prototype=Object.create($.prototype);var gb=function(a,b){this.n=a,this.d=b};gb.prototype.compare=function(a){return x(this.n,a)-this.d},fb.prototype.setVerts=function(a,b){e(a.length>=4,"Polygons require some verts"),e("number"==typeof a[0],"Polygon verticies should be specified in a flattened list (eg [x1,y1,x2,y2,x3,y3,...])"),e(eb(a),"Polygon is concave or has a reversed winding. Consider using cpConvexHull()");var c=a.length,d=c>>1;this.verts=new Array(c),this.tVerts=new Array(c),this.planes=new Array(d),this.tPlanes=new Array(d);for(var f=0;c>f;f+=2){var g=a[f]+b.x,h=a[f+1]+b.y,i=a[(f+2)%c]+b.x,j=a[(f+3)%c]+b.y,k=O(H(new v(i-g,j-h)));this.verts[f]=g,this.verts[f+1]=h,this.planes[f>>1]=new gb(k,y(k.x,k.y,g,h)),this.tPlanes[f>>1]=new gb(new v(0,0),0)}};var hb=(a.BoxShape=function(a,b,c){var d=b/2,e=c/2;return hb(a,new V(-d,-e,d,e))},a.BoxShape2=function(a,b){var c=[b.l,b.b,b.l,b.t,b.r,b.t,b.r,b.b];return new fb(a,c,w)});fb.prototype.transformVerts=function(a,c){for(var e=this.verts,f=this.tVerts,g=1/0,h=-1/0,i=1/0,j=-1/0,k=0;k<e.length;k+=2){var l=e[k],m=e[k+1],n=a.x+l*c.x-m*c.y,o=a.y+l*c.y+m*c.x;f[k]=n,f[k+1]=o,g=b(g,n),h=d(h,n),i=b(i,o),j=d(j,o)}this.bb_l=g,this.bb_b=i,this.bb_r=h,this.bb_t=j},fb.prototype.transformAxes=function(a,b){for(var c=this.planes,d=this.tPlanes,e=0;e<c.length;e++){var f=J(c[e].n,b);d[e].n=f,d[e].d=x(a,f)+c[e].d}},fb.prototype.cacheData=function(a,b){this.transformAxes(a,b),this.transformVerts(a,b)},fb.prototype.nearestPointQuery=function(a){for(var b=this.tPlanes,c=this.tVerts,d=c[c.length-2],e=c[c.length-1],f=1/0,g=w,h=!1,i=0;i<b.length;i++){b[i].compare(a)>0&&(h=!0);var j=c[2*i],k=c[2*i+1],m=l(a.x,a.y,d,e,j,k),n=R(a,m);f>n&&(f=n,g=m),d=j,e=k}return new _(this,g,h?f:-f)},fb.prototype.segmentQuery=function(a,b){for(var c=this.tPlanes,d=this.tVerts,e=c.length,f=2*e,g=0;e>g;g++){var h=c[g].n,i=x(a,h);if(!(c[g].d>i)){var j=x(b,h),k=(c[g].d-i)/(j-i);if(!(0>k||k>1)){var l=N(a,b,k),m=-F(h,l),n=-G(h.x,h.y,d[2*g],d[2*g+1]),o=-G(h.x,h.y,d[(2*g+2)%f],d[(2*g+3)%f]);if(m>=n&&o>=m)return new ab(this,k,h)}}}},fb.prototype.valueOnAxis=function(a,c){for(var d=this.tVerts,e=y(a.x,a.y,d[0],d[1]),f=2;f<d.length;f+=2)e=b(e,y(a.x,a.y,d[f],d[f+1]));return e-c},fb.prototype.containsVert=function(a,b){for(var c=this.tPlanes,d=0;d<c.length;d++){var e=c[d].n,f=y(e.x,e.y,a,b)-c[d].d;if(f>0)return!1}return!0},fb.prototype.containsVertPartial=function(a,b,c){for(var d=this.tPlanes,e=0;e<d.length;e++){var f=d[e].n;if(!(x(f,c)<0)){var g=y(f.x,f.y,a,b)-d[e].d;if(g>0)return!1}}return!0},fb.prototype.getNumVerts=function(){return this.verts.length/2},fb.prototype.getVert=function(a){return new v(this.verts[2*a],this.verts[2*a+1])};var ib=a.Body=function(a,b){this.p=new v(0,0),this.vx=this.vy=0,this.f=new v(0,0),this.w=0,this.t=0,this.v_limit=1/0,this.w_limit=1/0,this.v_biasx=this.v_biasy=0,this.w_bias=0,this.space=null,this.shapeList=[],this.arbiterList=null,this.constraintList=null,this.nodeRoot=null,this.nodeNext=null,this.nodeIdleTime=0,this.setMass(a),this.setMoment(b),this.rot=new v(0,0),this.setAngle(0)};if("undefined"!=typeof DEBUG&&DEBUG){var jb=function(a,b){e(a.x==a.x&&a.y==a.y,b)},kb=function(a,b){e(1/0!==Math.abs(a.x)&&1/0!==Math.abs(a.y),b)},lb=function(a,b){jb(a,b),kb(a,b)};ib.prototype.sanityCheck=function(){e(this.m===this.m&&this.m_inv===this.m_inv,"Body's mass is invalid."),e(this.i===this.i&&this.i_inv===this.i_inv,"Body's moment is invalid."),lb(this.p,"Body's position is invalid."),lb(this.f,"Body's force is invalid."),e(this.vx===this.vx&&1/0!==Math.abs(this.vx),"Body's velocity is invalid."),e(this.vy===this.vy&&1/0!==Math.abs(this.vy),"Body's velocity is invalid."),e(this.a===this.a&&1/0!==Math.abs(this.a),"Body's angle is invalid."),e(this.w===this.w&&1/0!==Math.abs(this.w),"Body's angular velocity is invalid."),e(this.t===this.t&&1/0!==Math.abs(this.t),"Body's torque is invalid."),lb(this.rot,"Body's rotation vector is invalid."),e(this.v_limit===this.v_limit,"Body's velocity limit is invalid."),e(this.w_limit===this.w_limit,"Body's angular velocity limit is invalid.")}}else ib.prototype.sanityCheck=function(){};ib.prototype.getPos=function(){return this.p},ib.prototype.getVel=function(){return new v(this.vx,this.vy)},ib.prototype.getAngVel=function(){return this.w},ib.prototype.isSleeping=function(){return null!==this.nodeRoot},ib.prototype.isStatic=function(){return 1/0===this.nodeIdleTime},ib.prototype.isRogue=function(){return null===this.space},ib.prototype.setMass=function(a){e(a>0,"Mass must be positive and non-zero."),this.activate(),this.m=a,this.m_inv=1/a},ib.prototype.setMoment=function(a){e(a>0,"Moment of Inertia must be positive and non-zero."),this.activate(),this.i=a,this.i_inv=1/a},ib.prototype.addShape=function(a){this.shapeList.push(a)},ib.prototype.removeShape=function(a){j(this.shapeList,a)};var mb=function(a,b,c){return a===c?a.next(b):(a.a===b?a.next_a=mb(a.next_a,b,c):a.next_b=mb(a.next_b,b,c),a)};ib.prototype.removeConstraint=function(a){this.constraintList=mb(this.constraintList,this,a)},ib.prototype.setPos=function(b){this.activate(),this.sanityCheck(),b===w&&(b=a.v(0,0)),this.p=b},ib.prototype.setVel=function(a){this.activate(),this.vx=a.x,this.vy=a.y},ib.prototype.setAngVel=function(a){this.activate(),this.w=a},ib.prototype.setAngleInternal=function(a){e(!isNaN(a),"Internal Error: Attempting to set body's angle to NaN"),this.a=a,this.rot.x=Math.cos(a),this.rot.y=Math.sin(a)},ib.prototype.setAngle=function(a){this.activate(),this.sanityCheck(),this.setAngleInternal(a)},ib.prototype.velocity_func=function(a,b,c){var d=this.vx*b+(a.x+this.f.x*this.m_inv)*c,e=this.vy*b+(a.y+this.f.y*this.m_inv)*c,f=this.v_limit,g=d*d+e*e,h=g>f*f?f/Math.sqrt(g):1;this.vx=d*h,this.vy=e*h;var i=this.w_limit;this.w=s(this.w*b+this.t*this.i_inv*c,-i,i),this.sanityCheck()},ib.prototype.position_func=function(a){this.p.x+=(this.vx+this.v_biasx)*a,this.p.y+=(this.vy+this.v_biasy)*a,this.setAngleInternal(this.a+(this.w+this.w_bias)*a),this.v_biasx=this.v_biasy=0,this.w_bias=0,this.sanityCheck()},ib.prototype.resetForces=function(){this.activate(),this.f=new v(0,0),this.t=0},ib.prototype.applyForce=function(a,b){this.activate(),this.f=B(this.f,a),this.t+=F(b,a)},ib.prototype.applyImpulse=function(a,b){this.activate(),oc(this,a.x,a.y,b)},ib.prototype.getVelAtPoint=function(a){return B(new v(this.vx,this.vy),E(H(a),this.w))},ib.prototype.getVelAtWorldPoint=function(a){return this.getVelAtPoint(C(a,this.p))},ib.prototype.getVelAtLocalPoint=function(a){return this.getVelAtPoint(J(a,this.rot))},ib.prototype.eachShape=function(a){for(var b=0,c=this.shapeList.length;c>b;b++)a(this.shapeList[b])},ib.prototype.eachConstraint=function(a){for(var b=this.constraintList;b;){var c=b.next(this);a(b),b=c}},ib.prototype.eachArbiter=function(a){for(var b=this.arbiterList;b;){var c=b.next(this);b.swappedColl=this===b.body_b,a(b),b=c}},ib.prototype.local2World=function(a){return B(this.p,J(a,this.rot))},ib.prototype.world2Local=function(a){return K(C(a,this.p),this.rot)},ib.prototype.kineticEnergy=function(){var a=this.vx*this.vx+this.vy*this.vy,b=this.w*this.w;return(a?a*this.m:0)+(b?b*this.i:0)};var nb=a.SpatialIndex=function(a){if(this.staticIndex=a,a){if(a.dynamicIndex)throw new Error("This static index is already associated with a dynamic index.");a.dynamicIndex=this}};nb.prototype.collideStatic=function(a,b){if(a.count>0){var c=a.query;this.each(function(a){c(a,new V(a.bb_l,a.bb_b,a.bb_r,a.bb_t),b)})}};var ob=a.BBTree=function(a){nb.call(this,a),this.velocityFunc=null,this.leaves={},this.count=0,this.root=null,this.pooledNodes=null,this.pooledPairs=null,this.stamp=0};ob.prototype=Object.create(nb.prototype);var pb=0,qb=function(a,c,e){this.obj=null,this.bb_l=b(c.bb_l,e.bb_l),this.bb_b=b(c.bb_b,e.bb_b),this.bb_r=d(c.bb_r,e.bb_r),this.bb_t=d(c.bb_t,e.bb_t),this.parent=null,this.setA(c),this.setB(e)};ob.prototype.makeNode=function(a,b){var c=this.pooledNodes;return c?(this.pooledNodes=c.parent,c.constructor(this,a,b),c):(pb++,new qb(this,a,b))};var rb=0,sb=function(a,b){this.obj=b,a.getBB(b,this),this.parent=null,this.stamp=1,this.pairs=null,rb++};ob.prototype.getBB=function(a,c){var e=this.velocityFunc;if(e){var f=.1,g=(a.bb_r-a.bb_l)*f,h=(a.bb_t-a.bb_b)*f,i=E(e(a),.1);c.bb_l=a.bb_l+b(-g,i.x),c.bb_b=a.bb_b+b(-h,i.y),c.bb_r=a.bb_r+d(g,i.x),c.bb_t=a.bb_t+d(h,i.y)}else c.bb_l=a.bb_l,c.bb_b=a.bb_b,c.bb_r=a.bb_r,c.bb_t=a.bb_t},ob.prototype.getStamp=function(){var a=this.dynamicIndex;return a&&a.stamp?a.stamp:this.stamp},ob.prototype.incrementStamp=function(){this.dynamicIndex&&this.dynamicIndex.stamp?this.dynamicIndex.stamp++:this.stamp++};var tb=0,ub=function(a,b,c,d){this.prevA=null,this.leafA=a,this.nextA=b,this.prevB=null,this.leafB=c,this.nextB=d};ob.prototype.makePair=function(a,b,c,d){var e=this.pooledPairs;return e?(this.pooledPairs=e.prevA,e.prevA=null,e.leafA=a,e.nextA=b,e.prevB=null,e.leafB=c,e.nextB=d,e):(tb++,new ub(a,b,c,d))},ub.prototype.recycle=function(a){this.prevA=a.pooledPairs,a.pooledPairs=this};var vb=function(a,b,c){c&&(c.leafA===b?c.prevA=a:c.prevB=a),a?a.leafA===b?a.nextA=c:a.nextB=c:b.pairs=c};sb.prototype.clearPairs=function(a){var b,c=this.pairs;for(this.pairs=null;c;)c.leafA===this?(b=c.nextA,vb(c.prevB,c.leafB,c.nextB)):(b=c.nextB,vb(c.prevA,c.leafA,c.nextA)),c.recycle(a),c=b};var wb=function(a,b,c){var d=a.pairs,e=b.pairs,f=c.makePair(a,d,b,e);a.pairs=b.pairs=f,d&&(d.leafA===a?d.prevA=f:d.prevB=f),e&&(e.leafA===b?e.prevA=f:e.prevB=f)};qb.prototype.recycle=function(a){this.parent=a.pooledNodes,a.pooledNodes=this},sb.prototype.recycle=function(){},qb.prototype.setA=function(a){this.A=a,a.parent=this},qb.prototype.setB=function(a){this.B=a,a.parent=this},sb.prototype.isLeaf=!0,qb.prototype.isLeaf=!1,qb.prototype.otherChild=function(a){return this.A==a?this.B:this.A},qb.prototype.replaceChild=function(a,c,e){f(a==this.A||a==this.B,"Node is not a child of parent."),this.A==a?(this.A.recycle(e),this.setA(c)):(this.B.recycle(e),this.setB(c));for(var g=this;g;g=g.parent){var h=g.A,i=g.B;g.bb_l=b(h.bb_l,i.bb_l),g.bb_b=b(h.bb_b,i.bb_b),g.bb_r=d(h.bb_r,i.bb_r),g.bb_t=d(h.bb_t,i.bb_t)}},qb.prototype.bbArea=sb.prototype.bbArea=function(){return(this.bb_r-this.bb_l)*(this.bb_t-this.bb_b)};var xb=function(a,c){return(d(a.bb_r,c.bb_r)-b(a.bb_l,c.bb_l))*(d(a.bb_t,c.bb_t)-b(a.bb_b,c.bb_b))},yb=function(a,b){return Math.abs(a.bb_l+a.bb_r-b.bb_l-b.bb_r)+Math.abs(a.bb_b+a.bb_t-b.bb_b-b.bb_t)},zb=function(a,c,e){if(null==a)return c;if(a.isLeaf)return e.makeNode(c,a);var f=a.B.bbArea()+xb(a.A,c),g=a.A.bbArea()+xb(a.B,c);return f===g&&(f=yb(a.A,c),g=yb(a.B,c)),f>g?a.setB(zb(a.B,c,e)):a.setA(zb(a.A,c,e)),a.bb_l=b(a.bb_l,c.bb_l),a.bb_b=b(a.bb_b,c.bb_b),a.bb_r=d(a.bb_r,c.bb_r),a.bb_t=d(a.bb_t,c.bb_t),a};qb.prototype.intersectsBB=sb.prototype.intersectsBB=function(a){return this.bb_l<=a.r&&a.l<=this.bb_r&&this.bb_b<=a.t&&a.b<=this.bb_t};var Ab=function(a,b,c){a.intersectsBB(b)&&(a.isLeaf?c(a.obj):(Ab(a.A,b,c),Ab(a.B,b,c)))},Bb=function(a,c,e){var f=1/(e.x-c.x),g=a.bb_l==c.x?-1/0:(a.bb_l-c.x)*f,h=a.bb_r==c.x?1/0:(a.bb_r-c.x)*f,i=b(g,h),j=d(g,h),k=1/(e.y-c.y),l=a.bb_b==c.y?-1/0:(a.bb_b-c.y)*k,m=a.bb_t==c.y?1/0:(a.bb_t-c.y)*k,n=b(l,m),o=d(l,m);if(j>=n&&o>=i){var p=d(i,n),q=b(j,o);if(q>=0&&1>=p)return d(p,0)}return 1/0},Cb=function(a,c,d,e,f){if(a.isLeaf)return f(a.obj);var g=Bb(a.A,c,d),h=Bb(a.B,c,d);return h>g?(e>g&&(e=b(e,Cb(a.A,c,d,e,f))),e>h&&(e=b(e,Cb(a.B,c,d,e,f)))):(e>h&&(e=b(e,Cb(a.B,c,d,e,f))),e>g&&(e=b(e,Cb(a.A,c,d,e,f)))),e};ob.prototype.subtreeRecycle=function(a){a.isLeaf&&(this.subtreeRecycle(a.A),this.subtreeRecycle(a.B),a.recycle(this))};var Db=function(a,b,c){if(b==a)return null;var d=b.parent;if(d==a){var e=a.otherChild(b);return e.parent=a.parent,a.recycle(c),e}return d.parent.replaceChild(d,d.otherChild(b),c),a},Eb=function(a,b){return a.bb_l<=b.bb_r&&b.bb_l<=a.bb_r&&a.bb_b<=b.bb_t&&b.bb_b<=a.bb_t};sb.prototype.markLeafQuery=function(a,b,c,d){Eb(a,this)&&(b?wb(a,this,c):(this.stamp<a.stamp&&wb(this,a,c),d&&d(a.obj,this.obj)))},qb.prototype.markLeafQuery=function(a,b,c,d){Eb(a,this)&&(this.A.markLeafQuery(a,b,c,d),this.B.markLeafQuery(a,b,c,d))},sb.prototype.markSubtree=function(a,b,c){if(this.stamp==a.getStamp()){b&&b.markLeafQuery(this,!1,a,c);for(var d=this;d.parent;d=d.parent)d==d.parent.A?d.parent.B.markLeafQuery(this,!0,a,c):d.parent.A.markLeafQuery(this,!1,a,c)}else for(var e=this.pairs;e;)this===e.leafB?(c&&c(e.leafA.obj,this.obj),e=e.nextB):e=e.nextA},qb.prototype.markSubtree=function(a,b,c){this.A.markSubtree(a,b,c),this.B.markSubtree(a,b,c)},sb.prototype.containsObj=function(a){return this.bb_l<=a.bb_l&&this.bb_r>=a.bb_r&&this.bb_b<=a.bb_b&&this.bb_t>=a.bb_t},sb.prototype.update=function(a){var b=a.root,c=this.obj;return this.containsObj(c)?!1:(a.getBB(this.obj,this),b=Db(b,this,a),a.root=zb(b,this,a),this.clearPairs(a),this.stamp=a.getStamp(),!0)},sb.prototype.addPairs=function(a){var b=a.dynamicIndex;if(b){var c=b.root;c&&c.markLeafQuery(this,!0,b,null)}else{var d=a.staticIndex.root;this.markSubtree(a,d,null)}},ob.prototype.insert=function(a,b){var c=new sb(this,a);this.leaves[b]=c,this.root=zb(this.root,c,this),this.count++,c.stamp=this.getStamp(),c.addPairs(this),this.incrementStamp()},ob.prototype.remove=function(a,b){var c=this.leaves[b];delete this.leaves[b],this.root=Db(this.root,c,this),this.count--,c.clearPairs(this),c.recycle(this)},ob.prototype.contains=function(a,b){return null!=this.leaves[b]};var Fb=function(){};ob.prototype.reindexQuery=function(a){if(this.root){var b,c=this.leaves;for(b in c)c[b].update(this);var d=this.staticIndex,e=d&&d.root;this.root.markSubtree(this,e,a),d&&!e&&this.collideStatic(this,d,a),this.incrementStamp()}},ob.prototype.reindex=function(){this.reindexQuery(Fb)},ob.prototype.reindexObject=function(a,b){var c=this.leaves[b];c&&(c.update(this)&&c.addPairs(this),this.incrementStamp())},ob.prototype.pointQuery=function(a,b){this.query(new V(a.x,a.y,a.x,a.y),b)},ob.prototype.segmentQuery=function(a,b,c,d){this.root&&Cb(this.root,a,b,c,d)},ob.prototype.query=function(a,b){this.root&&Ab(this.root,a,b)},ob.prototype.count=function(){return this.count},ob.prototype.each=function(a){var b;for(b in this.leaves)a(this.leaves[b].obj)};var Gb=function(a,c,e,f,g){return(d(a.bb_r,f)-b(a.bb_l,c))*(d(a.bb_t,g)-b(a.bb_b,e))},Hb=function(a,c,e,f){if(1==f)return c[e];if(2==f)return a.makeNode(c[e],c[e+1]);for(var g=c[e],h=g.bb_l,i=g.bb_b,j=g.bb_r,k=g.bb_t,l=e+f,m=e+1;l>m;m++)g=c[m],h=b(h,g.bb_l),i=b(i,g.bb_b),j=d(j,g.bb_r),k=d(k,g.bb_t);var n=j-h>k-i,o=new Array(2*f);if(n)for(var m=e;l>m;m++)o[2*m+0]=c[m].bb_l,o[2*m+1]=c[m].bb_r;else for(var m=e;l>m;m++)o[2*m+0]=c[m].bb_b,o[2*m+1]=c[m].bb_t;o.sort(function(a,b){return a-b});var p=.5*(o[f-1]+o[f]),q=h,r=i,s=j,t=k,u=h,v=i,w=j,x=k;n?s=u=p:t=v=p;for(var y=l,z=e;y>z;){var g=c[z];Gb(g,u,v,w,x)<Gb(g,q,r,s,t)?(y--,c[z]=c[y],c[y]=g):z++}if(y==f){for(var g=null,m=e;l>m;m++)g=zb(g,c[m],a);return g}return NodeNew(a,Hb(a,c,e,y-e),Hb(a,c,y,l-y))};ob.prototype.optimize=function(){var a=new Array(this.count),b=0;for(var c in this.leaves)a[b++]=this.nodes[c];tree.subtreeRecycle(root),this.root=Hb(tree,a,a.length)};var Ib=function(a,b){!a.isLeaf&&10>=b&&(Ib(a.A,b+1),Ib(a.B,b+1));for(var c="",d=0;b>d;d++)c+=" ";console.log(c+a.bb_b+" "+a.bb_t)};ob.prototype.log=function(){this.root&&Ib(this.root,0)};var Jb=a.CollisionHandler=function(){this.a=this.b=0};Jb.prototype.begin=function(){return!0},Jb.prototype.preSolve=function(){return!0},Jb.prototype.postSolve=function(){},Jb.prototype.separate=function(){};var Kb=function(a,b){this.e=0,this.u=0,this.surface_vr=w,this.a=a,this.body_a=a.body,this.b=b,this.body_b=b.body,this.thread_a_next=this.thread_a_prev=null,this.thread_b_next=this.thread_b_prev=null,this.contacts=null,this.stamp=0,this.handler=null,this.swappedColl=!1,this.state="first coll"};Kb.prototype.getShapes=function(){return this.swappedColl?[this.b,this.a]:[this.a,this.b]},Kb.prototype.totalImpulse=function(){for(var a=this.contacts,b=new v(0,0),c=0,d=a.length;d>c;c++){var e=a[c];b.add(E(e.n,e.jnAcc))}return this.swappedColl?b:b.neg()},Kb.prototype.totalImpulseWithFriction=function(){for(var a=this.contacts,b=new v(0,0),c=0,d=a.length;d>c;c++){var e=a[c];b.add(new v(e.jnAcc,e.jtAcc).rotate(e.n))}return this.swappedColl?b:b.neg()},Kb.prototype.totalKE=function(){for(var a=(1-this.e)/(1+this.e),b=0,c=this.contacts,d=0,e=c.length;e>d;d++){var f=c[d],g=f.jnAcc,h=f.jtAcc;b+=a*g*g/f.nMass+h*h/f.tMass}return b},Kb.prototype.ignore=function(){this.state="ignore"},Kb.prototype.getA=function(){return this.swappedColl?this.b:this.a},Kb.prototype.getB=function(){return this.swappedColl?this.a:this.b},Kb.prototype.isFirstContact=function(){return"first coll"===this.state};var Lb=function(a,b,c){this.point=a,this.normal=b,this.dist=c};Kb.prototype.getContactPointSet=function(){var a,b=new Array(this.contacts.length);for(a=0;a<b.length;a++)b[a]=new Lb(this.contacts[a].p,this.contacts[a].n,this.contacts[a].dist);return b},Kb.prototype.getNormal=function(a){var b=this.contacts[a].n;return this.swappedColl?D(b):b},Kb.prototype.getPoint=function(a){return this.contacts[a].p},Kb.prototype.getDepth=function(a){return this.contacts[a].dist};var Mb=function(a,b,c,d){c?c.body_a===b?c.thread_a_next=d:c.thread_b_next=d:b.arbiterList=d,d&&(d.body_a===b?d.thread_a_prev=c:d.thread_b_prev=c)};Kb.prototype.unthread=function(){Mb(this,this.body_a,this.thread_a_prev,this.thread_a_next),Mb(this,this.body_b,this.thread_b_prev,this.thread_b_next),this.thread_a_prev=this.thread_a_next=null,this.thread_b_prev=this.thread_b_next=null},Kb.prototype.update=function(a,b,c,d){if(this.contacts)for(var e=0;e<this.contacts.length;e++)for(var f=this.contacts[e],g=0;g<a.length;g++){var h=a[g];h.hash===f.hash&&(h.jnAcc=f.jnAcc,h.jtAcc=f.jtAcc)}this.contacts=a,this.handler=b,this.swappedColl=c.collision_type!==b.a,this.e=c.e*d.e,this.u=c.u*d.u,this.surface_vr=C(c.surface_v,d.surface_v),this.a=c,this.body_a=c.body,this.b=d,this.body_b=d.body,"cached"==this.state&&(this.state="first coll")},Kb.prototype.preStep=function(a,c,d){for(var e=this.body_a,f=this.body_b,g=0;g<this.contacts.length;g++){var h=this.contacts[g];h.r1=C(h.p,e.p),h.r2=C(h.p,f.p),h.nMass=1/sc(e,f,h.r1,h.r2,h.n),h.tMass=1/sc(e,f,h.r1,h.r2,H(h.n)),h.bias=-d*b(0,h.dist+c)/a,h.jBias=0,h.bounce=nc(e,f,h.r1,h.r2,h.n)*this.e}},Kb.prototype.applyCachedImpulse=function(a){if(!this.isFirstContact())for(var b=this.body_a,c=this.body_b,d=0;d<this.contacts.length;d++){var e=this.contacts[d],f=e.n.x,g=e.n.y,h=f*e.jnAcc-g*e.jtAcc,i=f*e.jtAcc+g*e.jnAcc;pc(b,c,e.r1,e.r2,h*a,i*a)}};var Nb=0,Ob=0;Kb.prototype.applyImpulse=function(){Nb++;for(var a=this.body_a,b=this.body_b,c=this.surface_vr,e=this.u,f=0;f<this.contacts.length;f++){Ob++;var g=this.contacts[f],h=g.nMass,i=g.n,j=g.r1,k=g.r2,l=b.vx-k.y*b.w-(a.vx-j.y*a.w),m=b.vy+k.x*b.w-(a.vy+j.x*a.w),n=i.x*(b.v_biasx-k.y*b.w_bias-a.v_biasx+j.y*a.w_bias)+i.y*(k.x*b.w_bias+b.v_biasy-j.x*a.w_bias-a.v_biasy),o=y(l,m,i.x,i.y),p=y(l+c.x,m+c.y,-i.y,i.x),q=(g.bias-n)*h,r=g.jBias;g.jBias=d(r+q,0);var t=-(g.bounce+o)*h,u=g.jnAcc;g.jnAcc=d(u+t,0);var v=e*g.jnAcc,w=-p*g.tMass,x=g.jtAcc;g.jtAcc=s(x+w,-v,v);var z=i.x*(g.jBias-r),A=i.y*(g.jBias-r);qc(a,-z,-A,j),qc(b,z,A,k);var B=g.jnAcc-u,C=g.jtAcc-x;pc(a,b,j,k,i.x*B-i.y*C,i.x*C+i.y*B)}},Kb.prototype.callSeparate=function(a){var b=a.lookupHandler(this.a.collision_type,this.b.collision_type);b.separate(this,a)},Kb.prototype.next=function(a){return this.body_a==a?this.thread_a_next:this.thread_b_next};var Pb=0,Qb=function(a,b,c,d){this.p=a,this.n=b,this.dist=c,this.r1=this.r2=w,this.nMass=this.tMass=this.bounce=this.bias=0,this.jnAcc=this.jtAcc=this.jBias=0,this.hash=d,Pb++},Rb=[],Sb=function(a,b,c,d){var e=c+d,f=C(b,a),g=L(f);if(!(g>=e*e)){var h=Math.sqrt(g);return new Qb(B(a,E(f,.5+(c-.5*e)/(h?h:1/0))),h?E(f,1/h):new v(1,0),h-e,0)}},Tb=function(a,b){var c=Sb(a.tc,b.tc,a.r,b.r);return c?[c]:Rb},Ub=function(a,b){var c=b.ta,d=b.tb,e=a.tc,f=C(d,c),g=t(x(f,C(e,c))/L(f)),h=B(c,E(f,g)),i=Sb(e,h,a.r,b.r);if(i){var j=i.n;return 0===g&&x(j,b.a_tangent)<0||1===g&&x(j,b.b_tangent)<0?Rb:[i]}return Rb},Vb=0,Wb=function(a,b){var c=0,d=a.valueOnAxis(b[0].n,b[0].d);if(d>0)return-1;for(var e=1;e<b.length;e++){var f=a.valueOnAxis(b[e].n,b[e].d);if(f>0)return-1;f>d&&(d=f,c=e)}return Vb=d,c},Xb=function(a,b,c,d){for(var e=[],f=a.tVerts,g=0;g<f.length;g+=2){var h=f[g],j=f[g+1];b.containsVertPartial(h,j,D(c))&&e.push(new Qb(new v(h,j),c,d,i(a.hashid,g)))}for(var k=b.tVerts,g=0;g<k.length;g+=2){var h=k[g],j=k[g+1];a.containsVertPartial(h,j,c)&&e.push(new Qb(new v(h,j),c,d,i(b.hashid,g)))}return e},Yb=function(a,b,c,d){for(var e=[],f=a.tVerts,g=0;g<f.length;g+=2){var h=f[g],j=f[g+1];b.containsVert(h,j)&&e.push(new Qb(new v(h,j),c,d,i(a.hashid,g>>1)))}for(var k=b.tVerts,g=0;g<k.length;g+=2){var h=k[g],j=k[g+1];a.containsVert(h,j)&&e.push(new Qb(new v(h,j),c,d,i(b.hashid,g>>1)))}return e.length?e:Xb(a,b,c,d)},Zb=function(a,b){var c=Wb(b,a.tPlanes);if(-1==c)return Rb;var d=Vb,e=Wb(a,b.tPlanes);if(-1==e)return Rb;var f=Vb;return d>f?Yb(a,b,a.tPlanes[c].n,d):Yb(a,b,D(b.tPlanes[e].n),f)},$b=function(a,c,d){var e=x(c,a.ta)-a.r,f=x(c,a.tb)-a.r;return b(e,f)-d},_b=function(a,b,c,d,e){for(var f=F(b.tn,b.ta),g=F(b.tn,b.tb),h=E(b.tn,e),j=c.tVerts,k=0;k<j.length;k+=2){var l=j[k],m=j[k+1];if(y(l,m,h.x,h.y)<x(b.tn,b.ta)*e+b.r){var n=G(b.tn.x,b.tn.y,l,m);f>=n&&n>=g&&a.push(new Qb(new v(l,m),h,d,i(c.hashid,k)))}}},ac=function(a,b){var c=[],d=b.tPlanes,e=d.length,f=x(a.tn,a.ta),g=b.valueOnAxis(a.tn,f)-a.r,h=b.valueOnAxis(D(a.tn),-f)-a.r;if(h>0||g>0)return Rb;var j=0,k=$b(a,d[0].n,d[0].d);if(k>0)return Rb;for(var l=0;e>l;l++){var m=$b(a,d[l].n,d[l].d);if(m>0)return Rb;m>k&&(k=m,j=l)}var n=D(d[j].n),o=B(a.ta,E(n,a.r)),p=B(a.tb,E(n,a.r));if(b.containsVert(o.x,o.y)&&c.push(new Qb(o,n,k,i(a.hashid,0))),b.containsVert(p.x,p.y)&&c.push(new Qb(p,n,k,i(a.hashid,1))),(g>=k||h>=k)&&(g>h?_b(c,a,b,g,1):_b(c,a,b,h,-1)),0===c.length){var q,r=2*j,s=b.tVerts,t=new v(s[r],s[r+1]);
if(q=Sb(a.ta,t,a.r,0,c))return[q];if(q=Sb(a.tb,t,a.r,0,c))return[q];var u=2*e,w=new v(s[(r+2)%u],s[(r+3)%u]);if(q=Sb(a.ta,w,a.r,0,c))return[q];if(q=Sb(a.tb,w,a.r,0,c))return[q]}return c},bc=function(a,b){for(var c=b.tPlanes,d=0,e=x(c[0].n,a.tc)-c[0].d-a.r,f=0;f<c.length;f++){var g=x(c[f].n,a.tc)-c[f].d-a.r;if(g>0)return Rb;g>e&&(e=g,d=f)}var h=c[d].n,i=b.tVerts,j=i.length,k=d<<1,l=i[k],m=i[k+1],n=i[(k+2)%j],o=i[(k+3)%j],p=G(h.x,h.y,l,m),q=G(h.x,h.y,n,o),r=F(h,a.tc);if(q>r){var s=Sb(a.tc,new v(n,o),a.r,0,s);return s?[s]:Rb}if(p>r)return[new Qb(C(a.tc,E(h,a.r+e/2)),D(h),e,0)];var s=Sb(a.tc,new v(l,m),a.r,0,s);return s?[s]:Rb};bb.prototype.collisionCode=0,db.prototype.collisionCode=1,fb.prototype.collisionCode=2,bb.prototype.collisionTable=[Tb,Ub,bc],db.prototype.collisionTable=[null,function(){return Rb},ac],fb.prototype.collisionTable=[null,null,Zb];var cc=a.collideShapes=function(a,b){return e(a.collisionCode<=b.collisionCode,"Collided shapes must be sorted by type"),a.collisionTable[b.collisionCode](a,b)},dc=new Jb,ec=a.Space=function(){this.stamp=0,this.curr_dt=0,this.bodies=[],this.rousedBodies=[],this.sleepingComponents=[],this.staticShapes=new ob(null),this.activeShapes=new ob(this.staticShapes),this.arbiters=[],this.contactBuffersHead=null,this.cachedArbiters={},this.constraints=[],this.locked=0,this.collisionHandlers={},this.defaultHandler=dc,this.postStepCallbacks=[],this.iterations=10,this.gravity=w,this.damping=1,this.idleSpeedThreshold=0,this.sleepTimeThreshold=1/0,this.collisionSlop=.1,this.collisionBias=Math.pow(.9,60),this.collisionPersistence=3,this.enableContactGraph=!1,this.staticBody=new ib(1/0,1/0),this.staticBody.nodeIdleTime=1/0,this.collideShapes=this.makeCollideShapes()};ec.prototype.getCurrentTimeStep=function(){return this.curr_dt},ec.prototype.setIterations=function(a){this.iterations=a},ec.prototype.isLocked=function(){return this.locked};var fc=function(a){e(!a.locked,"This addition/removal cannot be done safely during a call to cpSpaceStep()  or during a query. Put these calls into a post-step callback.")};ec.prototype.addCollisionHandler=function(a,b,c,d,e,f){fc(this),this.removeCollisionHandler(a,b);var g=new Jb;g.a=a,g.b=b,c&&(g.begin=c),d&&(g.preSolve=d),e&&(g.postSolve=e),f&&(g.separate=f),this.collisionHandlers[i(a,b)]=g},ec.prototype.removeCollisionHandler=function(a,b){fc(this),delete this.collisionHandlers[i(a,b)]},ec.prototype.setDefaultCollisionHandler=function(a,b,c,d){fc(this);var e=new Jb;a&&(e.begin=a),b&&(e.preSolve=b),c&&(e.postSolve=c),d&&(e.separate=d),this.defaultHandler=e},ec.prototype.lookupHandler=function(a,b){return this.collisionHandlers[i(a,b)]||this.defaultHandler},ec.prototype.addShape=function(a){var b=a.body;return b.isStatic()?this.addStaticShape(a):(e(!a.space,"This shape is already added to a space and cannot be added to another."),fc(this),b.activate(),b.addShape(a),a.update(b.p,b.rot),this.activeShapes.insert(a,a.hashid),a.space=this,a)},ec.prototype.addStaticShape=function(a){e(!a.space,"This shape is already added to a space and cannot be added to another."),fc(this);var b=a.body;return b.addShape(a),a.update(b.p,b.rot),this.staticShapes.insert(a,a.hashid),a.space=this,a},ec.prototype.addBody=function(a){return e(!a.isStatic(),"Static bodies cannot be added to a space as they are not meant to be simulated."),e(!a.space,"This body is already added to a space and cannot be added to another."),fc(this),this.bodies.push(a),a.space=this,a},ec.prototype.addConstraint=function(a){e(!a.space,"This shape is already added to a space and cannot be added to another."),fc(this);var b=a.a,c=a.b;return b.activate(),c.activate(),this.constraints.push(a),a.next_a=b.constraintList,b.constraintList=a,a.next_b=c.constraintList,c.constraintList=a,a.space=this,a},ec.prototype.filterArbiters=function(a,b){for(var c in this.cachedArbiters){var d=this.cachedArbiters[c];(a===d.body_a&&(b===d.a||null===b)||a===d.body_b&&(b===d.b||null===b))&&(b&&"cached"!==d.state&&d.callSeparate(this),d.unthread(),j(this.arbiters,d),delete this.cachedArbiters[c])}},ec.prototype.removeShape=function(a){var b=a.body;b.isStatic()?this.removeStaticShape(a):(e(this.containsShape(a),"Cannot remove a shape that was not added to the space. (Removed twice maybe?)"),fc(this),b.activate(),b.removeShape(a),this.filterArbiters(b,a),this.activeShapes.remove(a,a.hashid),a.space=null)},ec.prototype.removeStaticShape=function(a){e(this.containsShape(a),"Cannot remove a static or sleeping shape that was not added to the space. (Removed twice maybe?)"),fc(this);var b=a.body;b.isStatic()&&b.activateStatic(a),b.removeShape(a),this.filterArbiters(b,a),this.staticShapes.remove(a,a.hashid),a.space=null},ec.prototype.removeBody=function(a){e(this.containsBody(a),"Cannot remove a body that was not added to the space. (Removed twice maybe?)"),fc(this),a.activate(),j(this.bodies,a),a.space=null},ec.prototype.removeConstraint=function(a){e(this.containsConstraint(a),"Cannot remove a constraint that was not added to the space. (Removed twice maybe?)"),fc(this),a.a.activate(),a.b.activate(),j(this.constraints,a),a.a.removeConstraint(a),a.b.removeConstraint(a),a.space=null},ec.prototype.containsShape=function(a){return a.space===this},ec.prototype.containsBody=function(a){return a.space==this},ec.prototype.containsConstraint=function(a){return a.space==this},ec.prototype.uncacheArbiter=function(a){delete this.cachedArbiters[i(a.a.hashid,a.b.hashid)],j(this.arbiters,a)},ec.prototype.eachBody=function(a){this.lock();for(var b=this.bodies,c=0;c<b.length;c++)a(b[c]);for(var d=this.sleepingComponents,c=0;c<d.length;c++)for(var e=d[c],f=e;f;){var g=f.nodeNext;a(f),f=g}this.unlock(!0)},ec.prototype.eachShape=function(a){this.lock(),this.activeShapes.each(a),this.staticShapes.each(a),this.unlock(!0)},ec.prototype.eachConstraint=function(a){this.lock();for(var b=this.constraints,c=0;c<b.length;c++)a(b[c]);this.unlock(!0)},ec.prototype.reindexStatic=function(){e(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete."),this.staticShapes.each(function(a){var b=a.body;a.update(b.p,b.rot)}),this.staticShapes.reindex()},ec.prototype.reindexShape=function(a){e(!this.locked,"You cannot manually reindex objects while the space is locked. Wait until the current query or step is complete.");var b=a.body;a.update(b.p,b.rot),this.activeShapes.reindexObject(a,a.hashid),this.staticShapes.reindexObject(a,a.hashid)},ec.prototype.reindexShapesForBody=function(a){for(var b=a.shapeList;b;b=b.next)this.reindexShape(b)},ec.prototype.useSpatialHash=function(a,b){throw new Error("Spatial Hash not yet implemented!")},ec.prototype.activateBody=function(a){if(e(!a.isRogue(),"Internal error: Attempting to activate a rogue body."),this.locked)-1===this.rousedBodies.indexOf(a)&&this.rousedBodies.push(a);else{this.bodies.push(a);for(var b=0;b<a.shapeList.length;b++){var c=a.shapeList[b];this.staticShapes.remove(c,c.hashid),this.activeShapes.insert(c,c.hashid)}for(var d=a.arbiterList;d;d=d.next(a)){var f=d.body_a;if(a===f||f.isStatic()){var g=d.a,h=d.b;this.cachedArbiters[i(g.hashid,h.hashid)]=d,d.stamp=this.stamp,d.handler=this.lookupHandler(g.collision_type,h.collision_type),this.arbiters.push(d)}}for(var j=a.constraintList;j;j=j.nodeNext){var f=j.a;(a===f||f.isStatic())&&this.constraints.push(j)}}},ec.prototype.deactivateBody=function(a){e(!a.isRogue(),"Internal error: Attempting to deactivate a rogue body."),j(this.bodies,a);for(var b=0;b<a.shapeList.length;b++){var c=a.shapeList[b];this.activeShapes.remove(c,c.hashid),this.staticShapes.insert(c,c.hashid)}for(var d=a.arbiterList;d;d=d.next(a)){var f=d.body_a;(a===f||f.isStatic())&&this.uncacheArbiter(d)}for(var g=a.constraintList;g;g=g.nodeNext){var f=g.a;(a===f||f.isStatic())&&j(this.constraints,g)}};var gc=function(a){return a?a.nodeRoot:null},hc=function(a){if(a&&a.isSleeping(a)){e(!a.isRogue(),"Internal Error: componentActivate() called on a rogue body.");for(var b=a.space,c=a;c;){var d=c.nodeNext;c.nodeIdleTime=0,c.nodeRoot=null,c.nodeNext=null,b.activateBody(c),c=d}j(b.sleepingComponents,a)}};ib.prototype.activate=function(){this.isRogue()||(this.nodeIdleTime=0,hc(gc(this)))},ib.prototype.activateStatic=function(a){e(this.isStatic(),"Body.activateStatic() called on a non-static body.");for(var b=this.arbiterList;b;b=b.next(this))a&&a!=b.a&&a!=b.b||(b.body_a==this?b.body_b:b.body_a).activate()},ib.prototype.pushArbiter=function(a){f(null===(a.body_a===this?a.thread_a_next:a.thread_b_next),"Internal Error: Dangling contact graph pointers detected. (A)"),f(null===(a.body_a===this?a.thread_a_prev:a.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (B)");var b=this.arbiterList;f(null===b||null===(b.body_a===this?b.thread_a_prev:b.thread_b_prev),"Internal Error: Dangling contact graph pointers detected. (C)"),a.body_a===this?a.thread_a_next=b:a.thread_b_next=b,b&&(b.body_a===this?b.thread_a_prev=a:b.thread_b_prev=a),this.arbiterList=a};var ic=function(a,b){b.nodeRoot=a,b!==a&&(b.nodeNext=a.nodeNext,a.nodeNext=b)},jc=function(a,b){if(!b.isRogue()){var c=gc(b);if(null==c){ic(a,b);for(var d=b.arbiterList;d;d=d.next(b))jc(a,b==d.body_a?d.body_b:d.body_a);for(var e=b.constraintList;e;e=e.next(b))jc(a,b==e.a?e.b:e.a)}else f(c===a,"Internal Error: Inconsistency detected in the contact graph.")}},kc=function(a,b){for(var c=a;c;c=c.nodeNext)if(c.nodeIdleTime<b)return!0;return!1};ec.prototype.processComponents=function(a){for(var b=1/0!==this.sleepTimeThreshold,c=this.bodies,d=0;d<c.length;d++){var e=c[d];f(null===e.nodeNext,"Internal Error: Dangling next pointer detected in contact graph."),f(null===e.nodeRoot,"Internal Error: Dangling root pointer detected in contact graph.")}if(b)for(var g=this.idleSpeedThreshold,h=g?g*g:L(this.gravity)*a*a,d=0;d<c.length;d++){var e=c[d],i=h?e.m*h:0;e.nodeIdleTime=e.kineticEnergy()>i?0:e.nodeIdleTime+a}for(var j=this.arbiters,d=0,k=j.length;k>d;d++){var l=j[d],m=l.body_a,n=l.body_b;b&&((n.isRogue()&&!n.isStatic()||m.isSleeping())&&m.activate(),(m.isRogue()&&!m.isStatic()||n.isSleeping())&&n.activate()),m.pushArbiter(l),n.pushArbiter(l)}if(b){for(var o=this.constraints,d=0;d<o.length;d++){var p=o[d],m=p.a,n=p.b;n.isRogue()&&!n.isStatic()&&m.activate(),m.isRogue()&&!m.isStatic()&&n.activate()}for(var d=0;d<c.length;){var e=c[d];if(null!==gc(e)||(jc(e,e),kc(e,this.sleepTimeThreshold)))d++,e.nodeRoot=null,e.nodeNext=null;else{this.sleepingComponents.push(e);for(var q=e;q;q=q.nodeNext)this.deactivateBody(q)}}}},ib.prototype.sleep=function(){this.sleepWithGroup(null)},ib.prototype.sleepWithGroup=function(a){e(!this.isStatic()&&!this.isRogue(),"Rogue and static bodies cannot be put to sleep.");var b=this.space;if(e(b,"Cannot put a rogue body to sleep."),e(!b.locked,"Bodies cannot be put to sleep during a query or a call to cpSpaceStep(). Put these calls into a post-step callback."),e(null===a||a.isSleeping(),"Cannot use a non-sleeping body as a group identifier."),this.isSleeping())return void e(gc(this)===gc(a),"The body is already sleeping and it's group cannot be reassigned.");for(var c=0;c<this.shapeList.length;c++)this.shapeList[c].update(this.p,this.rot);if(b.deactivateBody(this),a){var d=gc(a);this.nodeRoot=d,this.nodeNext=d.nodeNext,this.nodeIdleTime=0,d.nodeNext=this}else this.nodeRoot=this,this.nodeNext=null,this.nodeIdleTime=0,b.sleepingComponents.push(this);j(b.bodies,this)},ec.prototype.activateShapesTouchingShape=function(a){1/0!==this.sleepTimeThreshold&&this.shapeQuery(a,function(a){a.body.activate()})},ec.prototype.pointQuery=function(a,b,c,d){var e=function(e){(!e.group||c!==e.group)&&b&e.layers&&e.pointQuery(a)&&d(e)},f=new V(a.x,a.y,a.x,a.y);this.lock(),this.activeShapes.query(f,e),this.staticShapes.query(f,e),this.unlock(!0)},ec.prototype.pointQueryFirst=function(a,b,c){var d=null;return this.pointQuery(a,b,c,function(a){a.sensor||(d=a)}),d},ec.prototype.nearestPointQuery=function(a,b,c,d,e){var f=function(f){if((!f.group||d!==f.group)&&c&f.layers){var g=f.nearestPointQuery(a);g.d<b&&e(f,g.d,g.p)}},g=W(a,b);this.lock(),this.activeShapes.query(g,f),this.staticShapes.query(g,f),this.unlock(!0)},ec.prototype.nearestPointQueryNearest=function(a,b,c,d){var e,f=function(f){if((!f.group||d!==f.group)&&c&f.layers&&!f.sensor){var g=f.nearestPointQuery(a);g.d<b&&(!e||g.d<e.d)&&(e=g)}},g=W(a,b);return this.activeShapes.query(g,f),this.staticShapes.query(g,f),e},ec.prototype.segmentQuery=function(a,b,c,d,e){var f=function(f){var g;return(!f.group||d!==f.group)&&c&f.layers&&(g=f.segmentQuery(a,b))&&e(f,g.t,g.n),1};this.lock(),this.staticShapes.segmentQuery(a,b,1,f),this.activeShapes.segmentQuery(a,b,1,f),this.unlock(!0)},ec.prototype.segmentQueryFirst=function(a,b,c,d){var e=null,f=function(f){var g;return(!f.group||d!==f.group)&&c&f.layers&&!f.sensor&&(g=f.segmentQuery(a,b))&&(null===e||g.t<e.t)&&(e=g),e?e.t:1};return this.staticShapes.segmentQuery(a,b,1,f),this.activeShapes.segmentQuery(a,b,e?e.t:1,f),e},ec.prototype.bbQuery=function(a,b,c,d){var e=function(e){(!e.group||c!==e.group)&&b&e.layers&&X(a,e.bb_l,e.bb_b,e.bb_r,e.bb_t)&&d(e)};this.lock(),this.activeShapes.query(a,e),this.staticShapes.query(a,e),this.unlock(!0)},ec.prototype.shapeQuery=function(a,b){var c=a.body;c&&a.update(c.p,c.rot);var d=new V(a.bb_l,a.bb_b,a.bb_r,a.bb_t),e=!1,f=function(c){var d=a;if((!d.group||d.group!==c.group)&&d.layers&c.layers&&d!==c){var f;if(d.collisionCode<=c.collisionCode)f=cc(d,c);else{f=cc(c,d);for(var g=0;g<f.length;g++)f[g].n=D(f[g].n)}if(f.length&&(e=!(d.sensor||c.sensor),b)){for(var h=new Array(f.length),g=0;g<f.length;g++)h[g]=new Lb(f[g].p,f[g].n,f[g].dist);b(c,h)}}};return this.lock(),this.activeShapes.query(d,f),this.staticShapes.query(d,f),this.unlock(!0),e},ec.prototype.addPostStepCallback=function(a){f(this.locked,"Adding a post-step callback when the space is not locked is unnecessary. Post-step callbacks will not called until the end of the next call to cpSpaceStep() or the next query."),this.postStepCallbacks.push(a)},ec.prototype.runPostStepCallbacks=function(){for(var a=0;a<this.postStepCallbacks.length;a++)this.postStepCallbacks[a]();this.postStepCallbacks=[]},ec.prototype.lock=function(){this.locked++},ec.prototype.unlock=function(a){if(this.locked--,e(this.locked>=0,"Internal Error: Space lock underflow."),0===this.locked&&a){for(var b=this.rousedBodies,c=0;c<b.length;c++)this.activateBody(b[c]);b.length=0,this.runPostStepCallbacks()}},ec.prototype.makeCollideShapes=function(){var a=this;return function(b,c){var d=a;if(b.bb_l<=c.bb_r&&c.bb_l<=b.bb_r&&b.bb_b<=c.bb_t&&c.bb_b<=b.bb_t&&b.body!==c.body&&(!b.group||b.group!==c.group)&&b.layers&c.layers){var e=d.lookupHandler(b.collision_type,c.collision_type),f=b.sensor||c.sensor;if(!f||e!==dc){if(b.collisionCode>c.collisionCode){var g=b;b=c,c=g}var h=cc(b,c);if(0!==h.length){var j=i(b.hashid,c.hashid),k=d.cachedArbiters[j];k||(k=d.cachedArbiters[j]=new Kb(b,c)),k.update(h,e,b,c),"first coll"!=k.state||e.begin(k,d)||k.ignore(),"ignore"!==k.state&&e.preSolve(k,d)&&!f?d.arbiters.push(k):(k.contacts=null,"ignore"!==k.state&&(k.state="normal")),k.stamp=d.stamp}}}}},ec.prototype.arbiterSetFilter=function(a){var b=this.stamp-a.stamp,c=a.body_a,d=a.body_b;return(c.isStatic()||c.isSleeping())&&(d.isStatic()||d.isSleeping())?!0:(b>=1&&"cached"!=a.state&&(a.callSeparate(this),a.state="cached"),b>=this.collisionPersistence?(a.contacts=null,!1):!0)};var lc=function(a){var b=a.body;a.update(b.p,b.rot)};ec.prototype.step=function(a){if(0!==a){e(0===w.x&&0===w.y,"vzero is invalid"),this.stamp++;var b=this.curr_dt;this.curr_dt=a;var c,d,f,g=this.bodies,h=this.constraints,i=this.arbiters;for(c=0;c<i.length;c++){var j=i[c];j.state="normal",j.body_a.isSleeping()||j.body_b.isSleeping()||j.unthread()}for(i.length=0,this.lock(),c=0;c<g.length;c++)g[c].position_func(a);this.activeShapes.each(lc),this.activeShapes.reindexQuery(this.collideShapes),this.unlock(!1),this.processComponents(a),this.lock();for(f in this.cachedArbiters)this.arbiterSetFilter(this.cachedArbiters[f])||delete this.cachedArbiters[f];var k=this.collisionSlop,l=1-Math.pow(this.collisionBias,a);for(c=0;c<i.length;c++)i[c].preStep(a,k,l);for(c=0;c<h.length;c++){var m=h[c];m.preSolve(this),m.preStep(a)}var n=Math.pow(this.damping,a),o=this.gravity;for(c=0;c<g.length;c++)g[c].velocity_func(o,n,a);var p=0===b?0:a/b;for(c=0;c<i.length;c++)i[c].applyCachedImpulse(p);for(c=0;c<h.length;c++)h[c].applyCachedImpulse(p);for(c=0;c<this.iterations;c++){for(d=0;d<i.length;d++)i[d].applyImpulse();for(d=0;d<h.length;d++)h[d].applyImpulse()}for(c=0;c<h.length;c++)h[c].postSolve(this);for(c=0;c<i.length;c++)i[c].handler.postSolve(i[c],this);this.unlock(!0)}};var mc=function(a,b,c,d){var e=a.vx+-c.y*a.w,f=a.vy+c.x*a.w,g=b.vx+-d.y*b.w,h=b.vy+d.x*b.w;return new v(g-e,h-f)},nc=function(a,b,c,d,e){var f=a.vx+-c.y*a.w,g=a.vy+c.x*a.w,h=b.vx+-d.y*b.w,i=b.vy+d.x*b.w;return y(h-f,i-g,e.x,e.y)},oc=function(a,b,c,d){a.vx+=b*a.m_inv,a.vy+=c*a.m_inv,a.w+=a.i_inv*(d.x*c-d.y*b)},pc=function(a,b,c,d,e,f){oc(a,-e,-f,c),oc(b,e,f,d)},qc=function(a,b,c,d){a.v_biasx+=b*a.m_inv,a.v_biasy+=c*a.m_inv,a.w_bias+=a.i_inv*G(d.x,d.y,b,c)},rc=function(a,b,c){var d=F(b,c);return a.m_inv+a.i_inv*d*d},sc=function(a,b,c,d,e){var g=rc(a,c,e)+rc(b,d,e);return f(0!==g,"Unsolvable collision or constraint."),g},tc=function(a,b,c,d,e,g){var h,i,j,k,l=a.m_inv+b.m_inv;h=l,i=0,j=0,k=l;var m=a.i_inv,n=c.x*c.x*m,o=c.y*c.y*m,p=-c.x*c.y*m;h+=o,i+=p,j+=p,k+=n;var q=b.i_inv,r=d.x*d.x*q,s=d.y*d.y*q,t=-d.x*d.y*q;h+=s,i+=t,j+=t,k+=r;var u=h*k-i*j;f(0!==u,"Unsolvable constraint.");var v=1/u;e.x=k*v,e.y=-i*v,g.x=-j*v,g.y=h*v},uc=function(a,b,c){return new v(x(a,b),x(a,c))},vc=function(a,b){return 1-Math.pow(a,b)},wc=a.Constraint=function(a,b){this.a=a,this.b=b,this.space=null,this.next_a=null,this.next_b=null,this.maxForce=1/0,this.errorBias=Math.pow(.9,60),this.maxBias=1/0};wc.prototype.activateBodies=function(){this.a&&this.a.activate(),this.b&&this.b.activate()},wc.prototype.preStep=function(){},wc.prototype.applyCachedImpulse=function(){},wc.prototype.applyImpulse=function(){},wc.prototype.getImpulse=function(){return 0},wc.prototype.preSolve=function(){},wc.prototype.postSolve=function(){},wc.prototype.next=function(a){return this.a===a?this.next_a:this.next_b};var xc=a.PinJoint=function(a,b,c,d){wc.call(this,a,b),this.anchr1=c,this.anchr2=d;var e=a?B(a.p,J(c,a.rot)):c,g=b?B(b.p,J(d,b.rot)):d;this.dist=z(C(g,e)),f(this.dist>0,"You created a 0 length pin joint. A pivot joint will be much more stable."),this.r1=this.r2=null,this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};xc.prototype=Object.create(wc.prototype),xc.prototype.preStep=function(a){var b=this.a,c=this.b;this.r1=J(this.anchr1,b.rot),this.r2=J(this.anchr2,c.rot);var d=C(B(c.p,this.r2),B(b.p,this.r1)),e=z(d);this.n=E(d,1/(e?e:1/0)),this.nMass=1/sc(b,c,this.r1,this.r2,this.n);var f=this.maxBias;this.bias=s(-vc(this.errorBias,a)*(e-this.dist)/a,-f,f),this.jnMax=this.maxForce*a},xc.prototype.applyCachedImpulse=function(a){var b=E(this.n,this.jnAcc*a);pc(this.a,this.b,this.r1,this.r2,b.x,b.y)},xc.prototype.applyImpulse=function(){var a=this.a,b=this.b,c=this.n,d=nc(a,b,this.r1,this.r2,c),e=(this.bias-d)*this.nMass,f=this.jnAcc;this.jnAcc=s(f+e,-this.jnMax,this.jnMax),e=this.jnAcc-f,pc(a,b,this.r1,this.r2,c.x*e,c.y*e)},xc.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var yc=a.SlideJoint=function(a,b,c,d,e,f){wc.call(this,a,b),this.anchr1=c,this.anchr2=d,this.min=e,this.max=f,this.r1=this.r2=this.n=null,this.nMass=0,this.jnAcc=this.jnMax=0,this.bias=0};yc.prototype=Object.create(wc.prototype),yc.prototype.preStep=function(a){var b=this.a,c=this.b;this.r1=J(this.anchr1,b.rot),this.r2=J(this.anchr2,c.rot);var d=C(B(c.p,this.r2),B(b.p,this.r1)),e=z(d),f=0;e>this.max?(f=e-this.max,this.n=P(d)):e<this.min?(f=this.min-e,this.n=D(P(d))):(this.n=w,this.jnAcc=0),this.nMass=1/sc(b,c,this.r1,this.r2,this.n);var g=this.maxBias;this.bias=s(-vc(this.errorBias,a)*f/a,-g,g),this.jnMax=this.maxForce*a},yc.prototype.applyCachedImpulse=function(a){var b=this.jnAcc*a;pc(this.a,this.b,this.r1,this.r2,this.n.x*b,this.n.y*b)},yc.prototype.applyImpulse=function(){if(0!==this.n.x||0!==this.n.y){var a=this.a,b=this.b,c=this.n,d=this.r1,e=this.r2,f=mc(a,b,d,e),g=x(f,c),h=(this.bias-g)*this.nMass,i=this.jnAcc;this.jnAcc=s(i+h,-this.jnMax,0),h=this.jnAcc-i,pc(a,b,this.r1,this.r2,c.x*h,c.y*h)}},yc.prototype.getImpulse=function(){return Math.abs(this.jnAcc)};var zc=a.PivotJoint=function(a,b,c,d){if(wc.call(this,a,b),"undefined"==typeof d){var e=c;c=a?a.world2Local(e):e,d=b?b.world2Local(e):e}this.anchr1=c,this.anchr2=d,this.r1=this.r2=w,this.k1=new v(0,0),this.k2=new v(0,0),this.jAcc=w,this.jMaxLen=0,this.bias=w};zc.prototype=Object.create(wc.prototype),zc.prototype.preStep=function(a){var b=this.a,c=this.b;this.r1=J(this.anchr1,b.rot),this.r2=J(this.anchr2,c.rot),tc(b,c,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*a;var d=C(B(c.p,this.r2),B(b.p,this.r1));this.bias=Q(E(d,-vc(this.errorBias,a)/a),this.maxBias)},zc.prototype.applyCachedImpulse=function(a){pc(this.a,this.b,this.r1,this.r2,this.jAcc.x*a,this.jAcc.y*a)},zc.prototype.applyImpulse=function(){var a=this.a,b=this.b,c=this.r1,d=this.r2,e=mc(a,b,c,d),f=uc(C(this.bias,e),this.k1,this.k2),g=this.jAcc;this.jAcc=Q(B(this.jAcc,f),this.jMaxLen),pc(a,b,this.r1,this.r2,this.jAcc.x-g.x,this.jAcc.y-g.y)},zc.prototype.getImpulse=function(){return z(this.jAcc)};var Ac=a.GrooveJoint=function(a,b,c,d,e){wc.call(this,a,b),this.grv_a=c,this.grv_b=d,this.grv_n=H(O(C(d,c))),this.anchr2=e,this.grv_tn=null,this.clamp=0,this.r1=this.r2=null,this.k1=new v(0,0),this.k2=new v(0,0),this.jAcc=w,this.jMaxLen=0,this.bias=null};Ac.prototype=Object.create(wc.prototype),Ac.prototype.preStep=function(a){var b=this.a,c=this.b,d=b.local2World(this.grv_a),e=b.local2World(this.grv_b),f=J(this.grv_n,b.rot),g=x(d,f);this.grv_tn=f,this.r2=J(this.anchr2,c.rot);var h=F(B(c.p,this.r2),f);h<=F(d,f)?(this.clamp=1,this.r1=C(d,b.p)):h>=F(e,f)?(this.clamp=-1,this.r1=C(e,b.p)):(this.clamp=0,this.r1=C(B(E(H(f),-h),E(f,g)),b.p)),tc(b,c,this.r1,this.r2,this.k1,this.k2),this.jMaxLen=this.maxForce*a;var i=C(B(c.p,this.r2),B(b.p,this.r1));this.bias=Q(E(i,-vc(this.errorBias,a)/a),this.maxBias)},Ac.prototype.applyCachedImpulse=function(a){pc(this.a,this.b,this.r1,this.r2,this.jAcc.x*a,this.jAcc.y*a)},Ac.prototype.grooveConstrain=function(a){var b=this.grv_tn,c=this.clamp*F(a,b)>0?a:I(a,b);return Q(c,this.jMaxLen)},Ac.prototype.applyImpulse=function(){var a=this.a,b=this.b,c=this.r1,d=this.r2,e=mc(a,b,c,d),f=uc(C(this.bias,e),this.k1,this.k2),g=this.jAcc;this.jAcc=this.grooveConstrain(B(g,f)),pc(a,b,this.r1,this.r2,this.jAcc.x-g.x,this.jAcc.y-g.y)},Ac.prototype.getImpulse=function(){return z(this.jAcc)},Ac.prototype.setGrooveA=function(a){this.grv_a=a,this.grv_n=H(O(C(this.grv_b,a))),this.activateBodies()},Ac.prototype.setGrooveB=function(a){this.grv_b=a,this.grv_n=H(O(C(a,this.grv_a))),this.activateBodies()};var Bc=function(a,b){return(a.restLength-b)*a.stiffness},Cc=a.DampedSpring=function(a,b,c,d,e,f,g){wc.call(this,a,b),this.anchr1=c,this.anchr2=d,this.restLength=e,this.stiffness=f,this.damping=g,this.springForceFunc=Bc,this.target_vrn=this.v_coef=0,this.r1=this.r2=null,this.nMass=0,this.n=null};Cc.prototype=Object.create(wc.prototype),Cc.prototype.preStep=function(a){var b=this.a,c=this.b;this.r1=J(this.anchr1,b.rot),this.r2=J(this.anchr2,c.rot);var d=C(B(c.p,this.r2),B(b.p,this.r1)),e=z(d);this.n=E(d,1/(e?e:1/0));var g=sc(b,c,this.r1,this.r2,this.n);f(0!==g,"Unsolvable this."),this.nMass=1/g,this.target_vrn=0,this.v_coef=1-Math.exp(-this.damping*a*g);var h=this.springForceFunc(this,e);pc(b,c,this.r1,this.r2,this.n.x*h*a,this.n.y*h*a)},Cc.prototype.applyCachedImpulse=function(){},Cc.prototype.applyImpulse=function(){var a=this.a,b=this.b,c=this.n,d=this.r1,e=this.r2,f=nc(a,b,d,e,c),g=(this.target_vrn-f)*this.v_coef;this.target_vrn=f+g,g*=this.nMass,pc(a,b,this.r1,this.r2,this.n.x*g,this.n.y*g)},Cc.prototype.getImpulse=function(){return 0};var Dc=function(a,b){return(b-a.restAngle)*a.stiffness},Ec=a.DampedRotarySpring=function(a,b,c,d,e){wc.call(this,a,b),this.restAngle=c,this.stiffness=d,this.damping=e,this.springTorqueFunc=Dc,this.target_wrn=0,this.w_coef=0,this.iSum=0};Ec.prototype=Object.create(wc.prototype),Ec.prototype.preStep=function(a){var b=this.a,c=this.b,d=b.i_inv+c.i_inv;f(0!==d,"Unsolvable spring."),this.iSum=1/d,this.w_coef=1-Math.exp(-this.damping*a*d),this.target_wrn=0;var e=this.springTorqueFunc(this,b.a-c.a)*a;b.w-=e*b.i_inv,c.w+=e*c.i_inv},Ec.prototype.applyImpulse=function(){var a=this.a,b=this.b,c=a.w-b.w,d=(this.target_wrn-c)*this.w_coef;this.target_wrn=c+d;var e=d*this.iSum;a.w+=e*a.i_inv,b.w-=e*b.i_inv};var Fc=a.RotaryLimitJoint=function(a,b,c,d){wc.call(this,a,b),this.min=c,this.max=d,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Fc.prototype=Object.create(wc.prototype),Fc.prototype.preStep=function(a){var b=this.a,c=this.b,d=c.a-b.a,e=0;d>this.max?e=this.max-d:d<this.min&&(e=this.min-d),this.iSum=1/(1/b.i+1/c.i);var f=this.maxBias;this.bias=s(-vc(this.errorBias,a)*e/a,-f,f),this.jMax=this.maxForce*a,this.bias||(this.jAcc=0)},Fc.prototype.applyCachedImpulse=function(a){var b=this.a,c=this.b,d=this.jAcc*a;b.w-=d*b.i_inv,c.w+=d*c.i_inv},Fc.prototype.applyImpulse=function(){if(this.bias){var a=this.a,b=this.b,c=b.w-a.w,d=-(this.bias+c)*this.iSum,e=this.jAcc;this.jAcc=this.bias<0?s(e+d,0,this.jMax):s(e+d,-this.jMax,0),d=this.jAcc-e,a.w-=d*a.i_inv,b.w+=d*b.i_inv}},Fc.prototype.getImpulse=function(){return Math.abs(joint.jAcc)};var Gc=a.RatchetJoint=function(a,b,c,d){wc.call(this,a,b),this.angle=0,this.phase=c,this.ratchet=d,this.angle=(b?b.a:0)-(a?a.a:0),this.iSum=this.bias=this.jAcc=this.jMax=0};Gc.prototype=Object.create(wc.prototype),Gc.prototype.preStep=function(a){var b=this.a,c=this.b,d=this.angle,e=this.phase,f=this.ratchet,g=c.a-b.a,h=d-g,i=0;h*f>0?i=h:this.angle=Math.floor((g-e)/f)*f+e,this.iSum=1/(b.i_inv+c.i_inv);var j=this.maxBias;this.bias=s(-vc(this.errorBias,a)*i/a,-j,j),this.jMax=this.maxForce*a,this.bias||(this.jAcc=0)},Gc.prototype.applyCachedImpulse=function(a){var b=this.a,c=this.b,d=this.jAcc*a;b.w-=d*b.i_inv,c.w+=d*c.i_inv},Gc.prototype.applyImpulse=function(){if(this.bias){var a=this.a,b=this.b,c=b.w-a.w,d=this.ratchet,e=-(this.bias+c)*this.iSum,f=this.jAcc;this.jAcc=s((f+e)*d,0,this.jMax*Math.abs(d))/d,e=this.jAcc-f,a.w-=e*a.i_inv,b.w+=e*b.i_inv}},Gc.prototype.getImpulse=function(a){return Math.abs(a.jAcc)};var Hc=a.GearJoint=function(a,b,c,d){wc.call(this,a,b),this.phase=c,this.ratio=d,this.ratio_inv=1/d,this.jAcc=0,this.iSum=this.bias=this.jMax=0};Hc.prototype=Object.create(wc.prototype),Hc.prototype.preStep=function(a){var b=this.a,c=this.b;this.iSum=1/(b.i_inv*this.ratio_inv+this.ratio*c.i_inv);var d=this.maxBias;this.bias=s(-vc(this.errorBias,a)*(c.a*this.ratio-b.a-this.phase)/a,-d,d),this.jMax=this.maxForce*a},Hc.prototype.applyCachedImpulse=function(a){var b=this.a,c=this.b,d=this.jAcc*a;b.w-=d*b.i_inv*this.ratio_inv,c.w+=d*c.i_inv},Hc.prototype.applyImpulse=function(){var a=this.a,b=this.b,c=b.w*this.ratio-a.w,d=(this.bias-c)*this.iSum,e=this.jAcc;this.jAcc=s(e+d,-this.jMax,this.jMax),d=this.jAcc-e,a.w-=d*a.i_inv*this.ratio_inv,b.w+=d*b.i_inv},Hc.prototype.getImpulse=function(){return Math.abs(this.jAcc)},Hc.prototype.setRatio=function(a){this.ratio=a,this.ratio_inv=1/a,this.activateBodies()};var Ic=a.SimpleMotor=function(a,b,c){wc.call(this,a,b),this.rate=c,this.jAcc=0,this.iSum=this.jMax=0};Ic.prototype=Object.create(wc.prototype),Ic.prototype.preStep=function(a){this.iSum=1/(this.a.i_inv+this.b.i_inv),this.jMax=this.maxForce*a},Ic.prototype.applyCachedImpulse=function(a){var b=this.a,c=this.b,d=this.jAcc*a;b.w-=d*b.i_inv,c.w+=d*c.i_inv},Ic.prototype.applyImpulse=function(){var a=this.a,b=this.b,c=b.w-a.w+this.rate,d=-c*this.iSum,e=this.jAcc;this.jAcc=s(e+d,-this.jMax,this.jMax),d=this.jAcc-e,a.w-=d*a.i_inv,b.w+=d*b.i_inv},Ic.prototype.getImpulse=function(){return Math.abs(this.jAcc)}}()},{}],2:[function(a,b,c){function d(a,b,c){if(!(this instanceof d))return new d(a,b,c);var e=typeof a;if("base64"===b&&"string"===e)for(a=C(a);a.length%4!==0;)a+="=";var f;if("number"===e)f=F(a);else if("string"===e)f=d.byteLength(a,b);else{if("object"!==e)throw new Error("First argument needs to be a number, array or string.");f=F(a.length)}var g;d._useTypedArrays?g=D(new Uint8Array(f)):(g=this,g.length=f,g._isBuffer=!0);var h;if(d._useTypedArrays&&"function"==typeof Uint8Array&&a instanceof Uint8Array)g._set(a);else if(H(a))for(h=0;f>h;h++)g[h]=d.isBuffer(a)?a.readUInt8(h):a[h];else if("string"===e)g.write(a,0,b);else if("number"===e&&!d._useTypedArrays&&!c)for(h=0;f>h;h++)g[h]=0;return g}function e(a,b,c,e){c=Number(c)||0;var f=a.length-c;e?(e=Number(e),e>f&&(e=f)):e=f;var g=b.length;S(g%2===0,"Invalid hex string"),e>g/2&&(e=g/2);for(var h=0;e>h;h++){var i=parseInt(b.substr(2*h,2),16);S(!isNaN(i),"Invalid hex string"),a[c+h]=i}return d._charsWritten=2*h,h}function f(a,b,c,e){var f=d._charsWritten=N(J(b),a,c,e);return f}function g(a,b,c,e){var f=d._charsWritten=N(K(b),a,c,e);return f}function h(a,b,c,d){return g(a,b,c,d)}function i(a,b,c,e){var f=d._charsWritten=N(M(b),a,c,e);return f}function j(a,b,c,e){var f=d._charsWritten=N(L(b),a,c,e);return f}function k(a,b,c){return T.fromByteArray(0===b&&c===a.length?a:a.slice(b,c))}function l(a,b,c){var d="",e="";c=Math.min(a.length,c);for(var f=b;c>f;f++)a[f]<=127?(d+=O(e)+String.fromCharCode(a[f]),e=""):e+="%"+a[f].toString(16);return d+O(e)}function m(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;c>e;e++)d+=String.fromCharCode(a[e]);return d}function n(a,b,c){return m(a,b,c)}function o(a,b,c){var d=a.length;(!b||0>b)&&(b=0),(!c||0>c||c>d)&&(c=d);for(var e="",f=b;c>f;f++)e+=I(a[f]);return e}function p(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function q(a,b,c,d){d||(S("boolean"==typeof c,"missing or invalid endian"),S(void 0!==b&&null!==b,"missing offset"),S(b+1<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){var f;return c?(f=a[b],e>b+1&&(f|=a[b+1]<<8)):(f=a[b]<<8,e>b+1&&(f|=a[b+1])),f}}function r(a,b,c,d){d||(S("boolean"==typeof c,"missing or invalid endian"),S(void 0!==b&&null!==b,"missing offset"),S(b+3<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){var f;return c?(e>b+2&&(f=a[b+2]<<16),e>b+1&&(f|=a[b+1]<<8),f|=a[b],e>b+3&&(f+=a[b+3]<<24>>>0)):(e>b+1&&(f=a[b+1]<<16),e>b+2&&(f|=a[b+2]<<8),e>b+3&&(f|=a[b+3]),f+=a[b]<<24>>>0),f}}function s(a,b,c,d){d||(S("boolean"==typeof c,"missing or invalid endian"),S(void 0!==b&&null!==b,"missing offset"),S(b+1<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){var f=q(a,b,c,!0),g=32768&f;return g?-1*(65535-f+1):f}}function t(a,b,c,d){d||(S("boolean"==typeof c,"missing or invalid endian"),S(void 0!==b&&null!==b,"missing offset"),S(b+3<a.length,"Trying to read beyond buffer length"));var e=a.length;if(!(b>=e)){var f=r(a,b,c,!0),g=2147483648&f;return g?-1*(4294967295-f+1):f}}function u(a,b,c,d){return d||(S("boolean"==typeof c,"missing or invalid endian"),S(b+3<a.length,"Trying to read beyond buffer length")),U.read(a,b,c,23,4)}function v(a,b,c,d){return d||(S("boolean"==typeof c,"missing or invalid endian"),S(b+7<a.length,"Trying to read beyond buffer length")),U.read(a,b,c,52,8)}function w(a,b,c,d,e){e||(S(void 0!==b&&null!==b,"missing value"),S("boolean"==typeof d,"missing or invalid endian"),S(void 0!==c&&null!==c,"missing offset"),S(c+1<a.length,"trying to write beyond buffer length"),P(b,65535));var f=a.length;if(!(c>=f))for(var g=0,h=Math.min(f-c,2);h>g;g++)a[c+g]=(b&255<<8*(d?g:1-g))>>>8*(d?g:1-g)}function x(a,b,c,d,e){e||(S(void 0!==b&&null!==b,"missing value"),S("boolean"==typeof d,"missing or invalid endian"),S(void 0!==c&&null!==c,"missing offset"),S(c+3<a.length,"trying to write beyond buffer length"),P(b,4294967295));var f=a.length;if(!(c>=f))for(var g=0,h=Math.min(f-c,4);h>g;g++)a[c+g]=b>>>8*(d?g:3-g)&255
}function y(a,b,c,d,e){e||(S(void 0!==b&&null!==b,"missing value"),S("boolean"==typeof d,"missing or invalid endian"),S(void 0!==c&&null!==c,"missing offset"),S(c+1<a.length,"Trying to write beyond buffer length"),Q(b,32767,-32768));var f=a.length;c>=f||(b>=0?w(a,b,c,d,e):w(a,65535+b+1,c,d,e))}function z(a,b,c,d,e){e||(S(void 0!==b&&null!==b,"missing value"),S("boolean"==typeof d,"missing or invalid endian"),S(void 0!==c&&null!==c,"missing offset"),S(c+3<a.length,"Trying to write beyond buffer length"),Q(b,2147483647,-2147483648));var f=a.length;c>=f||(b>=0?x(a,b,c,d,e):x(a,4294967295+b+1,c,d,e))}function A(a,b,c,d,e){e||(S(void 0!==b&&null!==b,"missing value"),S("boolean"==typeof d,"missing or invalid endian"),S(void 0!==c&&null!==c,"missing offset"),S(c+3<a.length,"Trying to write beyond buffer length"),R(b,3.4028234663852886e38,-3.4028234663852886e38));var f=a.length;c>=f||U.write(a,b,c,d,23,4)}function B(a,b,c,d,e){e||(S(void 0!==b&&null!==b,"missing value"),S("boolean"==typeof d,"missing or invalid endian"),S(void 0!==c&&null!==c,"missing offset"),S(c+7<a.length,"Trying to write beyond buffer length"),R(b,1.7976931348623157e308,-1.7976931348623157e308));var f=a.length;c>=f||U.write(a,b,c,d,52,8)}function C(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function D(a){return a._isBuffer=!0,a._get=a.get,a._set=a.set,a.get=V.get,a.set=V.set,a.write=V.write,a.toString=V.toString,a.toLocaleString=V.toString,a.toJSON=V.toJSON,a.copy=V.copy,a.slice=V.slice,a.readUInt8=V.readUInt8,a.readUInt16LE=V.readUInt16LE,a.readUInt16BE=V.readUInt16BE,a.readUInt32LE=V.readUInt32LE,a.readUInt32BE=V.readUInt32BE,a.readInt8=V.readInt8,a.readInt16LE=V.readInt16LE,a.readInt16BE=V.readInt16BE,a.readInt32LE=V.readInt32LE,a.readInt32BE=V.readInt32BE,a.readFloatLE=V.readFloatLE,a.readFloatBE=V.readFloatBE,a.readDoubleLE=V.readDoubleLE,a.readDoubleBE=V.readDoubleBE,a.writeUInt8=V.writeUInt8,a.writeUInt16LE=V.writeUInt16LE,a.writeUInt16BE=V.writeUInt16BE,a.writeUInt32LE=V.writeUInt32LE,a.writeUInt32BE=V.writeUInt32BE,a.writeInt8=V.writeInt8,a.writeInt16LE=V.writeInt16LE,a.writeInt16BE=V.writeInt16BE,a.writeInt32LE=V.writeInt32LE,a.writeInt32BE=V.writeInt32BE,a.writeFloatLE=V.writeFloatLE,a.writeFloatBE=V.writeFloatBE,a.writeDoubleLE=V.writeDoubleLE,a.writeDoubleBE=V.writeDoubleBE,a.fill=V.fill,a.inspect=V.inspect,a.toArrayBuffer=V.toArrayBuffer,a}function E(a,b,c){return"number"!=typeof a?c:(a=~~a,a>=b?b:a>=0?a:(a+=b,a>=0?a:0))}function F(a){return a=~~Math.ceil(+a),0>a?0:a}function G(a){return(Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)})(a)}function H(a){return G(a)||d.isBuffer(a)||a&&"object"==typeof a&&"number"==typeof a.length}function I(a){return 16>a?"0"+a.toString(16):a.toString(16)}function J(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);if(127>=d)b.push(a.charCodeAt(c));else{var e=c;d>=55296&&57343>=d&&c++;for(var f=encodeURIComponent(a.slice(e,c+1)).substr(1).split("%"),g=0;g<f.length;g++)b.push(parseInt(f[g],16))}}return b}function K(a){for(var b=[],c=0;c<a.length;c++)b.push(255&a.charCodeAt(c));return b}function L(a){for(var b,c,d,e=[],f=0;f<a.length;f++)b=a.charCodeAt(f),c=b>>8,d=b%256,e.push(d),e.push(c);return e}function M(a){return T.toByteArray(a)}function N(a,b,c,d){for(var e=0;d>e&&!(e+c>=b.length||e>=a.length);e++)b[e+c]=a[e];return e}function O(a){try{return decodeURIComponent(a)}catch(b){return String.fromCharCode(65533)}}function P(a,b){S("number"==typeof a,"cannot write a non-number as a number"),S(a>=0,"specified a negative value for writing an unsigned value"),S(b>=a,"value is larger than maximum value for type"),S(Math.floor(a)===a,"value has a fractional component")}function Q(a,b,c){S("number"==typeof a,"cannot write a non-number as a number"),S(b>=a,"value larger than maximum allowed value"),S(a>=c,"value smaller than minimum allowed value"),S(Math.floor(a)===a,"value has a fractional component")}function R(a,b,c){S("number"==typeof a,"cannot write a non-number as a number"),S(b>=a,"value larger than maximum allowed value"),S(a>=c,"value smaller than minimum allowed value")}function S(a,b){if(!a)throw new Error(b||"Failed assertion")}var T=a("base64-js"),U=a("ieee754");c.Buffer=d,c.SlowBuffer=d,c.INSPECT_MAX_BYTES=50,d.poolSize=8192,d._useTypedArrays=function(){if("undefined"==typeof Uint8Array||"undefined"==typeof ArrayBuffer)return!1;try{var a=new Uint8Array(0);return a.foo=function(){return 42},42===a.foo()&&"function"==typeof a.subarray}catch(b){return!1}}(),d.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.isBuffer=function(a){return!(null===a||void 0===a||!a._isBuffer)},d.byteLength=function(a,b){var c;switch(a+="",b||"utf8"){case"hex":c=a.length/2;break;case"utf8":case"utf-8":c=J(a).length;break;case"ascii":case"binary":case"raw":c=a.length;break;case"base64":c=M(a).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":c=2*a.length;break;default:throw new Error("Unknown encoding")}return c},d.concat=function(a,b){if(S(G(a),"Usage: Buffer.concat(list, [totalLength])\nlist should be an Array."),0===a.length)return new d(0);if(1===a.length)return a[0];var c;if("number"!=typeof b)for(b=0,c=0;c<a.length;c++)b+=a[c].length;var e=new d(b),f=0;for(c=0;c<a.length;c++){var g=a[c];g.copy(e,f),f+=g.length}return e},d.prototype.write=function(a,b,c,d){if(isFinite(b))isFinite(c)||(d=c,c=void 0);else{var k=d;d=b,b=c,c=k}b=Number(b)||0;var l=this.length-b;c?(c=Number(c),c>l&&(c=l)):c=l,d=String(d||"utf8").toLowerCase();var m;switch(d){case"hex":m=e(this,a,b,c);break;case"utf8":case"utf-8":m=f(this,a,b,c);break;case"ascii":m=g(this,a,b,c);break;case"binary":m=h(this,a,b,c);break;case"base64":m=i(this,a,b,c);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":m=j(this,a,b,c);break;default:throw new Error("Unknown encoding")}return m},d.prototype.toString=function(a,b,c){var d=this;if(a=String(a||"utf8").toLowerCase(),b=Number(b)||0,c=void 0!==c?Number(c):c=d.length,c===b)return"";var e;switch(a){case"hex":e=o(d,b,c);break;case"utf8":case"utf-8":e=l(d,b,c);break;case"ascii":e=m(d,b,c);break;case"binary":e=n(d,b,c);break;case"base64":e=k(d,b,c);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":e=p(d,b,c);break;default:throw new Error("Unknown encoding")}return e},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},d.prototype.copy=function(a,b,c,d){var e=this;if(c||(c=0),d||0===d||(d=this.length),b||(b=0),d!==c&&0!==a.length&&0!==e.length){S(d>=c,"sourceEnd < sourceStart"),S(b>=0&&b<a.length,"targetStart out of bounds"),S(c>=0&&c<e.length,"sourceStart out of bounds"),S(d>=0&&d<=e.length,"sourceEnd out of bounds"),d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);for(var f=0;d-c>f;f++)a[f+b]=this[f+c]}},d.prototype.slice=function(a,b){var c=this.length;if(a=E(a,c,0),b=E(b,c,c),d._useTypedArrays)return D(this.subarray(a,b));for(var e=b-a,f=new d(e,void 0,!0),g=0;e>g;g++)f[g]=this[g+a];return f},d.prototype.get=function(a){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(a)},d.prototype.set=function(a,b){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(a,b)},d.prototype.readUInt8=function(a,b){return b||(S(void 0!==a&&null!==a,"missing offset"),S(a<this.length,"Trying to read beyond buffer length")),a>=this.length?void 0:this[a]},d.prototype.readUInt16LE=function(a,b){return q(this,a,!0,b)},d.prototype.readUInt16BE=function(a,b){return q(this,a,!1,b)},d.prototype.readUInt32LE=function(a,b){return r(this,a,!0,b)},d.prototype.readUInt32BE=function(a,b){return r(this,a,!1,b)},d.prototype.readInt8=function(a,b){if(b||(S(void 0!==a&&null!==a,"missing offset"),S(a<this.length,"Trying to read beyond buffer length")),!(a>=this.length)){var c=128&this[a];return c?-1*(255-this[a]+1):this[a]}},d.prototype.readInt16LE=function(a,b){return s(this,a,!0,b)},d.prototype.readInt16BE=function(a,b){return s(this,a,!1,b)},d.prototype.readInt32LE=function(a,b){return t(this,a,!0,b)},d.prototype.readInt32BE=function(a,b){return t(this,a,!1,b)},d.prototype.readFloatLE=function(a,b){return u(this,a,!0,b)},d.prototype.readFloatBE=function(a,b){return u(this,a,!1,b)},d.prototype.readDoubleLE=function(a,b){return v(this,a,!0,b)},d.prototype.readDoubleBE=function(a,b){return v(this,a,!1,b)},d.prototype.writeUInt8=function(a,b,c){c||(S(void 0!==a&&null!==a,"missing value"),S(void 0!==b&&null!==b,"missing offset"),S(b<this.length,"trying to write beyond buffer length"),P(a,255)),b>=this.length||(this[b]=a)},d.prototype.writeUInt16LE=function(a,b,c){w(this,a,b,!0,c)},d.prototype.writeUInt16BE=function(a,b,c){w(this,a,b,!1,c)},d.prototype.writeUInt32LE=function(a,b,c){x(this,a,b,!0,c)},d.prototype.writeUInt32BE=function(a,b,c){x(this,a,b,!1,c)},d.prototype.writeInt8=function(a,b,c){c||(S(void 0!==a&&null!==a,"missing value"),S(void 0!==b&&null!==b,"missing offset"),S(b<this.length,"Trying to write beyond buffer length"),Q(a,127,-128)),b>=this.length||(a>=0?this.writeUInt8(a,b,c):this.writeUInt8(255+a+1,b,c))},d.prototype.writeInt16LE=function(a,b,c){y(this,a,b,!0,c)},d.prototype.writeInt16BE=function(a,b,c){y(this,a,b,!1,c)},d.prototype.writeInt32LE=function(a,b,c){z(this,a,b,!0,c)},d.prototype.writeInt32BE=function(a,b,c){z(this,a,b,!1,c)},d.prototype.writeFloatLE=function(a,b,c){A(this,a,b,!0,c)},d.prototype.writeFloatBE=function(a,b,c){A(this,a,b,!1,c)},d.prototype.writeDoubleLE=function(a,b,c){B(this,a,b,!0,c)},d.prototype.writeDoubleBE=function(a,b,c){B(this,a,b,!1,c)},d.prototype.fill=function(a,b,c){if(a||(a=0),b||(b=0),c||(c=this.length),"string"==typeof a&&(a=a.charCodeAt(0)),S("number"==typeof a&&!isNaN(a),"value is not a number"),S(c>=b,"end < start"),c!==b&&0!==this.length){S(b>=0&&b<this.length,"start out of bounds"),S(c>=0&&c<=this.length,"end out of bounds");for(var d=b;c>d;d++)this[d]=a}},d.prototype.inspect=function(){for(var a=[],b=this.length,d=0;b>d;d++)if(a[d]=I(this[d]),d===c.INSPECT_MAX_BYTES){a[d+1]="...";break}return"<Buffer "+a.join(" ")+">"},d.prototype.toArrayBuffer=function(){if("function"==typeof Uint8Array){if(d._useTypedArrays)return new d(this).buffer;for(var a=new Uint8Array(this.length),b=0,c=a.length;c>b;b+=1)a[b]=this[b];return a.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var V=d.prototype},{"base64-js":3,ieee754:4}],3:[function(a,b){var c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(){"use strict";function a(a){var b=a.charCodeAt(0);return b===g?62:b===h?63:i>b?-1:i+10>b?b-i+26+26:k+26>b?b-k:j+26>b?b-j+26:void 0}function d(b){function c(a){j[l++]=a}var d,e,g,h,i,j;if(b.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var k=b.length;i="="===b.charAt(k-2)?2:"="===b.charAt(k-1)?1:0,j=new f(3*b.length/4-i),g=i>0?b.length-4:b.length;var l=0;for(d=0,e=0;g>d;d+=4,e+=3)h=a(b.charAt(d))<<18|a(b.charAt(d+1))<<12|a(b.charAt(d+2))<<6|a(b.charAt(d+3)),c((16711680&h)>>16),c((65280&h)>>8),c(255&h);return 2===i?(h=a(b.charAt(d))<<2|a(b.charAt(d+1))>>4,c(255&h)):1===i&&(h=a(b.charAt(d))<<10|a(b.charAt(d+1))<<4|a(b.charAt(d+2))>>2,c(h>>8&255),c(255&h)),j}function e(a){function b(a){return c.charAt(a)}function d(a){return b(a>>18&63)+b(a>>12&63)+b(a>>6&63)+b(63&a)}var e,f,g,h=a.length%3,i="";for(e=0,g=a.length-h;g>e;e+=3)f=(a[e]<<16)+(a[e+1]<<8)+a[e+2],i+=d(f);switch(h){case 1:f=a[a.length-1],i+=b(f>>2),i+=b(f<<4&63),i+="==";break;case 2:f=(a[a.length-2]<<8)+a[a.length-1],i+=b(f>>10),i+=b(f>>4&63),i+=b(f<<2&63),i+="="}return i}var f="undefined"!=typeof Uint8Array?Uint8Array:Array,g=("0".charCodeAt(0),"+".charCodeAt(0)),h="/".charCodeAt(0),i="0".charCodeAt(0),j="a".charCodeAt(0),k="A".charCodeAt(0);b.exports.toByteArray=d,b.exports.fromByteArray=e}()},{}],4:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?0/0:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=0>b||0===b&&0>1/b?1:0;for(b=Math.abs(b),isNaN(b)||1/0===b?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],5:[function(a,b){var c=b.exports={};c.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};if(b){var c=[];return window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),c.length>0)){var d=c.shift();d()}},!0),function(a){c.push(a),window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}(),c.title="browser",c.browser=!0,c.env={},c.argv=[],c.binding=function(){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(){throw new Error("process.chdir is not supported")}},{}],6:[function(d,e,f){(function(){var d=this,h=h||{};h.WEBGL_RENDERER=0,h.CANVAS_RENDERER=1,h.VERSION="v1.5.1",h.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},h.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},h.INTERACTION_FREQUENCY=30,h.AUTO_PREVENT_DEFAULT=!0,h.RAD_TO_DEG=180/Math.PI,h.DEG_TO_RAD=Math.PI/180,h.Point=function(a,b){this.x=a||0,this.y=b||0},h.Point.prototype.clone=function(){return new h.Point(this.x,this.y)},h.Point.prototype.constructor=h.Point,h.Point.prototype.set=function(a,b){this.x=a||0,this.y=b||(0!==b?this.x:0)},h.Rectangle=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},h.Rectangle.prototype.clone=function(){return new h.Rectangle(this.x,this.y,this.width,this.height)},h.Rectangle.prototype.contains=function(a,b){if(this.width<=0||this.height<=0)return!1;var c=this.x;if(a>=c&&a<=c+this.width){var d=this.y;if(b>=d&&b<=d+this.height)return!0}return!1},h.Rectangle.prototype.constructor=h.Rectangle,h.EmptyRectangle=new h.Rectangle(0,0,0,0),h.Polygon=function(a){if(a instanceof Array||(a=Array.prototype.slice.call(arguments)),"number"==typeof a[0]){for(var b=[],c=0,d=a.length;d>c;c+=2)b.push(new h.Point(a[c],a[c+1]));a=b}this.points=a},h.Polygon.prototype.clone=function(){for(var a=[],b=0;b<this.points.length;b++)a.push(this.points[b].clone());return new h.Polygon(a)},h.Polygon.prototype.contains=function(a,b){for(var c=!1,d=0,e=this.points.length-1;d<this.points.length;e=d++){var f=this.points[d].x,g=this.points[d].y,h=this.points[e].x,i=this.points[e].y,j=g>b!=i>b&&(h-f)*(b-g)/(i-g)+f>a;j&&(c=!c)}return c},h.Polygon.prototype.constructor=h.Polygon,h.Circle=function(a,b,c){this.x=a||0,this.y=b||0,this.radius=c||0},h.Circle.prototype.clone=function(){return new h.Circle(this.x,this.y,this.radius)},h.Circle.prototype.contains=function(a,b){if(this.radius<=0)return!1;var c=this.x-a,d=this.y-b,e=this.radius*this.radius;return c*=c,d*=d,e>=c+d},h.Circle.prototype.constructor=h.Circle,h.Ellipse=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},h.Ellipse.prototype.clone=function(){return new h.Ellipse(this.x,this.y,this.width,this.height)},h.Ellipse.prototype.contains=function(a,b){if(this.width<=0||this.height<=0)return!1;var c=(a-this.x)/this.width,d=(b-this.y)/this.height;return c*=c,d*=d,1>=c+d},h.Ellipse.prototype.getBounds=function(){return new h.Rectangle(this.x,this.y,this.width,this.height)},h.Ellipse.prototype.constructor=h.Ellipse,h.determineMatrixArrayType=function(){return"undefined"!=typeof Float32Array?Float32Array:Array},h.Matrix2=h.determineMatrixArrayType(),h.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},h.Matrix.prototype.fromArray=function(a){this.a=a[0],this.b=a[1],this.c=a[3],this.d=a[4],this.tx=a[2],this.ty=a[5]},h.Matrix.prototype.toArray=function(a){this.array||(this.array=new Float32Array(9));var b=this.array;return a?(this.array[0]=this.a,this.array[1]=this.c,this.array[2]=0,this.array[3]=this.b,this.array[4]=this.d,this.array[5]=0,this.array[6]=this.tx,this.array[7]=this.ty,this.array[8]=1):(this.array[0]=this.a,this.array[1]=this.b,this.array[2]=this.tx,this.array[3]=this.c,this.array[4]=this.d,this.array[5]=this.ty,this.array[6]=0,this.array[7]=0,this.array[8]=1),b},h.identityMatrix=new h.Matrix,h.DisplayObject=function(){this.position=new h.Point,this.scale=new h.Point(1,1),this.pivot=new h.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new h.Matrix,this.color=[],this.dynamic=!0,this._sr=0,this._cr=1,this.filterArea=new h.Rectangle(0,0,1,1),this._bounds=new h.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null},h.DisplayObject.prototype.constructor=h.DisplayObject,h.DisplayObject.prototype.setInteractive=function(a){this.interactive=a},Object.defineProperty(h.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(a){this._interactive=a,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(h.DisplayObject.prototype,"worldVisible",{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);return!0}}),Object.defineProperty(h.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(a){this._mask&&(this._mask.isMask=!1),this._mask=a,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(h.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(a){if(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].passes,e=0;e<d.length;e++)b.push(d[e]);this._filterBlock={target:this,filterPasses:b}}this._filters=a}}),h.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var a=this.parent.worldTransform,b=this.worldTransform,c=this.pivot.x,d=this.pivot.y,e=this._cr*this.scale.x,f=-this._sr*this.scale.y,g=this._sr*this.scale.x,h=this._cr*this.scale.y,i=this.position.x-e*c-d*f,j=this.position.y-h*d-c*g,k=a.a,l=a.b,m=a.c,n=a.d;b.a=k*e+l*g,b.b=k*f+l*h,b.tx=k*i+l*j+a.tx,b.c=m*e+n*g,b.d=m*f+n*h,b.ty=m*i+n*j+a.ty,this.worldAlpha=this.alpha*this.parent.worldAlpha},h.DisplayObject.prototype.getBounds=function(a){return a=a,h.EmptyRectangle},h.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(h.identityMatrix)},h.DisplayObject.prototype.setStageReference=function(a){this.stage=a,this._interactive&&(this.stage.dirty=!0)},h.DisplayObject.prototype._renderWebGL=function(a){a=a},h.DisplayObject.prototype._renderCanvas=function(a){a=a},Object.defineProperty(h.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),Object.defineProperty(h.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),h.DisplayObjectContainer=function(){h.DisplayObject.call(this),this.children=[]},h.DisplayObjectContainer.prototype=Object.create(h.DisplayObject.prototype),h.DisplayObjectContainer.prototype.constructor=h.DisplayObjectContainer,h.DisplayObjectContainer.prototype.addChild=function(a){this.addChildAt(a,this.children.length)},h.DisplayObjectContainer.prototype.addChildAt=function(a,b){if(!(b>=0&&b<=this.children.length))throw new Error(a+" The index "+b+" supplied is out of bounds "+this.children.length);a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),this.stage&&a.setStageReference(this.stage)},h.DisplayObjectContainer.prototype.swapChildren=function(a,b){if(a!==b){var c=this.children.indexOf(a),d=this.children.indexOf(b);if(0>c||0>d)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[c]=b,this.children[d]=a}},h.DisplayObjectContainer.prototype.getChildAt=function(a){if(a>=0&&a<this.children.length)return this.children[a];throw new Error("The supplied DisplayObjects must be a child of the caller "+this)},h.DisplayObjectContainer.prototype.removeChild=function(a){var b=this.children.indexOf(a);if(-1===b)throw new Error(a+" The supplied DisplayObject must be a child of the caller "+this);this.stage&&a.removeStageReference(),a.parent=void 0,this.children.splice(b,1)},h.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible){h.DisplayObject.prototype.updateTransform.call(this);for(var a=0,b=this.children.length;b>a;a++)this.children[a].updateTransform()}},h.DisplayObjectContainer.prototype.getBounds=function(a){if(0===this.children.length)return h.EmptyRectangle;if(a){var b=this.worldTransform;this.worldTransform=a,this.updateTransform(),this.worldTransform=b}for(var c,d,e,f=1/0,g=1/0,i=-1/0,j=-1/0,k=!1,l=0,m=this.children.length;m>l;l++){var n=this.children[l];n.visible&&(k=!0,c=this.children[l].getBounds(a),f=f<c.x?f:c.x,g=g<c.y?g:c.y,d=c.width+c.x,e=c.height+c.y,i=i>d?i:d,j=j>e?j:e)}if(!k)return h.EmptyRectangle;var o=this._bounds;return o.x=f,o.y=g,o.width=i-f,o.height=j-g,o},h.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=h.identityMatrix;for(var b=0,c=this.children.length;c>b;b++)this.children[b].updateTransform();var d=this.getBounds();return this.worldTransform=a,d},h.DisplayObjectContainer.prototype.setStageReference=function(a){this.stage=a,this._interactive&&(this.stage.dirty=!0);for(var b=0,c=this.children.length;c>b;b++){var d=this.children[b];d.setStageReference(a)}},h.DisplayObjectContainer.prototype.removeStageReference=function(){for(var a=0,b=this.children.length;b>a;a++){var c=this.children[a];c.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},h.DisplayObjectContainer.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){var b,c;if(this._mask||this._filters){for(this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop(),this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(a),a.spriteBatch.start()}else for(b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}},h.DisplayObjectContainer.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){this._mask&&a.maskManager.pushMask(this._mask,a.context);for(var b=0,c=this.children.length;c>b;b++){var d=this.children[b];d._renderCanvas(a)}this._mask&&a.maskManager.popMask(a.context)}},h.Sprite=function(a){h.DisplayObjectContainer.call(this),this.anchor=new h.Point,this.texture=a,this._width=0,this._height=0,this.tint=16777215,this.blendMode=h.blendModes.NORMAL,a.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},h.Sprite.prototype=Object.create(h.DisplayObjectContainer.prototype),h.Sprite.prototype.constructor=h.Sprite,Object.defineProperty(h.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width,this._width=a}}),Object.defineProperty(h.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height,this._height=a}}),h.Sprite.prototype.setTexture=function(a){this.texture.baseTexture!==a.baseTexture?(this.textureChange=!0,this.texture=a):this.texture=a,this.cachedTint=16777215,this.updateFrame=!0},h.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height),this.updateFrame=!0},h.Sprite.prototype.getBounds=function(a){var b=this.texture.frame.width,c=this.texture.frame.height,d=b*(1-this.anchor.x),e=b*-this.anchor.x,f=c*(1-this.anchor.y),g=c*-this.anchor.y,h=a||this.worldTransform,i=h.a,j=h.c,k=h.b,l=h.d,m=h.tx,n=h.ty,o=i*e+k*g+m,p=l*g+j*e+n,q=i*d+k*g+m,r=l*g+j*d+n,s=i*d+k*f+m,t=l*f+j*d+n,u=i*e+k*f+m,v=l*f+j*e+n,w=-1/0,x=-1/0,y=1/0,z=1/0;y=y>o?o:y,y=y>q?q:y,y=y>s?s:y,y=y>u?u:y,z=z>p?p:z,z=z>r?r:z,z=z>t?t:z,z=z>v?v:z,w=o>w?o:w,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w,x=p>x?p:x,x=r>x?r:x,x=t>x?t:x,x=v>x?v:x;var A=this._bounds;return A.x=y,A.width=w-y,A.y=z,A.height=x-z,this._currentBounds=A,A},h.Sprite.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){var b,c;if(this._mask||this._filters){var d=a.spriteBatch;for(this._mask&&(d.stop(),a.maskManager.pushMask(this.mask,a),d.start()),this._filters&&(d.flush(),a.filterManager.pushFilter(this._filterBlock)),d.render(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);d.stop(),this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(a),d.start()}else for(a.spriteBatch.render(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}},h.Sprite.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){var b=this.texture.frame,c=a.context,d=this.texture;if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=h.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a.context),b&&b.width&&b.height&&d.baseTexture.source){c.globalAlpha=this.worldAlpha;var e=this.worldTransform;if(a.roundPixels?c.setTransform(e.a,e.c,e.b,e.d,e.tx||0,e.ty||0):c.setTransform(e.a,e.c,e.b,e.d,e.tx,e.ty),a.smoothProperty&&a.scaleMode!==this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,c[a.smoothProperty]=a.scaleMode===h.scaleModes.LINEAR),16777215!==this.tint){if(this.cachedTint!==this.tint){if(!d.baseTexture.hasLoaded)return;this.cachedTint=this.tint,this.tintedTexture=h.CanvasTinter.getTintedTexture(this,this.tint)}c.drawImage(this.tintedTexture,0,0,b.width,b.height,this.anchor.x*-b.width,this.anchor.y*-b.height,b.width,b.height)}else if(d.trim){var f=d.trim;c.drawImage(this.texture.baseTexture.source,b.x,b.y,b.width,b.height,f.x-this.anchor.x*f.width,f.y-this.anchor.y*f.height,b.width,b.height)}else c.drawImage(this.texture.baseTexture.source,b.x,b.y,b.width,b.height,this.anchor.x*-b.width,this.anchor.y*-b.height,b.width,b.height)}for(var g=0,i=this.children.length;i>g;g++){var j=this.children[g];j._renderCanvas(a)}this._mask&&a.maskManager.popMask(a.context)}},h.Sprite.fromFrame=function(a){var b=h.TextureCache[a];if(!b)throw new Error('The frameId "'+a+'" does not exist in the texture cache'+this);return new h.Sprite(b)},h.Sprite.fromImage=function(a,b,c){var d=h.Texture.fromImage(a,b,c);return new h.Sprite(d)},h.SpriteBatch=function(a){h.DisplayObjectContainer.call(this),this.textureThing=a,this.ready=!1},h.SpriteBatch.prototype=Object.create(h.DisplayObjectContainer.prototype),h.SpriteBatch.constructor=h.SpriteBatch,h.SpriteBatch.prototype.initWebGL=function(a){this.fastSpriteBatch=new h.WebGLFastSpriteBatch(a),this.ready=!0},h.SpriteBatch.prototype.updateTransform=function(){h.DisplayObject.prototype.updateTransform.call(this)},h.SpriteBatch.prototype._renderWebGL=function(a){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(a.gl),a.spriteBatch.stop(),a.shaderManager.activateShader(a.shaderManager.fastShader),this.fastSpriteBatch.begin(this,a),this.fastSpriteBatch.render(this),a.shaderManager.activateShader(a.shaderManager.defaultShader),a.spriteBatch.start())},h.SpriteBatch.prototype._renderCanvas=function(a){var b=a.context;b.globalAlpha=this.worldAlpha;var c=this.worldTransform;a.roundPixels?b.setTransform(c.a,c.c,c.b,c.d,Math.floor(c.tx),Math.floor(c.ty)):b.setTransform(c.a,c.c,c.b,c.d,c.tx,c.ty),b.save();for(var d=0;d<this.children.length;d++){var e=this.children[d],f=e.texture,g=f.frame;if(b.globalAlpha=this.worldAlpha*e.alpha,e.rotation%(2*Math.PI)===0)b.drawImage(f.baseTexture.source,g.x,g.y,g.width,g.height,e.anchor.x*-g.width*e.scale.x+e.position.x+.5|0,e.anchor.y*-g.height*e.scale.y+e.position.y+.5|0,g.width*e.scale.x,g.height*e.scale.y);else{h.DisplayObject.prototype.updateTransform.call(e),c=e.localTransform,this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var i=e._cr*e.scale.x,j=-e._sr*e.scale.y,k=e._sr*e.scale.x,l=e._cr*e.scale.y;b.setTransform(i,k,j,l,e.position.x,e.position.y),b.drawImage(f.baseTexture.source,g.x,g.y,g.width,g.height,e.anchor.x*-g.width+.5|0,e.anchor.y*-g.height+.5|0,g.width,g.height)}}b.restore()},h.MovieClip=function(a){h.Sprite.call(this,a[0]),this.textures=a,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},h.MovieClip.prototype=Object.create(h.Sprite.prototype),h.MovieClip.prototype.constructor=h.MovieClip,Object.defineProperty(h.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),h.MovieClip.prototype.stop=function(){this.playing=!1},h.MovieClip.prototype.play=function(){this.playing=!0},h.MovieClip.prototype.gotoAndStop=function(a){this.playing=!1,this.currentFrame=a;var b=this.currentFrame+.5|0;this.setTexture(this.textures[b%this.textures.length])},h.MovieClip.prototype.gotoAndPlay=function(a){this.currentFrame=a,this.playing=!0},h.MovieClip.prototype.updateTransform=function(){if(h.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var a=this.currentFrame+.5|0;this.loop||a<this.textures.length?this.setTexture(this.textures[a%this.textures.length]):a>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},h.FilterBlock=function(){this.visible=!0,this.renderable=!0},h.Text=function(a,b){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),h.Sprite.call(this,h.Texture.fromCanvas(this.canvas)),this.setText(a),this.setStyle(b),this.updateText(),this.dirty=!1},h.Text.prototype=Object.create(h.Sprite.prototype),h.Text.prototype.constructor=h.Text,h.Text.prototype.setStyle=function(a){a=a||{},a.font=a.font||"bold 20pt Arial",a.fill=a.fill||"black",a.align=a.align||"left",a.stroke=a.stroke||"black",a.strokeThickness=a.strokeThickness||0,a.wordWrap=a.wordWrap||!1,a.wordWrapWidth=a.wordWrapWidth||100,this.style=a,this.dirty=!0},h.Text.prototype.setText=function(a){this.text=a.toString()||" ",this.dirty=!0},h.Text.prototype.updateText=function(){this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.wordWrap(this.text));for(var b=a.split(/(?:\r\n|\r|\n)/),c=[],d=0,e=0;e<b.length;e++){var f=this.context.measureText(b[e]).width;c[e]=f,d=Math.max(d,f)}this.canvas.width=d+this.style.strokeThickness;var g=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;for(this.canvas.height=g*b.length,navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",e=0;e<b.length;e++){var i=new h.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+e*g);
"right"===this.style.align?i.x+=d-c[e]:"center"===this.style.align&&(i.x+=(d-c[e])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(b[e],i.x,i.y),this.style.fill&&this.context.fillText(b[e],i.x,i.y)}this.updateTexture()},h.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.frame.width=this.canvas.width,this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.requiresUpdate=!0},h.Text.prototype._renderWebGL=function(a){this.requiresUpdate&&(this.requiresUpdate=!1,h.updateWebGLTexture(this.texture.baseTexture,a.gl)),h.Sprite.prototype._renderWebGL.call(this,a)},h.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),h.Sprite.prototype.updateTransform.call(this)},h.Text.prototype.determineFontHeight=function(a){var b=h.Text.heightCache[a];if(!b){var c=document.getElementsByTagName("body")[0],d=document.createElement("div"),e=document.createTextNode("M");d.appendChild(e),d.setAttribute("style",a+";position:absolute;top:0;left:0"),c.appendChild(d),b=d.offsetHeight,h.Text.heightCache[a]=b,c.removeChild(d)}return b},h.Text.prototype.wordWrap=function(a){for(var b="",c=a.split("\n"),d=0;d<c.length;d++){for(var e=this.style.wordWrapWidth,f=c[d].split(" "),g=0;g<f.length;g++){var h=this.context.measureText(f[g]).width,i=h+this.context.measureText(" ").width;i>e?(g>0&&(b+="\n"),b+=f[g]+" ",e=this.style.wordWrapWidth-h):(e-=i,b+=f[g]+" ")}d<c.length-1&&(b+="\n")}return b},h.Text.prototype.destroy=function(a){a&&this.texture.destroy()},h.Text.heightCache={},h.BitmapText=function(a,b){h.DisplayObjectContainer.call(this),this._pool=[],this.setText(a),this.setStyle(b),this.updateText(),this.dirty=!1},h.BitmapText.prototype=Object.create(h.DisplayObjectContainer.prototype),h.BitmapText.prototype.constructor=h.BitmapText,h.BitmapText.prototype.setText=function(a){this.text=a||" ",this.dirty=!0},h.BitmapText.prototype.setStyle=function(a){a=a||{},a.align=a.align||"left",this.style=a;var b=a.font.split(" ");this.fontName=b[b.length-1],this.fontSize=b.length>=2?parseInt(b[b.length-2],10):h.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=a.tint},h.BitmapText.prototype.updateText=function(){for(var a=h.BitmapText.fonts[this.fontName],b=new h.Point,c=null,d=[],e=0,f=[],g=0,i=this.fontSize/a.size,j=0;j<this.text.length;j++){var k=this.text.charCodeAt(j);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(j)))f.push(b.x),e=Math.max(e,b.x),g++,b.x=0,b.y+=a.lineHeight,c=null;else{var l=a.chars[k];l&&(c&&l[c]&&(b.x+=l.kerning[c]),d.push({texture:l.texture,line:g,charCode:k,position:new h.Point(b.x+l.xOffset,b.y+l.yOffset)}),b.x+=l.xAdvance,c=k)}}f.push(b.x),e=Math.max(e,b.x);var m=[];for(j=0;g>=j;j++){var n=0;"right"===this.style.align?n=e-f[j]:"center"===this.style.align&&(n=(e-f[j])/2),m.push(n)}var o=this.children.length,p=d.length,q=this.tint||16777215;for(j=0;p>j;j++){var r=o>j?this.children[j]:this._pool.pop();r?r.setTexture(d[j].texture):r=new h.Sprite(d[j].texture),r.position.x=(d[j].position.x+m[d[j].line])*i,r.position.y=d[j].position.y*i,r.scale.x=r.scale.y=i,r.tint=q,r.parent||this.addChild(r)}for(;this.children.length>p;){var s=this.getChildAt(this.children.length-1);this._pool.push(s),this.removeChild(s)}this.textWidth=e*i,this.textHeight=(b.y+a.lineHeight)*i},h.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),h.DisplayObjectContainer.prototype.updateTransform.call(this)},h.BitmapText.fonts={},h.InteractionData=function(){this.global=new h.Point,this.local=new h.Point,this.target=null,this.originalEvent=null},h.InteractionData.prototype.getLocalPosition=function(a){var b=a.worldTransform,c=this.global,d=b.a,e=b.b,f=b.tx,g=b.c,i=b.d,j=b.ty,k=1/(d*i+e*-g);return new h.Point(i*k*c.x+-e*k*c.y+(j*e-f*i)*k,d*k*c.y+-g*k*c.x+(-j*d+f*g)*k)},h.InteractionData.prototype.constructor=h.InteractionData,h.InteractionManager=function(a){this.stage=a,this.mouse=new h.InteractionData,this.touchs={},this.tempPoint=new h.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1},h.InteractionManager.prototype.constructor=h.InteractionManager,h.InteractionManager.prototype.collectInteractiveSprite=function(a,b){for(var c=a.children,d=c.length,e=d-1;e>=0;e--){var f=c[e];f.interactive?(b.interactiveChildren=!0,this.interactiveItems.push(f),f.children.length>0&&this.collectInteractiveSprite(f,f)):(f.__iParent=null,f.children.length>0&&this.collectInteractiveSprite(f,b))}},h.InteractionManager.prototype.setTarget=function(a){this.target=a,null===this.interactionDOMElement&&this.setTargetDomElement(a.view)},h.InteractionManager.prototype.setTargetDomElement=function(a){this.removeEvents(),window.navigator.msPointerEnabled&&(a.style["-ms-content-zooming"]="none",a.style["-ms-touch-action"]="none"),this.interactionDOMElement=a,a.addEventListener("mousemove",this.onMouseMove,!0),a.addEventListener("mousedown",this.onMouseDown,!0),a.addEventListener("mouseout",this.onMouseOut,!0),a.addEventListener("touchstart",this.onTouchStart,!0),a.addEventListener("touchend",this.onTouchEnd,!0),a.addEventListener("touchmove",this.onTouchMove,!0),document.body.addEventListener("mouseup",this.onMouseUp,!0)},h.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,document.body.removeEventListener("mouseup",this.onMouseUp,!0))},h.InteractionManager.prototype.update=function(){if(this.target){var a=Date.now(),b=a-this.last;if(b=b*h.INTERACTION_FREQUENCY/1e3,!(1>b)){this.last=a;var c=0;if(this.dirty){this.dirty=!1;var d=this.interactiveItems.length;for(c=0;d>c;c++)this.interactiveItems[c].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)}var e=this.interactiveItems.length,f="inherit",g=!1;for(c=0;e>c;c++){var i=this.interactiveItems[c];i.__hit=this.hitTest(i,this.mouse),this.mouse.target=i,i.__hit&&!g?(i.buttonMode&&(f=i.defaultCursor),i.interactiveChildren||(g=!0),i.__isOver||(i.mouseover&&i.mouseover(this.mouse),i.__isOver=!0)):i.__isOver&&(i.mouseout&&i.mouseout(this.mouse),i.__isOver=!1)}this.currentCursorStyle!==f&&(this.currentCursorStyle=f,this.interactionDOMElement.style.cursor=f)}}},h.InteractionManager.prototype.onMouseMove=function(a){this.mouse.originalEvent=a||window.event;var b=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(a.clientX-b.left)*(this.target.width/b.width),this.mouse.global.y=(a.clientY-b.top)*(this.target.height/b.height);for(var c=this.interactiveItems.length,d=0;c>d;d++){var e=this.interactiveItems[d];e.mousemove&&e.mousemove(this.mouse)}},h.InteractionManager.prototype.onMouseDown=function(a){this.mouse.originalEvent=a||window.event,h.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var b=this.interactiveItems.length,c=0;b>c;c++){var d=this.interactiveItems[c];if((d.mousedown||d.click)&&(d.__mouseIsDown=!0,d.__hit=this.hitTest(d,this.mouse),d.__hit&&(d.mousedown&&d.mousedown(this.mouse),d.__isDown=!0,!d.interactiveChildren)))break}},h.InteractionManager.prototype.onMouseOut=function(){var a=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var b=0;a>b;b++){var c=this.interactiveItems[b];c.__isOver&&(this.mouse.target=c,c.mouseout&&c.mouseout(this.mouse),c.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},h.InteractionManager.prototype.onMouseUp=function(a){this.mouse.originalEvent=a||window.event;for(var b=this.interactiveItems.length,c=!1,d=0;b>d;d++){var e=this.interactiveItems[d];e.__hit=this.hitTest(e,this.mouse),e.__hit&&!c?(e.mouseup&&e.mouseup(this.mouse),e.__isDown&&e.click&&e.click(this.mouse),e.interactiveChildren||(c=!0)):e.__isDown&&e.mouseupoutside&&e.mouseupoutside(this.mouse),e.__isDown=!1}},h.InteractionManager.prototype.hitTest=function(a,b){var c=b.global;if(!a.worldVisible)return!1;var d=a instanceof h.Sprite,e=a.worldTransform,f=e.a,g=e.b,i=e.tx,j=e.c,k=e.d,l=e.ty,m=1/(f*k+g*-j),n=k*m*c.x+-g*m*c.y+(l*g-i*k)*m,o=f*m*c.y+-j*m*c.x+(-l*f+i*j)*m;if(b.target=a,a.hitArea&&a.hitArea.contains)return a.hitArea.contains(n,o)?(b.target=a,!0):!1;if(d){var p,q=a.texture.frame.width,r=a.texture.frame.height,s=-q*a.anchor.x;if(n>s&&s+q>n&&(p=-r*a.anchor.y,o>p&&p+r>o))return b.target=a,!0}for(var t=a.children.length,u=0;t>u;u++){var v=a.children[u],w=this.hitTest(v,b);if(w)return b.target=a,!0}return!1},h.InteractionManager.prototype.onTouchMove=function(a){var b,c=this.interactionDOMElement.getBoundingClientRect(),d=a.changedTouches,e=0;for(e=0;e<d.length;e++){var f=d[e];b=this.touchs[f.identifier],b.originalEvent=a||window.event,b.global.x=(f.clientX-c.left)*(this.target.width/c.width),b.global.y=(f.clientY-c.top)*(this.target.height/c.height),navigator.isCocoonJS&&(b.global.x=f.clientX,b.global.y=f.clientY)}var g=this.interactiveItems.length;for(e=0;g>e;e++){var h=this.interactiveItems[e];h.touchmove&&h.touchmove(b)}},h.InteractionManager.prototype.onTouchStart=function(a){var b=this.interactionDOMElement.getBoundingClientRect();h.AUTO_PREVENT_DEFAULT&&a.preventDefault();for(var c=a.changedTouches,d=0;d<c.length;d++){var e=c[d],f=this.pool.pop();f||(f=new h.InteractionData),f.originalEvent=a||window.event,this.touchs[e.identifier]=f,f.global.x=(e.clientX-b.left)*(this.target.width/b.width),f.global.y=(e.clientY-b.top)*(this.target.height/b.height),navigator.isCocoonJS&&(f.global.x=e.clientX,f.global.y=e.clientY);for(var g=this.interactiveItems.length,i=0;g>i;i++){var j=this.interactiveItems[i];if((j.touchstart||j.tap)&&(j.__hit=this.hitTest(j,f),j.__hit&&(j.touchstart&&j.touchstart(f),j.__isDown=!0,j.__touchData=f,!j.interactiveChildren)))break}}},h.InteractionManager.prototype.onTouchEnd=function(a){for(var b=this.interactionDOMElement.getBoundingClientRect(),c=a.changedTouches,d=0;d<c.length;d++){var e=c[d],f=this.touchs[e.identifier],g=!1;f.global.x=(e.clientX-b.left)*(this.target.width/b.width),f.global.y=(e.clientY-b.top)*(this.target.height/b.height),navigator.isCocoonJS&&(f.global.x=e.clientX,f.global.y=e.clientY);for(var h=this.interactiveItems.length,i=0;h>i;i++){var j=this.interactiveItems[i],k=j.__touchData;j.__hit=this.hitTest(j,f),k===f&&(f.originalEvent=a||window.event,(j.touchend||j.tap)&&(j.__hit&&!g?(j.touchend&&j.touchend(f),j.__isDown&&j.tap&&j.tap(f),j.interactiveChildren||(g=!0)):j.__isDown&&j.touchendoutside&&j.touchendoutside(f),j.__isDown=!1),j.__touchData=null)}this.pool.push(f),this.touchs[e.identifier]=null}},h.Stage=function(a){h.DisplayObjectContainer.call(this),this.worldTransform=new h.Matrix,this.interactive=!0,this.interactionManager=new h.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new h.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(a)},h.Stage.prototype=Object.create(h.DisplayObjectContainer.prototype),h.Stage.prototype.constructor=h.Stage,h.Stage.prototype.setInteractionDelegate=function(a){this.interactionManager.setTargetDomElement(a)},h.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0,b=this.children.length;b>a;a++)this.children[a].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},h.Stage.prototype.setBackgroundColor=function(a){this.backgroundColor=a||0,this.backgroundColorSplit=h.hex2rgb(this.backgroundColor);var b=this.backgroundColor.toString(16);b="000000".substr(0,6-b.length)+b,this.backgroundColorString="#"+b},h.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var i=0,j=["ms","moz","webkit","o"],k=0;k<j.length&&!window.requestAnimationFrame;++k)window.requestAnimationFrame=window[j[k]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[j[k]+"CancelAnimationFrame"]||window[j[k]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-i)),d=window.setTimeout(function(){a(b+c)},c);return i=b+c,d}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)}),window.requestAnimFrame=window.requestAnimationFrame,h.hex2rgb=function(a){return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]},h.rgb2hex=function(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var a=Array.prototype.slice;return function(b){function c(){var f=e.concat(a.call(arguments));d.apply(this instanceof c?this:b,f)}var d=this,e=a.call(arguments,1);if("function"!=typeof d)throw new TypeError;return c.prototype=function f(a){return a&&(f.prototype=a),this instanceof f?void 0:new f}(d.prototype),c}}()),h.AjaxRequest=function(){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var b=0;b<a.length;b++)try{return new window.ActiveXObject(a[b])}catch(c){}},h.canUseNewCanvasBlendModes=function(){var a=document.createElement("canvas");a.width=1,a.height=1;var b=a.getContext("2d");return b.fillStyle="#000",b.fillRect(0,0,1,1),b.globalCompositeOperation="multiply",b.fillStyle="#fff",b.fillRect(0,0,1,1),0===b.getImageData(0,0,1,1).data[0]},h.getNextPowerOfTwo=function(a){if(a>0&&0===(a&a-1))return a;for(var b=1;a>b;)b<<=1;return b},h.EventTarget=function(){var a={};this.addEventListener=this.on=function(b,c){void 0===a[b]&&(a[b]=[]),-1===a[b].indexOf(c)&&a[b].push(c)},this.dispatchEvent=this.emit=function(b){if(a[b.type]&&a[b.type].length)for(var c=0,d=a[b.type].length;d>c;c++)a[b.type][c](b)},this.removeEventListener=this.off=function(b,c){var d=a[b].indexOf(c);-1!==d&&a[b].splice(d,1)},this.removeAllEventListeners=function(b){var c=a[b];c&&(c.length=0)}},h.autoDetectRenderer=function(a,b,c,d,e){a||(a=800),b||(b=600);var f=function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}();return f?new h.WebGLRenderer(a,b,c,d,e):new h.CanvasRenderer(a,b,c,d)},h.PolyK={},h.PolyK.Triangulate=function(a){var b=!0,c=a.length>>1;if(3>c)return[];for(var d=[],e=[],f=0;c>f;f++)e.push(f);f=0;for(var g=c;g>3;){var i=e[(f+0)%g],j=e[(f+1)%g],k=e[(f+2)%g],l=a[2*i],m=a[2*i+1],n=a[2*j],o=a[2*j+1],p=a[2*k],q=a[2*k+1],r=!1;if(h.PolyK._convex(l,m,n,o,p,q,b)){r=!0;for(var s=0;g>s;s++){var t=e[s];if(t!==i&&t!==j&&t!==k&&h.PolyK._PointInTriangle(a[2*t],a[2*t+1],l,m,n,o,p,q)){r=!1;break}}}if(r)d.push(i,j,k),e.splice((f+1)%g,1),g--,f=0;else if(f++>3*g){if(!b)return window.console.log("PIXI Warning: shape too complex to fill"),[];for(d=[],e=[],f=0;c>f;f++)e.push(f);f=0,g=c,b=!1}}return d.push(e[0],e[1],e[2]),d},h.PolyK._PointInTriangle=function(a,b,c,d,e,f,g,h){var i=g-c,j=h-d,k=e-c,l=f-d,m=a-c,n=b-d,o=i*i+j*j,p=i*k+j*l,q=i*m+j*n,r=k*k+l*l,s=k*m+l*n,t=1/(o*r-p*p),u=(r*q-p*s)*t,v=(o*s-p*q)*t;return u>=0&&v>=0&&1>u+v},h.PolyK._convex=function(a,b,c,d,e,f,g){return(b-d)*(e-c)+(c-a)*(f-d)>=0===g},h.initDefaultShaders=function(){},h.CompileVertexShader=function(a,b){return h._CompileShader(a,b,a.VERTEX_SHADER)},h.CompileFragmentShader=function(a,b){return h._CompileShader(a,b,a.FRAGMENT_SHADER)},h._CompileShader=function(a,b,c){var d=b.join("\n"),e=a.createShader(c);return a.shaderSource(e,d),a.compileShader(e),a.getShaderParameter(e,a.COMPILE_STATUS)?e:(window.console.log(a.getShaderInfoLog(e)),null)},h.compileProgram=function(a,b,c){var d=h.CompileFragmentShader(a,c),e=h.CompileVertexShader(a,b),f=a.createProgram();return a.attachShader(f,e),a.attachShader(f,d),a.linkProgram(f),a.getProgramParameter(f,a.LINK_STATUS)||window.console.log("Could not initialise shaders"),f},h.PixiShader=function(a){this.gl=a,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.attributes=[],this.init()},h.PixiShader.prototype.init=function(){var a=this.gl,b=h.compileProgram(a,this.vertexSrc||h.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(b),this.uSampler=a.getUniformLocation(b,"uSampler"),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.dimensions=a.getUniformLocation(b,"dimensions"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(b,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var c in this.uniforms)this.uniforms[c].uniformLocation=a.getUniformLocation(b,c);this.initUniforms(),this.program=b},h.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var a,b=this.gl;for(var c in this.uniforms){a=this.uniforms[c];var d=a.type;"sampler2D"===d?(a._init=!1,null!==a.value&&this.initSampler2D(a)):"mat2"===d||"mat3"===d||"mat4"===d?(a.glMatrix=!0,a.glValueLength=1,"mat2"===d?a.glFunc=b.uniformMatrix2fv:"mat3"===d?a.glFunc=b.uniformMatrix3fv:"mat4"===d&&(a.glFunc=b.uniformMatrix4fv)):(a.glFunc=b["uniform"+d],a.glValueLength="2f"===d||"2i"===d?2:"3f"===d||"3i"===d?3:"4f"===d||"4i"===d?4:1)}},h.PixiShader.prototype.initSampler2D=function(a){if(a.value&&a.value.baseTexture&&a.value.baseTexture.hasLoaded){var b=this.gl;if(b.activeTexture(b["TEXTURE"+this.textureCount]),b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTexture),a.textureData){var c=a.textureData,d=c.magFilter?c.magFilter:b.LINEAR,e=c.minFilter?c.minFilter:b.LINEAR,f=c.wrapS?c.wrapS:b.CLAMP_TO_EDGE,g=c.wrapT?c.wrapT:b.CLAMP_TO_EDGE,h=c.luminance?b.LUMINANCE:b.RGBA;if(c.repeat&&(f=b.REPEAT,g=b.REPEAT),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!!c.flipY),c.width){var i=c.width?c.width:512,j=c.height?c.height:2,k=c.border?c.border:0;b.texImage2D(b.TEXTURE_2D,0,h,i,j,k,h,b.UNSIGNED_BYTE,null)}else b.texImage2D(b.TEXTURE_2D,0,h,b.RGBA,b.UNSIGNED_BYTE,a.value.baseTexture.source);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,d),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,e),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,g)}b.uniform1i(a.uniformLocation,this.textureCount),a._init=!0,this.textureCount++}},h.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a,b=this.gl;for(var c in this.uniforms)a=this.uniforms[c],1===a.glValueLength?a.glMatrix===!0?a.glFunc.call(b,a.uniformLocation,a.transpose,a.value):a.glFunc.call(b,a.uniformLocation,a.value):2===a.glValueLength?a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y):3===a.glValueLength?a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y,a.value.z):4===a.glValueLength?a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y,a.value.z,a.value.w):"sampler2D"===a.type&&(a._init?(b.activeTexture(b["TEXTURE"+this.textureCount]),b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTextures[b.id]||h.createWebGLTexture(a.value.baseTexture,b)),b.uniform1i(a.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(a))},h.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},h.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],h.PixiFastShader=function(a){this.gl=a,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},h.PixiFastShader.prototype.init=function(){var a=this.gl,b=h.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b),this.uSampler=a.getUniformLocation(b,"uSampler"),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.dimensions=a.getUniformLocation(b,"dimensions"),this.uMatrix=a.getUniformLocation(b,"uMatrix"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.aPositionCoord=a.getAttribLocation(b,"aPositionCoord"),this.aScale=a.getAttribLocation(b,"aScale"),this.aRotation=a.getAttribLocation(b,"aRotation"),this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(b,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=b},h.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},h.StripShader=function(){this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying float vColor;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","   gl_FragColor = gl_FragColor * alpha;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","varying vec2 vTextureCoord;","uniform vec2 offsetVector;","varying float vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition, 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"]},h.StripShader.prototype.init=function(){var a=h.gl,b=h.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b),this.uSampler=a.getUniformLocation(b,"uSampler"),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.colorAttribute=a.getAttribLocation(b,"aColor"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord"),this.translationMatrix=a.getUniformLocation(b,"translationMatrix"),this.alpha=a.getUniformLocation(b,"alpha"),this.program=b},h.PrimitiveShader=function(a){this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},h.PrimitiveShader.prototype.init=function(){var a=this.gl,b=h.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.tintColor=a.getUniformLocation(b,"tint"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.colorAttribute=a.getAttribLocation(b,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=a.getUniformLocation(b,"translationMatrix"),this.alpha=a.getUniformLocation(b,"alpha"),this.program=b},h.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},h.WebGLGraphics=function(){},h.WebGLGraphics.renderGraphics=function(a,b){var c=b.gl,d=b.projection,e=b.offset,f=b.shaderManager.primitiveShader;a._webGL[c.id]||(a._webGL[c.id]={points:[],indices:[],lastIndex:0,buffer:c.createBuffer(),indexBuffer:c.createBuffer()});var g=a._webGL[c.id];a.dirty&&(a.dirty=!1,a.clearDirty&&(a.clearDirty=!1,g.lastIndex=0,g.points=[],g.indices=[]),h.WebGLGraphics.updateGraphics(a,c)),b.shaderManager.activatePrimitiveShader(),c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.uniformMatrix3fv(f.translationMatrix,!1,a.worldTransform.toArray(!0)),c.uniform2f(f.projectionVector,d.x,-d.y),c.uniform2f(f.offsetVector,-e.x,-e.y),c.uniform3fv(f.tintColor,h.hex2rgb(a.tint)),c.uniform1f(f.alpha,a.worldAlpha),c.bindBuffer(c.ARRAY_BUFFER,g.buffer),c.vertexAttribPointer(f.aVertexPosition,2,c.FLOAT,!1,24,0),c.vertexAttribPointer(f.colorAttribute,4,c.FLOAT,!1,24,8),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,g.indexBuffer),c.drawElements(c.TRIANGLE_STRIP,g.indices.length,c.UNSIGNED_SHORT,0),b.shaderManager.deactivatePrimitiveShader()},h.WebGLGraphics.updateGraphics=function(a,b){for(var c=a._webGL[b.id],d=c.lastIndex;d<a.graphicsData.length;d++){var e=a.graphicsData[d];e.type===h.Graphics.POLY?(e.fill&&e.points.length>3&&h.WebGLGraphics.buildPoly(e,c),e.lineWidth>0&&h.WebGLGraphics.buildLine(e,c)):e.type===h.Graphics.RECT?h.WebGLGraphics.buildRectangle(e,c):(e.type===h.Graphics.CIRC||e.type===h.Graphics.ELIP)&&h.WebGLGraphics.buildCircle(e,c)}c.lastIndex=a.graphicsData.length,c.glPoints=new Float32Array(c.points),b.bindBuffer(b.ARRAY_BUFFER,c.buffer),b.bufferData(b.ARRAY_BUFFER,c.glPoints,b.STATIC_DRAW),c.glIndicies=new Uint16Array(c.indices),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,c.glIndicies,b.STATIC_DRAW)},h.WebGLGraphics.buildRectangle=function(a,b){var c=a.points,d=c[0],e=c[1],f=c[2],g=c[3];if(a.fill){var i=h.hex2rgb(a.fillColor),j=a.fillAlpha,k=i[0]*j,l=i[1]*j,m=i[2]*j,n=b.points,o=b.indices,p=n.length/6;n.push(d,e),n.push(k,l,m,j),n.push(d+f,e),n.push(k,l,m,j),n.push(d,e+g),n.push(k,l,m,j),n.push(d+f,e+g),n.push(k,l,m,j),o.push(p,p,p+1,p+2,p+3,p+3)}if(a.lineWidth){var q=a.points;a.points=[d,e,d+f,e,d+f,e+g,d,e+g,d,e],h.WebGLGraphics.buildLine(a,b),a.points=q}},h.WebGLGraphics.buildCircle=function(a,b){var c=a.points,d=c[0],e=c[1],f=c[2],g=c[3],i=40,j=2*Math.PI/i,k=0;if(a.fill){var l=h.hex2rgb(a.fillColor),m=a.fillAlpha,n=l[0]*m,o=l[1]*m,p=l[2]*m,q=b.points,r=b.indices,s=q.length/6;for(r.push(s),k=0;i+1>k;k++)q.push(d,e,n,o,p,m),q.push(d+Math.sin(j*k)*f,e+Math.cos(j*k)*g,n,o,p,m),r.push(s++,s++);r.push(s-1)}if(a.lineWidth){var t=a.points;for(a.points=[],k=0;i+1>k;k++)a.points.push(d+Math.sin(j*k)*f,e+Math.cos(j*k)*g);h.WebGLGraphics.buildLine(a,b),a.points=t}},h.WebGLGraphics.buildLine=function(a,b){var c=0,d=a.points;if(0!==d.length){if(a.lineWidth%2)for(c=0;c<d.length;c++)d[c]+=.5;var e=new h.Point(d[0],d[1]),f=new h.Point(d[d.length-2],d[d.length-1]);if(e.x===f.x&&e.y===f.y){d.pop(),d.pop(),f=new h.Point(d[d.length-2],d[d.length-1]);var g=f.x+.5*(e.x-f.x),i=f.y+.5*(e.y-f.y);d.unshift(g,i),d.push(g,i)}var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=b.points,H=b.indices,I=d.length/2,J=d.length,K=G.length/6,L=a.lineWidth/2,M=h.hex2rgb(a.lineColor),N=a.lineAlpha,O=M[0]*N,P=M[1]*N,Q=M[2]*N;for(l=d[0],m=d[1],n=d[2],o=d[3],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,G.push(l-r,m-s,O,P,Q,N),G.push(l+r,m+s,O,P,Q,N),c=1;I-1>c;c++)l=d[2*(c-1)],m=d[2*(c-1)+1],n=d[2*c],o=d[2*c+1],p=d[2*(c+1)],q=d[2*(c+1)+1],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,t=-(o-q),u=n-p,F=Math.sqrt(t*t+u*u),t/=F,u/=F,t*=L,u*=L,x=-s+m-(-s+o),y=-r+n-(-r+l),z=(-r+l)*(-s+o)-(-r+n)*(-s+m),A=-u+q-(-u+o),B=-t+n-(-t+p),C=(-t+p)*(-u+o)-(-t+n)*(-u+q),D=x*B-A*y,Math.abs(D)<.1?(D+=10.1,G.push(n-r,o-s,O,P,Q,N),G.push(n+r,o+s,O,P,Q,N)):(j=(y*C-B*z)/D,k=(A*z-x*C)/D,E=(j-n)*(j-n)+(k-o)+(k-o),E>19600?(v=r-t,w=s-u,F=Math.sqrt(v*v+w*w),v/=F,w/=F,v*=L,w*=L,G.push(n-v,o-w),G.push(O,P,Q,N),G.push(n+v,o+w),G.push(O,P,Q,N),G.push(n-v,o-w),G.push(O,P,Q,N),J++):(G.push(j,k),G.push(O,P,Q,N),G.push(n-(j-n),o-(k-o)),G.push(O,P,Q,N)));for(l=d[2*(I-2)],m=d[2*(I-2)+1],n=d[2*(I-1)],o=d[2*(I-1)+1],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,G.push(n-r,o-s),G.push(O,P,Q,N),G.push(n+r,o+s),G.push(O,P,Q,N),H.push(K),c=0;J>c;c++)H.push(K++);H.push(K-1)}},h.WebGLGraphics.buildPoly=function(a,b){var c=a.points;if(!(c.length<6)){var d=b.points,e=b.indices,f=c.length/2,g=h.hex2rgb(a.fillColor),i=a.fillAlpha,j=g[0]*i,k=g[1]*i,l=g[2]*i,m=h.PolyK.Triangulate(c),n=d.length/6,o=0;for(o=0;o<m.length;o+=3)e.push(m[o]+n),e.push(m[o]+n),e.push(m[o+1]+n),e.push(m[o+2]+n),e.push(m[o+2]+n);for(o=0;f>o;o++)d.push(c[2*o],c[2*o+1],j,k,l,i)}},h.glContexts=[],h.WebGLRenderer=function(a,b,c,d,e){h.defaultRenderer||(h.defaultRenderer=this),this.type=h.WEBGL_RENDERER,this.transparent=!!d,this.width=a||800,this.height=b||600,this.view=c||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height,this.contextLost=this.handleContextLost.bind(this),this.contextRestoredLost=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLost,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,!1),this.options={alpha:this.transparent,antialias:!!e,premultipliedAlpha:!!d,stencil:!0};try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(f){try{this.gl=this.view.getContext("webgl",this.options)}catch(g){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var i=this.gl;this.glContextId=i.id=h.WebGLRenderer.glContextId++,h.glContexts[this.glContextId]=i,h.blendModesWebGL||(h.blendModesWebGL=[],h.blendModesWebGL[h.blendModes.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.ADD]=[i.SRC_ALPHA,i.DST_ALPHA],h.blendModesWebGL[h.blendModes.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.SCREEN]=[i.SRC_ALPHA,i.ONE],h.blendModesWebGL[h.blendModes.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],h.blendModesWebGL[h.blendModes.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA]),this.projection=new h.Point,this.projection.x=this.width/2,this.projection.y=-this.height/2,this.offset=new h.Point(0,0),this.resize(this.width,this.height),this.contextLost=!1,this.shaderManager=new h.WebGLShaderManager(i),this.spriteBatch=new h.WebGLSpriteBatch(i),this.maskManager=new h.WebGLMaskManager(i),this.filterManager=new h.WebGLFilterManager(i,this.transparent),this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.spriteBatch=this.spriteBatch,i.useProgram(this.shaderManager.defaultShader.program),i.disable(i.DEPTH_TEST),i.disable(i.CULL_FACE),i.enable(i.BLEND),i.colorMask(!0,!0,!0,this.transparent)
},h.WebGLRenderer.prototype.constructor=h.WebGLRenderer,h.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){this.__stage!==a&&(a.interactive&&a.interactionManager.removeEvents(),this.__stage=a),h.WebGLRenderer.updateTextures(),a.updateTransform();var b=this.gl;b.viewport(0,0,this.width,this.height),b.bindFramebuffer(b.FRAMEBUFFER,null),this.transparent?b.clearColor(0,0,0,0):b.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1),b.clear(b.COLOR_BUFFER_BIT),this.renderDisplayObject(a,this.projection),a.interactive?a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)):a._interactiveEventsAdded&&(a._interactiveEventsAdded=!1,a.interactionManager.setTarget(this))}},h.WebGLRenderer.prototype.renderDisplayObject=function(a,b,c){this.renderSession.drawCount=0,this.renderSession.currentBlendMode=9999,this.renderSession.projection=b,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,c),a._renderWebGL(this.renderSession),this.spriteBatch.end()},h.WebGLRenderer.updateTextures=function(){var a=0;for(a=0;a<h.Texture.frameUpdates.length;a++)h.WebGLRenderer.updateTextureFrame(h.Texture.frameUpdates[a]);for(a=0;a<h.texturesToDestroy.length;a++)h.WebGLRenderer.destroyTexture(h.texturesToDestroy[a]);h.texturesToUpdate.length=0,h.texturesToDestroy.length=0,h.Texture.frameUpdates.length=0},h.WebGLRenderer.destroyTexture=function(a){for(var b=a._glTextures.length-1;b>=0;b--){var c=a._glTextures[b],d=h.glContexts[b];d&&c&&d.deleteTexture(c)}a._glTextures.length=0},h.WebGLRenderer.updateTextureFrame=function(a){a.updateFrame=!1,a._updateWebGLuvs()},h.WebGLRenderer.prototype.resize=function(a,b){this.width=a,this.height=b,this.view.width=a,this.view.height=b,this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2,this.projection.y=-this.height/2},h.createWebGLTexture=function(a,b){return a.hasLoaded&&(a._glTextures[b.id]=b.createTexture(),b.bindTexture(b.TEXTURE_2D,a._glTextures[b.id]),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a.source),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a.scaleMode===h.scaleModes.LINEAR?b.LINEAR:b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.scaleMode===h.scaleModes.LINEAR?b.LINEAR:b.NEAREST),a._powerOf2?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)),b.bindTexture(b.TEXTURE_2D,null)),a._glTextures[b.id]},h.updateWebGLTexture=function(a,b){a._glTextures[b.id]&&(b.bindTexture(b.TEXTURE_2D,a._glTextures[b.id]),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a.source),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a.scaleMode===h.scaleModes.LINEAR?b.LINEAR:b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.scaleMode===h.scaleModes.LINEAR?b.LINEAR:b.NEAREST),a._powerOf2?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)),b.bindTexture(b.TEXTURE_2D,null))},h.WebGLRenderer.prototype.handleContextLost=function(a){a.preventDefault(),this.contextLost=!0},h.WebGLRenderer.prototype.handleContextRestored=function(){try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(a){try{this.gl=this.view.getContext("webgl",this.options)}catch(b){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var c=this.gl;c.id=h.WebGLRenderer.glContextId++,this.shaderManager.setContext(c),this.spriteBatch.setContext(c),this.maskManager.setContext(c),this.filterManager.setContext(c),this.renderSession.gl=this.gl,c.disable(c.DEPTH_TEST),c.disable(c.CULL_FACE),c.enable(c.BLEND),c.colorMask(!0,!0,!0,this.transparent),this.gl.viewport(0,0,this.width,this.height);for(var d in h.TextureCache){var e=h.TextureCache[d].baseTexture;e._glTextures=[]}this.contextLost=!1},h.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost),this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost),h.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},h.WebGLRenderer.glContextId=0,h.WebGLMaskManager=function(a){this.maskStack=[],this.maskPosition=0,this.setContext(a)},h.WebGLMaskManager.prototype.setContext=function(a){this.gl=a},h.WebGLMaskManager.prototype.pushMask=function(a,b){var c=this.gl;0===this.maskStack.length&&(c.enable(c.STENCIL_TEST),c.stencilFunc(c.ALWAYS,1,1)),this.maskStack.push(a),c.colorMask(!1,!1,!1,!0),c.stencilOp(c.KEEP,c.KEEP,c.INCR),h.WebGLGraphics.renderGraphics(a,b),c.colorMask(!0,!0,!0,!0),c.stencilFunc(c.NOTEQUAL,0,this.maskStack.length),c.stencilOp(c.KEEP,c.KEEP,c.KEEP)},h.WebGLMaskManager.prototype.popMask=function(a){var b=this.gl,c=this.maskStack.pop();c&&(b.colorMask(!1,!1,!1,!1),b.stencilOp(b.KEEP,b.KEEP,b.DECR),h.WebGLGraphics.renderGraphics(c,a),b.colorMask(!0,!0,!0,!0),b.stencilFunc(b.NOTEQUAL,0,this.maskStack.length),b.stencilOp(b.KEEP,b.KEEP,b.KEEP)),0===this.maskStack.length&&b.disable(b.STENCIL_TEST)},h.WebGLMaskManager.prototype.destroy=function(){this.maskStack=null,this.gl=null},h.WebGLShaderManager=function(a){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var b=0;b<this.maxAttibs;b++)this.attribState[b]=!1;this.setContext(a)},h.WebGLShaderManager.prototype.setContext=function(a){this.gl=a,this.primitiveShader=new h.PrimitiveShader(a),this.defaultShader=new h.PixiShader(a),this.fastShader=new h.PixiFastShader(a),this.activateShader(this.defaultShader)},h.WebGLShaderManager.prototype.setAttribs=function(a){var b;for(b=0;b<this.tempAttribState.length;b++)this.tempAttribState[b]=!1;for(b=0;b<a.length;b++){var c=a[b];this.tempAttribState[c]=!0}var d=this.gl;for(b=0;b<this.attribState.length;b++)this.attribState[b]!==this.tempAttribState[b]&&(this.attribState[b]=this.tempAttribState[b],this.tempAttribState[b]?d.enableVertexAttribArray(b):d.disableVertexAttribArray(b))},h.WebGLShaderManager.prototype.activateShader=function(a){this.currentShader=a,this.gl.useProgram(a.program),this.setAttribs(a.attributes)},h.WebGLShaderManager.prototype.activatePrimitiveShader=function(){var a=this.gl;a.useProgram(this.primitiveShader.program),this.setAttribs(this.primitiveShader.attributes)},h.WebGLShaderManager.prototype.deactivatePrimitiveShader=function(){var a=this.gl;a.useProgram(this.defaultShader.program),this.setAttribs(this.defaultShader.attributes)},h.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.gl=null},h.WebGLSpriteBatch=function(a){this.vertSize=6,this.size=1e4;var b=4*this.size*this.vertSize,c=6*this.size;this.vertices=new Float32Array(b),this.indices=new Uint16Array(c),this.lastIndexCount=0;for(var d=0,e=0;c>d;d+=6,e+=4)this.indices[d+0]=e+0,this.indices[d+1]=e+1,this.indices[d+2]=e+2,this.indices[d+3]=e+0,this.indices[d+4]=e+2,this.indices[d+5]=e+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.setContext(a)},h.WebGLSpriteBatch.prototype.setContext=function(a){this.gl=a,this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW),this.currentBlendMode=99999},h.WebGLSpriteBatch.prototype.begin=function(a){this.renderSession=a,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},h.WebGLSpriteBatch.prototype.end=function(){this.flush()},h.WebGLSpriteBatch.prototype.render=function(a){(a.texture.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size)&&(this.flush(),this.currentBaseTexture=a.texture.baseTexture),a.blendMode!==this.currentBlendMode&&this.setBlendMode(a.blendMode);var b=a._uvs||a.texture._uvs;if(b){var c,d,e,f,g=a.worldAlpha,h=a.tint,i=this.vertices,j=a.texture.frame.width,k=a.texture.frame.height,l=a.anchor.x,m=a.anchor.y;if(a.texture.trim){var n=a.texture.trim;d=n.x-l*n.width,c=d+j,f=n.y-m*n.height,e=f+k}else c=j*(1-l),d=j*-l,e=k*(1-m),f=k*-m;var o=4*this.currentBatchSize*this.vertSize,p=a.worldTransform,q=p.a,r=p.c,s=p.b,t=p.d,u=p.tx,v=p.ty;i[o++]=q*d+s*f+u,i[o++]=t*f+r*d+v,i[o++]=b.x0,i[o++]=b.y0,i[o++]=g,i[o++]=h,i[o++]=q*c+s*f+u,i[o++]=t*f+r*c+v,i[o++]=b.x1,i[o++]=b.y1,i[o++]=g,i[o++]=h,i[o++]=q*c+s*e+u,i[o++]=t*e+r*c+v,i[o++]=b.x2,i[o++]=b.y2,i[o++]=g,i[o++]=h,i[o++]=q*d+s*e+u,i[o++]=t*e+r*d+v,i[o++]=b.x3,i[o++]=b.y3,i[o++]=g,i[o++]=h,this.currentBatchSize++}},h.WebGLSpriteBatch.prototype.renderTilingSprite=function(a){var b=a.tilingTexture;(b.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size)&&(this.flush(),this.currentBaseTexture=b.baseTexture),a.blendMode!==this.currentBlendMode&&this.setBlendMode(a.blendMode),a._uvs||(a._uvs=new h.TextureUvs);var c=a._uvs;a.tilePosition.x%=b.baseTexture.width,a.tilePosition.y%=b.baseTexture.height;var d=a.tilePosition.x/b.baseTexture.width,e=a.tilePosition.y/b.baseTexture.height,f=a.width/b.baseTexture.width/(a.tileScale.x*a.tileScaleOffset.x),g=a.height/b.baseTexture.height/(a.tileScale.y*a.tileScaleOffset.y);c.x0=0-d,c.y0=0-e,c.x1=1*f-d,c.y1=0-e,c.x2=1*f-d,c.y2=1*g-e,c.x3=0-d,c.y3=1*g-e;var i=a.worldAlpha,j=a.tint,k=this.vertices,l=a.width,m=a.height,n=a.anchor.x,o=a.anchor.y,p=l*(1-n),q=l*-n,r=m*(1-o),s=m*-o,t=4*this.currentBatchSize*this.vertSize,u=a.worldTransform,v=u.a,w=u.c,x=u.b,y=u.d,z=u.tx,A=u.ty;k[t++]=v*q+x*s+z,k[t++]=y*s+w*q+A,k[t++]=c.x0,k[t++]=c.y0,k[t++]=i,k[t++]=j,k[t++]=v*p+x*s+z,k[t++]=y*s+w*p+A,k[t++]=c.x1,k[t++]=c.y1,k[t++]=i,k[t++]=j,k[t++]=v*p+x*r+z,k[t++]=y*r+w*p+A,k[t++]=c.x2,k[t++]=c.y2,k[t++]=i,k[t++]=j,k[t++]=v*q+x*r+z,k[t++]=y*r+w*q+A,k[t++]=c.x3,k[t++]=c.y3,k[t++]=i,k[t++]=j,this.currentBatchSize++},h.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]||h.createWebGLTexture(this.currentBaseTexture,a)),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var b=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,b)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},h.WebGLSpriteBatch.prototype.stop=function(){this.flush()},h.WebGLSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var b=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,b.x,b.y);var c=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,c,0),a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,c,8),a.vertexAttribPointer(this.shader.colorAttribute,2,a.FLOAT,!1,c,16),this.currentBlendMode!==h.blendModes.NORMAL&&this.setBlendMode(h.blendModes.NORMAL)},h.WebGLSpriteBatch.prototype.setBlendMode=function(a){this.flush(),this.currentBlendMode=a;var b=h.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(b[0],b[1])},h.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},h.WebGLFastSpriteBatch=function(a){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var b=4*this.size*this.vertSize,c=6*this.maxSize;this.vertices=new Float32Array(b),this.indices=new Uint16Array(c),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var d=0,e=0;c>d;d+=6,e+=4)this.indices[d+0]=e+0,this.indices[d+1]=e+1,this.indices[d+2]=e+2,this.indices[d+3]=e+0,this.indices[d+4]=e+2,this.indices[d+5]=e+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(a)},h.WebGLFastSpriteBatch.prototype.setContext=function(a){this.gl=a,this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW),this.currentBlendMode=99999},h.WebGLFastSpriteBatch.prototype.begin=function(a,b){this.renderSession=b,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=a.worldTransform.toArray(!0),this.start()},h.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},h.WebGLFastSpriteBatch.prototype.render=function(a){var b=a.children,c=b[0];if(c.texture._uvs){this.currentBaseTexture=c.texture.baseTexture,c.blendMode!==this.currentBlendMode&&this.setBlendMode(c.blendMode);for(var d=0,e=b.length;e>d;d++)this.renderSprite(b[d]);this.flush()}},h.WebGLFastSpriteBatch.prototype.renderSprite=function(a){if(a.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=a.texture.baseTexture,a.texture._uvs)){var b,c,d,e,f,g,h,i,j=this.vertices;if(b=a.texture._uvs,c=a.texture.frame.width,d=a.texture.frame.height,a.texture.trim){var k=a.texture.trim;f=k.x-a.anchor.x*k.width,e=f+a.texture.frame.width,h=k.y-a.anchor.y*k.height,g=h+a.texture.frame.height}else e=a.texture.frame.width*(1-a.anchor.x),f=a.texture.frame.width*-a.anchor.x,g=a.texture.frame.height*(1-a.anchor.y),h=a.texture.frame.height*-a.anchor.y;i=4*this.currentBatchSize*this.vertSize,j[i++]=f,j[i++]=h,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x0,j[i++]=b.y1,j[i++]=a.alpha,j[i++]=e,j[i++]=h,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x1,j[i++]=b.y1,j[i++]=a.alpha,j[i++]=e,j[i++]=g,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x2,j[i++]=b.y2,j[i++]=a.alpha,j[i++]=f,j[i++]=g,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x3,j[i++]=b.y3,j[i++]=a.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},h.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||h.createWebGLTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var b=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,b)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},h.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},h.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var b=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,b.x,b.y),a.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var c=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,c,0),a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,!1,c,8),a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,!1,c,16),a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,!1,c,24),a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,c,28),a.vertexAttribPointer(this.shader.colorAttribute,1,a.FLOAT,!1,c,36),this.currentBlendMode!==h.blendModes.NORMAL&&this.setBlendMode(h.blendModes.NORMAL)},h.WebGLFastSpriteBatch.prototype.setBlendMode=function(a){this.flush(),this.currentBlendMode=a;var b=h.blendModesWebGL[this.currentBlendMode];this.gl.blendFunc(b[0],b[1])},h.WebGLFilterManager=function(a,b){this.transparent=b,this.filterStack=[],this.offsetX=0,this.offsetY=0,this.setContext(a)},h.WebGLFilterManager.prototype.setContext=function(a){this.gl=a,this.texturePool=[],this.initShaderBuffers()},h.WebGLFilterManager.prototype.begin=function(a,b){this.renderSession=a,this.defaultShader=a.shaderManager.defaultShader;var c=this.renderSession.projection;this.width=2*c.x,this.height=2*-c.y,this.buffer=b},h.WebGLFilterManager.prototype.pushFilter=function(a){var b=this.gl,c=this.renderSession.projection,d=this.renderSession.offset;this.filterStack.push(a);var e=a.filterPasses[0];this.offsetX+=a.target.filterArea.x,this.offsetY+=a.target.filterArea.y;var f=this.texturePool.pop();f?f.resize(this.width,this.height):f=new h.FilterTexture(this.gl,this.width,this.height),b.bindTexture(b.TEXTURE_2D,f.texture),a.target.filterArea=a.target.getBounds();var g=a.target.filterArea,i=e.padding;g.x-=i,g.y-=i,g.width+=2*i,g.height+=2*i,g.x<0&&(g.x=0),g.width>this.width&&(g.width=this.width),g.y<0&&(g.y=0),g.height>this.height&&(g.height=this.height),b.bindFramebuffer(b.FRAMEBUFFER,f.frameBuffer),b.viewport(0,0,g.width,g.height),c.x=g.width/2,c.y=-g.height/2,d.x=-g.x,d.y=-g.y,b.uniform2f(this.defaultShader.projectionVector,g.width/2,-g.height/2),b.uniform2f(this.defaultShader.offsetVector,-g.x,-g.y),b.colorMask(!0,!0,!0,!0),b.clearColor(0,0,0,0),b.clear(b.COLOR_BUFFER_BIT),a._glFilterTexture=f},h.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,b=this.filterStack.pop(),c=b.target.filterArea,d=b._glFilterTexture,e=this.renderSession.projection,f=this.renderSession.offset;if(b.filterPasses.length>1){a.viewport(0,0,c.width,c.height),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=c.height,this.vertexArray[2]=c.width,this.vertexArray[3]=c.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=c.width,this.vertexArray[7]=0,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=c.width/this.width,this.uvArray[5]=c.height/this.height,this.uvArray[6]=c.width/this.width,this.uvArray[7]=c.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);var g=d,i=this.texturePool.pop();i||(i=new h.FilterTexture(this.gl,this.width,this.height)),a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.BLEND);for(var j=0;j<b.filterPasses.length-1;j++){var k=b.filterPasses[j];a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,g.texture),this.applyFilterPass(k,c,c.width,c.height);var l=g;g=i,i=l}a.enable(a.BLEND),d=g,this.texturePool.push(i)}var m=b.filterPasses[b.filterPasses.length-1];this.offsetX-=c.x,this.offsetY-=c.y;var n=this.width,o=this.height,p=0,q=0,r=this.buffer;if(0===this.filterStack.length)a.colorMask(!0,!0,!0,this.transparent);else{var s=this.filterStack[this.filterStack.length-1];c=s.target.filterArea,n=c.width,o=c.height,p=c.x,q=c.y,r=s._glFilterTexture.frameBuffer}e.x=n/2,e.y=-o/2,f.x=p,f.y=q,c=b.target.filterArea;var t=c.x-p,u=c.y-q;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=t,this.vertexArray[1]=u+c.height,this.vertexArray[2]=t+c.width,this.vertexArray[3]=u+c.height,this.vertexArray[4]=t,this.vertexArray[5]=u,this.vertexArray[6]=t+c.width,this.vertexArray[7]=u,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=c.width/this.width,this.uvArray[5]=c.height/this.height,this.uvArray[6]=c.width/this.width,this.uvArray[7]=c.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray),a.viewport(0,0,n,o),a.bindFramebuffer(a.FRAMEBUFFER,r),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,d.texture),this.applyFilterPass(m,c,n,o),a.useProgram(this.defaultShader.program),a.uniform2f(this.defaultShader.projectionVector,n/2,-o/2),a.uniform2f(this.defaultShader.offsetVector,-p,-q),this.texturePool.push(d),b._glFilterTexture=null},h.WebGLFilterManager.prototype.applyFilterPass=function(a,b,c,d){var e=this.gl,f=a.shaders[e.id];f||(f=new h.PixiShader(e),f.fragmentSrc=a.fragmentSrc,f.uniforms=a.uniforms,f.init(),a.shaders[e.id]=f),e.useProgram(f.program),e.uniform2f(f.projectionVector,c/2,-d/2),e.uniform2f(f.offsetVector,0,0),a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=this.width,a.uniforms.dimensions.value[1]=this.height,a.uniforms.dimensions.value[2]=this.vertexArray[0],a.uniforms.dimensions.value[3]=this.vertexArray[5]),f.syncUniforms(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.vertexAttribPointer(f.aVertexPosition,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.vertexAttribPointer(f.aTextureCoord,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.colorBuffer),e.vertexAttribPointer(f.colorAttribute,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0),this.renderSession.drawCount++},h.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer(),this.uvBuffer=a.createBuffer(),this.colorBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer),a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)},h.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var b=0;b<this.texturePool.length;b++)this.texturePool.destroy();this.texturePool=null,a.deleteBuffer(this.vertexBuffer),a.deleteBuffer(this.uvBuffer),a.deleteBuffer(this.colorBuffer),a.deleteBuffer(this.indexBuffer)},h.FilterTexture=function(a,b,c){this.gl=a,this.frameBuffer=a.createFramebuffer(),this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer),a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0),this.resize(b,c)},h.FilterTexture.prototype.clear=function(){var a=this.gl;a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT)},h.FilterTexture.prototype.resize=function(a,b){if(this.width!==a||this.height!==b){this.width=a,this.height=b;var c=this.gl;c.bindTexture(c.TEXTURE_2D,this.texture),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null)}},h.FilterTexture.prototype.destroy=function(){var a=this.gl;a.deleteFramebuffer(this.frameBuffer),a.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},h.CanvasMaskManager=function(){},h.CanvasMaskManager.prototype.pushMask=function(a,b){b.save();var c=a.alpha,d=a.worldTransform;b.setTransform(d.a,d.c,d.b,d.d,d.tx,d.ty),h.CanvasGraphics.renderGraphicsMask(a,b),b.clip(),a.worldAlpha=c},h.CanvasMaskManager.prototype.popMask=function(a){a.restore()},h.CanvasTinter=function(){},h.CanvasTinter.getTintedTexture=function(a,b){var c=a.texture;b=h.CanvasTinter.roundColor(b);var d="#"+("00000"+(0|b).toString(16)).substr(-6);if(c.tintCache=c.tintCache||{},c.tintCache[d])return c.tintCache[d];var e=h.CanvasTinter.canvas||document.createElement("canvas");if(h.CanvasTinter.tintMethod(c,b,e),h.CanvasTinter.convertTintToImage){var f=new Image;f.src=e.toDataURL(),c.tintCache[d]=f}else c.tintCache[d]=e,h.CanvasTinter.canvas=null;return e},h.CanvasTinter.tintWithMultiply=function(a,b,c){var d=c.getContext("2d"),e=a.frame;c.width=e.width,c.height=e.height,d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6),d.fillRect(0,0,e.width,e.height),d.globalCompositeOperation="multiply",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height),d.globalCompositeOperation="destination-atop",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)},h.CanvasTinter.tintWithOverlay=function(a,b,c){var d=c.getContext("2d"),e=a.frame;c.width=e.width,c.height=e.height,d.globalCompositeOperation="copy",d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6),d.fillRect(0,0,e.width,e.height),d.globalCompositeOperation="destination-atop",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)},h.CanvasTinter.tintWithPerPixel=function(a,b,c){var d=c.getContext("2d"),e=a.frame;c.width=e.width,c.height=e.height,d.globalCompositeOperation="copy",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height);for(var f=h.hex2rgb(b),g=f[0],i=f[1],j=f[2],k=d.getImageData(0,0,e.width,e.height),l=k.data,m=0;m<l.length;m+=4)l[m+0]*=g,l[m+1]*=i,l[m+2]*=j;d.putImageData(k,0,0)},h.CanvasTinter.roundColor=function(a){var b=h.CanvasTinter.cacheStepsPerColorChannel,c=h.hex2rgb(a);return c[0]=Math.min(255,c[0]/b*b),c[1]=Math.min(255,c[1]/b*b),c[2]=Math.min(255,c[2]/b*b),h.rgb2hex(c)},h.CanvasTinter.cacheStepsPerColorChannel=8,h.CanvasTinter.convertTintToImage=!1,h.CanvasTinter.canUseMultiply=h.canUseNewCanvasBlendModes(),h.CanvasTinter.tintMethod=h.CanvasTinter.canUseMultiply?h.CanvasTinter.tintWithMultiply:h.CanvasTinter.tintWithPerPixel,h.CanvasRenderer=function(a,b,c,d){h.defaultRenderer=h.defaultRenderer||this,this.type=h.CANVAS_RENDERER,this.clearBeforeRender=!0,this.roundPixels=!1,this.transparent=!!d,h.blendModesCanvas||(h.blendModesCanvas=[],h.canUseNewCanvasBlendModes()?(h.blendModesCanvas[h.blendModes.NORMAL]="source-over",h.blendModesCanvas[h.blendModes.ADD]="lighter",h.blendModesCanvas[h.blendModes.MULTIPLY]="multiply",h.blendModesCanvas[h.blendModes.SCREEN]="screen",h.blendModesCanvas[h.blendModes.OVERLAY]="overlay",h.blendModesCanvas[h.blendModes.DARKEN]="darken",h.blendModesCanvas[h.blendModes.LIGHTEN]="lighten",h.blendModesCanvas[h.blendModes.COLOR_DODGE]="color-dodge",h.blendModesCanvas[h.blendModes.COLOR_BURN]="color-burn",h.blendModesCanvas[h.blendModes.HARD_LIGHT]="hard-light",h.blendModesCanvas[h.blendModes.SOFT_LIGHT]="soft-light",h.blendModesCanvas[h.blendModes.DIFFERENCE]="difference",h.blendModesCanvas[h.blendModes.EXCLUSION]="exclusion",h.blendModesCanvas[h.blendModes.HUE]="hue",h.blendModesCanvas[h.blendModes.SATURATION]="saturation",h.blendModesCanvas[h.blendModes.COLOR]="color",h.blendModesCanvas[h.blendModes.LUMINOSITY]="luminosity"):(h.blendModesCanvas[h.blendModes.NORMAL]="source-over",h.blendModesCanvas[h.blendModes.ADD]="lighter",h.blendModesCanvas[h.blendModes.MULTIPLY]="source-over",h.blendModesCanvas[h.blendModes.SCREEN]="source-over",h.blendModesCanvas[h.blendModes.OVERLAY]="source-over",h.blendModesCanvas[h.blendModes.DARKEN]="source-over",h.blendModesCanvas[h.blendModes.LIGHTEN]="source-over",h.blendModesCanvas[h.blendModes.COLOR_DODGE]="source-over",h.blendModesCanvas[h.blendModes.COLOR_BURN]="source-over",h.blendModesCanvas[h.blendModes.HARD_LIGHT]="source-over",h.blendModesCanvas[h.blendModes.SOFT_LIGHT]="source-over",h.blendModesCanvas[h.blendModes.DIFFERENCE]="source-over",h.blendModesCanvas[h.blendModes.EXCLUSION]="source-over",h.blendModesCanvas[h.blendModes.HUE]="source-over",h.blendModesCanvas[h.blendModes.SATURATION]="source-over",h.blendModesCanvas[h.blendModes.COLOR]="source-over",h.blendModesCanvas[h.blendModes.LUMINOSITY]="source-over")),this.width=a||800,this.height=b||600,this.view=c||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0,this.maskManager=new h.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null},"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="oImageSmoothingEnabled")},h.CanvasRenderer.prototype.constructor=h.CanvasRenderer,h.CanvasRenderer.prototype.render=function(a){h.texturesToUpdate.length=0,h.texturesToDestroy.length=0,a.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,!this.transparent&&this.clearBeforeRender?(this.context.fillStyle=a.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)):this.transparent&&this.clearBeforeRender&&this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(a),a.interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this))),h.Texture.frameUpdates.length>0&&(h.Texture.frameUpdates.length=0)},h.CanvasRenderer.prototype.resize=function(a,b){this.width=a,this.height=b,this.view.width=a,this.view.height=b},h.CanvasRenderer.prototype.renderDisplayObject=function(a,b){this.renderSession.context=b||this.context,a._renderCanvas(this.renderSession)},h.CanvasRenderer.prototype.renderStripFlat=function(a){var b=this.context,c=a.verticies,d=c.length/2;this.count++,b.beginPath();for(var e=1;d-2>e;e++){var f=2*e,g=c[f],h=c[f+2],i=c[f+4],j=c[f+1],k=c[f+3],l=c[f+5];b.moveTo(g,j),b.lineTo(h,k),b.lineTo(i,l)}b.fillStyle="#FF0000",b.fill(),b.closePath()},h.CanvasRenderer.prototype.renderStrip=function(a){var b=this.context,c=a.verticies,d=a.uvs,e=c.length/2;this.count++;for(var f=1;e-2>f;f++){var g=2*f,h=c[g],i=c[g+2],j=c[g+4],k=c[g+1],l=c[g+3],m=c[g+5],n=d[g]*a.texture.width,o=d[g+2]*a.texture.width,p=d[g+4]*a.texture.width,q=d[g+1]*a.texture.height,r=d[g+3]*a.texture.height,s=d[g+5]*a.texture.height;b.save(),b.beginPath(),b.moveTo(h,k),b.lineTo(i,l),b.lineTo(j,m),b.closePath(),b.clip();var t=n*r+q*p+o*s-r*p-q*o-n*s,u=h*r+q*j+i*s-r*j-q*i-h*s,v=n*i+h*p+o*j-i*p-h*o-n*j,w=n*r*j+q*i*p+h*o*s-h*r*p-q*o*j-n*i*s,x=k*r+q*m+l*s-r*m-q*l-k*s,y=n*l+k*p+o*m-l*p-k*o-n*m,z=n*r*m+q*l*p+k*o*s-k*r*p-q*o*m-n*l*s;b.transform(u/t,x/t,v/t,y/t,w/t,z/t),b.drawImage(a.texture.baseTexture.source,0,0),b.restore()}},h.CanvasBuffer=function(a,b){this.width=a,this.height=b,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=a,this.canvas.height=b},h.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},h.CanvasBuffer.prototype.resize=function(a,b){this.width=this.canvas.width=a,this.height=this.canvas.height=b},h.CanvasGraphics=function(){},h.CanvasGraphics.renderGraphics=function(a,b){for(var c=a.worldAlpha,d="",e=0;e<a.graphicsData.length;e++){var f=a.graphicsData[e],g=f.points;if(b.strokeStyle=d="#"+("00000"+(0|f.lineColor).toString(16)).substr(-6),b.lineWidth=f.lineWidth,f.type===h.Graphics.POLY){b.beginPath(),b.moveTo(g[0],g[1]);for(var i=1;i<g.length/2;i++)b.lineTo(g[2*i],g[2*i+1]);g[0]===g[g.length-2]&&g[1]===g[g.length-1]&&b.closePath(),f.fill&&(b.globalAlpha=f.fillAlpha*c,b.fillStyle=d="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),b.fill()),f.lineWidth&&(b.globalAlpha=f.lineAlpha*c,b.stroke())
}else if(f.type===h.Graphics.RECT)(f.fillColor||0===f.fillColor)&&(b.globalAlpha=f.fillAlpha*c,b.fillStyle=d="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),b.fillRect(g[0],g[1],g[2],g[3])),f.lineWidth&&(b.globalAlpha=f.lineAlpha*c,b.strokeRect(g[0],g[1],g[2],g[3]));else if(f.type===h.Graphics.CIRC)b.beginPath(),b.arc(g[0],g[1],g[2],0,2*Math.PI),b.closePath(),f.fill&&(b.globalAlpha=f.fillAlpha*c,b.fillStyle=d="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),b.fill()),f.lineWidth&&(b.globalAlpha=f.lineAlpha*c,b.stroke());else if(f.type===h.Graphics.ELIP){var j=f.points,k=2*j[2],l=2*j[3],m=j[0]-k/2,n=j[1]-l/2;b.beginPath();var o=.5522848,p=k/2*o,q=l/2*o,r=m+k,s=n+l,t=m+k/2,u=n+l/2;b.moveTo(m,u),b.bezierCurveTo(m,u-q,t-p,n,t,n),b.bezierCurveTo(t+p,n,r,u-q,r,u),b.bezierCurveTo(r,u+q,t+p,s,t,s),b.bezierCurveTo(t-p,s,m,u+q,m,u),b.closePath(),f.fill&&(b.globalAlpha=f.fillAlpha*c,b.fillStyle=d="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),b.fill()),f.lineWidth&&(b.globalAlpha=f.lineAlpha*c,b.stroke())}}},h.CanvasGraphics.renderGraphicsMask=function(a,b){var c=a.graphicsData.length;if(0!==c){c>1&&(c=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var d=0;1>d;d++){var e=a.graphicsData[d],f=e.points;if(e.type===h.Graphics.POLY){b.beginPath(),b.moveTo(f[0],f[1]);for(var g=1;g<f.length/2;g++)b.lineTo(f[2*g],f[2*g+1]);f[0]===f[f.length-2]&&f[1]===f[f.length-1]&&b.closePath()}else if(e.type===h.Graphics.RECT)b.beginPath(),b.rect(f[0],f[1],f[2],f[3]),b.closePath();else if(e.type===h.Graphics.CIRC)b.beginPath(),b.arc(f[0],f[1],f[2],0,2*Math.PI),b.closePath();else if(e.type===h.Graphics.ELIP){var i=e.points,j=2*i[2],k=2*i[3],l=i[0]-j/2,m=i[1]-k/2;b.beginPath();var n=.5522848,o=j/2*n,p=k/2*n,q=l+j,r=m+k,s=l+j/2,t=m+k/2;b.moveTo(l,t),b.bezierCurveTo(l,t-p,s-o,m,s,m),b.bezierCurveTo(s+o,m,q,t-p,q,t),b.bezierCurveTo(q,t+p,s+o,r,s,r),b.bezierCurveTo(s-o,r,l,t+p,l,t),b.closePath()}}}},h.Graphics=function(){h.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.tint=16777215,this.blendMode=h.blendModes.NORMAL,this.currentPath={points:[]},this._webGL=[],this.isMask=!1,this.bounds=null,this.boundsPadding=10},h.Graphics.prototype=Object.create(h.DisplayObjectContainer.prototype),h.Graphics.prototype.constructor=h.Graphics,Object.defineProperty(h.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap=a,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),h.Graphics.prototype.lineStyle=function(a,b,c){return this.currentPath.points.length||this.graphicsData.pop(),this.lineWidth=a||0,this.lineColor=b||0,this.lineAlpha=arguments.length<3?1:c,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:h.Graphics.POLY},this.graphicsData.push(this.currentPath),this},h.Graphics.prototype.moveTo=function(a,b){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:h.Graphics.POLY},this.currentPath.points.push(a,b),this.graphicsData.push(this.currentPath),this},h.Graphics.prototype.lineTo=function(a,b){return this.currentPath.points.push(a,b),this.dirty=!0,this},h.Graphics.prototype.beginFill=function(a,b){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=arguments.length<2?1:b,this},h.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},h.Graphics.prototype.drawRect=function(a,b,c,d){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,b,c,d],type:h.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0,this},h.Graphics.prototype.drawCircle=function(a,b,c){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,b,c,c],type:h.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0,this},h.Graphics.prototype.drawEllipse=function(a,b,c,d){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,b,c,d],type:h.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0,this},h.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this.bounds=null,this},h.Graphics.prototype.generateTexture=function(){var a=this.getBounds(),b=new h.CanvasBuffer(a.width,a.height),c=h.Texture.fromCanvas(b.canvas);return b.context.translate(-a.x,-a.y),h.CanvasGraphics.renderGraphics(this,b.context),c},h.Graphics.prototype._renderWebGL=function(a){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return this.dirty&&(this._generateCachedSprite(),h.updateWebGLTexture(this._cachedSprite.texture.baseTexture,a.gl),this.dirty=!1),void h.Sprite.prototype._renderWebGL.call(this._cachedSprite,a);if(a.spriteBatch.stop(),this._mask&&a.maskManager.pushMask(this.mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var b=h.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(b[0],b[1])}if(h.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(var c=0,d=this.children.length;d>c;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(a),a.drawCount++,a.spriteBatch.start()}},h.Graphics.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){var b=a.context,c=this.worldTransform;this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,b.globalCompositeOperation=h.blendModesCanvas[a.currentBlendMode]),b.setTransform(c.a,c.c,c.b,c.d,c.tx,c.ty),h.CanvasGraphics.renderGraphics(this,b);for(var d=0,e=this.children.length;e>d;d++)this.children[d]._renderCanvas(a)}},h.Graphics.prototype.getBounds=function(a){this.bounds||this.updateBounds();var b=this.bounds.x,c=this.bounds.width+this.bounds.x,d=this.bounds.y,e=this.bounds.height+this.bounds.y,f=a||this.worldTransform,g=f.a,h=f.c,i=f.b,j=f.d,k=f.tx,l=f.ty,m=g*c+i*e+k,n=j*e+h*c+l,o=g*b+i*e+k,p=j*e+h*b+l,q=g*b+i*d+k,r=j*d+h*b+l,s=g*c+i*d+k,t=j*d+h*c+l,u=-1/0,v=-1/0,w=1/0,x=1/0;w=w>m?m:w,w=w>o?o:w,w=w>q?q:w,w=w>s?s:w,x=x>n?n:x,x=x>p?p:x,x=x>r?r:x,x=x>t?t:x,u=m>u?m:u,u=o>u?o:u,u=q>u?q:u,u=s>u?s:u,v=n>v?n:v,v=p>v?p:v,v=r>v?r:v,v=t>v?t:v;var y=this._bounds;return y.x=w,y.width=u-w,y.y=x,y.height=v-x,y},h.Graphics.prototype.updateBounds=function(){for(var a,b,c,d,e,f=1/0,g=-1/0,i=1/0,j=-1/0,k=0;k<this.graphicsData.length;k++){var l=this.graphicsData[k],m=l.type,n=l.lineWidth;if(a=l.points,m===h.Graphics.RECT)b=a[0]-n/2,c=a[1]-n/2,d=a[2]+n,e=a[3]+n,f=f>b?b:f,g=b+d>g?b+d:g,i=i>c?b:i,j=c+e>j?c+e:j;else if(m===h.Graphics.CIRC||m===h.Graphics.ELIP)b=a[0],c=a[1],d=a[2]+n/2,e=a[3]+n/2,f=f>b-d?b-d:f,g=b+d>g?b+d:g,i=i>c-e?c-e:i,j=c+e>j?c+e:j;else for(var o=0;o<a.length;o+=2)b=a[o],c=a[o+1],f=f>b-n?b-n:f,g=b+n>g?b+n:g,i=i>c-n?c-n:i,j=c+n>j?c+n:j}var p=this.boundsPadding;this.bounds=new h.Rectangle(f-p,i-p,g-f+2*p,j-i+2*p)},h.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var b=new h.CanvasBuffer(a.width,a.height),c=h.Texture.fromCanvas(b.canvas);this._cachedSprite=new h.Sprite(c),this._cachedSprite.buffer=b,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(a.x/a.width),this._cachedSprite.anchor.y=-(a.y/a.height),this._cachedSprite.buffer.context.translate(-a.x,-a.y),h.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context)},h.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},h.Graphics.POLY=0,h.Graphics.RECT=1,h.Graphics.CIRC=2,h.Graphics.ELIP=3,h.Strip=function(a,b,c){h.DisplayObjectContainer.call(this),this.texture=a,this.blendMode=h.blendModes.NORMAL;try{this.uvs=new Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new Float32Array([0,0,0,0,0,0,0,0,0]),this.colors=new Float32Array([1,1,1,1]),this.indices=new Uint16Array([0,1,2,3])}catch(d){this.uvs=[0,1,1,1,1,0,0,1],this.verticies=[0,0,0,0,0,0,0,0,0],this.colors=[1,1,1,1],this.indices=[0,1,2,3]}this.width=b,this.height=c,a.baseTexture.hasLoaded?(this.width=this.texture.frame.width,this.height=this.texture.frame.height,this.updateFrame=!0):(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},h.Strip.prototype=Object.create(h.DisplayObjectContainer.prototype),h.Strip.prototype.constructor=h.Strip,h.Strip.prototype.setTexture=function(a){this.texture=a,this.width=a.frame.width,this.height=a.frame.height,this.updateFrame=!0},h.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},h.Rope=function(a,b){h.Strip.call(this,a),this.points=b;try{this.verticies=new Float32Array(4*b.length),this.uvs=new Float32Array(4*b.length),this.colors=new Float32Array(2*b.length),this.indices=new Uint16Array(2*b.length)}catch(c){this.verticies=new Array(4*b.length),this.uvs=new Array(4*b.length),this.colors=new Array(2*b.length),this.indices=new Array(2*b.length)}this.refresh()},h.Rope.prototype=Object.create(h.Strip.prototype),h.Rope.prototype.constructor=h.Rope,h.Rope.prototype.refresh=function(){var a=this.points;if(!(a.length<1)){var b=this.uvs,c=a[0],d=this.indices,e=this.colors;this.count-=.2,b[0]=0,b[1]=1,b[2]=0,b[3]=1,e[0]=1,e[1]=1,d[0]=0,d[1]=1;for(var f,g,h,i=a.length,j=1;i>j;j++)f=a[j],g=4*j,h=j/(i-1),j%2?(b[g]=h,b[g+1]=0,b[g+2]=h,b[g+3]=1):(b[g]=h,b[g+1]=0,b[g+2]=h,b[g+3]=1),g=2*j,e[g]=1,e[g+1]=1,g=2*j,d[g]=g,d[g+1]=g+1,c=f}},h.Rope.prototype.updateTransform=function(){var a=this.points;if(!(a.length<1)){var b,c=a[0],d={x:0,y:0};this.count-=.2;var e=this.verticies;e[0]=c.x+d.x,e[1]=c.y+d.y,e[2]=c.x-d.x,e[3]=c.y-d.y;for(var f,g,i,j,k,l=a.length,m=1;l>m;m++)f=a[m],g=4*m,b=m<a.length-1?a[m+1]:f,d.y=-(b.x-c.x),d.x=b.y-c.y,i=10*(1-m/(l-1)),i>1&&(i=1),j=Math.sqrt(d.x*d.x+d.y*d.y),k=this.texture.height/2,d.x/=j,d.y/=j,d.x*=k,d.y*=k,e[g]=f.x+d.x,e[g+1]=f.y+d.y,e[g+2]=f.x-d.x,e[g+3]=f.y-d.y,c=f;h.DisplayObjectContainer.prototype.updateTransform.call(this)}},h.Rope.prototype.setTexture=function(a){this.texture=a,this.updateFrame=!0},h.TilingSprite=function(a,b,c){h.Sprite.call(this,a),this.width=b||100,this.height=c||100,this.tileScale=new h.Point(1,1),this.tileScaleOffset=new h.Point(1,1),this.tilePosition=new h.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=h.blendModes.NORMAL},h.TilingSprite.prototype=Object.create(h.Sprite.prototype),h.TilingSprite.prototype.constructor=h.TilingSprite,Object.defineProperty(h.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}}),Object.defineProperty(h.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}}),h.TilingSprite.prototype.onTextureUpdate=function(){this.updateFrame=!0},h.TilingSprite.prototype._renderWebGL=function(a){if(this.visible!==!1&&0!==this.alpha){var b,c;if(this.mask||this.filters){for(this.mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this.filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),this.tilingTexture?a.spriteBatch.renderTilingSprite(this):this.generateTilingTexture(!0),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop(),this.filters&&a.filterManager.popFilter(),this.mask&&a.maskManager.popMask(a),a.spriteBatch.start()}else for(this.tilingTexture?a.spriteBatch.renderTilingSprite(this):this.generateTilingTexture(!0),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}},h.TilingSprite.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){var b=a.context;this._mask&&a.maskManager.pushMask(this._mask,b),b.globalAlpha=this.worldAlpha;var c=this.worldTransform;b.setTransform(c.a,c.c,c.b,c.d,c.tx,c.ty),this.__tilePattern||(this.generateTilingTexture(!1),this.tilingTexture&&(this.__tilePattern=b.createPattern(this.tilingTexture.baseTexture.source,"repeat"))),this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,b.globalCompositeOperation=h.blendModesCanvas[a.currentBlendMode]),b.beginPath();var d=this.tilePosition,e=this.tileScale;d.x%=this.tilingTexture.baseTexture.width,d.y%=this.tilingTexture.baseTexture.height,b.scale(e.x,e.y),b.translate(d.x,d.y),b.fillStyle=this.__tilePattern,b.fillRect(-d.x,-d.y,this.width/e.x,this.height/e.y),b.scale(1/e.x,1/e.y),b.translate(-d.x,-d.y),b.closePath(),this._mask&&a.maskManager.popMask(a.context)}},h.TilingSprite.prototype.getBounds=function(){var a=this._width,b=this._height,c=a*(1-this.anchor.x),d=a*-this.anchor.x,e=b*(1-this.anchor.y),f=b*-this.anchor.y,g=this.worldTransform,h=g.a,i=g.c,j=g.b,k=g.d,l=g.tx,m=g.ty,n=h*d+j*f+l,o=k*f+i*d+m,p=h*c+j*f+l,q=k*f+i*c+m,r=h*c+j*e+l,s=k*e+i*c+m,t=h*d+j*e+l,u=k*e+i*d+m,v=-1/0,w=-1/0,x=1/0,y=1/0;x=x>n?n:x,x=x>p?p:x,x=x>r?r:x,x=x>t?t:x,y=y>o?o:y,y=y>q?q:y,y=y>s?s:y,y=y>u?u:y,v=n>v?n:v,v=p>v?p:v,v=r>v?r:v,v=t>v?t:v,w=o>w?o:w,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w;var z=this._bounds;return z.x=x,z.width=v-x,z.y=y,z.height=w-y,this._currentBounds=z,z},h.TilingSprite.prototype.generateTilingTexture=function(a){var b=this.texture;if(b.baseTexture.hasLoaded){var c,d,e=b.baseTexture,f=b.frame,g=f.width!==e.width||f.height!==e.height;this.tilingTexture=b;var i=!1;if(a?(c=h.getNextPowerOfTwo(b.frame.width),d=h.getNextPowerOfTwo(b.frame.height),f.width!==c&&f.height!==d&&(i=!0)):g&&(c=f.width,d=f.height,i=!0),i){var j=new h.CanvasBuffer(c,d);j.context.drawImage(b.baseTexture.source,f.x,f.y,f.width,f.height,0,0,c,d),this.tilingTexture=h.Texture.fromCanvas(j.canvas),this.tileScaleOffset.x=f.width/c,this.tileScaleOffset.y=f.height/d}this.tilingTexture.baseTexture._powerOf2=!0}};var l={};l.BoneData=function(a,b){this.name=a,this.parent=b},l.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},l.SlotData=function(a,b){this.name=a,this.boneData=b},l.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},l.Bone=function(a,b){this.data=a,this.parent=b,this.setToSetupPose()},l.Bone.yDown=!1,l.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(a,b){var c=this.parent;null!=c?(this.worldX=this.x*c.m00+this.y*c.m01+c.worldX,this.worldY=this.x*c.m10+this.y*c.m11+c.worldY,this.worldScaleX=c.worldScaleX*this.scaleX,this.worldScaleY=c.worldScaleY*this.scaleY,this.worldRotation=c.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var d=this.worldRotation*Math.PI/180,e=Math.cos(d),f=Math.sin(d);this.m00=e*this.worldScaleX,this.m10=f*this.worldScaleX,this.m01=-f*this.worldScaleY,this.m11=e*this.worldScaleY,a&&(this.m00=-this.m00,this.m01=-this.m01),b&&(this.m10=-this.m10,this.m11=-this.m11),l.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var a=this.data;this.x=a.x,this.y=a.y,this.rotation=a.rotation,this.scaleX=a.scaleX,this.scaleY=a.scaleY}},l.Slot=function(a,b,c){this.data=a,this.skeleton=b,this.bone=c,this.setToSetupPose()},l.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(a){this.attachment=a,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(a){this._attachmentTime=this.skeleton.time-a},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var a=this.data;this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a;for(var b=this.skeleton.data.slots,c=0,d=b.length;d>c;c++)if(b[c]==a){this.setAttachment(a.attachmentName?this.skeleton.getAttachmentBySlotIndex(c,a.attachmentName):null);break}}},l.Skin=function(a){this.name=a,this.attachments={}},l.Skin.prototype={addAttachment:function(a,b,c){this.attachments[a+":"+b]=c},getAttachment:function(a,b){return this.attachments[a+":"+b]},_attachAll:function(a,b){for(var c in b.attachments){var d=c.indexOf(":"),e=parseInt(c.substring(0,d),10),f=c.substring(d+1),g=a.slots[e];if(g.attachment&&g.attachment.name==f){var h=this.getAttachment(e,f);h&&g.setAttachment(h)}}}},l.Animation=function(a,b,c){this.name=a,this.timelines=b,this.duration=c},l.Animation.prototype={apply:function(a,b,c){c&&this.duration&&(b%=this.duration);for(var d=this.timelines,e=0,f=d.length;f>e;e++)d[e].apply(a,b,1)},mix:function(a,b,c,d){c&&this.duration&&(b%=this.duration);for(var e=this.timelines,f=0,g=e.length;g>f;f++)e[f].apply(a,b,d)}},l.binarySearch=function(a,b,c){var d=0,e=Math.floor(a.length/c)-2;if(!e)return c;for(var f=e>>>1;;){if(a[(f+1)*c]<=b?d=f+1:e=f,d==e)return(d+1)*c;f=d+e>>>1}},l.linearSearch=function(a,b,c){for(var d=0,e=a.length-c;e>=d;d+=c)if(a[d]>b)return d;return-1},l.Curves=function(a){this.curves=[],this.curves.length=6*(a-1)},l.Curves.prototype={setLinear:function(a){this.curves[6*a]=0},setStepped:function(a){this.curves[6*a]=-1},setCurve:function(a,b,c,d,e){var f=.1,g=f*f,h=g*f,i=3*f,j=3*g,k=6*g,l=6*h,m=2*-b+d,n=2*-c+e,o=3*(b-d)+1,p=3*(c-e)+1,q=6*a,r=this.curves;r[q]=b*i+m*j+o*h,r[q+1]=c*i+n*j+p*h,r[q+2]=m*k+o*l,r[q+3]=n*k+p*l,r[q+4]=o*l,r[q+5]=p*l},getCurvePercent:function(a,b){b=0>b?0:b>1?1:b;var c=6*a,d=this.curves,e=d[c];if(!e)return b;if(-1==e)return 0;for(var f=d[c+1],g=d[c+2],h=d[c+3],i=d[c+4],j=d[c+5],k=e,l=f,m=8;;){if(k>=b){var n=k-e,o=l-f;return o+(l-o)*(b-n)/(k-n)}if(!m)break;m--,e+=g,f+=h,g+=i,h+=j,k+=e,l+=f}return l+(1-l)*(b-k)/(1-k)}},l.RotateTimeline=function(a){this.curves=new l.Curves(a),this.frames=[],this.frames.length=2*a},l.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(a,b,c){a*=2,this.frames[a]=b,this.frames[a+1]=c},apply:function(a,b,c){var d,e=this.frames;if(!(b<e[0])){var f=a.bones[this.boneIndex];if(b>=e[e.length-2]){for(d=f.data.rotation+e[e.length-1]-f.rotation;d>180;)d-=360;for(;-180>d;)d+=360;return void(f.rotation+=d*c)}var g=l.binarySearch(e,b,2),h=e[g-1],i=e[g],j=1-(b-i)/(e[g-2]-i);for(j=this.curves.getCurvePercent(g/2-1,j),d=e[g+1]-h;d>180;)d-=360;for(;-180>d;)d+=360;for(d=f.data.rotation+(h+d*j)-f.rotation;d>180;)d-=360;for(;-180>d;)d+=360;f.rotation+=d*c}}},l.TranslateTimeline=function(a){this.curves=new l.Curves(a),this.frames=[],this.frames.length=3*a},l.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,c,d){a*=3,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){var e=a.bones[this.boneIndex];if(b>=d[d.length-3])return e.x+=(e.data.x+d[d.length-2]-e.x)*c,void(e.y+=(e.data.y+d[d.length-1]-e.y)*c);var f=l.binarySearch(d,b,3),g=d[f-2],h=d[f-1],i=d[f],j=1-(b-i)/(d[f+-3]-i);j=this.curves.getCurvePercent(f/3-1,j),e.x+=(e.data.x+g+(d[f+1]-g)*j-e.x)*c,e.y+=(e.data.y+h+(d[f+2]-h)*j-e.y)*c}}},l.ScaleTimeline=function(a){this.curves=new l.Curves(a),this.frames=[],this.frames.length=3*a},l.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,c,d){a*=3,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){var e=a.bones[this.boneIndex];if(b>=d[d.length-3])return e.scaleX+=(e.data.scaleX-1+d[d.length-2]-e.scaleX)*c,void(e.scaleY+=(e.data.scaleY-1+d[d.length-1]-e.scaleY)*c);var f=l.binarySearch(d,b,3),g=d[f-2],h=d[f-1],i=d[f],j=1-(b-i)/(d[f+-3]-i);j=this.curves.getCurvePercent(f/3-1,j),e.scaleX+=(e.data.scaleX-1+g+(d[f+1]-g)*j-e.scaleX)*c,e.scaleY+=(e.data.scaleY-1+h+(d[f+2]-h)*j-e.scaleY)*c}}},l.ColorTimeline=function(a){this.curves=new l.Curves(a),this.frames=[],this.frames.length=5*a},l.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(c,d){c*=5,this.frames[c]=d,this.frames[c+1]=r,this.frames[c+2]=g,this.frames[c+3]=b,this.frames[c+4]=a},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){var e=a.slots[this.slotIndex];if(b>=d[d.length-5]){var f=d.length-1;return e.r=d[f-3],e.g=d[f-2],e.b=d[f-1],void(e.a=d[f])}var g=l.binarySearch(d,b,5),h=d[g-4],i=d[g-3],j=d[g-2],k=d[g-1],m=d[g],n=1-(b-m)/(d[g-5]-m);n=this.curves.getCurvePercent(g/5-1,n);var o=h+(d[g+1]-h)*n,p=i+(d[g+2]-i)*n,q=j+(d[g+3]-j)*n,r=k+(d[g+4]-k)*n;1>c?(e.r+=(o-e.r)*c,e.g+=(p-e.g)*c,e.b+=(q-e.b)*c,e.a+=(r-e.a)*c):(e.r=o,e.g=p,e.b=q,e.a=r)}}},l.AttachmentTimeline=function(a){this.curves=new l.Curves(a),this.frames=[],this.frames.length=a,this.attachmentNames=[],this.attachmentNames.length=a},l.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(a,b,c){this.frames[a]=b,this.attachmentNames[a]=c},apply:function(a,b){var c=this.frames;if(!(b<c[0])){var d;d=b>=c[c.length-1]?c.length-1:l.binarySearch(c,b,1)-1;var e=this.attachmentNames[d];a.slots[this.slotIndex].setAttachment(e?a.getAttachmentBySlotIndex(this.slotIndex,e):null)}}},l.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},l.SkeletonData.prototype={defaultSkin:null,findBone:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},findBoneIndex:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].name==a)return c;return-1},findSlot:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].name==a)return slot[c];return null},findSlotIndex:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].name==a)return c;return-1},findSkin:function(a){for(var b=this.skins,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},findAnimation:function(a){for(var b=this.animations,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null}},l.Skeleton=function(a){this.data=a,this.bones=[];for(var b=0,c=a.bones.length;c>b;b++){var d=a.bones[b],e=d.parent?this.bones[a.bones.indexOf(d.parent)]:null;this.bones.push(new l.Bone(d,e))}for(this.slots=[],this.drawOrder=[],b=0,c=a.slots.length;c>b;b++){var f=a.slots[b],g=this.bones[a.bones.indexOf(f.boneData)],h=new l.Slot(f,this,g);this.slots.push(h),this.drawOrder.push(h)}},l.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var a=this.flipX,b=this.flipY,c=this.bones,d=0,e=c.length;e>d;d++)c[d].updateWorldTransform(a,b)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var a=this.bones,b=0,c=a.length;c>b;b++)a[b].setToSetupPose()},setSlotsToSetupPose:function(){for(var a=this.slots,b=0,c=a.length;c>b;b++)a[b].setToSetupPose(b)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return b[c];return null},findBoneIndex:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return c;return-1},findSlot:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return b[c];return null},findSlotIndex:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return c;return-1},setSkinByName:function(a){var b=this.data.findSkin(a);if(!b)throw"Skin not found: "+a;this.setSkin(b)},setSkin:function(a){this.skin&&a&&a._attachAll(this,this.skin),this.skin=a},getAttachmentBySlotName:function(a,b){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(a),b)},getAttachmentBySlotIndex:function(a,b){if(this.skin){var c=this.skin.getAttachment(a,b);if(c)return c}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(a,b):null},setAttachment:function(a,b){for(var c=this.slots,d=0,e=c.size;e>d;d++){var f=c[d];if(f.data.name==a){var g=null;if(b&&(g=this.getAttachment(d,b),null==g))throw"Attachment not found: "+b+", for slot: "+a;return void f.setAttachment(g)}}throw"Slot not found: "+a},update:function(a){time+=a}},l.AttachmentType={region:0},l.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},l.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(a,b,c,d,e){var f=this.uvs;e?(f[2]=a,f[3]=d,f[4]=a,f[5]=b,f[6]=c,f[7]=b,f[0]=c,f[1]=d):(f[0]=a,f[1]=d,f[2]=a,f[3]=b,f[4]=c,f[5]=b,f[6]=c,f[7]=d)},updateOffset:function(){var a=this.width/this.regionOriginalWidth*this.scaleX,b=this.height/this.regionOriginalHeight*this.scaleY,c=-this.width/2*this.scaleX+this.regionOffsetX*a,d=-this.height/2*this.scaleY+this.regionOffsetY*b,e=c+this.regionWidth*a,f=d+this.regionHeight*b,g=this.rotation*Math.PI/180,h=Math.cos(g),i=Math.sin(g),j=c*h+this.x,k=c*i,l=d*h+this.y,m=d*i,n=e*h+this.x,o=e*i,p=f*h+this.y,q=f*i,r=this.offset;r[0]=j-m,r[1]=l+k,r[2]=j-q,r[3]=p+k,r[4]=n-q,r[5]=p+o,r[6]=n-m,r[7]=l+o},computeVertices:function(a,b,c,d){a+=c.worldX,b+=c.worldY;var e=c.m00,f=c.m01,g=c.m10,h=c.m11,i=this.offset;d[0]=i[0]*e+i[1]*f+a,d[1]=i[0]*g+i[1]*h+b,d[2]=i[2]*e+i[3]*f+a,d[3]=i[2]*g+i[3]*h+b,d[4]=i[4]*e+i[5]*f+a,d[5]=i[4]*g+i[5]*h+b,d[6]=i[6]*e+i[7]*f+a,d[7]=i[6]*g+i[7]*h+b}},l.AnimationStateData=function(a){this.skeletonData=a,this.animationToMixTime={}},l.AnimationStateData.prototype={defaultMix:0,setMixByName:function(a,b,c){var d=this.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;var e=this.skeletonData.findAnimation(b);if(!e)throw"Animation not found: "+b;this.setMix(d,e,c)},setMix:function(a,b,c){this.animationToMixTime[a.name+":"+b.name]=c},getMix:function(a,b){var c=this.animationToMixTime[a.name+":"+b.name];return c?c:this.defaultMix}},l.AnimationState=function(a){this.data=a,this.queue=[]},l.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(a){if(this.currentTime+=a,this.previousTime+=a,this.mixTime+=a,this.queue.length>0){var b=this.queue[0];this.currentTime>=b.delay&&(this._setAnimation(b.animation,b.loop),this.queue.shift())}},apply:function(a){if(this.current)if(this.previous){this.previous.apply(a,this.previousTime,this.previousLoop);var b=this.mixTime/this.mixDuration;b>=1&&(b=1,this.previous=null),this.current.mix(a,this.currentTime,this.currentLoop,b)}else this.current.apply(a,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(a,b){this.previous=null,a&&this.current&&(this.mixDuration=this.data.getMix(this.current,a),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=a,this.currentLoop=b,this.currentTime=0},setAnimationByName:function(a,b){var c=this.data.skeletonData.findAnimation(a);if(!c)throw"Animation not found: "+a;this.setAnimation(c,b)},setAnimation:function(a,b){this.queue.length=0,this._setAnimation(a,b)},addAnimationByName:function(a,b,c){var d=this.data.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;this.addAnimation(d,b,c)},addAnimation:function(a,b,c){var d={};if(d.animation=a,d.loop=b,!c||0>=c){var e=this.queue.length?this.queue[this.queue.length-1].animation:this.current;c=null!=e?e.duration-this.data.getMix(e,a)+(c||0):0}d.delay=c,this.queue.push(d)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},l.SkeletonJson=function(a){this.attachmentLoader=a},l.SkeletonJson.prototype={scale:1,readSkeletonData:function(a){for(var b,c=new l.SkeletonData,d=a.bones,e=0,f=d.length;f>e;e++){var g=d[e],h=null;if(g.parent&&(h=c.findBone(g.parent),!h))throw"Parent bone not found: "+g.parent;b=new l.BoneData(g.name,h),b.length=(g.length||0)*this.scale,b.x=(g.x||0)*this.scale,b.y=(g.y||0)*this.scale,b.rotation=g.rotation||0,b.scaleX=g.scaleX||1,b.scaleY=g.scaleY||1,c.bones.push(b)}var i=a.slots;for(e=0,f=i.length;f>e;e++){var j=i[e];if(b=c.findBone(j.bone),!b)throw"Slot bone not found: "+j.bone;var k=new l.SlotData(j.name,b),m=j.color;m&&(k.r=l.SkeletonJson.toColor(m,0),k.g=l.SkeletonJson.toColor(m,1),k.b=l.SkeletonJson.toColor(m,2),k.a=l.SkeletonJson.toColor(m,3)),k.attachmentName=j.attachment,c.slots.push(k)}var n=a.skins;for(var o in n)if(n.hasOwnProperty(o)){var p=n[o],q=new l.Skin(o);for(var r in p)if(p.hasOwnProperty(r)){var s=c.findSlotIndex(r),t=p[r];for(var u in t)if(t.hasOwnProperty(u)){var v=this.readAttachment(q,u,t[u]);null!=v&&q.addAttachment(s,u,v)}}c.skins.push(q),"default"==q.name&&(c.defaultSkin=q)}var w=a.animations;for(var x in w)w.hasOwnProperty(x)&&this.readAnimation(x,w[x],c);return c},readAttachment:function(a,b,c){b=c.name||b;var d=l.AttachmentType[c.type||"region"];if(d==l.AttachmentType.region){var e=new l.RegionAttachment;return e.x=(c.x||0)*this.scale,e.y=(c.y||0)*this.scale,e.scaleX=c.scaleX||1,e.scaleY=c.scaleY||1,e.rotation=c.rotation||0,e.width=(c.width||32)*this.scale,e.height=(c.height||32)*this.scale,e.updateOffset(),e.rendererObject={},e.rendererObject.name=b,e.rendererObject.scale={},e.rendererObject.scale.x=e.scaleX,e.rendererObject.scale.y=e.scaleY,e.rendererObject.rotation=-e.rotation*Math.PI/180,e}throw"Unknown attachment type: "+d},readAnimation:function(a,b,c){var d,e,f,g,h,i,j,k=[],m=0,n=b.bones;for(var o in n)if(n.hasOwnProperty(o)){var p=c.findBoneIndex(o);if(-1==p)throw"Bone not found: "+o;var q=n[o];for(f in q)if(q.hasOwnProperty(f))if(h=q[f],"rotate"==f){for(e=new l.RotateTimeline(h.length),e.boneIndex=p,d=0,i=0,j=h.length;j>i;i++)g=h[i],e.setFrame(d,g.time,g.angle),l.SkeletonJson.readCurve(e,d,g),d++;k.push(e),m=Math.max(m,e.frames[2*e.getFrameCount()-2])}else{if("translate"!=f&&"scale"!=f)throw"Invalid timeline type for a bone: "+f+" ("+o+")";var r=1;for("scale"==f?e=new l.ScaleTimeline(h.length):(e=new l.TranslateTimeline(h.length),r=this.scale),e.boneIndex=p,d=0,i=0,j=h.length;j>i;i++){g=h[i];var s=(g.x||0)*r,t=(g.y||0)*r;e.setFrame(d,g.time,s,t),l.SkeletonJson.readCurve(e,d,g),d++}k.push(e),m=Math.max(m,e.frames[3*e.getFrameCount()-3])}}var u=b.slots;for(var v in u)if(u.hasOwnProperty(v)){var w=u[v],x=c.findSlotIndex(v);for(f in w)if(w.hasOwnProperty(f))if(h=w[f],"color"==f){for(e=new l.ColorTimeline(h.length),e.slotIndex=x,d=0,i=0,j=h.length;j>i;i++){g=h[i];var y=g.color,z=l.SkeletonJson.toColor(y,0),A=l.SkeletonJson.toColor(y,1),B=l.SkeletonJson.toColor(y,2),C=l.SkeletonJson.toColor(y,3);e.setFrame(d,g.time,z,A,B,C),l.SkeletonJson.readCurve(e,d,g),d++}k.push(e),m=Math.max(m,e.frames[5*e.getFrameCount()-5])}else{if("attachment"!=f)throw"Invalid timeline type for a slot: "+f+" ("+v+")";for(e=new l.AttachmentTimeline(h.length),e.slotIndex=x,d=0,i=0,j=h.length;j>i;i++)g=h[i],e.setFrame(d++,g.time,g.name);k.push(e),m=Math.max(m,e.frames[e.getFrameCount()-1])}}c.animations.push(new l.Animation(a,k,m))}},l.SkeletonJson.readCurve=function(a,b,c){var d=c.curve;d&&("stepped"==d?a.curves.setStepped(b):d instanceof Array&&a.curves.setCurve(b,d[0],d[1],d[2],d[3]))},l.SkeletonJson.toColor=function(a,b){if(8!=a.length)throw"Color hexidecimal length must be 8, recieved: "+a;
return parseInt(a.substring(2*b,2),16)/255},l.Atlas=function(a,b){this.textureLoader=b,this.pages=[],this.regions=[];var c=new l.AtlasReader(a),d=[];d.length=4;for(var e=null;;){var f=c.readLine();if(null==f)break;if(f=c.trim(f),f.length)if(e){var g=new l.AtlasRegion;g.name=f,g.page=e,g.rotate="true"==c.readValue(),c.readTuple(d);var h=parseInt(d[0],10),i=parseInt(d[1],10);c.readTuple(d);var j=parseInt(d[0],10),k=parseInt(d[1],10);g.u=h/e.width,g.v=i/e.height,g.rotate?(g.u2=(h+k)/e.width,g.v2=(i+j)/e.height):(g.u2=(h+j)/e.width,g.v2=(i+k)/e.height),g.x=h,g.y=i,g.width=Math.abs(j),g.height=Math.abs(k),4==c.readTuple(d)&&(g.splits=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],4==c.readTuple(d)&&(g.pads=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],c.readTuple(d))),g.originalWidth=parseInt(d[0],10),g.originalHeight=parseInt(d[1],10),c.readTuple(d),g.offsetX=parseInt(d[0],10),g.offsetY=parseInt(d[1],10),g.index=parseInt(c.readValue(),10),this.regions.push(g)}else{e=new l.AtlasPage,e.name=f,e.format=l.Atlas.Format[c.readValue()],c.readTuple(d),e.minFilter=l.Atlas.TextureFilter[d[0]],e.magFilter=l.Atlas.TextureFilter[d[1]];var m=c.readValue();e.uWrap=l.Atlas.TextureWrap.clampToEdge,e.vWrap=l.Atlas.TextureWrap.clampToEdge,"x"==m?e.uWrap=l.Atlas.TextureWrap.repeat:"y"==m?e.vWrap=l.Atlas.TextureWrap.repeat:"xy"==m&&(e.uWrap=e.vWrap=l.Atlas.TextureWrap.repeat),b.load(e,f),this.pages.push(e)}else e=null}},l.Atlas.prototype={findRegion:function(a){for(var b=this.regions,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},dispose:function(){for(var a=this.pages,b=0,c=a.length;c>b;b++)this.textureLoader.unload(a[b].rendererObject)},updateUVs:function(a){for(var b=this.regions,c=0,d=b.length;d>c;c++){var e=b[c];e.page==a&&(e.u=e.x/a.width,e.v=e.y/a.height,e.rotate?(e.u2=(e.x+e.height)/a.width,e.v2=(e.y+e.width)/a.height):(e.u2=(e.x+e.width)/a.width,e.v2=(e.y+e.height)/a.height))}}},l.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},l.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},l.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},l.AtlasPage=function(){},l.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},l.AtlasRegion=function(){},l.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},l.AtlasReader=function(a){this.lines=a.split(/\r\n|\r|\n/)},l.AtlasReader.prototype={index:0,trim:function(a){return a.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var a=this.readLine(),b=a.indexOf(":");if(-1==b)throw"Invalid line: "+a;return this.trim(a.substring(b+1))},readTuple:function(a){var b=this.readLine(),c=b.indexOf(":");if(-1==c)throw"Invalid line: "+b;for(var d=0,e=c+1;3>d;d++){var f=b.indexOf(",",e);if(-1==f){if(!d)throw"Invalid line: "+b;break}a[d]=this.trim(b.substr(e,f-e)),e=f+1}return a[d]=this.trim(b.substring(e)),d+1}},l.AtlasAttachmentLoader=function(a){this.atlas=a},l.AtlasAttachmentLoader.prototype={newAttachment:function(a,b,c){switch(b){case l.AttachmentType.region:var d=this.atlas.findRegion(c);if(!d)throw"Region not found in atlas: "+c+" ("+b+")";var e=new l.RegionAttachment(c);return e.rendererObject=d,e.setUVs(d.u,d.v,d.u2,d.v2,d.rotate),e.regionOffsetX=d.offsetX,e.regionOffsetY=d.offsetY,e.regionWidth=d.width,e.regionHeight=d.height,e.regionOriginalWidth=d.originalWidth,e.regionOriginalHeight=d.originalHeight,e}throw"Unknown attachment type: "+b}},l.Bone.yDown=!0,h.AnimCache={},h.Spine=function(a){if(h.DisplayObjectContainer.call(this),this.spineData=h.AnimCache[a],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+a);this.skeleton=new l.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new l.AnimationStateData(this.spineData),this.state=new l.AnimationState(this.stateData),this.slotContainers=[];for(var b=0,c=this.skeleton.drawOrder.length;c>b;b++){var d=this.skeleton.drawOrder[b],e=d.attachment,f=new h.DisplayObjectContainer;if(this.slotContainers.push(f),this.addChild(f),e instanceof l.RegionAttachment){var g=e.rendererObject.name,i=this.createSprite(d,e.rendererObject);d.currentSprite=i,d.currentSpriteName=g,f.addChild(i)}}},h.Spine.prototype=Object.create(h.DisplayObjectContainer.prototype),h.Spine.prototype.constructor=h.Spine,h.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var a=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(a),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var b=this.skeleton.drawOrder,c=0,d=b.length;d>c;c++){var e=b[c],f=e.attachment,g=this.slotContainers[c];if(f instanceof l.RegionAttachment){if(f.rendererObject&&(!e.currentSpriteName||e.currentSpriteName!=f.name)){var i=f.rendererObject.name;if(void 0!==e.currentSprite&&(e.currentSprite.visible=!1),e.sprites=e.sprites||{},void 0!==e.sprites[i])e.sprites[i].visible=!0;else{var j=this.createSprite(e,f.rendererObject);g.addChild(j)}e.currentSprite=e.sprites[i],e.currentSpriteName=i}g.visible=!0;var k=e.bone;g.position.x=k.worldX+f.x*k.m00+f.y*k.m01,g.position.y=k.worldY+f.x*k.m10+f.y*k.m11,g.scale.x=k.worldScaleX,g.scale.y=k.worldScaleY,g.rotation=-(e.bone.worldRotation*Math.PI/180)}else g.visible=!1}h.DisplayObjectContainer.prototype.updateTransform.call(this)},h.Spine.prototype.createSprite=function(a,b){var c=h.TextureCache[b.name]?b.name:b.name+".png",d=new h.Sprite(h.Texture.fromFrame(c));return d.scale=b.scale,d.rotation=b.rotation,d.anchor.x=d.anchor.y=.5,a.sprites=a.sprites||{},a.sprites[b.name]=d,d},h.BaseTextureCache={},h.texturesToUpdate=[],h.texturesToDestroy=[],h.BaseTextureCacheIdGenerator=0,h.BaseTexture=function(a,b){if(h.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=b||h.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=a,a){if(this.source.complete||this.source.getContext)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,h.texturesToUpdate.push(this);else{var c=this;this.source.onload=function(){c.hasLoaded=!0,c.width=c.source.width,c.height=c.source.height,h.texturesToUpdate.push(c),c.dispatchEvent({type:"loaded",content:c})}}this.imageUrl=null,this._powerOf2=!1,this.id=h.BaseTextureCacheIdGenerator++,this._glTextures=[]}},h.BaseTexture.prototype.constructor=h.BaseTexture,h.BaseTexture.prototype.destroy=function(){this.imageUrl&&(delete h.BaseTextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null),this.source=null,h.texturesToDestroy.push(this)},h.BaseTexture.prototype.updateSourceImage=function(a){this.hasLoaded=!1,this.source.src=null,this.source.src=a},h.BaseTexture.fromImage=function(a,b,c){var d=h.BaseTextureCache[a];if(b=!b,!d){var e=new Image;b&&(e.crossOrigin=""),e.src=a,d=new h.BaseTexture(e,c),d.imageUrl=a,h.BaseTextureCache[a]=d}return d},h.BaseTexture.fromCanvas=function(a,b){a._pixiId||(a._pixiId="canvas_"+h.TextureCacheIdGenerator++);var c=h.BaseTextureCache[a._pixiId];return c||(c=new h.BaseTexture(a,b),h.BaseTextureCache[a._pixiId]=c),c},h.TextureCache={},h.FrameCache={},h.TextureCacheIdGenerator=0,h.Texture=function(a,b){if(h.EventTarget.call(this),b||(this.noFrame=!0,b=new h.Rectangle(0,0,1,1)),a instanceof h.Texture&&(a=a.baseTexture),this.baseTexture=a,this.frame=b,this.trim=null,this.scope=this,a.hasLoaded)this.noFrame&&(b=new h.Rectangle(0,0,a.width,a.height)),this.setFrame(b);else{var c=this;a.addEventListener("loaded",function(){c.onBaseTextureLoaded()})}},h.Texture.prototype.constructor=h.Texture,h.Texture.prototype.onBaseTextureLoaded=function(){var a=this.baseTexture;a.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new h.Rectangle(0,0,a.width,a.height)),this.setFrame(this.frame),this.scope.dispatchEvent({type:"update",content:this})},h.Texture.prototype.destroy=function(a){a&&this.baseTexture.destroy()},h.Texture.prototype.setFrame=function(a){if(this.frame=a,this.width=a.width,this.height=a.height,a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height)throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.updateFrame=!0,h.Texture.frameUpdates.push(this)},h.Texture.prototype._updateWebGLuvs=function(){this._uvs||(this._uvs=new h.TextureUvs);var a=this.frame,b=this.baseTexture.width,c=this.baseTexture.height;this._uvs.x0=a.x/b,this._uvs.y0=a.y/c,this._uvs.x1=(a.x+a.width)/b,this._uvs.y1=a.y/c,this._uvs.x2=(a.x+a.width)/b,this._uvs.y2=(a.y+a.height)/c,this._uvs.x3=a.x/b,this._uvs.y3=(a.y+a.height)/c},h.Texture.fromImage=function(a,b,c){var d=h.TextureCache[a];return d||(d=new h.Texture(h.BaseTexture.fromImage(a,b,c)),h.TextureCache[a]=d),d},h.Texture.fromFrame=function(a){var b=h.TextureCache[a];if(!b)throw new Error('The frameId "'+a+'" does not exist in the texture cache ');return b},h.Texture.fromCanvas=function(a,b){var c=h.BaseTexture.fromCanvas(a,b);return new h.Texture(c)},h.Texture.addTextureToCache=function(a,b){h.TextureCache[b]=a},h.Texture.removeTextureFromCache=function(a){var b=h.TextureCache[a];return h.TextureCache[a]=null,b},h.Texture.frameUpdates=[],h.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y4=0},h.RenderTexture=function(a,b,c){if(h.EventTarget.call(this),this.width=a||100,this.height=b||100,this.frame=new h.Rectangle(0,0,this.width,this.height),this.baseTexture=new h.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTextures=[],this.baseTexture.hasLoaded=!0,this.renderer=c||h.defaultRenderer,this.renderer.type===h.WEBGL_RENDERER){var d=this.renderer.gl;this.textureBuffer=new h.FilterTexture(d,this.width,this.height),this.baseTexture._glTextures[d.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new h.Point(this.width/2,-this.height/2)}else this.render=this.renderCanvas,this.textureBuffer=new h.CanvasBuffer(this.width,this.height),this.baseTexture.source=this.textureBuffer.canvas;h.Texture.frameUpdates.push(this)},h.RenderTexture.prototype=Object.create(h.Texture.prototype),h.RenderTexture.prototype.constructor=h.RenderTexture,h.RenderTexture.prototype.resize=function(a,b){if(this.width=a,this.height=b,this.frame.width=this.width,this.frame.height=this.height,this.renderer.type===h.WEBGL_RENDERER){this.projection.x=this.width/2,this.projection.y=-this.height/2;var c=this.renderer.gl;c.bindTexture(c.TEXTURE_2D,this.baseTexture._glTextures[c.id]),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,this.width,this.height,0,c.RGBA,c.UNSIGNED_BYTE,null)}else this.textureBuffer.resize(this.width,this.height);h.Texture.frameUpdates.push(this)},h.RenderTexture.prototype.renderWebGL=function(a,b,c){var d=this.renderer.gl;d.colorMask(!0,!0,!0,!0),d.viewport(0,0,this.width,this.height),d.bindFramebuffer(d.FRAMEBUFFER,this.textureBuffer.frameBuffer),c&&this.textureBuffer.clear();var e=a.children,f=a.worldTransform;a.worldTransform=h.RenderTexture.tempMatrix,a.worldTransform.d=-1,a.worldTransform.ty=-2*this.projection.y,b&&(a.worldTransform.tx=b.x,a.worldTransform.ty-=b.y);for(var g=0,i=e.length;i>g;g++)e[g].updateTransform();h.WebGLRenderer.updateTextures(),this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer),a.worldTransform=f},h.RenderTexture.prototype.renderCanvas=function(a,b,c){var d=a.children;a.worldTransform=h.RenderTexture.tempMatrix,b&&(a.worldTransform.tx=b.x,a.worldTransform.ty=b.y);for(var e=0,f=d.length;f>e;e++)d[e].updateTransform();c&&this.textureBuffer.clear();var g=this.textureBuffer.context;this.renderer.renderDisplayObject(a,g),g.setTransform(1,0,0,1,0,0)},h.RenderTexture.tempMatrix=new h.Matrix,h.AssetLoader=function(a,b){h.EventTarget.call(this),this.assetURLs=a,this.crossorigin=b,this.loadersByType={jpg:h.ImageLoader,jpeg:h.ImageLoader,png:h.ImageLoader,gif:h.ImageLoader,json:h.JsonLoader,atlas:h.AtlasLoader,anim:h.SpineLoader,xml:h.BitmapFontLoader,fnt:h.BitmapFontLoader}},h.AssetLoader.prototype.constructor=h.AssetLoader,h.AssetLoader.prototype._getDataType=function(a){var b="data:",c=a.slice(0,b.length).toLowerCase();if(c===b){var d=a.slice(b.length),e=d.indexOf(",");if(-1===e)return null;var f=d.slice(0,e).split(";")[0];return f&&"text/plain"!==f.toLowerCase()?f.split("/").pop().toLowerCase():"txt"}return null},h.AssetLoader.prototype.load=function(){function a(a){b.onAssetLoaded(a.loader)}var b=this;this.loadCount=this.assetURLs.length;for(var c=0;c<this.assetURLs.length;c++){var d=this.assetURLs[c],e=this._getDataType(d);e||(e=d.split("?").shift().split(".").pop().toLowerCase());var f=this.loadersByType[e];if(!f)throw new Error(e+" is an unsupported file type");var g=new f(d,this.crossorigin);g.addEventListener("loaded",a),g.load()}},h.AssetLoader.prototype.onAssetLoaded=function(a){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this,loader:a}),this.onProgress&&this.onProgress(a),this.loadCount||(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},h.JsonLoader=function(a,b){h.EventTarget.call(this),this.url=a,this.crossorigin=b,this.baseUrl=a.replace(/[^\/]*$/,""),this.loaded=!1},h.JsonLoader.prototype.constructor=h.JsonLoader,h.JsonLoader.prototype.load=function(){this.ajaxRequest=new h.AjaxRequest(this.crossorigin);var a=this;this.ajaxRequest.onreadystatechange=function(){a.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},h.JsonLoader.prototype.onJSONLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var a=this,b=this.baseUrl+this.json.meta.image,c=new h.ImageLoader(b,this.crossorigin),d=this.json.frames;this.texture=c.texture.baseTexture,c.addEventListener("loaded",function(){a.onLoaded()});for(var e in d){var f=d[e].frame;if(f&&(h.TextureCache[e]=new h.Texture(this.texture,{x:f.x,y:f.y,width:f.w,height:f.h}),d[e].trimmed)){var g=h.TextureCache[e],i=d[e].sourceSize,j=d[e].spriteSourceSize;g.trim=new h.Rectangle(j.x,j.y,i.w,i.h)}}c.load()}else if(this.json.bones){var k=new l.SkeletonJson,m=k.readSkeletonData(this.json);h.AnimCache[this.url]=m,this.onLoaded()}else this.onLoaded();else this.onError()},h.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},h.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},h.AtlasLoader=function(a,b){h.EventTarget.call(this),this.url=a,this.baseUrl=a.replace(/[^\/]*$/,""),this.crossorigin=b,this.loaded=!1},h.AtlasLoader.constructor=h.AtlasLoader,h.AtlasLoader.prototype.load=function(){this.ajaxRequest=new h.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},h.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var a=this.ajaxRequest.responseText.split(/\r?\n/),b=-3,c=0,d=null,e=!1,f=0,g=0,i=this.onLoaded.bind(this);for(f=0;f<a.length;f++)if(a[f]=a[f].replace(/^\s+|\s+$/g,""),""===a[f]&&(e=f+1),a[f].length>0){if(e===f)this.atlas.meta.image.push(a[f]),c=this.atlas.meta.image.length-1,this.atlas.frames.push({}),b=-3;else if(b>0)if(b%7===1)null!=d&&(this.atlas.frames[c][d.name]=d),d={name:a[f],frame:{}};else{var j=a[f].split(" ");if(b%7===3)d.frame.x=Number(j[1].replace(",","")),d.frame.y=Number(j[2]);else if(b%7===4)d.frame.w=Number(j[1].replace(",","")),d.frame.h=Number(j[2]);else if(b%7===5){var k={x:0,y:0,w:Number(j[1].replace(",","")),h:Number(j[2])};k.w>d.frame.w||k.h>d.frame.h?(d.trimmed=!0,d.realSize=k):d.trimmed=!1}}b++}if(null!=d&&(this.atlas.frames[c][d.name]=d),this.atlas.meta.image.length>0){for(this.images=[],g=0;g<this.atlas.meta.image.length;g++){var l=this.baseUrl+this.atlas.meta.image[g],m=this.atlas.frames[g];this.images.push(new h.ImageLoader(l,this.crossorigin));for(f in m){var n=m[f].frame;n&&(h.TextureCache[f]=new h.Texture(this.images[g].texture.baseTexture,{x:n.x,y:n.y,width:n.w,height:n.h}),m[f].trimmed&&(h.TextureCache[f].realSize=m[f].realSize,h.TextureCache[f].trim.x=0,h.TextureCache[f].trim.y=0))}}for(this.currentImageId=0,g=0;g<this.images.length;g++)this.images[g].addEventListener("loaded",i);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},h.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.dispatchEvent({type:"loaded",content:this}))},h.AtlasLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},h.SpriteSheetLoader=function(a,b){h.EventTarget.call(this),this.url=a,this.crossorigin=b,this.baseUrl=a.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},h.SpriteSheetLoader.prototype.constructor=h.SpriteSheetLoader,h.SpriteSheetLoader.prototype.load=function(){var a=this,b=new h.JsonLoader(this.url,this.crossorigin);b.addEventListener("loaded",function(b){a.json=b.content.json,a.onLoaded()}),b.load()},h.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},h.ImageLoader=function(a,b){h.EventTarget.call(this),this.texture=h.Texture.fromImage(a,b),this.frames=[]},h.ImageLoader.prototype.constructor=h.ImageLoader,h.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var a=this;this.texture.baseTexture.addEventListener("loaded",function(){a.onLoaded()})}},h.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},h.ImageLoader.prototype.loadFramedSpriteSheet=function(a,b,c){this.frames=[];for(var d=Math.floor(this.texture.width/a),e=Math.floor(this.texture.height/b),f=0,g=0;e>g;g++)for(var i=0;d>i;i++,f++){var j=new h.Texture(this.texture,{x:i*a,y:g*b,width:a,height:b});this.frames.push(j),c&&(h.TextureCache[c+"-"+f]=j)}if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var k=this;this.texture.baseTexture.addEventListener("loaded",function(){k.onLoaded()})}},h.BitmapFontLoader=function(a,b){h.EventTarget.call(this),this.url=a,this.crossorigin=b,this.baseUrl=a.replace(/[^\/]*$/,""),this.texture=null},h.BitmapFontLoader.prototype.constructor=h.BitmapFontLoader,h.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new h.AjaxRequest;var a=this;this.ajaxRequest.onreadystatechange=function(){a.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},h.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var a=this.ajaxRequest.responseXML;if(!a||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var b=new DOMParser;a=b.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var c=document.createElement("div");c.innerHTML=this.ajaxRequest.responseText,a=c}var d=this.baseUrl+a.getElementsByTagName("page")[0].getAttribute("file"),e=new h.ImageLoader(d,this.crossorigin);this.texture=e.texture.baseTexture;var f={},g=a.getElementsByTagName("info")[0],i=a.getElementsByTagName("common")[0];f.font=g.getAttribute("face"),f.size=parseInt(g.getAttribute("size"),10),f.lineHeight=parseInt(i.getAttribute("lineHeight"),10),f.chars={};for(var j=a.getElementsByTagName("char"),k=0;k<j.length;k++){var l=parseInt(j[k].getAttribute("id"),10),m=new h.Rectangle(parseInt(j[k].getAttribute("x"),10),parseInt(j[k].getAttribute("y"),10),parseInt(j[k].getAttribute("width"),10),parseInt(j[k].getAttribute("height"),10));f.chars[l]={xOffset:parseInt(j[k].getAttribute("xoffset"),10),yOffset:parseInt(j[k].getAttribute("yoffset"),10),xAdvance:parseInt(j[k].getAttribute("xadvance"),10),kerning:{},texture:h.TextureCache[l]=new h.Texture(this.texture,m)}}var n=a.getElementsByTagName("kerning");for(k=0;k<n.length;k++){var o=parseInt(n[k].getAttribute("first"),10),p=parseInt(n[k].getAttribute("second"),10),q=parseInt(n[k].getAttribute("amount"),10);f.chars[p].kerning[o]=q}h.BitmapText.fonts[f.font]=f;var r=this;e.addEventListener("loaded",function(){r.onLoaded()}),e.load()}},h.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},h.SpineLoader=function(a,b){h.EventTarget.call(this),this.url=a,this.crossorigin=b,this.loaded=!1},h.SpineLoader.prototype.constructor=h.SpineLoader,h.SpineLoader.prototype.load=function(){var a=this,b=new h.JsonLoader(this.url,this.crossorigin);b.addEventListener("loaded",function(b){a.json=b.content.json,a.onLoaded()}),b.load()},h.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},h.AbstractFilter=function(a,b){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=b||{},this.fragmentSrc=a||[]},h.AlphaMaskFilter=function(a){h.AbstractFilter.call(this),this.passes=[this],a.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:a},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},a.baseTexture.hasLoaded?(this.uniforms.mask.value.x=a.width,this.uniforms.mask.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},h.AlphaMaskFilter.prototype=Object.create(h.AbstractFilter.prototype),h.AlphaMaskFilter.prototype.constructor=h.AlphaMaskFilter,h.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(h.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(a){this.uniforms.mask.value=a}}),h.ColorMatrixFilter=function(){h.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},h.ColorMatrixFilter.prototype=Object.create(h.AbstractFilter.prototype),h.ColorMatrixFilter.prototype.constructor=h.ColorMatrixFilter,Object.defineProperty(h.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(a){this.uniforms.matrix.value=a}}),h.GrayFilter=function(){h.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},h.GrayFilter.prototype=Object.create(h.AbstractFilter.prototype),h.GrayFilter.prototype.constructor=h.GrayFilter,Object.defineProperty(h.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(a){this.uniforms.gray.value=a}}),h.DisplacementFilter=function(a){h.AbstractFilter.call(this),this.passes=[this],a.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:a},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},a.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=a.width,this.uniforms.mapDimensions.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},h.DisplacementFilter.prototype=Object.create(h.AbstractFilter.prototype),h.DisplacementFilter.prototype.constructor=h.DisplacementFilter,h.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(h.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(a){this.uniforms.displacementMap.value=a}}),Object.defineProperty(h.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.uniforms.scale.value=a}}),Object.defineProperty(h.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.uniforms.offset.value=a}}),h.PixelateFilter=function(){h.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},h.PixelateFilter.prototype=Object.create(h.AbstractFilter.prototype),h.PixelateFilter.prototype.constructor=h.PixelateFilter,Object.defineProperty(h.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(a){this.dirty=!0,this.uniforms.pixelSize.value=a}}),h.BlurXFilter=function(){h.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},h.BlurXFilter.prototype=Object.create(h.AbstractFilter.prototype),h.BlurXFilter.prototype.constructor=h.BlurXFilter,Object.defineProperty(h.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.dirty=!0,this.uniforms.blur.value=1/7e3*a}}),h.BlurYFilter=function(){h.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},h.BlurYFilter.prototype=Object.create(h.AbstractFilter.prototype),h.BlurYFilter.prototype.constructor=h.BlurYFilter,Object.defineProperty(h.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a}}),h.BlurFilter=function(){this.blurXFilter=new h.BlurXFilter,this.blurYFilter=new h.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},Object.defineProperty(h.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=this.blurYFilter.blur=a}}),Object.defineProperty(h.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=a}}),Object.defineProperty(h.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(a){this.blurYFilter.blur=a}}),h.InvertFilter=function(){h.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},h.InvertFilter.prototype=Object.create(h.AbstractFilter.prototype),h.InvertFilter.prototype.constructor=h.InvertFilter,Object.defineProperty(h.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value
},set:function(a){this.uniforms.invert.value=a}}),h.SepiaFilter=function(){h.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},h.SepiaFilter.prototype=Object.create(h.AbstractFilter.prototype),h.SepiaFilter.prototype.constructor=h.SepiaFilter,Object.defineProperty(h.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(a){this.uniforms.sepia.value=a}}),h.TwistFilter=function(){h.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},h.TwistFilter.prototype=Object.create(h.AbstractFilter.prototype),h.TwistFilter.prototype.constructor=h.TwistFilter,Object.defineProperty(h.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.dirty=!0,this.uniforms.offset.value=a}}),Object.defineProperty(h.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(a){this.dirty=!0,this.uniforms.radius.value=a}}),Object.defineProperty(h.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0,this.uniforms.angle.value=a}}),h.ColorStepFilter=function(){h.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},h.ColorStepFilter.prototype=Object.create(h.AbstractFilter.prototype),h.ColorStepFilter.prototype.constructor=h.ColorStepFilter,Object.defineProperty(h.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(a){this.uniforms.step.value=a}}),h.DotScreenFilter=function(){h.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},h.DotScreenFilter.prototype=Object.create(h.DotScreenFilter.prototype),h.DotScreenFilter.prototype.constructor=h.DotScreenFilter,Object.defineProperty(h.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.dirty=!0,this.uniforms.scale.value=a}}),Object.defineProperty(h.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0,this.uniforms.angle.value=a}}),h.CrossHatchFilter=function(){h.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},h.CrossHatchFilter.prototype=Object.create(h.AbstractFilter.prototype),h.CrossHatchFilter.prototype.constructor=h.BlurYFilter,Object.defineProperty(h.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a}}),h.RGBSplitFilter=function(){h.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},h.RGBSplitFilter.prototype=Object.create(h.AbstractFilter.prototype),h.RGBSplitFilter.prototype.constructor=h.RGBSplitFilter,Object.defineProperty(h.RGBSplitFilter.prototype,"angle",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a}}),"undefined"!=typeof f?("undefined"!=typeof e&&e.exports&&(f=e.exports=h),f.PIXI=h):"undefined"!=typeof c&&c.amd?c(h):d.PIXI=h}).call(this)},{}],7:[function(a,b,c){(function(a,b){(function(){"use strict";function d(a){throw a}function e(a,b){this.index="number"==typeof b?b:0,this.m=0,this.buffer=a instanceof(K?Uint8Array:Array)?a:new(K?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&d(Error("invalid index")),this.buffer.length<=this.index&&this.f()}function f(a,b,c){var d,e="number"==typeof b?b:b=0,f="number"==typeof c?c:a.length;for(d=-1,e=7&f;e--;++b)d=d>>>8^S[255&(d^a[b])];for(e=f>>3;e--;b+=8)d=d>>>8^S[255&(d^a[b])],d=d>>>8^S[255&(d^a[b+1])],d=d>>>8^S[255&(d^a[b+2])],d=d>>>8^S[255&(d^a[b+3])],d=d>>>8^S[255&(d^a[b+4])],d=d>>>8^S[255&(d^a[b+5])],d=d>>>8^S[255&(d^a[b+6])],d=d>>>8^S[255&(d^a[b+7])];return(4294967295^d)>>>0}function g(){}function h(a){this.buffer=new(K?Uint16Array:Array)(2*a),this.length=0}function i(a){var b,c,d,e,f,g,h,i,j,k=a.length,l=0,m=Number.POSITIVE_INFINITY;for(i=0;k>i;++i)a[i]>l&&(l=a[i]),a[i]<m&&(m=a[i]);for(b=1<<l,c=new(K?Uint32Array:Array)(b),d=1,e=0,f=2;l>=d;){for(i=0;k>i;++i)if(a[i]===d){for(g=0,h=e,j=0;d>j;++j)g=g<<1|1&h,h>>=1;for(j=g;b>j;j+=f)c[j]=d<<16|i;++e}++d,e<<=1,f<<=1}return[c,l,m]}function j(a,b){this.k=U,this.F=0,this.input=K&&a instanceof Array?new Uint8Array(a):a,this.b=0,b&&(b.lazy&&(this.F=b.lazy),"number"==typeof b.compressionType&&(this.k=b.compressionType),b.outputBuffer&&(this.a=K&&b.outputBuffer instanceof Array?new Uint8Array(b.outputBuffer):b.outputBuffer),"number"==typeof b.outputIndex&&(this.b=b.outputIndex)),this.a||(this.a=new(K?Uint8Array:Array)(32768))}function k(a,b){this.length=a,this.N=b}function l(a,b){function c(a,b){var c,e=a.N,f=[],g=0;c=Y[a.length],f[g++]=65535&c,f[g++]=c>>16&255,f[g++]=c>>24;var h;switch(J){case 1===e:h=[0,e-1,0];break;case 2===e:h=[1,e-2,0];break;case 3===e:h=[2,e-3,0];break;case 4===e:h=[3,e-4,0];break;case 6>=e:h=[4,e-5,1];break;case 8>=e:h=[5,e-7,1];break;case 12>=e:h=[6,e-9,2];break;case 16>=e:h=[7,e-13,2];break;case 24>=e:h=[8,e-17,3];break;case 32>=e:h=[9,e-25,3];break;case 48>=e:h=[10,e-33,4];break;case 64>=e:h=[11,e-49,4];break;case 96>=e:h=[12,e-65,5];break;case 128>=e:h=[13,e-97,5];break;case 192>=e:h=[14,e-129,6];break;case 256>=e:h=[15,e-193,6];break;case 384>=e:h=[16,e-257,7];break;case 512>=e:h=[17,e-385,7];break;case 768>=e:h=[18,e-513,8];break;case 1024>=e:h=[19,e-769,8];break;case 1536>=e:h=[20,e-1025,9];break;case 2048>=e:h=[21,e-1537,9];break;case 3072>=e:h=[22,e-2049,10];break;case 4096>=e:h=[23,e-3073,10];break;case 6144>=e:h=[24,e-4097,11];break;case 8192>=e:h=[25,e-6145,11];break;case 12288>=e:h=[26,e-8193,12];break;case 16384>=e:h=[27,e-12289,12];break;case 24576>=e:h=[28,e-16385,13];break;case 32768>=e:h=[29,e-24577,13];break;default:d("invalid distance")}c=h,f[g++]=c[0],f[g++]=c[1],f[g++]=c[2];var i,j;for(i=0,j=f.length;j>i;++i)p[q++]=f[i];s[f[0]]++,t[f[3]]++,r=a.length+b-1,l=null}var e,f,g,h,i,j,k,l,n,o={},p=K?new Uint16Array(2*b.length):[],q=0,r=0,s=new(K?Uint32Array:Array)(286),t=new(K?Uint32Array:Array)(30),u=a.F;if(!K){for(g=0;285>=g;)s[g++]=0;for(g=0;29>=g;)t[g++]=0}for(s[256]=1,e=0,f=b.length;f>e;++e){for(g=i=0,h=3;h>g&&e+g!==f;++g)i=i<<8|b[e+g];if(o[i]===I&&(o[i]=[]),j=o[i],!(0<r--)){for(;0<j.length&&32768<e-j[0];)j.shift();if(e+3>=f){for(l&&c(l,-1),g=0,h=f-e;h>g;++g)n=b[e+g],p[q++]=n,++s[n];break}0<j.length?(k=m(b,e,j),l?l.length<k.length?(n=b[e-1],p[q++]=n,++s[n],c(k,0)):c(l,-1):k.length<u?l=k:c(k,0)):l?c(l,-1):(n=b[e],p[q++]=n,++s[n])}j.push(e)}return p[q++]=256,s[256]++,a.U=s,a.T=t,K?p.subarray(0,q):p}function m(a,b,c){var d,e,f,g,h,i,j=0,l=a.length;g=0,i=c.length;a:for(;i>g;g++){if(d=c[i-g-1],f=3,j>3){for(h=j;h>3;h--)if(a[d+h-1]!==a[b+h-1])continue a;f=j}for(;258>f&&l>b+f&&a[d+f]===a[b+f];)++f;if(f>j&&(e=d,j=f),258===f)break}return new k(j,b-e)}function n(a,b){var c,d,e,f,g,i=a.length,j=new h(572),k=new(K?Uint8Array:Array)(i);if(!K)for(f=0;i>f;f++)k[f]=0;for(f=0;i>f;++f)0<a[f]&&j.push(f,a[f]);if(c=Array(j.length/2),d=new(K?Uint32Array:Array)(j.length/2),1===c.length)return k[j.pop().index]=1,k;for(f=0,g=j.length/2;g>f;++f)c[f]=j.pop(),d[f]=c[f].value;for(e=o(d,d.length,b),f=0,g=c.length;g>f;++f)k[c[f].index]=e[f];return k}function o(a,b,c){function d(a){var c=n[a][o[a]];c===b?(d(a+1),d(a+1)):--l[c],++o[a]}var e,f,g,h,i,j=new(K?Uint16Array:Array)(c),k=new(K?Uint8Array:Array)(c),l=new(K?Uint8Array:Array)(b),m=Array(c),n=Array(c),o=Array(c),p=(1<<c)-b,q=1<<c-1;for(j[c-1]=b,f=0;c>f;++f)q>p?k[f]=0:(k[f]=1,p-=q),p<<=1,j[c-2-f]=(j[c-1-f]/2|0)+b;for(j[0]=k[0],m[0]=Array(j[0]),n[0]=Array(j[0]),f=1;c>f;++f)j[f]>2*j[f-1]+k[f]&&(j[f]=2*j[f-1]+k[f]),m[f]=Array(j[f]),n[f]=Array(j[f]);for(e=0;b>e;++e)l[e]=c;for(g=0;g<j[c-1];++g)m[c-1][g]=a[g],n[c-1][g]=g;for(e=0;c>e;++e)o[e]=0;for(1===k[c-1]&&(--l[0],++o[c-1]),f=c-2;f>=0;--f){for(h=e=0,i=o[f+1],g=0;g<j[f];g++)h=m[f+1][i]+m[f+1][i+1],h>a[e]?(m[f][g]=h,n[f][g]=b,i+=2):(m[f][g]=a[e],n[f][g]=e,++e);o[f]=0,1===k[f]&&d(f)}return l}function p(a){var b,c,d,e,f=new(K?Uint16Array:Array)(a.length),g=[],h=[],i=0;for(b=0,c=a.length;c>b;b++)g[a[b]]=(0|g[a[b]])+1;for(b=1,c=16;c>=b;b++)h[b]=i,i+=0|g[b],i<<=1;for(b=0,c=a.length;c>b;b++)for(i=h[a[b]],h[a[b]]+=1,d=f[b]=0,e=a[b];e>d;d++)f[b]=f[b]<<1|1&i,i>>>=1;return f}function q(a,b){this.input=a,this.b=this.c=0,this.g={},b&&(b.flags&&(this.g=b.flags),"string"==typeof b.filename&&(this.filename=b.filename),"string"==typeof b.comment&&(this.w=b.comment),b.deflateOptions&&(this.l=b.deflateOptions)),this.l||(this.l={})}function r(a,b){switch(this.o=[],this.p=32768,this.e=this.j=this.c=this.s=0,this.input=K?new Uint8Array(a):a,this.u=!1,this.q=cb,this.K=!1,(b||!(b={}))&&(b.index&&(this.c=b.index),b.bufferSize&&(this.p=b.bufferSize),b.bufferType&&(this.q=b.bufferType),b.resize&&(this.K=b.resize)),this.q){case bb:this.b=32768,this.a=new(K?Uint8Array:Array)(32768+this.p+258);break;case cb:this.b=0,this.a=new(K?Uint8Array:Array)(this.p),this.f=this.S,this.z=this.O,this.r=this.Q;break;default:d(Error("invalid inflate mode"))}}function s(a,b){for(var c,e=a.j,f=a.e,g=a.input,h=a.c;b>f;)c=g[h++],c===I&&d(Error("input buffer is broken")),e|=c<<f,f+=8;return c=e&(1<<b)-1,a.j=e>>>b,a.e=f-b,a.c=h,c}function t(a,b){for(var c,d,e,f=a.j,g=a.e,h=a.input,i=a.c,j=b[0],k=b[1];k>g&&(c=h[i++],c!==I);)f|=c<<g,g+=8;return d=j[f&(1<<k)-1],e=d>>>16,a.j=f>>e,a.e=g-e,a.c=i,65535&d}function u(a){function b(a,b,c){var d,e,f,g;for(g=0;a>g;)switch(d=t(this,b)){case 16:for(f=3+s(this,2);f--;)c[g++]=e;break;case 17:for(f=3+s(this,3);f--;)c[g++]=0;e=0;break;case 18:for(f=11+s(this,7);f--;)c[g++]=0;e=0;break;default:e=c[g++]=d}return c}var c,d,e,f,g=s(a,5)+257,h=s(a,5)+1,j=s(a,4)+4,k=new(K?Uint8Array:Array)(gb.length);for(f=0;j>f;++f)k[gb[f]]=s(a,3);c=i(k),d=new(K?Uint8Array:Array)(g),e=new(K?Uint8Array:Array)(h),a.r(i(b.call(a,g,c,d)),i(b.call(a,h,c,e)))}function v(a){this.input=a,this.c=0,this.G=[],this.R=!1}function w(a){if("string"==typeof a){var b,c,d=a.split("");for(b=0,c=d.length;c>b;b++)d[b]=(255&d[b].charCodeAt(0))>>>0;a=d}for(var e,f=1,g=0,h=a.length,i=0;h>0;){e=h>1024?1024:h,h-=e;do f+=a[i++],g+=f;while(--e);f%=65521,g%=65521}return(g<<16|f)>>>0}function x(a,b){var c,e;switch(this.input=a,this.c=0,(b||!(b={}))&&(b.index&&(this.c=b.index),b.verify&&(this.V=b.verify)),c=a[this.c++],e=a[this.c++],15&c){case vb:this.method=vb;break;default:d(Error("unsupported compression method"))}0!==((c<<8)+e)%31&&d(Error("invalid fcheck flag:"+((c<<8)+e)%31)),32&e&&d(Error("fdict flag is not supported")),this.J=new r(a,{index:this.c,bufferSize:b.bufferSize,bufferType:b.bufferType,resize:b.resize})}function y(a,b){this.input=a,this.a=new(K?Uint8Array:Array)(32768),this.k=wb.t;var c,d={};!b&&(b={})||"number"!=typeof b.compressionType||(this.k=b.compressionType);for(c in b)d[c]=b[c];d.outputBuffer=this.a,this.I=new j(this.input,d)}function z(b,c,d){a.nextTick(function(){var a,e;try{e=A(b,d)}catch(f){a=f}c(a,e)})}function A(a,b){var c;return c=new y(a).h(),b||(b={}),b.H?c:H(c)}function B(b,c,d){a.nextTick(function(){var a,e;try{e=C(b,d)}catch(f){a=f}c(a,e)})}function C(a,b){var c;return a.subarray=a.slice,c=new x(a).i(),b||(b={}),b.noBuffer?c:H(c)}function D(b,c,d){a.nextTick(function(){var a,e;try{e=E(b,d)}catch(f){a=f}c(a,e)})}function E(a,b){var c;return a.subarray=a.slice,c=new q(a).h(),b||(b={}),b.H?c:H(c)}function F(b,c,d){a.nextTick(function(){var a,e;try{e=G(b,d)}catch(f){a=f}c(a,e)})}function G(a,b){var c;return a.subarray=a.slice,c=new v(a).i(),b||(b={}),b.H?c:H(c)}function H(a){var c,d,e=new b(a.length);for(c=0,d=a.length;d>c;++c)e[c]=a[c];return e}var I=void 0,J=!0,K="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;e.prototype.f=function(){var a,b=this.buffer,c=b.length,d=new(K?Uint8Array:Array)(c<<1);if(K)d.set(b);else for(a=0;c>a;++a)d[a]=b[a];return this.buffer=d},e.prototype.d=function(a,b,c){var d,e=this.buffer,f=this.index,g=this.m,h=e[f];if(c&&b>1&&(a=b>8?(Q[255&a]<<24|Q[a>>>8&255]<<16|Q[a>>>16&255]<<8|Q[a>>>24&255])>>32-b:Q[a]>>8-b),8>b+g)h=h<<b|a,g+=b;else for(d=0;b>d;++d)h=h<<1|a>>b-d-1&1,8===++g&&(g=0,e[f++]=Q[h],h=0,f===e.length&&(e=this.f()));e[f]=h,this.buffer=e,this.m=g,this.index=f},e.prototype.finish=function(){var a,b=this.buffer,c=this.index;return 0<this.m&&(b[c]<<=8-this.m,b[c]=Q[b[c]],c++),K?a=b.subarray(0,c):(b.length=c,a=b),a};var L,M=new(K?Uint8Array:Array)(256);for(L=0;256>L;++L){for(var N=L,O=N,P=7,N=N>>>1;N;N>>>=1)O<<=1,O|=1&N,--P;M[L]=(O<<P&255)>>>0}var Q=M,R=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],S=K?new Uint32Array(R):R;h.prototype.getParent=function(a){return 2*((a-2)/4|0)},h.prototype.push=function(a,b){var c,d,e,f=this.buffer;for(c=this.length,f[this.length++]=b,f[this.length++]=a;c>0&&(d=this.getParent(c),f[c]>f[d]);)e=f[c],f[c]=f[d],f[d]=e,e=f[c+1],f[c+1]=f[d+1],f[d+1]=e,c=d;return this.length},h.prototype.pop=function(){var a,b,c,d,e,f=this.buffer;for(b=f[0],a=f[1],this.length-=2,f[0]=f[this.length],f[1]=f[this.length+1],e=0;(d=2*e+2,!(d>=this.length))&&(d+2<this.length&&f[d+2]>f[d]&&(d+=2),f[d]>f[e]);)c=f[e],f[e]=f[d],f[d]=c,c=f[e+1],f[e+1]=f[d+1],f[d+1]=c,e=d;return{index:a,value:b,length:this.length}};var T,U=2,V={NONE:0,L:1,t:U,X:3},W=[];for(T=0;288>T;T++)switch(J){case 143>=T:W.push([T+48,8]);break;case 255>=T:W.push([T-144+400,9]);break;case 279>=T:W.push([T-256+0,7]);break;case 287>=T:W.push([T-280+192,8]);break;default:d("invalid literal: "+T)}j.prototype.h=function(){var a,b,c,f,g=this.input;switch(this.k){case 0:for(c=0,f=g.length;f>c;){b=K?g.subarray(c,c+65535):g.slice(c,c+65535),c+=b.length;var h=b,i=c===f,j=I,k=I,m=I,o=I,q=I,r=this.a,s=this.b;if(K){for(r=new Uint8Array(this.a.buffer);r.length<=s+h.length+5;)r=new Uint8Array(r.length<<1);r.set(this.a)}if(j=i?1:0,r[s++]=0|j,k=h.length,m=~k+65536&65535,r[s++]=255&k,r[s++]=k>>>8&255,r[s++]=255&m,r[s++]=m>>>8&255,K)r.set(h,s),s+=h.length,r=r.subarray(0,s);else{for(o=0,q=h.length;q>o;++o)r[s++]=h[o];r.length=s}this.b=s,this.a=r}break;case 1:var t=new e(K?new Uint8Array(this.a.buffer):this.a,this.b);t.d(1,1,J),t.d(1,2,J);var u,v,w,x=l(this,g);for(u=0,v=x.length;v>u;u++)if(w=x[u],e.prototype.d.apply(t,W[w]),w>256)t.d(x[++u],x[++u],J),t.d(x[++u],5),t.d(x[++u],x[++u],J);else if(256===w)break;this.a=t.finish(),this.b=this.a.length;break;case U:var y,z,A,B,C,D,E,F,G,H,L,M,N,O,P,Q=new e(K?new Uint8Array(this.a.buffer):this.a,this.b),R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S=Array(19);for(y=U,Q.d(1,1,J),Q.d(y,2,J),z=l(this,g),D=n(this.U,15),E=p(D),F=n(this.T,7),G=p(F),A=286;A>257&&0===D[A-1];A--);for(B=30;B>1&&0===F[B-1];B--);var T,V,X,Y,Z,$,_=A,ab=B,bb=new(K?Uint32Array:Array)(_+ab),cb=new(K?Uint32Array:Array)(316),db=new(K?Uint8Array:Array)(19);for(T=V=0;_>T;T++)bb[V++]=D[T];for(T=0;ab>T;T++)bb[V++]=F[T];if(!K)for(T=0,Y=db.length;Y>T;++T)db[T]=0;for(T=Z=0,Y=bb.length;Y>T;T+=V){for(V=1;Y>T+V&&bb[T+V]===bb[T];++V);if(X=V,0===bb[T])if(3>X)for(;0<X--;)cb[Z++]=0,db[0]++;else for(;X>0;)$=138>X?X:138,$>X-3&&X>$&&($=X-3),10>=$?(cb[Z++]=17,cb[Z++]=$-3,db[17]++):(cb[Z++]=18,cb[Z++]=$-11,db[18]++),X-=$;else if(cb[Z++]=bb[T],db[bb[T]]++,X--,3>X)for(;0<X--;)cb[Z++]=bb[T],db[bb[T]]++;else for(;X>0;)$=6>X?X:6,$>X-3&&X>$&&($=X-3),cb[Z++]=16,cb[Z++]=$-3,db[16]++,X-=$}for(a=K?cb.subarray(0,Z):cb.slice(0,Z),H=n(db,7),O=0;19>O;O++)S[O]=H[R[O]];for(C=19;C>4&&0===S[C-1];C--);for(L=p(H),Q.d(A-257,5,J),Q.d(B-1,5,J),Q.d(C-4,4,J),O=0;C>O;O++)Q.d(S[O],3,J);for(O=0,P=a.length;P>O;O++)if(M=a[O],Q.d(L[M],H[M],J),M>=16){switch(O++,M){case 16:N=2;break;case 17:N=3;break;case 18:N=7;break;default:d("invalid code: "+M)}Q.d(a[O],N,J)}var eb,fb,gb,hb,ib,jb,kb,lb,mb=[E,D],nb=[G,F];for(ib=mb[0],jb=mb[1],kb=nb[0],lb=nb[1],eb=0,fb=z.length;fb>eb;++eb)if(gb=z[eb],Q.d(ib[gb],jb[gb],J),gb>256)Q.d(z[++eb],z[++eb],J),hb=z[++eb],Q.d(kb[hb],lb[hb],J),Q.d(z[++eb],z[++eb],J);else if(256===gb)break;this.a=Q.finish(),this.b=this.a.length;break;default:d("invalid compression type")}return this.a};var X=function(){function a(a){switch(J){case 3===a:return[257,a-3,0];case 4===a:return[258,a-4,0];case 5===a:return[259,a-5,0];case 6===a:return[260,a-6,0];case 7===a:return[261,a-7,0];case 8===a:return[262,a-8,0];case 9===a:return[263,a-9,0];case 10===a:return[264,a-10,0];case 12>=a:return[265,a-11,1];case 14>=a:return[266,a-13,1];case 16>=a:return[267,a-15,1];case 18>=a:return[268,a-17,1];case 22>=a:return[269,a-19,2];case 26>=a:return[270,a-23,2];case 30>=a:return[271,a-27,2];case 34>=a:return[272,a-31,2];case 42>=a:return[273,a-35,3];case 50>=a:return[274,a-43,3];case 58>=a:return[275,a-51,3];case 66>=a:return[276,a-59,3];case 82>=a:return[277,a-67,4];case 98>=a:return[278,a-83,4];case 114>=a:return[279,a-99,4];case 130>=a:return[280,a-115,4];case 162>=a:return[281,a-131,5];case 194>=a:return[282,a-163,5];case 226>=a:return[283,a-195,5];case 257>=a:return[284,a-227,5];case 258===a:return[285,a-258,0];default:d("invalid length: "+a)}}var b,c,e=[];for(b=3;258>=b;b++)c=a(b),e[b]=c[2]<<24|c[1]<<16|c[0];return e}(),Y=K?new Uint32Array(X):X;q.prototype.h=function(){var a,b,c,d,e,g,h,i,k=new(K?Uint8Array:Array)(32768),l=0,m=this.input,n=this.c,o=this.filename,p=this.w;if(k[l++]=31,k[l++]=139,k[l++]=8,a=0,this.g.fname&&(a|=_),this.g.fcomment&&(a|=ab),this.g.fhcrc&&(a|=$),k[l++]=a,b=(Date.now?Date.now():+new Date)/1e3|0,k[l++]=255&b,k[l++]=b>>>8&255,k[l++]=b>>>16&255,k[l++]=b>>>24&255,k[l++]=0,k[l++]=Z,this.g.fname!==I){for(h=0,i=o.length;i>h;++h)g=o.charCodeAt(h),g>255&&(k[l++]=g>>>8&255),k[l++]=255&g;k[l++]=0}if(this.g.comment){for(h=0,i=p.length;i>h;++h)g=p.charCodeAt(h),g>255&&(k[l++]=g>>>8&255),k[l++]=255&g;k[l++]=0}return this.g.fhcrc&&(c=65535&f(k,0,l),k[l++]=255&c,k[l++]=c>>>8&255),this.l.outputBuffer=k,this.l.outputIndex=l,e=new j(m,this.l),k=e.h(),l=e.b,K&&(l+8>k.buffer.byteLength?(this.a=new Uint8Array(l+8),this.a.set(new Uint8Array(k.buffer)),k=this.a):k=new Uint8Array(k.buffer)),d=f(m,I,I),k[l++]=255&d,k[l++]=d>>>8&255,k[l++]=d>>>16&255,k[l++]=d>>>24&255,i=m.length,k[l++]=255&i,k[l++]=i>>>8&255,k[l++]=i>>>16&255,k[l++]=i>>>24&255,this.c=n,K&&l<k.length&&(this.a=k=k.subarray(0,l)),k};var Z=255,$=2,_=8,ab=16,bb=0,cb=1;r.prototype.i=function(){for(;!this.u;){var a=s(this,3);switch(1&a&&(this.u=J),a>>>=1){case 0:var b=this.input,c=this.c,e=this.a,f=this.b,g=I,h=I,i=I,j=e.length,k=I;switch(this.e=this.j=0,g=b[c++],g===I&&d(Error("invalid uncompressed block header: LEN (first byte)")),h=g,g=b[c++],g===I&&d(Error("invalid uncompressed block header: LEN (second byte)")),h|=g<<8,g=b[c++],g===I&&d(Error("invalid uncompressed block header: NLEN (first byte)")),i=g,g=b[c++],g===I&&d(Error("invalid uncompressed block header: NLEN (second byte)")),i|=g<<8,h===~i&&d(Error("invalid uncompressed block header: length verify")),c+h>b.length&&d(Error("input buffer is broken")),this.q){case bb:for(;f+h>e.length;){if(k=j-f,h-=k,K)e.set(b.subarray(c,c+k),f),f+=k,c+=k;else for(;k--;)e[f++]=b[c++];this.b=f,e=this.f(),f=this.b}break;case cb:for(;f+h>e.length;)e=this.f({B:2});break;default:d(Error("invalid inflate mode"))}if(K)e.set(b.subarray(c,c+h),f),f+=h,c+=h;else for(;h--;)e[f++]=b[c++];this.c=c,this.b=f,this.a=e;break;case 1:this.r(sb,ub);break;case 2:u(this);break;default:d(Error("unknown BTYPE: "+a))}}return this.z()};var db,eb,fb=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],gb=K?new Uint16Array(fb):fb,hb=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],ib=K?new Uint16Array(hb):hb,jb=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],kb=K?new Uint8Array(jb):jb,lb=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],mb=K?new Uint16Array(lb):lb,nb=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ob=K?new Uint8Array(nb):nb,pb=new(K?Uint8Array:Array)(288);for(db=0,eb=pb.length;eb>db;++db)pb[db]=143>=db?8:255>=db?9:279>=db?7:8;var qb,rb,sb=i(pb),tb=new(K?Uint8Array:Array)(30);for(qb=0,rb=tb.length;rb>qb;++qb)tb[qb]=5;var ub=i(tb);r.prototype.r=function(a,b){var c=this.a,d=this.b;this.A=a;for(var e,f,g,h,i=c.length-258;256!==(e=t(this,a));)if(256>e)d>=i&&(this.b=d,c=this.f(),d=this.b),c[d++]=e;else for(f=e-257,h=ib[f],0<kb[f]&&(h+=s(this,kb[f])),e=t(this,b),g=mb[e],0<ob[e]&&(g+=s(this,ob[e])),d>=i&&(this.b=d,c=this.f(),d=this.b);h--;)c[d]=c[d++-g];for(;8<=this.e;)this.e-=8,this.c--;this.b=d},r.prototype.Q=function(a,b){var c=this.a,d=this.b;this.A=a;for(var e,f,g,h,i=c.length;256!==(e=t(this,a));)if(256>e)d>=i&&(c=this.f(),i=c.length),c[d++]=e;else for(f=e-257,h=ib[f],0<kb[f]&&(h+=s(this,kb[f])),e=t(this,b),g=mb[e],0<ob[e]&&(g+=s(this,ob[e])),d+h>i&&(c=this.f(),i=c.length);h--;)c[d]=c[d++-g];for(;8<=this.e;)this.e-=8,this.c--;this.b=d},r.prototype.f=function(){var a,b,c=new(K?Uint8Array:Array)(this.b-32768),d=this.b-32768,e=this.a;if(K)c.set(e.subarray(32768,c.length));else for(a=0,b=c.length;b>a;++a)c[a]=e[a+32768];if(this.o.push(c),this.s+=c.length,K)e.set(e.subarray(d,d+32768));else for(a=0;32768>a;++a)e[a]=e[d+a];return this.b=32768,e},r.prototype.S=function(a){var b,c,d,e,f=this.input.length/this.c+1|0,g=this.input,h=this.a;return a&&("number"==typeof a.B&&(f=a.B),"number"==typeof a.M&&(f+=a.M)),2>f?(c=(g.length-this.c)/this.A[2],e=258*(c/2)|0,d=e<h.length?h.length+e:h.length<<1):d=h.length*f,K?(b=new Uint8Array(d),b.set(h)):b=h,this.a=b},r.prototype.z=function(){var a,b,c,d,e,f=0,g=this.a,h=this.o,i=new(K?Uint8Array:Array)(this.s+(this.b-32768));if(0===h.length)return K?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(b=0,c=h.length;c>b;++b)for(a=h[b],d=0,e=a.length;e>d;++d)i[f++]=a[d];for(b=32768,c=this.b;c>b;++b)i[f++]=g[b];return this.o=[],this.buffer=i},r.prototype.O=function(){var a,b=this.b;return K?this.K?(a=new Uint8Array(b),a.set(this.a.subarray(0,b))):a=this.a.subarray(0,b):(this.a.length>b&&(this.a.length=b),a=this.a),this.buffer=a},v.prototype.i=function(){for(var a=this.input.length;this.c<a;){var b=new g,c=I,e=I,h=I,i=I,j=I,k=I,l=I,m=I,n=I,o=this.input,p=this.c;switch(b.C=o[p++],b.D=o[p++],(31!==b.C||139!==b.D)&&d(Error("invalid file signature:"+b.C+","+b.D)),b.v=o[p++],b.v){case 8:break;default:d(Error("unknown compression method: "+b.v))}if(b.n=o[p++],m=o[p++]|o[p++]<<8|o[p++]<<16|o[p++]<<24,b.$=new Date(1e3*m),b.ba=o[p++],b.aa=o[p++],0<(4&b.n)&&(b.W=o[p++]|o[p++]<<8,p+=b.W),0<(b.n&_)){for(l=[],k=0;0<(j=o[p++]);)l[k++]=String.fromCharCode(j);b.name=l.join("")}if(0<(b.n&ab)){for(l=[],k=0;0<(j=o[p++]);)l[k++]=String.fromCharCode(j);b.w=l.join("")}0<(b.n&$)&&(b.P=65535&f(o,0,p),b.P!==(o[p++]|o[p++]<<8)&&d(Error("invalid header crc16"))),c=o[o.length-4]|o[o.length-3]<<8|o[o.length-2]<<16|o[o.length-1]<<24,o.length-p-4-4<512*c&&(i=c),e=new r(o,{index:p,bufferSize:i}),b.data=h=e.i(),p=e.c,b.Y=n=(o[p++]|o[p++]<<8|o[p++]<<16|o[p++]<<24)>>>0,f(h,I,I)!==n&&d(Error("invalid CRC-32 checksum: 0x"+f(h,I,I).toString(16)+" / 0x"+n.toString(16))),b.Z=c=(o[p++]|o[p++]<<8|o[p++]<<16|o[p++]<<24)>>>0,(4294967295&h.length)!==c&&d(Error("invalid input size: "+(4294967295&h.length)+" / "+c)),this.G.push(b),this.c=p}this.R=J;var q,s,t,u=this.G,v=0,w=0;for(q=0,s=u.length;s>q;++q)w+=u[q].data.length;if(K)for(t=new Uint8Array(w),q=0;s>q;++q)t.set(u[q].data,v),v+=u[q].data.length;else{for(t=[],q=0;s>q;++q)t[q]=u[q].data;t=Array.prototype.concat.apply([],t)}return t},x.prototype.i=function(){var a,b,c=this.input;return a=this.J.i(),this.c=this.J.c,this.V&&(b=(c[this.c++]<<24|c[this.c++]<<16|c[this.c++]<<8|c[this.c++])>>>0,b!==w(a)&&d(Error("invalid adler-32 checksum"))),a};var vb=8,wb=V;y.prototype.h=function(){var a,b,c,e,f,g,h,i=0;switch(h=this.a,a=vb){case vb:b=Math.LOG2E*Math.log(32768)-8;break;default:d(Error("invalid compression method"))}switch(c=b<<4|a,h[i++]=c,a){case vb:switch(this.k){case wb.NONE:f=0;break;case wb.L:f=1;break;case wb.t:f=2;break;default:d(Error("unsupported compression type"))}break;default:d(Error("invalid compression method"))}return e=f<<6|0,h[i++]=e|31-(256*c+e)%31,g=w(this.input),this.I.b=i,h=this.I.h(),i=h.length,K&&(h=new Uint8Array(h.buffer),h.length<=i+4&&(this.a=new Uint8Array(h.length+4),this.a.set(h),h=this.a),h=h.subarray(0,i+4)),h[i++]=g>>24&255,h[i++]=g>>16&255,h[i++]=g>>8&255,h[i++]=255&g,h},c.deflate=z,c.deflateSync=A,c.inflate=B,c.inflateSync=C,c.gzip=D,c.gzipSync=E,c.gunzip=F,c.gunzipSync=G}).call(this)}).call(this,a("C:\\Users\\jakec.NEXUSOS\\Documents\\GitHub\\jQuest\\bower_components\\grapefruit\\node_modules\\grunt-browserify\\node_modules\\browserify\\node_modules\\insert-module-globals\\node_modules\\process\\browser.js"),a("buffer").Buffer)},{"C:\\Users\\jakec.NEXUSOS\\Documents\\GitHub\\jQuest\\bower_components\\grapefruit\\node_modules\\grunt-browserify\\node_modules\\browserify\\node_modules\\insert-module-globals\\node_modules\\process\\browser.js":5,buffer:2}],8:[function(a,b){var c=a("./AudioPlayer"),d=a("../utils/inherit"),e=a("../utils/support"),f=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,g=e.webAudio?new f:null,h=function(a,b){this.game=a,this.parent=b,this._muted=!1,this._volume=1,this.ctx=g,this.canPlay=e.webAudio||e.htmlAudio,e.webAudio&&(this.masterGain=this.ctx.createGain?this.ctx.createGain():this.ctx.createGainNode(),this.masterGain.gain.value=1,this.setParent(b)),this.sounds={}};d(h,Object,{mute:function(){return this.setMuted(!0)},unmute:function(){return this.setMuted(!1)},setMuted:function(a){this._muted=a=!!a,e.webAudio&&(this.masterGain.gain.value=a?0:this._volume);for(var b in this.sounds)if(this.sounds.hasOwnProperty(b)&&this.sounds[b]._webAudio===!1)for(var c=this.sounds[b],d=0,f=c._nodes.length;f>d;++d)c._nodes[d].mute();
return this},setParent:function(a){return this.parent=a,e.webAudio&&this.masterGain.connect(a&&a.masterGain?a.masterGain:this.ctx.destination),this},attach:function(a){if(a._manager!==this&&(a._manager&&a._manager.detach(a),this.sounds[a.key]=a,a._manager=this,e.webAudio))for(var b=0;b<a._nodes.length;++b)a._nodes[b].connect(this.masterGain);return a},detach:function(a){if(a._manager!==this&&(delete this.sounds[a.key],a._manager=null,e.webAudio))for(var b=0;b<a._nodes.length;++b)a._nodes[b].disconnect();return a},add:function(a,b){if(!this.canPlay)return!1;var d=this.game.cache.getAudio(a);return d.player||(d.player=new c(this,d,b)),this.sounds[a]=d.player},remove:function(a){var b=this.sounds[a];return b&&b.stop(),delete this.sounds[a],b?b:!1}}),Object.defineProperty(h.prototype,"volume",{get:function(){return this._volume},set:function(a){if(a=parseFloat(a,10),!isNaN(a)&&a>=0&&1>=a){this._volume=a,e.webAudio&&(this.masterGain.gain.value=a);for(var b in this.sounds)if(this.sounds.hasOwnProperty(b)&&this.sounds[b]._webAudio===!1)for(var c=this.sounds[b],d=0,f=c._nodes.length;f>d;++d)c._nodes[d].volume=c._volume*this._volume}}}),b.exports=h},{"../utils/inherit":69,"../utils/support":70,"./AudioPlayer":9}],9:[function(a,b){var c=a("./AudioPlayer"),d=a("../utils/EventEmitter"),e=a("../utils/utils"),f=a("../utils/inherit"),g=a("../utils/support"),c=function(a,b,c){d.call(this),this.src="",this.game=a.game,this.key=b.key,this.autoplay=!1,this.format=null,this.loop=!1,this.pos3d=[0,0,-.5],this.sprite={},this._file=b,this._volume=1,this._duration=0,this._loaded=!1,this._manager=a,this._webAudio=g.webAudio,this._nodes=[],this._onendTimer=[],e.setValues(this,c),this._webAudio&&this._setupAudioNode(),this._load()};f(c,Object,{_load:function(){var a=this,b=this._file;if(b.webAudio)b.decoded?this._loadSoundBuffer(b.data):this._manager.ctx.decodeAudioData(b.data,function(c){c&&(b.data=c,b.decoded=!0,a._loadSoundBuffer(c))});else{var c=b.data.cloneNode();this._nodes.push(c),c._pos=0,c.volume=this._manager.muted?0:this._volume*this._manager.volume,this._duration=c.duration,this.sprite._default=[0,1e3*c.duration],this._loaded||(this._loaded=!0,this.emit("ready",this.src)),this.autoplay&&this.play()}return this},play:function(a,b){var c=this;return"function"==typeof a&&(b=a,a=null),a||(a="_default"),this._loaded?this.sprite[a]?(this._inactiveNode(function(d){var e,f=d._pos>0?d._pos:c.sprite[a][0]/1e3,g=c.sprite[a][1]/1e3-d._pos,h=c.loop||c.sprite[a][2],i="string"==typeof b?b:Math.round(Date.now()*Math.random())+"";if(d._sprite=a,function(a){e=setTimeout(function(){!c._webAudio&&a.loop&&c.stop(a.id,a.timer).play(a.sprite,a.id),c._webAudio&&!a.loop&&(c._nodeById(a.id).paused=!0),c._webAudio||a.loop||c.stop(a.id,a.timer),c.emit("end",a.id)},1e3*g),c._onendTimer.push(e),a.timer=e}({id:i,sprite:a,loop:h}),c._webAudio)d.id=i,d.paused=!1,c._refreshBuffer([h,f,g],i),c._playStart=c._manager.ctx.currentTime,d.gain.value=c._volume,"undefined"==typeof d.bufferSource.start?d.bufferSource.noteGrainOn(0,f,g):d.bufferSource.start(0,f,g);else{if(4!==d.readyState)return c._clearEndTimer(e),function(){var e=c,f=a,g=b,h=d,i=function(){e.play(f,g),h.removeEventListener("canplaythrough",i,!1)};h.addEventListener("canplaythrough",i,!1)}(),c;d.id=i,d.currentTime=f,d.muted=c._manager.muted,d.volume=c._volume*c._manager.volume,d.play()}c.emit("play",i),"function"==typeof b&&b(i)}),this):("function"==typeof b&&b(),this):(this.on("ready",function(){c.play(a,b)}),this)},pause:function(a,b){var c=this;if(!this._loaded)return this.on("play",function(){c.play(a,b)}),this;this._clearEndTimer(b||0);var d=a?this._nodeById(a):this._activeNode();if(d)if(this._webAudio){if(!d.bufferSource)return this;d.paused=!0,d._pos+=this._manager.ctx.currentTime-this._playStart,"undefined"==typeof d.bufferSource.stop?d.bufferSource.noteOff(0):d.bufferSource.stop(0)}else d._pos=d.currentTime,d.pause();return this.emit("pause",d?d.id:a),this},stop:function(a,b){var c=this;if(!this._loaded)return this.on("play",function(){c.stop(a,b)}),this;this._clearEndTimer(b||0);var d=a?this._nodeById(a):this._activeNode();if(d)if(d._pos=0,this._webAudio){if(!d.bufferSource)return this;d.paused=!0,"undefined"==typeof d.bufferSource.stop?d.bufferSource.noteOff(0):d.bufferSource.stop(0)}else d.pause(),d.currentTime=0;return this},mute:function(a){return this.setMuted(!0,a)},unmute:function(a){return this.setMuted(!1,a)},setMuted:function(a,b){var c=this;if(!this._loaded)return this.on("play",function(){c.setMuted(a,b)}),this;var d=b?this._nodeById(b):this._activeNode();return d&&(this._webAudio?d.gain.value=a?0:this._volume:d.volume=a?0:this._volume),this},seek:function(a,b){var c=this;if(!this._loaded)return this.on("ready",function(){c.seek(a,b)}),this;(!a||0>a)&&(a=0);var d=b?this._nodeById(b):this._activeNode();return d&&(this._webAudio?(d._pos=a,this.pause(d.id).play(d._sprite,b)):d.currentTime=a),this},getPosition:function(a){var b=this;if(!this._loaded)return this.on("ready",function(){b.getPosition(a)}),this;var c=a?this._nodeById(a):this._activeNode();return c?this._webAudio?c._pos+(this._manager.ctx.currentTime-this._playStart):c.currentTime:0},fade:function(a,b,c,d,e){var f=this,g=Math.abs(a-b),h=a>b?"dowm":"up",i=g/.01,j=c/i;if("function"==typeof d&&(e=d,d=null),!this._loaded)return this.on("ready",function(){f.fade(a,b,c,d,e)}),this;this.setVolume(a,d);for(var k=1;i>=k;++k){var l=this._volume+("up"===h?.01:-.01)*k,m=Math.round(1e3*l)/1e3,n=j*k;this._doFadeStep(m,n,b,d,e)}},getVolume:function(){return this._volume},setVolume:function(a,b){var c=this;if(a=parseFloat(a),!this._loaded)return this.on("play",function(){c.setVolume(a,b)}),this;if(a>=0&&1>=a){this._volume=a;var d=b?this._nodeById(b):this._activeNode();d&&(this._webAudio?d.gain.volume=a:d.volume=a*this._manager.volume)}return this},setPosition:function(a,b,c,d){var e=this;if(a=a?a:0,b=b?b:0,c=c||0===c?c:-.5,!this._loaded)return this.on("play",function(){e.setPosition(a,b,c,d)}),this;if(this._webAudio){var f=d?this._nodeById(d):this._activeNode();f&&(this.pos3d[0]=a,this.pos3d[1]=b,this.pos3d[2]=c,f.panner.setPosition(a,b,c))}return this},_doFadeStep:function(a,b,c,d,e){var f=this;setTimeout(function(){f.setVolume(a,d),a===c&&"function"==typeof e&&e()},b)},_nodeById:function(a){for(var b=this._nodes[0],c=0,d=this._nodes.length;d>c;++c)if(this._nodes[c].id===a){b=this._nodes[c];break}return b},_activeNode:function(){for(var a,b=0,c=this._nodes.length;c>b;++b)if(!this._nodes[b].paused){a=this._nodes[b];break}return this._drainPool(),a},_inactiveNode:function(a){for(var b,c=0,d=this._nodes.length;d>c;++c)if(this._nodes[c].paused&&4===this._nodes[c].readyState){a(b=this._nodes[c]);break}this._drainPool(),b||(this._webAudio?(b=this._setupAudioNode(),a(b)):(this._load(),b=this._nodes[this.nodes.length-1],b.addEventListener("loadedmetadata",function(){a(b)})))},_drainPool:function(){var a=0,b=0,c=0;for(b=0,c=this._nodes.length;c>b;++b)this._nodes[b].paused&&a++;for(b=this._nodes.length-1;b>=0&&!(5>=a);--b)this._nodes[b].paused&&(a--,this._nodes.splice(b,1))},_clearEndTimer:function(a){var b=this._onendTimer.indexOf(a);b=b>=0?b:0,this._onendTimer[b]&&(clearTimeout(this._onendTimer[b]),this._onendTimer.splice(b,1))},_setupAudioNode:function(){var a=this._manager.ctx.createGain?this._manager.ctx.createGain():this._manager.ctx.createGainNode();return this._nodes.push(a),a.gain.value=this._volume,a.paused=!0,a._pos=0,a.readyState=4,a.connect(this._manager.masterGain),a.panner=this._manager.ctx.createPanner(),a.panner.setPosition(this.pos3d[0],this.pos3d[1],this.pos3d[2]),a.panner.connect(a),a},_loadSoundBuffer:function(a){this._duration=a?a.duration:this._duration,this.sprite._default=[0,1e3*this._duration],this._loaded||(this._loaded=!0,this.emit("ready",this.src)),this.autoplay&&this.play()},_refreshBuffer:function(a,b){var c=this._nodeById(b);c.bufferSource=this._manager.ctx.createBufferSource(),c.bufferSource.buffer=this._file.data,c.bufferSource.connect(c.panner),c.bufferSource.loop=a[0],a[0]&&(c.bufferSource.loopStart=a[1],c.bufferSource.loopEnd=a[1]+a[2])}}),Object.defineProperty(c.prototype,"volume",{get:c.prototype.getVolume,set:c.prototype.setVolume}),b.exports=c},{"../utils/EventEmitter":64,"../utils/inherit":69,"../utils/support":70,"../utils/utils":71,"./AudioPlayer":9}],10:[function(a,b){var c=a("../display/Container"),d=a("../display/Sprite"),e=a("../geom/Rectangle"),f=a("../math/Vector"),g=a("../utils/ObjectPool"),h=a("../utils/ObjectFactory"),i=a("../fx/camera/Close"),j=a("../fx/camera/Fade"),k=a("../fx/camera/Flash"),l=a("../fx/camera/Scanlines"),m=a("../fx/camera/Shake"),n=a("../utils/inherit"),o=a("../math/math"),p=a("../constants"),q=function(a){this.world=a.world,this.game=a.game,this.state=a,this.bounds=a.world.bounds.clone(),this._deadzone=null,this._target=null,this._targetPos=new f,this.size=new f,this.hSize=new f,this.gui=new c,this.add=new h(a,this.gui),this.fxpools={flash:new g(k,this),fade:new g(j,this),shake:new g(m,this),scanlines:new g(l,this),close:new g(i,this)};var b=this;Object.keys(this.fxpools).forEach(function(a){b[a]=function(){var c=b.fxpools[a].create(),d=Array.prototype.slice.call(arguments),e=d.pop();return void 0!==e&&"function"!=typeof e&&d.push(e),d.push(this._fxCallback.bind(this,c,a,e)),c.start.apply(c,d)}}),c.call(this),this.addChild(this.gui)};n(q,c,{_fxCallback:function(a,b,c){var d;return"function"==typeof c&&(d=c()),this.fxpools[b].free(a),d},follow:function(a,b){if(!(a instanceof d))return this;switch(this._target=a,this._targetPos.set(null,null),b){case p.CAMERA_FOLLOW.PLATFORMER:var c=this.size.x/8,f=this.size.y/3;this._deadzone=new e((this.size.x-c)/2,(this.size.y-f)/2-f/4,c,f);break;case p.CAMERA_FOLLOW.TOPDOWN:var g=Math.max(this.size.x,this.size.y)/4;this._deadzone=new e((this.size.x-g)/2,(this.size.y-g)/2,g,g);break;case p.CAMERA_FOLLOW.TOPDOWN_TIGHT:var h=Math.max(this.size.x,this.size.y)/8;this._deadzone=new e((this.size.x-h)/2,(this.size.y-h)/2,h,h);break;case p.CAMERA_FOLLOW.LOCKON:default:this._deadzone=null}return this.focusSprite(this._target),this},unfollow:function(){return this._target=null,this._targetPos.set(null,null),this},focusSprite:function(a){for(var b=a.position.x,c=a.position.y,d=a.parent;d&&d!==this.world;)b+=d.position.x,c+=d.position.y,d=d.parent;return this.focus(b*this.world.scale.x,c*this.world.scale.y)},focus:function(a,b){b=void 0!==a.y?a.y:b||0,a=void 0!==a.x?a.x:a||0;var c=a-this.hSize.x/this.world.worldTransform.a,d=b-this.hSize.y/this.world.worldTransform.d,e=c+this.world.position.x,f=d+this.world.position.y;return this.pan(e,f)},pan:function(a,b){if(b=void 0!==a.y?a.y:b||0,a=void 0!==a.x?a.x:a||0,a||b){var c=this.world.position,d=c.x-a,e=c.y-b,f=this.bounds;return f&&(this._outsideBounds(-d,-c.y)&&(a=(0>a?f.x:f.right-this.size.x)+c.x),this._outsideBounds(-c.x,-e)&&(b=(0>b?f.y:f.bottom-this.size.y)+c.y)),(a||b)&&(a||(a=0),b||(b=0),this.world.pan(-a,-b)),this}},_outsideBounds:function(a,b){return!(this.bounds.contains(a,b)&&this.bounds.contains(a,b+this.size.y)&&this.bounds.contains(a+this.size.x,b)&&this.bounds.contains(a+this.size.x,b+this.size.y))},resize:function(a,b){return this.size.set(a,b),this.hSize.set(o.round(this.size.x/2),o.round(this.size.y/2)),this},constrain:function(a){return this.bounds=a,this},unconstrain:function(){return this.bounds=null,this},update:function(a){if(this._target){var b=this._target.worldTransform,c=b.tx,d=b.ty;if(this._targetPos.x!==c||this._targetPos.y!==d)if(this._targetPos.set(c,d),this._deadzone){var e,f,g,h;e=f=g=h=0,g=c-this._deadzone.x,h=d-this._deadzone.y,0>g&&(e=g),0>h&&(f=h),g=c-(this._deadzone.x+this._deadzone.width),h=d-(this._deadzone.y+this._deadzone.height),g>0&&(e=g),h>0&&(f=h),this.pan(e,f)}else this.focusSprite(this._target)}for(var i=0,j=this.children.length;j>i;++i){var k=this.children[i];k.update&&k.update(a)}return this}}),b.exports=q},{"../constants":11,"../display/Container":16,"../display/Sprite":19,"../fx/camera/Close":23,"../fx/camera/Fade":25,"../fx/camera/Flash":26,"../fx/camera/Scanlines":27,"../fx/camera/Shake":28,"../geom/Rectangle":37,"../math/Vector":47,"../math/math":48,"../utils/ObjectFactory":65,"../utils/ObjectPool":66,"../utils/inherit":69}],11:[function(a,b){var c={RENDERER:{AUTO:"auto",CANVAS:"canvas",WEBGL:"webgl"},FILE_FORMAT:{JSON:"json",XML:"xml",CSV:"csv"},ATLAS_FORMAT:{JSON_ARRAY:"json_array",JSON_HASH:"json_hash",XML_STARLING:"xml_starling"},CAMERA_FOLLOW:{PLATFORMER:0,TOPDOWN:1,TOPDOWN_TIGHT:2,LOCKON:3},AXIS:{NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},DIRECTION:{NONE:0,LEFT:1,RIGHT:2,UP:4,DOWN:8,ALL:15},SHAPE:{CIRCLE:1,POLYGON:2,RECTANGLE:3}};b.exports=c},{}],12:[function(a,b){var c=a("../utils/inherit"),d=function(a,b){this.game=a,this.actions=b||[],this.sprites=[],this.actionmap={};for(var c=0;b&&c<b.length;++c){var e=b[c],f=this.actionmap[e]={callbacks:{}};for(var g in d.BIND_TYPE)f[d.BIND_TYPE[g]]=[],f.callbacks[g]=null}};c(d,Object,{control:function(a){return-1===this.sprites.indexOf(a)&&this.sprites.push(a),this},release:function(a){var b=this.sprites.indexOf(a);return-1!==b&&this.sprites.splice(b,1),this},setKeys:function(a,b){this._setBinds(this.game.input.keyboard,d.BIND_TYPE.KEYBOARD,a,b)},setGpButtons:function(a,b){this._setBinds(this.game.input.gamepad.buttons,d.BIND_TYPE.GPBUTTON,a,b)},setGpAxis:function(a,b){this._setBinds(this.game.input.gamepad.sticks,d.BIND_TYPE.GPAXIS,a,b)},_setBinds:function(a,b,c,d){var e=this.actionmap[c],f=e[b],g=e.callbacks[b],h=0;for(h=0;h<f.length;++h)a.off(f[h],g);for(f.length=0,h=0;h<d.length;++h)a.on(d[h],g),f.push(d[h])}}),d.BIND_TYPE={KEYBOARD:"keyboard",GPBUTTON:"gpbutton",GPAXIS:"gpaxis"},b.exports=d},{"../utils/inherit":69}],13:[function(a,b){var c=a("./Controls"),d=a("../math/Vector"),e=a("../utils/inherit"),f=a("../input/Keyboard").KEY,g=a("../input/gamepad/GamepadButtons").BUTTON,h=a("../input/gamepad/GamepadSticks").AXIS,i=function(a,b){c.call(this,a,["left","right","up","down"]),this.actionmap.left.callbacks[c.BIND_TYPE.KEYBOARD]=this.onKey.bind(this,"left"),this.actionmap.left.callbacks[c.BIND_TYPE.GPBUTTON]=this.onKey.bind(this,"left"),this.actionmap.left.callbacks[c.BIND_TYPE.GPAXIS]=this.onGpAxis.bind(this,"left"),this.actionmap.right.callbacks[c.BIND_TYPE.KEYBOARD]=this.onKey.bind(this,"right"),this.actionmap.right.callbacks[c.BIND_TYPE.GPBUTTON]=this.onKey.bind(this,"right"),this.actionmap.right.callbacks[c.BIND_TYPE.GPAXIS]=this.onGpAxis.bind(this,"right"),this.actionmap.up.callbacks[c.BIND_TYPE.KEYBOARD]=this.onKey.bind(this,"up"),this.actionmap.up.callbacks[c.BIND_TYPE.GPBUTTON]=this.onKey.bind(this,"up"),this.actionmap.up.callbacks[c.BIND_TYPE.GPAXIS]=this.onGpAxis.bind(this,"up"),this.actionmap.down.callbacks[c.BIND_TYPE.KEYBOARD]=this.onKey.bind(this,"down"),this.actionmap.down.callbacks[c.BIND_TYPE.GPBUTTON]=this.onKey.bind(this,"down"),this.actionmap.down.callbacks[c.BIND_TYPE.GPAXIS]=this.onGpAxis.bind(this,"down");for(var e=0;e<this.actions.length;++e){var f=this.actions[e];this.setKeys(f,b&&b.keys?b.keys[f]:i.DEFAULT_KEYS[f]),this.setGpButtons(f,b&&b.buttons?b.buttons[f]:i.DEFAULT_BUTTONS[f]),this.setGpAxis(f,b&&b.axes?b.axes[f]:i.DEFAULT_AXES[f])}this.move={left:!1,right:!1,up:!1,down:!1,lastHorzGpValue:0,lastVertGpValue:0,vec:new d,lastVec:new d,maxVec:new d(1,1),minVec:new d(-1,-1),dir:{left:["x",-1],right:["x",1],up:["y",-1],down:["y",1]},speed:100}};e(i,c,{control:function(a){c.prototype.control.call(this,a),a._phys.system.addControlBody(a),a._moveVector=new d},onKey:function(a,b){if(b.originalEvent&&b.originalEvent.preventDefault(),b.down){if(this.move[a])return;this.move[a]=!0,this.move.vec[this.move.dir[a][0]]+=this.move.dir[a][1]}else this.move[a]=!1,this.move.vec[this.move.dir[a][0]]-=this.move.dir[a][1];this._checkMovement()},onGpAxis:function(a,b){if(b.code===h.LEFT_ANALOGUE_HOR){if(0===b.value){if(!this.move.lastHorzGpValue)return;this.move.left=!1,this.move.right=!1,this.move.vec.x=0}else if(b.value>0){if(this.move.right)return;this.move.right=!0,this.move.vec.x=this.move.dir.right[1]}else{if(this.move.left)return;this.move.left=!0,this.move.vec.x=this.move.dir.left[1]}this.move.lastHorzGpValue=b.value}else if(b.code===h.LEFT_ANALOGUE_VERT){if(0===b.value){if(!this.move.lastVertGpValue)return;this.move.down=!1,this.move.up=!1,this.move.vec.y=0}else if(b.value>0){if(this.move.down)return;this.move.down=!0,this.move.vec.y=this.move.dir.down[1]}else{if(this.move.up)return;this.move.up=!0,this.move.vec.y=this.move.dir.up[1]}this.move.lastVertGpValue=b.value}this.move.vec.equals(this.move.lastVec)||(this.move.lastVec.copy(this.move.vec),this._checkMovement())},_checkMovement:function(){var a,b;this.move.vec.clamp(this.move.minVec,this.move.maxVec);for(var c=0;c<this.sprites.length;++c){if(a=this.sprites[c],b=a.moveSpeed||this.move.speed,a._moveVector.x=this.move.vec.x*b,a._moveVector.y=this.move.vec.y*b,a.locked)return;a._setMoveAnimation&&a._setMoveAnimation(),a.setVelocity(a._moveVector)}}}),i.DEFAULT_KEYS={left:[f.A,f.LEFT],right:[f.D,f.RIGHT],up:[f.W,f.UP],down:[f.S,f.DOWN]},i.DEFAULT_BUTTONS={left:[g.PAD_LEFT],right:[g.PAD_RIGHT],up:[g.PAD_UP],down:[g.PAD_DOWN]},i.DEFAULT_AXES={left:[h.LEFT_ANALOGUE_HOR,h.RIGHT_ANALOGUE_HOR],right:[h.LEFT_ANALOGUE_HOR,h.RIGHT_ANALOGUE_HOR],up:[h.LEFT_ANALOGUE_VERT,h.RIGHT_ANALOGUE_VERT],down:[h.LEFT_ANALOGUE_VERT,h.RIGHT_ANALOGUE_VERT]},b.exports=i},{"../input/Keyboard":41,"../input/gamepad/GamepadButtons":43,"../input/gamepad/GamepadSticks":44,"../math/Vector":47,"../utils/inherit":69,"./Controls":12}],14:[function(a,b){var c={AudioManager:a("./audio/AudioManager"),AudioPlayer:a("./audio/AudioPlayer"),Camera:a("./camera/Camera"),Controls:a("./controls/Controls"),TopDownControls:a("./controls/TopDownControls"),BaseTexture:a("./display/BaseTexture"),Container:a("./display/Container"),Graphics:a("./display/Graphics"),RenderTexture:a("./display/RenderTexture"),Sprite:a("./display/Sprite"),SpriteBatch:a("./display/SpriteBatch"),Texture:a("./display/Texture"),TilingSprite:a("./display/TilingSprite"),fx:{camera:{Effect:a("./fx/camera/Effect"),Close:a("./fx/camera/Close"),Fade:a("./fx/camera/Fade"),Flash:a("./fx/camera/Flash"),Scanlines:a("./fx/camera/Scanlines"),Shake:a("./fx/camera/Shake")},filters:{Filter:a("./fx/filters/Filter")}},Game:a("./game/Game"),State:a("./game/State"),StateManager:a("./game/StateManager"),World:a("./game/World"),Circle:a("./geom/Circle"),Ellipse:a("./geom/Ellipse"),Polygon:a("./geom/Polygon"),Rectangle:a("./geom/Rectangle"),Input:a("./input/Input"),InputManager:a("./input/InputManager"),Keyboard:a("./input/Keyboard"),Gamepad:a("./input/Gamepad"),GamepadButtons:a("./input/gamepad/GamepadButtons"),GamepadSticks:a("./input/gamepad/GamepadSticks"),Pointers:a("./input/Pointers"),Pointer:a("./input/pointer/Pointer"),Loader:a("./loader/Loader"),math:a("./math/math"),Vector:a("./math/Vector"),ParticleEmitter:a("./particles/ParticleEmitter"),ParticleSystem:a("./particles/ParticleSystem"),PhysicsSystem:a("./physics/PhysicsSystem"),PhysicsTarget:a("./physics/PhysicsTarget"),BitmapText:a("./text/BitmapText"),Text:a("./text/Text"),Tile:a("./tilemap/Tile"),Tilelayer:a("./tilemap/Tilelayer"),Tilemap:a("./tilemap/Tilemap"),Tileset:a("./tilemap/Tileset"),ObjectGroup:a("./tilemap/ObjectGroup"),utils:a("./utils/utils"),support:a("./utils/support"),inherit:a("./utils/inherit"),Cache:a("./utils/Cache"),Clock:a("./utils/Clock"),Color:a("./utils/Color"),EventEmitter:a("./utils/EventEmitter"),ObjectPool:a("./utils/ObjectPool"),Queue:a("./utils/Queue"),SpritePool:a("./utils/SpritePool"),ObjectFactory:a("./utils/ObjectFactory"),PIXI:a("pixi.js"),cp:a("chipmunk")};c.PIXI.Point=c.Vector;for(var d=["FilterBlock","WebGLFilterManager","FilterTexture","AlphaMaskFilter","ColorMatrixFilter","GrayFilter","DisplacementFilter","PixelateFilter","BlurXFilter","BlurYFilter","BlurFilter","InvertFilter","SepiaFilter","TwistFilter","ColorStepFilter","DotScreenFilter","CrossHatchFilter","RGBSplitFilter"],e=0;e<d.length;++e)c.fx.filters[d[e]]=c.PIXI[d[e]];var f=a("./constants");for(var g in f)c[g]=f[g];b.exports=c},{"./audio/AudioManager":8,"./audio/AudioPlayer":9,"./camera/Camera":10,"./constants":11,"./controls/Controls":12,"./controls/TopDownControls":13,"./display/BaseTexture":15,"./display/Container":16,"./display/Graphics":17,"./display/RenderTexture":18,"./display/Sprite":19,"./display/SpriteBatch":20,"./display/Texture":21,"./display/TilingSprite":22,"./fx/camera/Close":23,"./fx/camera/Effect":24,"./fx/camera/Fade":25,"./fx/camera/Flash":26,"./fx/camera/Scanlines":27,"./fx/camera/Shake":28,"./fx/filters/Filter":29,"./game/Game":30,"./game/State":31,"./game/StateManager":32,"./game/World":33,"./geom/Circle":34,"./geom/Ellipse":35,"./geom/Polygon":36,"./geom/Rectangle":37,"./input/Gamepad":38,"./input/Input":39,"./input/InputManager":40,"./input/Keyboard":41,"./input/Pointers":42,"./input/gamepad/GamepadButtons":43,"./input/gamepad/GamepadSticks":44,"./input/pointer/Pointer":45,"./loader/Loader":46,"./math/Vector":47,"./math/math":48,"./particles/ParticleEmitter":50,"./particles/ParticleSystem":51,"./physics/PhysicsSystem":52,"./physics/PhysicsTarget":53,"./text/BitmapText":54,"./text/Text":55,"./tilemap/ObjectGroup":56,"./tilemap/Tile":57,"./tilemap/Tilelayer":58,"./tilemap/Tilemap":59,"./tilemap/Tileset":60,"./utils/Cache":61,"./utils/Clock":62,"./utils/Color":63,"./utils/EventEmitter":64,"./utils/ObjectFactory":65,"./utils/ObjectPool":66,"./utils/Queue":67,"./utils/SpritePool":68,"./utils/inherit":69,"./utils/support":70,"./utils/utils":71,chipmunk:1,"pixi.js":6}],15:[function(a,b){var c=a("pixi.js").BaseTexture;b.exports=c},{"pixi.js":6}],16:[function(a,b){var c=a("../utils/EventEmitter"),d=a("../physics/PhysicsTarget"),e=a("../utils/utils"),f=a("../utils/inherit"),g=a("pixi.js"),h=function(a){g.DisplayObjectContainer.call(this),c.call(this),d.call(this),e.setValues(this,a)};f(h,g.DisplayObjectContainer,{show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},addChild:function(a){return g.DisplayObjectContainer.prototype.addChild.apply(this,arguments),a},addChildAt:function(a){return g.DisplayObjectContainer.prototype.addChildAt.apply(this,arguments),a},removeChild:function(a){return g.DisplayObjectContainer.prototype.removeChild.apply(this,arguments),a},removeAllChildren:function(){for(;this.children.length;)this.removeChild(this.children[0]);return this},bringChildToTop:function(a){return a.parent===this&&this.addChild(this.removeChild(a)),a},destroy:function(){this.disablePhysics(),this.destroyAllChildren(),this.parent&&this.parent.removeChild(this)},destroyAllChildren:function(){for(;this.children.length;)this.children[0].destroy?this.children[0].destroy():this.removeChild(this.children[0]);return this}}),b.exports=h},{"../physics/PhysicsTarget":53,"../utils/EventEmitter":64,"../utils/inherit":69,"../utils/utils":71,"pixi.js":6}],17:[function(a,b){var c=a("pixi.js").Graphics;b.exports=c},{"pixi.js":6}],18:[function(a,b){var c=a("pixi.js").RenderTexture;b.exports=c},{"pixi.js":6}],19:[function(a,b){var c=a("../utils/EventEmitter"),d=a("../geom/Rectangle"),e=a("../physics/PhysicsTarget"),f=a("../utils/Clock"),g=a("../utils/inherit"),h=a("./Texture"),i=a("../utils/utils"),j=a("pixi.js"),k=function(a,b,g){if(c.call(this),e.call(this),a||(a=h.__default),a instanceof h)a={_default:{frames:[a]}},g="_default";else if(a instanceof Array)a={_default:{frames:a}},g="_default";else for(var i in a){void 0===g&&(g=i);var k=a[i];k instanceof Array?a[i]={name:i,frames:k}:k instanceof h?a[i]={name:i,frames:[k]}:a[i].name=i}j.Sprite.call(this,a[g].frames[0]),this.name="",this.lifespan=1/0,this.frameTime=b||250,this.loop=!1,this.animations=a,this.currentAnimation=g,this.currentFrame=0,this.playing=!1,this.hitArea=this.hitArea||new d(0,0,this.width,this.height),this.goto(0,this.currentAnimation),this._clock=new f,this._clock.start(),this._frameTime=0};g(k,j.Sprite,{enableInteractivity:function(a){return a.input.pointers.watchSprite(this),this},show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},clone:function(a){var b=i.extend(!0,{},this.animations);return a=a||new k(b,this.frameTime,this.currentAnimation),a.name=this.name,a.loop=this.loop,a.currentFrame=this.currentFrame,a.playing=this.playing,a.hitArea=this.hitArea.clone(),a.blendMode=this.blendMode,a.anchor.x=this.anchor.x,a.anchor.y=this.anchor.y,a.position.x=this.position.x,a.position.y=this.position.y,a.scale.x=this.scale.x,a.scale.y=this.scale.y,a.pivot.x=this.pivot.x,a.pivot.y=this.pivot.y,a.rotation=this.rotation,a.alpha=this.alpha,a.visible=this.visible,a.buttonMode=this.buttonMode,a.renderable=this.renderable,a},addAnimation:function(a,b,c,d){return"object"==typeof a?this.animations[a.name]=a:this.animations[a]={name:a,frames:b,frameTime:c,loop:d},this},"goto":function(a,b){return"string"==typeof a&&(b=a,a=0),this.currentFrame=a||0,b&&(this.currentAnimation=b),this.setTexture(this.animations[this.currentAnimation].frames[this.currentFrame]),this.emit("frame",this.currentAnimation,this.currentFrame),this},play:function(){return this.playing=!0,this},stop:function(){return this.playing=!1,this},destroy:function(){this.stop(),this.disablePhysics(),this.parent&&this.parent.removeChild(this),this.name=null,this.lifetime=null,this.frameTime=null,this.loop=null,this.animations=null,this.currentAnimation=null,this.currentFrame=null,this.playing=null,this.hitArea=null},updateTransform:function(){j.Sprite.prototype.updateTransform.call(this);var a=this._clock.getDelta();if(this.playing){var b=this.animations[this.currentAnimation];if(this._frameTime+=1e3*a,!(this._frameTime<(b.frameTime||500))){var c=void 0!==b.loop?b.loop:this.loop,d=++this.currentFrame;this._frameTime=0,d<b.frames.length?(this.setTexture(b.frames[d]),this.emit("frame",this.currentAnimation,d)):c?this.goto(0):(this.stop(),this.emit("complete",this.currentAnimation))}}}}),b.exports=k},{"../geom/Rectangle":37,"../physics/PhysicsTarget":53,"../utils/Clock":62,"../utils/EventEmitter":64,"../utils/inherit":69,"../utils/utils":71,"./Texture":21,"pixi.js":6}],20:[function(a,b){var c=a("../utils/EventEmitter"),d=a("../utils/utils"),e=a("../utils/inherit"),f=a("pixi.js"),g=function(a){f.SpriteBatch.call(this),c.call(this),d.setValues(this,a)};e(g,f.SpriteBatch,{show:function(){return this.visible=!0,this},hide:function(){return this.visible=!1,this},addChild:function(a){return f.SpriteBatch.prototype.addChild.apply(this,arguments),a},addChildAt:function(a){return f.SpriteBatch.prototype.addChildAt.apply(this,arguments),a},removeChild:function(a){return f.SpriteBatch.prototype.removeChild.apply(this,arguments),a},removeAllChildren:function(){for(;this.children.length;)this.removeChild(this.children[0]);return this},bringChildToTop:function(a){return a.parent===this&&this.addChild(this.removeChild(a)),a},destroy:function(){this.disablePhysics(),this.destroyAllChildren(),this.parent&&this.parent.removeChild(this)},destroyAllChildren:function(){for(;this.children.length;)this.children[0].destroy?this.children[0].destroy():this.removeChild(this.children[0]);return this}}),b.exports=g},{"../utils/EventEmitter":64,"../utils/inherit":69,"../utils/utils":71,"pixi.js":6}],21:[function(a,b){var c=a("pixi.js").Texture,d=a("../geom/Rectangle"),e=a("../utils/utils"),f=a("pixi.js");c.fromJSON=function(a,b,d){if(!b.frames)return void e.warn('Invalid Texture Atlas JSON for fromJSON, missing "frames" array, full json:',b);var f,g=b.frames,h={};if(g.length)for(var i=0,j=g.length;j>i;++i)f=a+"_"+g[i].filename,h[g[i].filename]=c._createFrame(f,g[i],d);else for(var k in g)f=a+"_"+k,h[k]=c._createFrame(f,g[k],d);return h},c._createFrame=function(a,b,e){var g=b.frame;if(g){var h=f.TextureCache[a]=new c(e,{x:g.x,y:g.y,width:g.w,height:g.h});return(h.trimmed=b.trimmed)&&(h.trim=new d(b.spriteSourceSize.x,b.spriteSourceSize.y,b.sourceSize.w,b.sourceSize.h)),h}},c.fromXML=function(a,b,d){if(!b.getElementsByTagName("TextureAtlas"))return void e.warn("Invalid Texture Atlas XML given, missing <TextureAtlas> tag, full xml:",b);for(var g=b.getElementsByTagName("SubTexture")||b.getElementsByTagName("sprite"),h={},i=0;i<g.length;i++){var j=g[i],k=j.attributes,l=k.getNamedItem("name")||k.getNamedItem("n"),m=k.getNamedItem("x"),n=k.getNamedItem("y"),o=k.getNamedItem("width")||k.getNamedItem("w"),p=k.getNamedItem("height")||k.getNamedItem("h"),q=k.getNamedItem("frameX")||k.getNamedItem("oX"),r=k.getNamedItem("frameY")||k.getNamedItem("oY"),s=k.getNamedItem("frameWidth")||k.getNamedItem("oW"),t=k.getNamedItem("frameHeight")||k.getNamedItem("oH"),u=!!k.getNamedItem("r"),v=h[l]=f.TextureCache[a+"_"+l]=new c(d,{x:parseInt(m.nodeValue,10),y:parseInt(n.nodeValue,10),width:parseInt(o.nodeValue,10),height:parseInt(p.nodeValue,10)});v.trimmed=q&&r,v.rotated=u,v.trimmed&&(v.sourceSize={w:parseInt(s.nodeValue,10),h:parseInt(t.nodeValue,10)},v.realSize={x:Math.abs(parseInt(q.nodeValue,10)),y:Math.abs(parseInt(r.nodeValue,10)),w:parseInt(s.nodeValue,10),h:parseInt(t.nodeValue,10)})}return h},c.fromSpritesheet=function(a){return a},b.exports=c},{"../geom/Rectangle":37,"../utils/utils":71,"pixi.js":6}],22:[function(a,b){var c=a("pixi.js").TilingSprite;b.exports=c},{"pixi.js":6}],23:[function(a,b){var c=a("./Effect"),d=a("../../utils/inherit"),e=function(){c.call(this)};d(e,c,{start:function(a,b,d,e){return"function"==typeof d&&(e=d,d=null),"function"==typeof b&&(e=b,d=null,b=null),"function"==typeof a&&(e=a,d=null,b=null,a=null),c.prototype.start.call(this,e),this.shape=a||"circle",this.duration=b&&b>0?b:1e3,this.cx=d?d.x:this.parent.size.x/2,this.cy=d?d.y:this.parent.size.y/2,this.w=this.mx=this.parent.size.x,this.h=this.my=this.parent.size.y,this.radius=this.maxRadius=Math.max(this.w/2,this.h/2),this.gfx.visible=!0,this.gfx.position.x=this.cx,this.gfx.position.y=this.cy,this.parent.state.mask=this.gfx,this.gfx.scale.y="ellipse"===a?.5:1,this},stop:function(){return c.prototype.stop.call(this),this.radius=this.sx=this.sy=0,this.gfx.visible=!1,this.parent.state.mask===this.gfx&&(this.parent.state.mask=null),this},update:function(a){if(!this.done){var b=1e3*a/this.duration;switch(this.gfx.clear(),this.gfx.beginFill(16711935),this.shape){case"ellipse":case"circle":this.radius-=b*this.maxRadius,this.radius<=0?this._complete():this.gfx.drawCircle(0,0,this.radius);break;case"rect":case"rectangle":this.w-=b*this.mx,this.h-=b*this.my,this.w<=0?this._complete():this.gfx.drawRect(-(this.w/2),-(this.h/2),this.w,this.h)}return this.gfx.endFill(),this}}}),b.exports=e},{"../../utils/inherit":69,"./Effect":24}],24:[function(a,b){var c=a("../../display/Container"),d=a("../../utils/inherit"),e=a("../../display/Graphics"),f=function(){c.call(this),this.gfx=this.addChild(new e),this.gfx.visible=!1,this.done=!0};d(f,c,{start:function(a){return this.done=!1,this.cb=a,this},stop:function(){return this.done=!0,this},update:function(){return this},_complete:function(){if(this.done=!0,"function"==typeof this.cb){var a=this.cb();a!==!1&&this.stop()}else this.stop()}}),b.exports=f},{"../../display/Container":16,"../../display/Graphics":17,"../../utils/inherit":69}],25:[function(a,b){var c=a("./Effect"),d=a("../../utils/inherit"),e=function(){c.call(this)};d(e,c,{start:function(a,b,d,e){return"function"==typeof d&&(e=b,d=null),"function"==typeof b&&(e=b,d=null,b=null),"function"==typeof a&&(e=a,d=null,b=null,a=null),c.prototype.start.call(this,e),a="number"==typeof a?a:16777215,this.goal=d||1,this.duration=b&&b>0?b:1e3,this.gfx.visible=!0,this.gfx.alpha=0,this.gfx.clear(),this.gfx.beginFill(a),this.gfx.drawRect(0,0,this.parent.size.x,this.parent.size.y),this},stop:function(){return c.prototype.stop.call(this),this.gfx.alpha=0,this.gfx.visible=!1,this},update:function(a){return this.done?void 0:(this.gfx.alpha<this.goal&&(this.gfx.alpha+=1e3*a/this.duration,this.gfx.alpha>=this.goal&&this._complete()),this)}}),b.exports=e},{"../../utils/inherit":69,"./Effect":24}],26:[function(a,b){var c=a("./Effect"),d=a("../../utils/inherit"),e=function(){c.call(this)
};d(e,c,{start:function(a,b,d,e){return"function"==typeof d&&(e=b,d=null),"function"==typeof b&&(e=b,d=null,b=null),"function"==typeof a&&(e=a,d=null,b=null,a=null),c.prototype.start.call(this,e),d=d||1,a="number"==typeof a?a:16777215,this.duration=b&&b>0?b:1e3,this.gfx.visible=!0,this.gfx.alpha=d,this.gfx.clear(),this.gfx.beginFill(a),this.gfx.drawRect(0,0,this.parent.size.x,this.parent.size.y),this},stop:function(){return c.prototype.stop.call(this),this.gfx.alpha=0,this.gfx.visible=!1,this},update:function(a){return this.done?void 0:(this.gfx.alpha>0&&(this.gfx.alpha-=1e3*a/this.duration,this.gfx.alpha<=0&&this._complete()),this)}}),b.exports=e},{"../../utils/inherit":69,"./Effect":24}],27:[function(a,b){var c=a("./Effect"),d=a("../../utils/inherit"),e=a("../../constants"),f=function(){c.call(this)};d(f,c,{start:function(a,b,d,f,g,h){"function"==typeof g&&(h=g,g=null),"function"==typeof f&&(h=f,g=null,f=null),"function"==typeof d&&(h=d,g=null,f=null,d=null),"function"==typeof b&&(h=d,g=null,f=null,d=null,b=null),"function"==typeof a&&(h=d,g=null,f=null,d=null,b=null,a=null),c.prototype.start.call(this,h),a=a||0,b=b||e.AXIS.HORIZONTAL,d=d||4,f=f||1,g=g||.3;var i=this.parent.size.x,j=this.parent.size.y;if(this.gfx.clear(),this.gfx.visible=!0,this.gfx.beginFill(a,g),b&e.AXIS.VERTICAL)for(var k=0;i>k;k+=d)this.gfx.drawRect(k,0,f,j);if(b&e.AXIS.HORIZONTAL)for(var l=0;j>l;l+=d)this.gfx.drawRect(0,l,i,f);return this.gfx.endFill(),this},stop:function(){return c.prototype.stop.call(this),this.gfx.visible=!1,this}}),b.exports=f},{"../../constants":11,"../../utils/inherit":69,"./Effect":24}],28:[function(a,b){var c=a("./Effect"),d=a("../../math/Vector"),e=a("../../utils/inherit"),f=a("../../math/math"),g=a("../../constants"),h=function(){c.call(this),this.offset=new d};e(h,c,{start:function(a,b,d,e){return"function"==typeof d&&(e=d,d=null),"function"==typeof b&&(e=b,d=null,b=null),"function"==typeof a&&(e=a,d=null,b=null,a=null),c.prototype.start.call(this,e),this.intensity=a||.01,this.duration=b||1e3,this.direction=d||g.AXIS.BOTH,this.offset.x=this.offset.y=0,this},stop:function(){return c.prototype.stop.call(this),this.duration=this.offset.x=this.offset.y=0,this},update:function(a){this.done||(this.duration-=1e3*a,this.offset.x=-this.offset.x,this.offset.y=-this.offset.y,this.parent.pan(this.offset.x,this.offset.y),this.duration<=0?this._complete():(this.direction&g.AXIS.HORIZONTAL&&(this.offset.x=f.round(Math.random()*this.intensity*this.parent.size.x*2-this.intensity*this.parent.size.x)),this.direction&g.AXIS.VERTICAL&&(this.offset.y=f.round(Math.random()*this.intensity*this.parent.size.y*2-this.intensity*this.parent.size.y)),this.parent.pan(this.offset.x,this.offset.y)))}}),b.exports=h},{"../../constants":11,"../../math/Vector":47,"../../math/math":48,"../../utils/inherit":69,"./Effect":24}],29:[function(a,b){var c=a("pixi.js"),d=c.AbstractFilter;b.exports=d},{"pixi.js":6}],30:[function(a,b){var c=a("./StateManager"),d=a("../utils/EventEmitter"),e=a("../utils/Cache"),f=a("../utils/Clock"),g=a("../utils/SpritePool"),h=a("../loader/Loader"),i=a("../input/InputManager"),j=a("../audio/AudioManager"),k=a("../math/Vector"),l=a("../utils/utils"),m=a("../utils/support"),n=a("../utils/inherit"),o=a("pixi.js"),p=a("../constants"),q=function(a,b){d.call(this),b=b||{},b.width=b.width||800,b.height=b.height||600,b.renderer=b.renderer||p.RENDERER.AUTO,b.transparent=b.transparent||!1,b.background=b.background||"#FFF",b.antialias=void 0!==b.antialias?b.antialias:!0,b.canvas=b.canvas||null,this.container="string"==typeof a?document.getElementById(a):a,this.container||(this.container=document.body),this.width=b.width,this.height=b.height,this.renderMethod=b.renderer,this.transparent=b.transparent,this.background=b.background,this.antialias=b.antialias,this.canvas=b.canvas,this.renderer=this._createRenderer(),this.stage=new o.Stage(this.background),this.clock=new f,this.audio=new j(this),this.load=new h(this),this.cache=new e(this),this.input=new i(this),this.spritepool=new g(this),this.state=new c(this),this.offset=new k,this.timings={},this.maxDelta=5;var l=this.canvas;l.getAttribute("tabindex")||l.setAttribute("tabindex","1"),l.focus(),l.addEventListener("click",function(){l.focus()},!1)};n(q,Object,{_createRenderer:function(){var a=this.renderMethod,b=null;if(!m.webgl&&!m.canvas)throw new Error("Neither WebGL nor Canvas is supported by this browser!");if(a!==p.RENDERER.WEBGL&&a!==p.RENDERER.AUTO||!m.webgl){if(a!==p.RENDERER.CANVAS&&a!==p.RENDERER.AUTO||!m.canvas)throw new Error('Your render method ("'+a+'") is not supported by this browser!');a=p.RENDERER.CANVAS,b=new o.CanvasRenderer(this.width,this.height,this.canvas,this.transparent)}else a=p.RENDERER.WEBGL,b=new o.WebGLRenderer(this.width,this.height,this.canvas,this.transparent,this.antialias);return this.canvas||(this.container.appendChild(b.view),this.canvas=b.view),this.offset=l.getOffset(this.canvas),this.renderMethod=a,b},resize:function(a,b){this.renderer.resize(a,b),this.width=a,this.height=b;for(var c=0,d=this.stage.children.length;d>c;++c){var e=this.stage.children[c];e.resize&&e.resize(a,b)}return this},requestFullscreen:function(){var a=this.renderer.view;return a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(),this},render:function(){return this.clock.start(),this._tick(),this},_tick:function(){window.requestAnimFrame(this._tick.bind(this));var a=this.clock.getDelta();a>this.maxDelta||(this.timings.lastTickStart=this.timings.tickStart,this.timings.tickStart=this.clock.now(),this.timings.lastDelta=a,this.timings.inputStart=this.clock.now(),this.input.update(a),this.timings.inputEnd=this.clock.now(),this.timings.stateStart=this.clock.now(),this.state.active.update(a),this.timings.stateEnd=this.clock.now(),this.timings.userFuncsStart=this.clock.now(),this.emit("tick",a),this.timings.userFuncsEnd=this.clock.now(),this.timings.renderStart=this.clock.now(),this.renderer.render(this.stage),this.timings.renderEnd=this.clock.now(),this.timings.tickEnd=this.clock.now())}}),Object.defineProperty(q.prototype,"physics",{get:function(){return this.state.active.physics}}),Object.defineProperty(q.prototype,"camera",{get:function(){return this.state.active.camera}}),Object.defineProperty(q.prototype,"world",{get:function(){return this.state.active.world}}),b.exports=q},{"../audio/AudioManager":8,"../constants":11,"../input/InputManager":40,"../loader/Loader":46,"../math/Vector":47,"../utils/Cache":61,"../utils/Clock":62,"../utils/EventEmitter":64,"../utils/SpritePool":68,"../utils/inherit":69,"../utils/support":70,"../utils/utils":71,"./StateManager":32,"pixi.js":6}],31:[function(a,b){var c=a("../audio/AudioManager"),d=a("../display/Container"),e=a("./World"),f=a("../camera/Camera"),g=a("../physics/PhysicsSystem"),h=a("../math/math"),i=a("../utils/inherit"),j=function(a,b,i){b||(b=h.randomString()),this.name=b,this.game=a,this.audio=new c(a,a.audio),this.world=new e(this),this.physics=new g(this,i),this.camera=new f(this),d.call(this),this.visible=!1,this.addChild(this.world),this.addChild(this.camera),this.camera.resize(a.width,a.height)};i(j,d,{enable:function(){return this.game.state.enable(this),this},resize:function(a,b){return this.camera.resize(a,b),this.world.resize(a,b),this},update:function(a){return this.game.timings.cameraStart=this.game.clock.now(),this.camera.update(a),this.game.timings.cameraEnd=this.game.clock.now(),this.game.timings.physicsStart=this.game.clock.now(),this.physics.update(a),this.game.timings.physicsEnd=this.game.clock.now(),this}}),b.exports=j},{"../audio/AudioManager":8,"../camera/Camera":10,"../display/Container":16,"../math/math":48,"../physics/PhysicsSystem":52,"../utils/inherit":69,"./World":33}],32:[function(a,b){var c=a("../utils/inherit"),d=a("./State"),e=function(a){this.game=a,this.states={},this.active=null,this.count=0,this._createDefault()};c(e,Object,{_createDefault:function(){return this.add("__default",!0)},add:function(a,b){var c;return"string"==typeof a?c=new d(this.game,a):"function"==typeof a?c=new a(this.game):(c=a,c.game=this.game),this.states[c.name]=c,this.game.stage.addChild(c),b&&this.enable(c),this.count++,c},remove:function(a){return"string"==typeof a&&(a=this.states[a]),a.parent&&a.parent.removeChild(a),delete this.states[a.name],this.count--,this},enable:function(a){return"string"!=typeof a&&(a=a.name),this.states[a]&&(this.active&&(this.active.visible=!1,this.active.physics.pause()),this.active=this.states[a],this.active.visible=!0,this.active.physics.resume()),this},destroy:function(){this.game=null,this.states=null}}),b.exports=e},{"../utils/inherit":69,"./State":31}],33:[function(a,b){var c=a("../utils/inherit"),d=a("../display/Container"),e=a("../geom/Rectangle"),f=a("../utils/ObjectFactory"),g=a("../math/math"),h=function(a){d.call(this),this.game=a.game,this.state=a,this.bounds=new e(0,0,a.game.width,a.game.height),this.add=new f(a,this)};c(h,d,{pan:function(a,b){b=g.floor(void 0!==a.y?a.y:b||0),a=g.floor(void 0!==a.x?a.x:a||0),this.position.x+=a*this.scale.x,this.position.y+=b*this.scale.y;for(var c=0,d=this.children.length;d>c;++c){var e=this.children[c];e.pan&&e.pan(a,b)}return this},resize:function(a,b){for(var c=0,d=this.children.length;d>c;++c){var e=this.children[c];e.render&&e.render(-this.position.x,-this.position.y,a,b)}return this}}),b.exports=h},{"../display/Container":16,"../geom/Rectangle":37,"../math/math":48,"../utils/ObjectFactory":65,"../utils/inherit":69}],34:[function(a,b){var c=a("../utils/inherit"),d=a("../math/Vector"),e=a("../constants"),f=function(a,b,c,f){this.position=new d,this._radius=c||0,this.radius=c||0,this.scale=f||new d(1,1),this.x=a||0,this.y=b||0,this._shapetype=e.SHAPE.CIRCLE,this.recalc()};c(f,Object,{clone:function(){return new f(this.x,this.y,this.radius)},copy:function(a){return this.x=a.x,this.y=a.y,this.radius=a.radius,this},contains:function(a,b){if(this.radius<=0)return!1;var c=a-this.x,d=b-this.y,e=this.radius*this.radius;return c*=c,d*=d,e>=c+d},overlaps:function(a){var b=this.position.clone().sub(a.position),c=this.radius+a.radius,d=c*c,e=b.lengthSq();return!(e>d)},equals:function(a){return this.position.equals(a.position)&&this.radius===a.radius},recalc:function(){return this.radius=this._radius*this.scale.x,this}}),Object.defineProperty(f.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),Object.defineProperty(f.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),Object.defineProperty(f.prototype,"radius",{get:function(){return this._radius*this.scale.x},set:function(a){this._radius=a}}),Object.defineProperty(f.prototype,"circumference",{get:function(){return 2*Math.PI*this.radius}}),Object.defineProperty(f.prototype,"area",{get:function(){return Math.PI*this.radius*this.radius}}),b.exports=f},{"../constants":11,"../math/Vector":47,"../utils/inherit":69}],35:[function(a,b){var c=a("pixi.js").Ellipse;b.exports=c},{"pixi.js":6}],36:[function(a,b){var c=a("../utils/inherit"),d=a("../math/Vector"),e=a("../constants"),f=function(a,b,c,f){if(this.position=new d,this._points=null,this.scale=f||new d(1,1),this.points=[],this.edges=[],this.normals=[],"number"==typeof c[0]){for(var g=[],h=0,i=c.length;i>h;h+=2)g.push(new d(c[h],c[h+1]));c=g}this._points=c,this.x=a||0,this.y=b||0,this.recalc(),this._shapetype=e.SHAPE.POLYGON};c(f,Object,{clone:function(){for(var a=[],b=0;b<this._points.length;b++)a.push(this._points[b].clone());return new f(a,this.scale)},copy:function(a){this.position.copy(a.position),this._points.length=this.points.length=0;for(var b=0;b<a._points.length;++b)this._points.push(a._points[b].clone());return this.scale.copy(a.scale),this.recalc(),this},contains:function(a,b){for(var c=!1,d=0,e=this.points.length-1;d<this.points.length;e=d++){var f=this.points[d].x,g=this.points[d].y,h=this.points[e].x,i=this.points[e].y,j=g>b!=i>b&&(h-f)*(b-g)/(i-g)+f>a;j&&(c=!c)}return c},equals:function(a){if(!this.position.equals(a.position)||this.points.length!==a.points.length)return!1;for(var b=0;b<a.points.length;++b)if(!this.points[b].equals(a.points[b]))return!1;return!0},recalc:function(){var a,b,c,e,f=this._points,g=f.length,h=0;for(h=0;g>h;h++)this.points[h]||(this.points[h]=new d),this.points[h].set(this._points[h].x*this.scale.x,this._points[h].y*this.scale.y);for(this.edges.length=this.normals.length=0,h=0;g>h;++h)a=f[h],b=g-1>h?f[h+1]:f[0],c=b.clone().sub(a),e=c.clone().perp().normalize(),this.edges.push(c),this.normals.push(e);return this}}),Object.defineProperty(f.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),Object.defineProperty(f.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),b.exports=f},{"../constants":11,"../math/Vector":47,"../utils/inherit":69}],37:[function(a,b){var c=a("../utils/inherit"),d=a("./Polygon"),e=a("../math/Vector"),f=a("../math/math"),g=a("../constants"),h=function(a,b,c,d){this.position=new e,this.x=a||0,this.y=b||0,this._width=c||0,this._height=d||0,this.halfWidth=this._width/2,this.halfHeight=this._height/2,this._shapetype=g.SHAPE.RECTANGLE};c(h,Object,{clone:function(){return new h(this.x,this.y,this._width,this._height)},copy:function(a){return this.x=a.x,this.y=a.y,this.width=a.width,this.height=a.height,this},contains:function(a,b){if(this._width<=0||this._height<=0)return!1;var c=this.x;if(a>=c&&a<=c+this._width){var d=this.y;if(b>=d&&b<=d+this._height)return!0}return!1},overlaps:function(a){return this.right>a.x&&this.x<a.right&&this.bottom>a.y&&this.y<a.bottom},toPolygon:function(a){return a=a||this.position,new d(this.x-a.x,this.y-a.y,[new e(a.x,a.y),new e(this.width,a.y),new e(this.width,this.height),new e(a.x,this.height)])},equals:function(a){return this.position.equals(a.position)&&this._width===a._width&&this._height===a._height},union:function(a,b){return b=b||new h,b.x=f.min(this.x,a.x),b.y=f.min(this.y,a.y),b.width=f.max(this.right,a.right),b.height=f.max(this.bottom,a.bottom),b}}),Object.defineProperty(h.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),Object.defineProperty(h.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),Object.defineProperty(h.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a||0,this.halfWidth=this._width/2}}),Object.defineProperty(h.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a||0,this.halfHeight=this._height/2}}),Object.defineProperty(h.prototype,"right",{get:function(){return this.x+this._width}}),Object.defineProperty(h.prototype,"left",{get:function(){return this.x}}),Object.defineProperty(h.prototype,"top",{get:function(){return this.y}}),Object.defineProperty(h.prototype,"bottom",{get:function(){return this.y+this._height}}),Object.defineProperty(h.prototype,"perimeter",{get:function(){return 2*(this._width+this._height)}}),Object.defineProperty(h.prototype,"area",{get:function(){return this._width*this._height}}),b.exports=h},{"../constants":11,"../math/Vector":47,"../math/math":48,"../utils/inherit":69,"./Polygon":36}],38:[function(a,b){var c=a("../utils/inherit"),d=a("./Input"),e=a("./gamepad/GamepadButtons"),f=a("./gamepad/GamepadSticks"),g=function(){d.call(this),this.ticking=!1,this.pads=[],this.prevTimestamps=[],this.buttons=new e,this.sticks=new f,window.addEventListener("MozGamepadConnected",this.onGamepadConnect.bind(this),!1),window.addEventListener("MozGamepadDisconnected",this.onGamepadDisconnect.bind(this),!1),(navigator.webkitGamepads||navigator.webkitGetGamepads)&&this.startPolling()};c(g,d,{onGamepadConnect:function(a){this.pads.push(a.gamepad),this.startPolling()},onGamepadDisconnect:function(a){for(var b=0,c=this.pads.length;c>b;++b)if(this.pads[b].index===a.gamepad.index){this.pads.splice(b,1);break}0===this.pads.length&&this.stopPolling()},startPolling:function(){this.ticking||(this.ticking=!0,this.update())},stopPolling:function(){this.ticking=!1},pollGamepads:function(){var a=navigator.webkitGetGamepads&&navigator.webkitGetGamepads()||navigator.webkitGamepads;if(a){this.pads.length=0;for(var b=0,c=a.length;c>b;++b)a[b]&&this.pads.push(a[b])}},pollStatus:function(){for(var a=0,b=this.pads.length;b>a;++a){var c=this.pads[a];c.timestamp&&c.timestamp===this.prevTimestamps[a]||(this.prevTimestamps[a]=c.timestamp,this.buttons.pollStatus(c),this.sticks.pollStatus(c))}},update:function(){this.ticking&&(this.pollGamepads(),this.pollStatus())}}),b.exports=g},{"../utils/inherit":69,"./Input":39,"./gamepad/GamepadButtons":43,"./gamepad/GamepadSticks":44}],39:[function(a,b){var c=a("../utils/inherit"),d=a("../utils/EventEmitter"),e=function(a){d.call(this),this.game=a};c(e,Object,{}),b.exports=e},{"../utils/EventEmitter":64,"../utils/inherit":69}],40:[function(a,b){var c=a("../utils/inherit"),d=a("./Keyboard"),e=a("./Gamepad"),f=a("./Pointers"),g=function(a){this.game=a,this.canvas=a.canvas,this.keyboard=new d(a),this.pointers=new f(a),this.gamepad=new e};c(g,Object,{update:function(a){this.pointers.update(a),this.gamepad.update(a)}}),b.exports=g},{"../utils/inherit":69,"./Gamepad":38,"./Keyboard":41,"./Pointers":42}],41:[function(a,b){var c=a("../utils/inherit"),d=a("./Input"),e=function(a){d.call(this,a),this.sequence=[],this.sequenceTimeout=500,this._clearSq=null,a.canvas.addEventListener("keydown",this.onKeyDown.bind(this),!1),a.canvas.addEventListener("keyup",this.onKeyUp.bind(this),!1)};c(e,d,{onKeyDown:function(a,b){return this.modifyKey(a,b||a.keyCode||a.which,!0)},onKeyUp:function(a,b){return this.modifyKey(a,b||a.keyCode||a.which,!1)},modifyKey:function(a,b,c){if(this.emit(b,this._getEventData(a,c)),c){this.sequence.push(b);var d=this.sequence.toString();d!==b.toString()&&this.emit(d,this._getEventData(a,c)),clearTimeout(this._clearSq),this._clearSq=setTimeout(this._clearSequence.bind(this),this.sequenceTimeout)}},_getEventData:function(a,b){return{input:this,originalEvent:a,down:b}},_clearSequence:function(){this.sequence.length=0}}),e.KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,PLUS:61,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,NUMPAD_STAR:106,NUMPAD_PLUS:107,NUMPAD_MINUS:109,NUMPAD_DOT:110,NUMPAD_SLASH:111,F1:112,F2:113,F3:114,F4:115,MINUS:173,TILDE:192},b.exports=e},{"../utils/inherit":69,"./Input":39}],42:[function(a,b){var c=a("../utils/inherit"),d=a("./Input"),e=a("./pointer/Pointer"),f=function(a){d.call(this,a),this.pointers={},this.maxPointers=10,this.clickDelay=200,this.doubleClickDelay=300,this.holdDelay=2e3,this.mouse=this.pointers[1]=new e(1,this),this.activePointers=0,a.canvas.addEventListener("pointerdown",this.onPointer.bind(this,"down"),!1),a.canvas.addEventListener("pointerup",this.onPointer.bind(this,"up"),!1),a.canvas.addEventListener("pointermove",this.onPointer.bind(this,"move"),!1),a.canvas.addEventListener("pointerover",this.onPointer.bind(this,"over"),!1),a.canvas.addEventListener("pointerout",this.onPointer.bind(this,"out"),!1),a.canvas.addEventListener("pointercancel",this.onPointer.bind(this,"cancel"),!1),a.canvas.addEventListener("pointerenter",this.onPointer.bind(this,"enter"),!1),a.canvas.addEventListener("pointerleave",this.onPointer.bind(this,"leave"),!1),this.interactiveSprites=[]};c(f,d,{watchSprite:function(a){return this.interactiveSprites.push(a),this},onPointer:function(a,b){var c=b.pointerId,d=this.pointers[c];if(!d){if(!(this._numPointers<this.maxPointers))return;this.pointers[c]=new e(c,this)}d[a]&&d[a](b),this.emit(a,d)},update:function(a){var b;for(var c in this.pointers)b=this.pointers[c],b&&b.update(a);return this}}),b.exports=f,function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&1/0!=d&&d!=-1/0&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1});var a=["PointerDown","PointerUp","PointerMove","PointerOver","PointerOut","PointerCancel","PointerEnter","PointerLeave","pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","pointerenter","pointerleave"],b="touch",c="pen",d="mouse",e={},f=function(a){for(;a&&a.handjs_forcePreventDefault!==!0;)a=a.parentElement;return null!=a},g=function(a,e){var g;if(document.createEvent?(g=document.createEvent("MouseEvents"),g.initMouseEvent(e,!0,!0,window,1,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,null)):(g=document.createEventObject(),g.screenX=a.screenX,g.screenY=a.screenY,g.clientX=a.clientX,g.clientY=a.clientY,g.ctrlKey=a.ctrlKey,g.altKey=a.altKey,g.shiftKey=a.shiftKey,g.metaKey=a.metaKey,g.button=a.button),void 0===g.offsetX&&(void 0!==a.offsetX?(Object&&void 0!==Object.defineProperty&&(Object.defineProperty(g,"offsetX",{writable:!0}),Object.defineProperty(g,"offsetY",{writable:!0})),g.offsetX=a.offsetX,g.offsetY=a.offsetY):void 0!==a.layerX&&(g.offsetX=a.layerX-a.currentTarget.offsetLeft,g.offsetY=a.layerY-a.currentTarget.offsetTop)),g.isPrimary=void 0!==a.isPrimary?a.isPrimary:!0,a.pressure)g.pressure=a.pressure;else{var h=0;void 0!==a.which?h=a.which:void 0!==a.button&&(h=a.button),g.pressure=0==h?0:.5}if(g.rotation=a.rotation?a.rotation:0,g.hwTimestamp=a.hwTimestamp?a.hwTimestamp:0,g.tiltX=a.tiltX?a.tiltX:0,g.tiltY=a.tiltY?a.tiltY:0,g.height=a.height?a.height:0,g.width=a.width?a.width:0,g.preventDefault=function(){void 0!==a.preventDefault&&a.preventDefault()},void 0!==g.stopPropagation){var i=g.stopPropagation;g.stopPropagation=function(){void 0!==a.stopPropagation&&a.stopPropagation(),i.call(this)}}switch(g.POINTER_TYPE_TOUCH=b,g.POINTER_TYPE_PEN=c,g.POINTER_TYPE_MOUSE=d,g.pointerId=a.pointerId,g.pointerType=a.pointerType,g.pointerType){case 2:g.pointerType=g.POINTER_TYPE_TOUCH;break;case 3:g.pointerType=g.POINTER_TYPE_PEN;break;case 4:g.pointerType=g.POINTER_TYPE_MOUSE}a.currentTarget&&f(a.currentTarget)===!0&&g.preventDefault(),a.target?a.target.dispatchEvent(g):a.srcElement.fireEvent("on"+m(e),g)},h=function(a,b){a.pointerId=1,a.pointerType=d,g(a,b)},i=function(a,c,d,e){var f=c.identifier+2;c.pointerId=f,c.pointerType=b,c.currentTarget=d,c.target=d,void 0!==e.preventDefault&&(c.preventDefault=function(){e.preventDefault()}),g(c,a)},j=function(a,b){for(;a&&(!a.__handjsGlobalRegisteredEvents||!a.__handjsGlobalRegisteredEvents[b]);)a=a.parentElement;return null!=a},k=function(a,b,c,d){j(c,a)&&i(a,b,c,d)},l=function(a,b,c,d){a.preventManipulation&&a.preventManipulation();for(var f=0;f<a.changedTouches.length;++f){var g=a.changedTouches[f];c&&(e[g.identifier]=g.target),d?k(b,g,e[g.identifier],a):i(b,g,e[g.identifier],a)}},m=function(a){return a.toLowerCase().replace("pointer","mouse")},n=function(b,c,d){var e;if(d==d.toLowerCase()){var f=a.indexOf(d)-a.length/2;e=c+a[f]}else e=c+d;return e===c+"PointerEnter"&&void 0===b["on"+c.toLowerCase()+"pointerenter"]&&(e=c+"PointerOver"),e===c+"PointerLeave"&&void 0===b["on"+c.toLowerCase()+"pointerleave"]&&(e=c+"PointerOut"),e},o=function(a,b,c,d){if(void 0===a.__handjsRegisteredEvents&&(a.__handjsRegisteredEvents=[]),d){if(void 0!==a.__handjsRegisteredEvents[b])return void a.__handjsRegisteredEvents[b]++;a.__handjsRegisteredEvents[b]=1,a.addEventListener(b,c,!1)}else{if(-1!==a.__handjsRegisteredEvents.indexOf(b)&&(a.__handjsRegisteredEvents[b]--,0!=a.__handjsRegisteredEvents[b]))return;a.removeEventListener(b,c),a.__handjsRegisteredEvents[b]=0}},p=function(a,b,c){if(void 0===a.onpointerdown){if(void 0!==a.onmspointerdown){var d=n(a,"MS",b);return void o(a,d,function(a){g(a,b)},c)}if(void 0!==a.ontouchstart)switch(b){case"pointermove":o(a,"touchmove",function(a){l(a,b)},c);break;case"pointercancel":o(a,"touchcancel",function(a){l(a,b)},c);break;case"pointerdown":case"pointerup":case"pointerout":case"pointerover":case"pointerleave":case"pointerenter":if(a.__handjsGlobalRegisteredEvents||(a.__handjsGlobalRegisteredEvents=[]),c){if(void 0!==a.__handjsGlobalRegisteredEvents[b])return void a.__handjsGlobalRegisteredEvents[b]++;a.__handjsGlobalRegisteredEvents[b]=1}else void 0!==a.__handjsGlobalRegisteredEvents[b]&&(a.__handjsGlobalRegisteredEvents[b]--,a.__handjsGlobalRegisteredEvents[b]<0&&(a.__handjsGlobalRegisteredEvents[b]=0))}switch(b){case"pointerdown":o(a,"mousedown",function(a){h(a,b)},c);break;case"pointermove":o(a,"mousemove",function(a){h(a,b)},c);break;case"pointerup":o(a,"mouseup",function(a){h(a,b)},c);break;case"pointerover":o(a,"mouseover",function(a){h(a,b)},c);break;case"pointerout":o(a,"mouseout",function(a){h(a,b)},c);break;case"pointerenter":void 0===a.onmouseenter?o(a,"mouseover",function(a){h(a,b)},c):o(a,"mouseenter",function(a){h(a,b)},c);break;case"pointerleave":void 0===a.onmouseleave?o(a,"mouseout",function(a){h(a,b)},c):o(a,"mouseleave",function(a){h(a,b)},c)}}},q=function(b){var c=b.prototype?b.prototype.addEventListener:b.addEventListener,d=function(b,d,e){-1!=a.indexOf(b)&&p(this,b,!0),void 0===c?this.attachEvent("on"+m(b),d):c.call(this,b,d,e)};b.prototype?b.prototype.addEventListener=d:b.addEventListener=d},r=function(b){var c=b.prototype?b.prototype.removeEventListener:b.removeEventListener,d=function(b,d,e){-1!=a.indexOf(b)&&p(this,b,!1),void 0===c?this.detachEvent(m(b),d):c.call(this,b,d,e)};b.prototype?b.prototype.removeEventListener=d:b.removeEventListener=d};q(HTMLElement),q(document),q(HTMLBodyElement),q(HTMLDivElement),q(HTMLImageElement),q(HTMLUListElement),q(HTMLAnchorElement),q(HTMLLIElement),q(HTMLTableElement),window.HTMLSpanElement&&q(HTMLSpanElement),window.HTMLCanvasElement&&q(HTMLCanvasElement),window.SVGElement&&q(SVGElement),r(HTMLElement),r(document),r(HTMLBodyElement),r(HTMLDivElement),r(HTMLImageElement),r(HTMLUListElement),r(HTMLAnchorElement),r(HTMLLIElement),r(HTMLTableElement),window.HTMLSpanElement&&r(HTMLSpanElement),window.HTMLCanvasElement&&r(HTMLCanvasElement),window.SVGElement&&r(SVGElement),void 0!==window.ontouchstart&&(window.addEventListener("touchstart",function(a){for(var b=0;b<a.changedTouches.length;++b){var c=a.changedTouches[b];e[c.identifier]=c.target,k("pointerenter",c,c.target,a),k("pointerover",c,c.target,a),k("pointerdown",c,c.target,a)}}),window.addEventListener("touchend",function(a){for(var b=0;b<a.changedTouches.length;++b){var c=a.changedTouches[b],d=e[c.identifier];k("pointerup",c,d,a),k("pointerout",c,d,a),k("pointerleave",c,d,a)}}),window.addEventListener("touchmove",function(a){for(var b=0;b<a.changedTouches.length;++b){var c=a.changedTouches[b],d=document.elementFromPoint(c.clientX,c.clientY),f=e[c.identifier];f!==d&&(f&&(k("pointerout",c,f,a),f.contains(d)||k("pointerleave",c,f,a)),d&&(k("pointerover",c,d,a),d.contains(f)||k("pointerenter",c,d,a)),e[c.identifier]=d)}})),void 0===navigator.pointerEnabled&&(navigator.pointerEnabled=!0,navigator.msPointerEnabled&&(navigator.maxTouchPoints=navigator.msMaxTouchPoints)),document.styleSheets&&document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){var a=function(a){return a.replace(/^\s+|\s+$/,"")},b=function(b){for(var c=new RegExp(".+?{.*?}","m"),d=new RegExp(".+?{","m");""!=b;){var e=c.exec(b);if(!e)break;var f=e[0];b=a(b.replace(f,""));var g=a(d.exec(f)[0].replace("{",""));if(-1!=f.replace(/\s/g,"").indexOf("touch-action:none"))for(var h=document.querySelectorAll(g),i=0;i<h.length;i++){var j=h[i];void 0!==j.style.msTouchAction?j.style.msTouchAction="none":j.handjs_forcePreventDefault=!0}}};try{for(var c=0;c<document.styleSheets.length;c++){var d=document.styleSheets[c];if(void 0!=d.href){var e=new XMLHttpRequest;e.open("get",d.href,!1),e.send();var f=e.responseText.replace(/(\n|\r)/g,"");b(f)}}}catch(g){}for(var h=document.getElementsByTagName("style"),c=0;c<h.length;c++){var i=h[c],j=a(i.innerHTML.replace(/(\n|\r)/g,""));b(j)}},!1)}()},{"../utils/inherit":69,"./Input":39,"./pointer/Pointer":45}],43:[function(a,b){var c=a("../../utils/inherit"),d=a("../Input"),e=function(){d.call(this),this.threshold=.4,this.buttons={};for(var a in e.BUTTON)this.buttons[e.BUTTON[a]]={code:e.BUTTON[a],name:a,down:!1,value:0}};c(e,d,{pollStatus:function(a){for(var b=0,c=a.buttons.length;c>b;++b){var d=a.buttons[b]>this.threshold,e=this.buttons[b];e.value=a.buttons[b],e.down!==d&&(e.down=d,this.emit(b,e))}}}),e.BUTTON={FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SELECT:8,START:9,LEFT_ANALOGUE_STICK:10,RIGHT_ANALOGUE_STICK:11,PAD_UP:12,PAD_DOWN:13,PAD_LEFT:14,PAD_RIGHT:15,SYSTEM_MENU:16},e.getGpButtonName=function(a){for(var b in e.BUTTON)if(e.BUTTON[b]===a)return b;return""},b.exports=e},{"../../utils/inherit":69,"../Input":39}],44:[function(a,b){var c=a("../../utils/inherit"),d=a("../Input"),e=function(){d.call(this),this.threshold=.5,this.axes={};for(var a in e.AXIS)this.axes[e.AXIS[a]]={code:e.AXIS[a],name:a,value:0}};c(e,d,{pollStatus:function(a){for(var b=0,c=a.axes.length;c>b;++b){var d=a.axes[b],e=this.axes[b];e.value=Math.abs(d)>=this.threshold?d:0,this.emit(b,e)}}}),e.AXIS={LEFT_ANALOGUE_HOR:0,LEFT_ANALOGUE_VERT:1,RIGHT_ANALOGUE_HOR:2,RIGHT_ANALOGUE_VERT:3},e.getGpAxisName=function(a){for(var b in e.AXIS)if(e.AXIS[b]===a)return b;return""},b.exports=e},{"../../utils/inherit":69,"../Input":39}],45:[function(a,b){var c=a("../Input"),d=a("../../math/Vector"),e=a("../../utils/Clock"),f=a("../../utils/inherit"),g=function(a,b){c.call(this),this.id=a,this.manager=b,this.game=b.game,this.active=!1,this.mouse=1===a,this.clock=new e,this.button=null,this.type=null,this._holdSent=!1,this.hitSprites=[],this.position=new d,this.positionDown=new d};f(g,c,{down:function(a){this.originalEvent=a,this.timeDown=this.clock.now(),this.timeHold=0,this._holdSent=!1,this.move(a),this.positionDown.copy(this.position),this.button=a.button,this.type=a.pointerType,this.active||(this.active=!0,this.manager.activePointers++);for(var b=0;b<this.hitSprites.length;++b){var c=this.hitSprites[b];c.__isDown=!0,c.emit("pointerdown",this)}},up:function(a){var b;this.originalEvent=a,this.timeUp=this.clock.now(),this.timeHold=this.timeUp-this.timeDown,this.timeHold>=0&&this.timeHold<=this.manager.clickDelay&&(b=this.timeUp-this.previousClickTime<=this.manager.doubleClickDelay?"pointerdoubleclick":"pointerclick",this.previousClickTime=this.timeUp),this.mouse||(this.active=!1,this.manager.activePointers--);for(var c=0;c<this.hitSprites.length;++c){var d=this.hitSprites[c];d.__isDown&&(d.emit("pointerup",this),d.emit(b,this)),d.__isDown=!1}},move:function(a){this.originalEvent=a,this.button=a.button,this.type=a.pointerType;var b=this.manager.game.canvas.getBoundingClientRect();this.position.set((a.clientX-b.left)*(this.manager.game.width/b.width),(a.clientY-b.top)*(this.manager.game.height/b.height));for(var c=0;c<this.hitSprites.length;++c)this.hitSprites[c].emit("pointermove",this)},leave:function(a){this.move(a);for(var b=0;b<this.hitSprites.length;++b){var c=this.hitSprites[b];c.__isOver&&(c.__isOver=!1,c.emit("pointerout",this))}},update:function(){if(this.active){this.timeHold+=this.clock.now()-this.timeDown;var a=this.timeHold>=this.manager.holdDelay,b=this;this.checkHits(function(c){a&&c.__isDown&&c.emit("pointerhold",b)})}},hitTest:function(a){if(!a.worldVisible)return!1;var b=a.worldTransform,c=b.a,d=b.b,e=b.tx,f=b.c,g=b.d,h=b.ty,i=1/(c*g+d*-f),j=g*i*this.position.x+-d*i*this.position.y+(h*d-e*g)*i,k=c*i*this.position.y+-f*i*this.position.x+(-h*c+e*f)*i;if(a.hitArea&&a.hitArea.contains)return a.hitArea.contains(j,k);
var l,m=a.texture.frame.width,n=a.texture.frame.height,o=-m*a.anchor.x;return j>o&&o+m>j?(l=-n*a.anchor.y,k>l&&l+n>k):!1},checkHits:function(a){this.hitSprites.length=0;for(var b,c=0;c<this.manager.interactiveSprites.length;++c)b=this.manager.interactiveSprites[c],this.hitTest(b)?(this.hitSprites.push(b),a&&a(b),b.__isOver||(b.emit("pointerover",this),b.__isOver=!0)):b.__isOver&&(b.emit("pointerout",this),b.__isOver=!1)},getLocalPosition:function(a){var b=a.worldTransform,c=b.a,e=b.b,f=b.tx,g=b.c,h=b.d,i=b.ty,j=1/(c*h+e*-g);return new d(h*j*this.position.x+-e*j*this.position.y+(i*e-f*h)*j,c*j*this.position.y+-g*j*this.position.x+(-i*c+f*g)*j)}}),g.TYPE={TOUCH:"touch",PEN:"pen",MOUSE:"mouse"},b.exports=g},{"../../math/Vector":47,"../../utils/Clock":62,"../../utils/inherit":69,"../Input":39}],46:[function(a,b){var c=a("../utils/utils"),d=a("../utils/inherit"),e=a("../utils/support"),f=a("../utils/EventEmitter"),g=a("../constants"),h=function(a){f.call(this),this.game=a,this.keys=[],this.assets={},this.total=0,this.done=0,this.isLoading=!1,this.hasLoaded=!1,this.progress=0,this.crossOrigin="",this.baseUrl=""};d(h,Object,{hasKey:function(a){return!!this.assets[a]},reset:function(){return this.progress=0,this.total=0,this.done=0,this.hasLoaded=!1,this.isLoading=!1,this.assets={},this.keys.length=0,this},add:function(a,b,c,d){var e={type:a,key:b,url:c,image:null,data:null,error:!1,loaded:!1};if(void 0!==d)for(var f in d)e[f]=d[f];return this.assets[b]=e,this.keys.push(b),this.total++,this},image:function(a,b,c){return(c||!this.hasKey(a))&&this.add("image",a,b),this},text:function(a,b,c){return(c||!this.hasKey(a))&&this.add("text",a,b),this},spritesheet:function(a,b,c,d,e,f){return(f||!this.hasKey(a))&&this.add("spritesheet",a,b,{frameWidth:c,frameHeight:d,numFrames:e}),this},audio:function(a,b,c){return(c||!this.hasKey(a))&&this.add("audio",a,b),this},tilemap:function(a,b,c,d,e){if(e||!this.hasKey(a)){if(d||(d=g.FILE_FORMAT.JSON),"string"==typeof c)switch(d){case g.FILE_FORMAT.JSON:c=JSON.parse(c);break;case g.FILE_FORMAT.XML:c=g.utils.parseXML(c);break;case g.FILE_FORMAT.CSV:}this.add("tilemap",a,b,{data:c,format:d})}return this},bitmapFont:function(a,b,d,e,f,h){if(h||!this.hasKey(a)){if(f||(f=g.FILE_FORMAT.XML),"string"==typeof e)switch(f){case g.FILE_FORMAT.XML:e=c.parseXML(e);break;case g.FILE_FORMAT.JSON:e=JSON.parse(e)}this.add("bitmapfont",a,b,{dataUrl:d,data:e,format:f})}return this},atlasJSONArray:function(a,b,c,d){return this.atlas(a,b,c,d,g.ATLAS_FORMAT.JSON_ARRAY)},atlasJSONHash:function(a,b,c,d){return this.atlas(a,b,c,d,g.ATLAS_FORMAT.JSON_HASH)},atlasXML:function(a,b,c,d){return this.atlas(a,b,c,d,g.ATLAS_FORMAT.XML_STARLING)},atlas:function(a,b,d,e,f,h){if(h||!this.hasKey(a)){if(f||(f=g.ATLAS_FORMAT.JSON_ARRAY),"string"==typeof e)switch(f){case g.ATLAS_FORMAT.XML_STARLING:e=c.parseXML(e);break;case g.ATLAS_FORMAT.JSON_ARRAY:case g.ATLAS_FORMAT.JSON_HASH:e=JSON.parse(e)}this.add("textureatlas",a,b,{dataUrl:d,data:e,format:f})}return this},start:function(){if(!this.isLoading){if(this.progress=0,this.hasLoaded=!1,this.isLoading=!0,this.emit("start",this.keys.length),this.keys.length>0)for(;this.keys.length>0;)this.loadFile();else this.isLoading=!1,this.progress=100,this.hasLoaded=!0,this.emit("complete");return this}},loadFile:function(){var a=this.assets[this.keys.shift()],b=this;switch(a.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":a.image=new Image,a.image.name=a.key,a.image.addEventListener("load",this.fileComplete.bind(this,a.key),!1),a.image.addEventListener("error",this.fileError.bind(this,a.key),!1),a.image.crossOrigin=void 0!==a.crossOrigin?a.crossOrigin:this.crossOrigin,a.image.src=this.baseUrl+a.url;break;case"tilemap":c.ajax({url:this.baseUrl+a.url,dataType:this._getFormatAjaxType(a.format),load:function(c){a.data=c,b.fileComplete(a.key)},error:function(c){b.fileError(a.key,c)}});break;case"audio":a.url=this.getAudioUrl(a.url),a.url?e.webAudio?c.ajax({url:this.baseUrl+a.url,dataType:"arraybuffer",load:function(c){a.data=c,b.fileComplete(a.key)},error:function(c){b.fileError(a.key,c)}}):e.htmlAudio&&(a.data=new Audio,a.data.name=a.key,a.data.preload="auto",a.data.src=this.baseUrl+a.url,a.data.addEventListener("error",a._bndError=this.fileError.bind(this,a.key),!1),a.data.addEventListener("canplaythrough",a._bndComplete=this.fileComplete.bind(this,a.key),!1),a.data.load()):this.fileError(a.key,"No supported audio URL could be determined!");break;case"text":c.ajax({url:this.baseUrl+a.url,dataType:"text",load:function(c){a.data=c,b.fileComplete(a.key)},error:function(c){b.fileError(a.key,c)}})}return this},getAudioUrl:function(a){for(var b=0,c=a.length;c>b;++b){var d=a[b],f=d.match(/.+\.([^?]+)(\?|$)/);if(f=f&&f.length>=2?f[1]:d.match(/data\:audio\/([^?]+);/)[1],e.codec&&e.codec[f])return d}return!1},fileError:function(a,b){this.assets[a].loaded=!0,this.assets[a].error=b,this.fileDone(a,b)},fileComplete:function(a){if(!this.assets[a])return c.warn("fileComplete key is invalid!",a);this.assets[a].loaded=!0;var b=this.assets[a],d=!0,f=this;switch(b.type){case"image":this.game.cache.addImage(b);break;case"spritesheet":this.game.cache.addSpriteSheet(b);break;case"tilemap":b.baseUrl=b.url.replace(/[^\/]*$/,""),b.numImages=b.numLoaded=0,b.images={},b.format===g.FILE_FORMAT.JSON?(d=!1,this._loadJsonTilesets(b)):b.format===g.FILE_FORMAT.XML&&(d=!1,this._loadXmlTilesets(b));break;case"textureatlas":d=!1,this._dataget(b,function(){f.game.cache.addTextureAtlas(b)});break;case"bitmapfont":d=!1,this._dataget(b,function(){f.game.cache.addBitmapFont(b)});break;case"audio":e.webAudio?(b.webAudio=!0,b.decoded=!1):(b.data.removeEventListener("error",b._bndError),b.data.removeEventListener("canplaythrough",b._bndComplete)),this.game.cache.addAudio(b);break;case"text":this.game.cache.addText(b)}d&&this.fileDone(b.key)},fileDone:function(a,b){this.done++,this.progress=Math.round(this.done/this.total*100),this.emit("progress",this.progress),b&&(c.warn('Error loading file "'+a+'", error received:',b),this.emit("error",b,a)),this.progress>=100&&(this.progress=100,this.hasLoaded=!0,this.isLoading=!1,this.emit("complete"))},_getFormatAjaxType:function(a){switch(a){case g.ATLAS_FORMAT.JSON_ARRAY:case g.ATLAS_FORMAT.JSON_HASH:case g.FILE_FORMAT.JSON:return"json";case g.ATLAS_FORMAT.XML_STARLING:case g.FILE_FORMAT.XML:return"xml";case g.FILE_FORMAT.CSV:return"text"}},_dataget:function(a,b){var d=this;a.dataUrl?c.ajax({url:this.baseUrl+a.dataUrl,dataType:this._getFormatAjaxType(a.format),load:function(c){a.data=c,b&&b(),d.fileDone(a.key)},error:function(b){d.fileError(a.key,b)}}):setTimeout(b,1)},_loadJsonTilesets:function(a){for(var b=a.data,c=0,d=b.tilesets.length;d>c;++c){var e=b.tilesets[c];if(e.image)a.numImages++,a.images[e.image]=this._getTilesetImage(a,e.image);else if(e.tiles)for(var f in e.tiles)a.numImages++,a.images[e.tiles[f].image]=this._getTilesetImage(a,e.tiles[f].image)}},_loadXmlTilesets:function(a){for(var b=a.data,c=b.getElementsByTagName("tileset"),d=0,e=c.length;e>d;++d){var f=c[d],g=f.getElementsByTagName("image")[0];if(g){a.numImages++;var h=g.attributes.getNamedItem("source").nodeValue;a.images[h]=this._getTilesetImage(a,h)}}},_getTilesetImage:function(a,b){var c=new Image;return c.addEventListener("load",this._onTilesetLoaded.bind(this,a),!1),c.addEventListener("error",this._onTilesetError.bind(this,a),!1),c.crossOrigin=void 0!==a.crossOrigin?a.crossOrigin:this.crossOrigin,c.src=this.baseUrl+a.baseUrl+b,c},_onTilesetLoaded:function(a){a.numLoaded++,a.numImages===a.numLoaded&&(this.game.cache.addTilemap(a),this.fileDone(a.key))},_onTilesetError:function(a,b){a.error=b,a.numLoaded++,a.numImages===a.numLoaded&&this.fileDone(a.key,b)}}),b.exports=h},{"../constants":11,"../utils/EventEmitter":64,"../utils/inherit":69,"../utils/support":70,"../utils/utils":71}],47:[function(a,b){var c=a("../utils/inherit"),d=a("./math"),e=function(a,b){this.x=a||0,this.y=b||0};c(e,Object,{set:function(a,b){return this.x=a,this.y=b,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new RangeError("index is out of range: "+a)}return this},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new RangeError("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this},floor:function(){return this.x=d.floor(this.x),this.y=d.floor(this.y),this},ceil:function(){return this.x=d.ceil(this.x),this.y=d.ceil(this.y),this},round:function(){return this.x=d.round(this.x),this.y=d.round(this.y),this},add:function(a){return this.x+=a.x,this.y+=a.y,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScalar:function(a){return this.x+=a,this.y+=a,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this},divideScalar:function(a){return 0!==a?(this.x/=a,this.y/=a):this.set(0,0),this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this},negate:function(){return this.multiplyScalar(-1)},project:function(a){var b=this.dot(a)/a.lengthSq();return this.x=b*a.x,this.y=b*a.y,this},projectN:function(a){var b=this.dot(a);return this.x=b*a.x,this.y=b*a.y,this},reflect:function(a){var b=this.x,c=this.y;return this.project(a).multiplyScalar(2),this.x-=b,this.y-=c,this},reflectN:function(a){var b=this.x,c=this.y;return this.projectN(a).multiplyScalar(2),this.x-=b,this.y-=c,this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.dot(this)},length:function(){return d.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return d.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this},perp:function(){var a=this.x;return this.x=this.y,this.y=-a,this},rotate:function(a,b){var c=b.distanceTo(this);return this.set(b.x+c*d.cos(a),b.y+c*d.sin(a))},equals:function(a){return a.x===this.x&&a.y===this.y},toArray:function(){return[this.x,this.y]},clone:function(){return new e(this.x,this.y)}}),e.ZERO=new e,b.exports=e},{"../utils/inherit":69,"./math":48}],48:[function(a,b){var c=a("./random"),d=a("pixi.js"),e={DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,rand:c,Matrix:d.Matrix,floor:Math.floor,ceil:Math.ceil,abs:Math.abs,sqrt:Math.sqrt,min:Math.min,max:Math.max,round:Math.round,clamp:function(a,b,c){return e.max(b,e.min(c,a))},truncate:function(a){return a>0?e.floor(a):e.ceil(a)},snap:function(a,b,c){return 0===b?a:(c=c||0,a-=c,a=b*e.round(a/b),c+a)},snapFloor:function(a,b,c){return 0===b?a:(c=c||0,a-=c,a=b*e.floor(a/b),c+a)},snapCeil:function(a,b,c){return 0===b?a:(c=c||0,a-=c,a=b*e.ceil(a/b),c+a)},radiansToDegrees:function(a){return a*e.RAD_TO_DEG},degreesToRadians:function(a){return a*e.DEG_TO_RAD},angleBetween:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)}};b.exports=e},{"./random":49,"pixi.js":6}],49:[function(a,b){var c=a("../utils/support"),d="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz",e={_x:0,_y:0,_nextX:function(){return 36969*(65535&this._x)+(this._x>>16)},_nextY:function(){return 18273*(65535&this._y)+(this._y>>16)},seed:function(a,b,c){this._seed=arguments,null==b&&null==c?(this._x=3253*a,this._y=this._nextX()):null==c?(this._x=2549*a+3571*b,this._y=2549*b+3571*a):(this._x=2549*a+3571*b+3253*c,this._y=3253*a+2549*b+3571*c)},next:function(){return 0===this._x&&(this._x=-1),0===this._y&&(this._y=-1),this._x=this._nextX(),this._y=this._nextY(),((this._x<<16)+(65535&this._y))/4294967295+.5},bool:function(a){return void 0===a&&(a=50),0>=a?!1:a>=100?!0:100*e.next()<a},"int":function(a,b){return void 0!==a&&a===b?a:(a=a||0,b=b||100,Math.floor(e.next()*(b-a+1)+a))},real:function(a,b){return void 0!==a&&a===b?a:(a=a||0,b=b||1,e.next()*(b-a)+a)},sign:function(a){return e.bool(a)?1:-1},string:function(a){a=a||16;for(var b="",c=0;a>c;++c)b+=d.charAt(Math.floor(e.next()*d.length));return b},uuid:function(){var a=e.bytes(e.__uuidBytes);a[6]=15&a[6]|64,a[8]=63&a[8]|128;var b=0,c=e.__byteToHex;return c[a[b++]]+c[a[b++]]+c[a[b++]]+c[a[b++]]+"-"+c[a[b++]]+c[a[b++]]+"-"+c[a[b++]]+c[a[b++]]+"-"+c[a[b++]]+c[a[b++]]+"-"+c[a[b++]]+c[a[b++]]+c[a[b++]]+c[a[b++]]+c[a[b++]]+c[a[b++]]},__uuidBytes:new Uint8Array(16),__byteToHex:function(){for(var a=[],b={},c=0;256>c;c++)a[c]=(c+256).toString(16).substr(1),b[a[c]]=c;return a}(),bytes:function(a){return a=a||(c.typedArrays?new Uint8Array(16):new Array(16)),window.crypto.getRandomValues(a),a},element:function(a,b,c){return a&&a.length?1===a.length?a[0]:((!b||0>b)&&(b=b||0),(!c||0>c)&&(c=a.length-1),a[e.int(b,c)]):null}};e.random=e.next,e.seed(Math.floor(Date.now()*Math.random())),e._getRandomValuesTyped=function(a){for(var b,c=a.buffer,d=c.byteLength,f=new Uint8Array(c),g=0;d>g;++g)0===(3&g)&&(b=4294967296*e.next()),f[g]=b>>>((3&g)<<3)&255;return a},e._getRandomValuesArray=function(a){for(var b=0;b<a.length;++b)a[b]=4294967296*e.next();return a},c.crypto||(window.crypto=window.crypto||{},window.crypto.getRandomValues=c.typedArrays?e._getRandomValuesTyped:e._getRandomValuesArray),b.exports=e},{"../utils/support":70}],50:[function(a,b){var c=a("../display/Sprite"),d=a("../display/Texture"),e=a("../display/SpriteBatch"),f=a("../math/Vector"),g=a("../math/math"),h=a("../utils/inherit"),i=a("../constants"),j=function(a,b){e.call(this),this.state=a,this.name=b,this.maxParticles=100,this.width=0,this.height=0,this.lifespan=2e3,this.minSpeed=new f(-100,-100),this.maxSpeed=new f(100,100),this.minScale=1,this.maxScale=1,this.minRotation=-2*Math.PI,this.maxRotation=2*Math.PI,this.delay=100,this.active=!1,this.gravity=new f(0,9.87),this._rate=0,this._total=0,this._emitted=0,this._timer=0,this._particle=null,this._textures=null,this._pool=[]};h(j,e,{start:function(a,b,c,d){if(this.active=!0,this.lifespan=a||2e3,this.delay=d||250,this._rate=b||1,this._total=c||100,this._timer=0,1/0===this._rate){this.active=!1;for(var e=0;e<this._total;++e)this.emitParticle()}return this},stop:function(){return this.active=!1,this},setup:function(a,b){return void 0===b&&(b=i.DIRECTION.ALL),a instanceof d?(this._particle=new c(a),this._textures=[a]):Array.isArray(a)?(this._particle=new c(a[0]),this._textures=a):(this._particle=a,this._textures=[a.texture]),this},_get:function(){if(this._emitted>=this._total||this._emitted>this.maxParticles)return null;var a=this._pool.pop();return a||(a=this._particle.clone()),a.setTexture(g.rand.element(this._textures)),a.visible=!0,this.addChild(a),this._emitted++,a},_free:function(a){a.visible=!1,this._pool.push(a),this.removeChild(a),this._emitted--},emitParticle:function(){var a=this._get();if(a)return a.setPosition(g.rand.int(0,this.width),g.rand.int(0,this.height)),a.scale.x=a.scale.y=g.rand.real(this.minScale,this.maxScale),a.lifespan=this.lifespan,a.setVelocity(g.rand.int(this.minSpeed.x,this.maxSpeed.x),g.rand.int(this.minSpeed.y,this.maxSpeed.y)),this},update:function(a){for(var b=1e3*a,c=0;c<this.children.length;++c){var d=this.children[c];d.lifespan-=b,d.position.x+=(d._velocity.x+=this.gravity.x)*a,d.position.y+=(d._velocity.y+=this.gravity.y)*a,d.lifespan<=0&&(this.emit("particle.expire",d),this._free(d))}if(this.active&&(this._timer+=b,this._timer>=this.delay)){this._timer-=this.delay;for(var e=0;e<this._rate;++e)this.emitParticle()}}}),b.exports=j},{"../constants":11,"../display/Sprite":19,"../display/SpriteBatch":20,"../display/Texture":21,"../math/Vector":47,"../math/math":48,"../utils/inherit":69}],51:[function(a,b){var c=a("./ParticleEmitter"),d=a("../display/Container"),e=a("../utils/inherit"),f=function(a){d.call(this),this.state=a,this.emitters={},this.nextId=0};e(f,d,{add:function(a){var b;return b="string"==typeof a?new c(this.state,a):"function"==typeof a?new a(this.state):a,b.name||(b.name="emitter_"+this.nextId++),this.emitters[b.name]=b,this.addChild(b),b},remove:function(a){return"string"==typeof a&&(a=this.emitters[a]),a.parent&&a.parent.removeChild(a),delete this.emitters[a.name],this},updateTransform:function(){d.prototype.updateTransform.apply(this,arguments);for(var a=this.state.game.timings.lastDelta,b=0,c=this.children.length;c>b;++b){var e=this.children[b];e.update&&e.update(a)}}}),b.exports=f},{"../display/Container":16,"../utils/inherit":69,"./ParticleEmitter":50}],52:[function(a,b){var c=a("../geom/Rectangle"),d=a("../geom/Circle"),e=a("../geom/Polygon"),f=a("../math/Vector"),g=a("../tilemap/Tile"),h=a("../math/math"),i=a("../utils/inherit"),j=a("chipmunk"),k=function(a,b){b=b||{},b.gravity=b.gravity instanceof f?b.gravity:new f(0,9.87),b.iterations=b.iterations||10,b.sleepTimeThreshold=void 0!==b.sleepTimeThreshold?b.sleepTimeThreshold:.5,b.collisionSlop=void 0!==b.collisionSlop?b.collisionSlop:.1,b.stepTime=b.stepTime||1/60,this.state=a,this.stepTime=b.stepTime,this.space=new j.Space,this.gravity=this.space.gravity=b.gravity,this.space.sleepTimeThreshold=b.sleepTimeThreshold,this.space.collisionSlop=b.collisionSlop,this.space.addCollisionHandler(k.COLLISION_TYPE.SPRITE,k.COLLISION_TYPE.SPRITE,this.onCollisionBegin.bind(this),null,this.onCollisionPostSolve.bind(this),this.onCollisionEnd.bind(this)),this.space.addCollisionHandler(k.COLLISION_TYPE.SPRITE,k.COLLISION_TYPE.TILE,this.onCollisionBegin.bind(this),null,this.onCollisionPostSolve.bind(this),this.onCollisionEnd.bind(this)),this.actionQueue=[],this.tickCallbacks=[],this._skip=0,this._updateNum=0,this._paused=!1};i(k,Object,{pause:function(){return this._paused=!0,this},resume:function(){return this._paused=!1,this},skip:function(a){return this._skip+=a,this},skipNext:function(){return this.skip(1)},nextTick:function(a){return this.tickCallbacks.push(a),this},getCollisionType:function(a){return a instanceof g?k.COLLISION_TYPE.TILE:k.COLLISION_TYPE.SPRITE},add:function(a,b){if(!a._phys.active){var c=this._createBody(a),d=this._createShape(a,c);return a._phys.active=!0,this.actionQueue.push(["add",{spr:a,body:c,shape:d},b]),this.act(),a}},addControlBody:function(a,b){var c=a._phys.body;if(!c.isStatic()){var d,e=new j.Body(1/0,1/0),f=new j.PivotJoint(e,c,j.vzero,j.vzero);f.maxBias=0,f.maxForce=1e4,1/0!==c.i&&(d=new j.GearJoint(e,c,0,1),d.errorBias=0,d.maxBias=1.2,d.maxForce=5e4),this.actionQueue.push(["addControl",{spr:a,body:e,pivot:f,gear:d},b]),this.act()}return a},remove:function(a,b){return a&&a._phys.active?(a._phys.active=!1,this.actionQueue.push(["remove",a._phys,b]),this.act(),a):void 0},reindex:function(a,b){return a&&a._phys.active?(this.actionQueue.push(["reindex",a._phys.shape,b]),this.act(),this):void 0},reindexStatic:function(a){return this.actionQueue.push(["reindexStatic",null,a]),this.act(),this},addCustomShape:function(a,b,c,d){if(a&&a._phys.body){var e=this._createShape(a,a._phys.body,b);return e.width=a.width,e.height=a.height,e.sprite=a,e.setSensor(c),e.setElasticity(0),e.setSensor(void 0!==c?c:a.sensor),e.setCollisionType(this.getCollisionType(a)),e.setFriction(a.friction||0),this.actionQueue.push(["addCustomShape",{spr:a,shape:e},d]),this.act(),e}},setMass:function(a,b){return a&&a._phys.body?(a._phys.body.setMass(b),this):void 0},setVelocity:function(a,b){return a?(a._phys.control?a._phys.control.body.setVel(b):a._phys.body&&a._phys.body.setVel(b),this):void 0},setPosition:function(a,b){return a?(a._phys.body&&a._phys.body.setPos(b.clone()),a._phys.control&&a._phys.control.body.setPos(b.clone()),this):void 0},setRotation:function(a,b){return a?(a._phys.control?a._phys.control.body.setAngle(b):a._phys.body&&a._phys.body.setAngle(b),this):void 0},update:function(a){if(!this._paused){for(;this.tickCallbacks.length;)this.tickCallbacks.shift().call(this);if(this._skip)return this._skip--;this.space.step(this.stepTime);var b,c,d=a/this.stepTime,e=this._updateNum++;d>1&&(this.update(a-this.stepTime),d=1),this.space.activeShapes.each(function(a){c=a.body,b=a.sprite,c._updateNum!==e&&(c._updateNum=e,b.position.lerp(c.p,d).round(),b.rotation+=(c.a-b.rotation)*d,b.rotation=h.round(b.rotation),b.emit("physUpdate"))})}},onCollisionBegin:function(a){var b=a.getShapes(),c=b[0].sprite,d=b[1].sprite;return(b[0].sensor||b[1].sensor)&&(c.onCollision(d,a.getNormal(0),b[1],b[0]),d.onCollision(c,a.getNormal(0),b[0],b[1])),!0},onCollisionPostSolve:function(a){var b=a.getShapes(),c=b[0].sprite,d=b[1].sprite;return a.isFirstContact()&&(c.onCollision(d,a.totalImpulse(),b[1],b[0]),d.onCollision(c,a.totalImpulse(),b[0],b[1])),!0},onCollisionEnd:function(a){var b=a.getShapes(),c=b[0].sprite,d=b[1].sprite;return c.onSeparate(d,b[1],b[0]),d.onSeparate(c,b[0],b[1]),!0},act:function(){if(this.space.locked)this.space.addPostStepCallback(this.onPostStep.bind(this));else{var a=this;setTimeout(function(){a.onPostStep()},1)}},onPostStep:function(){for(;this.actionQueue.length;){var a=this.actionQueue.shift(),b=a[0],c=a[1],d=a[2];switch(b){case"add":c.body.setPos(c.spr.position.clone()),c.body.isStatic()||this.space.addBody(c.body),this.space.addShape(c.shape),c.spr._phys.body=c.body,c.spr._phys.shape=c.shape,c.body.sprite=c.spr;break;case"addControl":c.body.setPos(c.spr.position.clone()),this.space.addBody(c.body),this.space.addConstraint(c.pivot),c.gear&&this.space.addConstraint(c.gear),c.spr._phys.control=c,delete c.spr;break;case"addCustomShape":c.spr._phys.customShapes||(c.spr._phys.customShapes=[]),c.spr._phys.customShapes.push(c.shape),this.space.addShape(c.shape);break;case"remove":if(c.body.space&&this.space.removeBody(c.body),c.shape.space&&this.space.removeShape(c.shape),c.control&&(c.control.body.space&&this.space.removeBody(c.control.body),c.control.pivot.space&&this.space.removeConstraint(c.control.pivot),c.control.gear&&c.control.gear.space&&this.space.removeConstraint(c.control.gear)),c.customShapes)for(var e=c.customShapes.length-1;e>-1;--e)this.space.removeShape(c.customShapes[e]);c.body=null,c.shape.sprite=null,c.shape=null,c.customShapes=null;break;case"reindex":this.space.reindexShape(c);break;case"reindexStatic":this.space.reindexStatic()}d&&d.call(this)}},_createBody:function(a){var b=a.mass||1,c=a.inertia||j.momentForBox(b,a.width,a.height)||1/0,d=new j.Body(b,c);return d.nodeIdleTime=1/0===b?1/0:0,d},_createShape:function(a,b,g){var h,i=g||a.hitArea,k=a.anchor?a.anchor.x:0,l=a.anchor?a.anchor.y:0,m=a.width*k,n=a.height*l;if(i)if(i instanceof c){var o=i.x,p=i.x+i.width,q=i.y-a.height,r=q+i.height;o-=m,p-=m,q+=a.height-n,r+=a.height-n,h=new j.BoxShape2(b,new j.BB(o,q,p,r))}else if(i instanceof d){var s=new f(a.width/2-m+i.x,a.height/2-n+i.y);h=new j.CircleShape(b,i.radius,s)}else if(i instanceof e){for(var t=[],u=i.points,v=0;v<u.length;++v){var w=u[v];t.push(w.x-m),t.push(w.y-n)}h=new j.PolyShape(b,j.convexHull(t,null,0),j.vzero)}return h||(h=new j.BoxShape2(b,new j.BB(0,-a.height,a.width,0))),h.width=a.width,h.height=a.height,h.sprite=a,h.setElasticity(a.bounce||a.elasticity||0),h.setSensor(a.sensor),h.setCollisionType(this.getCollisionType(a)),h.setFriction(a.friction||0),h.group=a.shapeGroup||0,h}}),k.COLLISION_TYPE={SPRITE:0,TILE:1},b.exports=k},{"../geom/Circle":34,"../geom/Polygon":36,"../geom/Rectangle":37,"../math/Vector":47,"../math/math":48,"../tilemap/Tile":57,"../utils/inherit":69,chipmunk:1}],53:[function(a,b){var c=a("../math/Vector");b.exports=function(){this._phys={},this.mass=0,this.inertia=0,this._velocity=new c,this.enablePhysics=function(a,b){var c=this;return"function"==typeof a&&(b=a,a=null),a?(this._phys.active?this._phys.system.remove(this,function(){a.add(c,b)}):a.add(this,b),this._phys.system=a):this._phys.system.add(this,b),this},this.disablePhysics=function(a){return this._phys.system&&this._phys.system.remove(this,a),this},this.reindex=function(a){return this._phys.system&&this._phys.system.reindex(this,a),this},this.setMass=function(a){return this._phys.system&&this._phys.system.setMass(this,a),this},this.setVelocity=function(a,b){return b=void 0!==a.y?a.y:b||0,a=void 0!==a.x?a.x:a||0,this._velocity.set(a,b),this._phys.system&&this._phys.system.setVelocity(this,this._velocity),this},this.setRotation=function(a){return this.rotation=a,this._phys.system&&this._phys.system.setRotation(this,a),this},this.setPosition=function(a,b){return b=void 0!==a.y?a.y:b||0,a=void 0!==a.x?a.x:a||0,this.position.set(a,b),this._phys.system&&this._phys.system.setPosition(this,this.position),this},this.onCollision=function(a,b,c,d){this.emit("collision",a,b,c,d)},this.onSeparate=function(a,b,c){this.emit("separate",a,b,c)}}},{"../math/Vector":47}],54:[function(a,b){var c=a("../display/SpriteBatch"),d=a("../utils/ObjectPool"),e=a("../display/Texture"),f=a("../display/Sprite"),g=a("../math/Vector"),h=a("../geom/Rectangle"),i=a("../utils/utils"),j=a("../utils/inherit"),k=a("pixi.js"),l=function(a,b,e){c.call(this),this.dirty=!1,this.font=b,this.monospace=0,this._text=a,this._style={size:null,align:"left"},this.sprites=new d(f,this),this.text=a,this.style=e};j(l,c,{renderText:function(){for(var a=this.font,b=new g,c=null,d=[],e=0,f=[],h=0,i=this._style.size/a.size,j=0;j<this.text.length;++j){var k=this.text.charCodeAt(j),l=this.text.charAt(j);if(/(?:\r\n|\r|\n)/.test(l))f.push(b.x),e=Math.max(e,b.x),h++,b.x=0,b.y+=a.lineHeight,c=null;else{var m=a.chars[k];m&&(c&&m[c]&&(b.x+=m.kerning[c]||0),d.push({texture:m.texture,line:h,code:k,x:b.x+m.xOffset,y:b.y+m.yOffset}),b.x+=this.monospace||m.xAdvance,c=k)}}f.push(b.x),e=Math.max(e,b.x);var n=[],o=this._style.align,p=0;for(j=0;h>=j;++j)p=0,"right"===o?p=e-f[j]:"center"===o&&(p=(e-f[j])/2),n.push(p);var q,r=d.length,s=this.children.length,t=this._style.tint||16777215;for(j=0;r>j;++j)q=s>j?this.children[j]:this.sprites.create(d[j].texture),q.setTexture(d[j].texture),q.position.x=(d[j].x+n[d[j].line])*i,q.position.y=d[j].y*i,q.scale.x=q.scale.y=i,q.tint=t,q.parent||this.addChild(q);for(;this.children.length>r;)q=this.children[this.children.length-1],this.sprites.free(q),this.removeChild(q);this.width=e*i,this.height=(b.y+a.lineHeight)*i},clone:function(){return new l(this._text,this.font,this._style)},updateTransform:function(){this.dirty&&(this.renderText(),this.dirty=!1),c.prototype.updateTransform.call(this)}}),Object.defineProperty(l.prototype,"text",{get:function(){return this._text},set:function(a){this._text=a,this.dirty=!0}}),Object.defineProperty(l.prototype,"style",{get:function(){return this._style},set:function(a){this._style.size=a&&a.size||this._style.size,this._style.align=a&&a.align||this._style.align,this.dirty=!0}}),Object.defineProperty(l.prototype,"size",{get:function(){return this._style.size},set:function(a){this._style.size=a||this._style.size,this.dirty=!0}}),Object.defineProperty(l.prototype,"align",{get:function(){return this._style.align},set:function(a){this._style.align=a||this._style.align,this.dirty=!0}}),l.parseXMLFont=function(a,b,c){var d=c.baseTexture;b.getElementsByTagName("font")||i.warn("Invalid XML for BitmapText.parseXML(), missing <font> tag. Full XML:",b);var f={},g=b.getElementsByTagName("info")[0],j=b.getElementsByTagName("common")[0];f.name=g.attributes.getNamedItem("face").nodeValue,f.size=parseInt(g.attributes.getNamedItem("size").nodeValue,10),f.lineHeight=parseInt(j.attributes.getNamedItem("lineHeight").nodeValue,10),f.chars={};for(var l=b.getElementsByTagName("char"),m=0,n=l.length;n>m;++m){var o=l[m],p=o.attributes,q=parseInt(p.getNamedItem("id").nodeValue,10),r=new h(parseInt(p.getNamedItem("x").nodeValue,10),parseInt(p.getNamedItem("y").nodeValue,10),parseInt(p.getNamedItem("width").nodeValue,10),parseInt(p.getNamedItem("height").nodeValue,10)),s=k.TextureCache[a+"_"+q]=new e(d,r);f.chars[q]={xOffset:parseInt(p.getNamedItem("xoffset").nodeValue,10),yOffset:parseInt(p.getNamedItem("yoffset").nodeValue,10),xAdvance:parseInt(p.getNamedItem("xadvance").nodeValue,10),kerning:{},texture:s}}var t=b.getElementsByTagName("kerning");for(m=0,n=t.length;n>m;++m){var u=t[m],v=u.attributes,w=parseInt(v.getNamedItem("first").nodeValue,10),x=parseInt(v.getNamedItem("second").nodeValue,10),y=parseInt(v.getNamedItem("amount").nodeValue,10);f.chars[x].kerning[w]=y}return k.BitmapText.fonts[f.name]=f,f},b.exports=l},{"../display/Sprite":19,"../display/SpriteBatch":20,"../display/Texture":21,"../geom/Rectangle":37,"../math/Vector":47,"../utils/ObjectPool":66,"../utils/inherit":69,"../utils/utils":71,"pixi.js":6}],55:[function(a,b){var c=a("pixi.js").Text;b.exports=c},{"pixi.js":6}],56:[function(a,b){var c=a("../display/Container"),d=a("../math/Vector"),e=a("../geom/Polygon"),f=a("../geom/Ellipse"),g=a("../geom/Rectangle"),h=a("../utils/utils"),i=a("../utils/inherit"),j=a("../math/math"),k=a("pixi.js"),l=function(a,b){c.call(this,b),this.map=a,this.game=a.game,this.state=a.state,this.name=b.name||"",this.color=b.color,this.properties=b.properties||{},this.objects=b.objects,this.type=b.type||"objectgroup",this.position.x=b.x||0,this.position.y=b.y||0,this.alpha=void 0!==b.opacity?b.opacity:1,this.visible=void 0!==b.visible?b.visible:!0};i(l,c,{getBounds:function(){return this.map.getBounds()},spawn:function(){for(var a=this.game,b=this.objects.length-1;b>=0;--b){var d,e,f,g=this.objects[b],i=h.parseTiledProperties(g.properties)||{};if(i.tileprops={},g.gid?(d=this.parent.getTileset(g.gid),d&&(i.texture=d.getTileTexture(g.gid),i.tileprops=d.getTileProperties(g.gid),i.hitArea||(i.hitArea=i.tileprops.hitArea?i.tileprops.hitArea:d.properties.hitArea))):i.hitArea||(i.hitArea=g.polyline?this._getPolyline(g):g.polygon?this._getPolygon(g):g.ellipse?this._getEllipse(g):this._getRectangle(g)),g.name=g.name||i.name||i.tileprops.name,g.type=g.type||i.type||i.tileprops.type,"string"==typeof i.texture&&(i.texture=a.cache.getTexture(i.texture)),i.texture){i.width=g.width,i.height=g.height,i.zIndex=this.zIndex,f=a.spritepool.create(g.name,i.texture,i),f.name=g.name,f.type=g.type,f.position.x=g.x,f.position.y=g.y,f.mass=i.mass||i.tileprops.mass,f.inertia=i.inertia||i.tileprops.inertia,f.friction=i.friction||i.tileprops.friction,f.sensor=i.sensor||i.tileprops.sensor,f.hitArea=i.hitArea,f.blendMode=i.blendMode||this.properties.blendMode?k.blendModes[i.blendMode||this.properties.blendMode]:k.blendModes.NORMAL;var l=i.anchor||i.tileprops.anchor;f.anchor.y=l?l[1]:1,f.anchor.x=l?l[0]:"isometric"===this.parent.orientation?.5:0,f.mass&&f.enablePhysics(a.physics),i.tileprops&&(i.tileprops.flippedX&&(f.scale.x=-1,f.anchor.x=l?l[0]:1),i.tileprops.flippedY&&(f.scale.y=-1,f.anchor.y=l?l[1]:0),i.tileprops.rotatedCW&&(f.rotation=j.degreesToRadians(45))),(i.animation||i.tileprops.animation)&&f.goto&&f.goto(0,i.animation||i.tileprops.animation).play(),"number"==typeof g.rotation&&f.setRotation(g.rotation)}else f=new c,f.width=g.width,f.height=g.height,f.name=g.name,f.type=g.type,f.rotation=g.rotation,f.position.x=g.x,f.position.y=g.y,f.sensor=!0,f.hitArea=i.hitArea,f.enablePhysics(a.physics);if(f.visible=void 0!==g.visible?!!g.visible:!0,"isometric"===this.parent.orientation){var m=g.x/this.parent.tileSize.x,n=g.y/this.parent.tileSize.y;g.x=m*this.parent.tileSize.x-(n-1)*(this.parent.tileSize.x/2),g.y=n*this.parent.tileSize.y/2+m*this.parent.tileSize.y}e=this._getInteractive(d,i),e&&(f.interactive=e,f.click=this.onObjectEvent.bind(this,"click",f),f.mousedown=this.onObjectEvent.bind(this,"mousedown",f),f.mouseup=this.onObjectEvent.bind(this,"mouseup",f),f.mousemove=this.onObjectEvent.bind(this,"mousemove",f),f.mouseout=this.onObjectEvent.bind(this,"mouseout",f),f.mouseover=this.onObjectEvent.bind(this,"mouseover",f),f.mouseupoutside=this.onObjectEvent.bind(this,"mouseupoutside",f)),f.properties={};for(var o in i.tileprops)f.properties[o]=i.tileprops[o];
for(var p in i)"tileprops"!==p&&(f.properties[p]=i[p]);f._objIndex=b,this.addChild(f)}return this},onObjectEvent:function(a,b,c){this.parent.onObjectEvent(a,b,c)},_getPolygon:function(a){for(var b=[],c=0,f=a.polygon.length;f>c;++c)b.push(new d(a.polygon[c].x,a.polygon[c].y));return new e(b)},_getPolyline:function(a){for(var b=[],c=0,f=a.polyline.length;f>c;++c)b.push(new d(a.polyline[c].x,a.polyline[c].y));return new e(b)},_getEllipse:function(a){return new f(0,0,a.width,a.height)},_getRectangle:function(a){return new g(0,0,a.width,a.height)},_getInteractive:function(a,b){return b.interactive||b.tileprops.interactive||a&&a.properties.interactive||this.properties.interactive||this.parent.properties.interactive},despawn:function(){return c.prototype.destroyAllChildren.call(this)},destroy:function(){this.despawn(),c.prototype.destroy.call(this),this.map=null,this.game=null,this.state=null,this.name=null,this.color=null,this.properties=null,this.objects=null,this.type=null}}),b.exports=l},{"../display/Container":16,"../geom/Ellipse":35,"../geom/Polygon":36,"../geom/Rectangle":37,"../math/Vector":47,"../math/math":48,"../utils/inherit":69,"../utils/utils":71,"pixi.js":6}],57:[function(a,b){var c=a("../display/Sprite"),d=a("../utils/inherit"),e=function(a){c.call(this,a)};d(e,c,{}),b.exports=e},{"../display/Sprite":19,"../utils/inherit":69}],58:[function(a,b){var c=a("../display/SpriteBatch"),d=a("../geom/Rectangle"),e=a("../math/Vector"),f=a("../display/Texture"),g=a("./Tile"),h=a("../math/math"),i=a("../utils/utils"),j=a("../utils/inherit"),k=a("../utils/support"),l=a("pixi.js"),m=function(a,b){c.call(this),this.map=a,this.state=a.state,this.state=a.state,this.tiles=[],this.name=b.name||"",this.size=new e(b.width||0,b.height||0),this.tileIds=k.typedArrays?new Uint32Array(b.data):b.data,this.properties=i.parseTiledProperties(b.properties)||{},this.type=b.type||"tilelayer",this.preRender=b.preRender||this.properties.preRender||this.map.properties.preRender||!1,this.chunkSize=new e(b.chunkSizeX||b.chunkSize||this.properties.chunkSizeX||this.properties.chunkSize||512,b.chunkSizeY||b.chunkSize||this.properties.chunkSizeY||this.properties.chunkSize||512),this.position.x=b.x||0,this.position.y=b.y||0,this.alpha=void 0!==b.opacity?b.opacity:1,this.visible=void 0!==b.visible?b.visible:!0,this._preRendered=!1,this._tilePool=[],this._buffered={left:!1,right:!1,top:!1,bottom:!1},this._panDelta=new e,this._rendered=new d,this.physicsContainer=new c,this.createPhysicalTiles()};j(m,c,{getBounds:function(){return this.map.getBounds()},createPhysicalTiles:function(){for(var a,b,c,d,e,f=this.map.size.x,i=this.map.tileSize.x,j=this.map.tileSize.y,k=0;k<this.tileIds.length;++k)a=this.tileIds[k],c=this.map.getTileset(a),c&&(d=c.getTileProperties(a),d.mass&&(b=c.getTileTexture(a),e=new g(b),this.physicsContainer.addChild(e),e.mass=d.mass,e.hitArea=d.hitArea||c.properties.hitArea,e.setPosition(k%f*i+c.tileoffset.x,h.floor(k/f)*j+c.tileoffset.y+j),e.enablePhysics(this.state.physics)))},render:function(a,b,c,d){if(!this.preRender)return this.tileSize||(this.tileSize=this.map.tileSize),this.clearTiles(),this._renderTiles(a,b,c,d),this;if(this._preRendered)for(var e=this.children.length-1;e>-1;--e)this.children[e].visible=!0;else this._preRender()},_preRender:function(){if(this.visible){this._preRendered=!0,this.tileSize=this.chunkSize.clone();for(var a=this.map,b=a.size.x*a.tileSize.x,c=a.size.y*a.tileSize.y,d=h.ceil(b/this.chunkSize.x),e=h.ceil(c/this.chunkSize.y),f=0;d>f;++f)for(var g=0;e>g;++g){var i=f===d-1?b-f*this.chunkSize.x:this.chunkSize.x,j=g===e-1?c-g*this.chunkSize.y:this.chunkSize.y;this._preRenderChunk(f,g,i,j)}}},_preRenderChunk:function(a,b,c,d){var e=this.map,i=e.tileSize.x,j=e.tileSize.y,k=c/i,l=d/j,m=a*this.chunkSize.x%i,n=b*this.chunkSize.y%j,o=h.floor(a*this.chunkSize.x/i),p=h.floor(b*this.chunkSize.y/j),q=e.size.x,r=e.size.y,s=document.createElement("canvas"),t=s.getContext("2d");s.width=c,s.height=d;for(var u=0;k>u;++u)for(var v=0;l>v;++v)if(q>u+o&&r>v+p){var w,x,y=u+o+(v+p)*q,z=this.tileIds[y],A=e.getTileset(z);A&&(w=A.getTileTexture(z),x=w.frame,t.drawImage(w.baseTexture.source,x.x,x.y,x.width,x.height,u*i-m+A.tileoffset.x,v*j-n+A.tileoffset.y,x.width,x.height))}var B=new g(f.fromCanvas(s));B.setPosition(a*this.chunkSize.x,b*this.chunkSize.y),this.tiles[a]||(this.tiles[a]={}),this.addChild(B),this.tiles[a][b]=B},_renderTiles:function(a,b,c,d){a=h.floor(a/this.map.scaledTileSize.x),b=h.floor(b/this.map.scaledTileSize.y),a=0>a?0:a,b=0>b?0:b,c=h.ceil(c/this.map.scaledTileSize.x)+1,d=h.ceil(d/this.map.scaledTileSize.y)+1,c=a+c>this.map.size.x?this.map.size.x-a:c,d=b+d>this.map.size.y?this.map.size.y-b:d;for(var e=a+c,f=b+d,g=a;e>g;++g)for(var i=b;f>i;++i)this.moveTileSprite(-1,-1,g,i);this._rendered.x=a,this._rendered.y=b,this._rendered.width=c-1,this._rendered.height=d-1,this._buffered.left=this._buffered.right=this._buffered.top=this._buffered.bottom=!1,this._panDelta.x=this.state.world.position.x%this.map.scaledTileSize.x,this._panDelta.y=this.state.world.position.y%this.map.scaledTileSize.y},_freeTile:function(a,b){this.tiles[a]&&this.tiles[a][b]&&(this.clearTile(this.tiles[a][b]),this.tiles[a][b]=null)},clearTiles:function(a){var b;{if(!this.preRender||a){for(this._preRendered=!1,b=this.children.length-1;b>-1;--b)this.clearTile(this.children[b],a);return this.tiles.length=0,this}for(b=this.children.length-1;b>-1;--b)this.children[b].visible=!1}},clearTile:function(a,b){return a.visible=!1,b?this.removeChild(a):this._tilePool.push(a),this},moveTileSprite:function(a,b,c,d){if(this._freeTile(c,d),this._freeTile(a,b),!(0>c||0>d||c>=this.map.size.x||d>=this.map.size.y)){var e,f,h,i,j,k,m=c+d*this.size.x,n=this.tileIds[m],o=this.map.getTileset(n);if(o)return f=o.getTileTexture(n),h=o.getTileProperties(n),j=h.hitArea||o.properties.hitArea,k=this._getInteractive(o,h),i=[c*this.map.tileSize.x+o.tileoffset.x,d*this.map.tileSize.y+o.tileoffset.y],i[1]+=this.map.tileSize.y,e=this._tilePool.pop(),e||(e=new g(f),e.anchor.y=1,this.addChild(e)),e.interactive=k,e.hitArea=j,e.blendMode=h.blendMode||this.properties.blendMode?l.blendModes[h.blendMode||this.properties.blendMode]:l.blendModes.NORMAL,e.setTexture(f),e.setPosition(i[0],i[1]),e.show(),k&&(e.click=this.onTileEvent.bind(this,"click",e),e.mousedown=this.onTileEvent.bind(this,"mousedown",e),e.mouseup=this.onTileEvent.bind(this,"mouseup",e),e.mousemove=this.onTileEvent.bind(this,"mousemove",e),e.mouseout=this.onTileEvent.bind(this,"mouseout",e),e.mouseover=this.onTileEvent.bind(this,"mouseover",e),e.mouseupoutside=this.onTileEvent.bind(this,"mouseupoutside",e)),this.tiles[c]||(this.tiles[c]=[]),this.tiles[c][d]=e,e}},onTileEvent:function(a,b,c){this.map.onTileEvent(a,b,c)},_getInteractive:function(a,b){return b.interactive||a&&a.properties.interactive||this.properties.interactive||this.map.properties.interactive},pan:function(a,b){if(!this.preRender){this._panDelta.x+=a,this._panDelta.y+=b;var c=this.map.scaledTileSize.x,d=this.map.scaledTileSize.y;for(a>0&&!this._buffered.left?this._renderLeft(this._buffered.left=!0):0>a&&!this._buffered.right&&this._renderRight(this._buffered.right=!0),b>0&&!this._buffered.top?this._renderUp(this._buffered.top=!0):0>b&&!this._buffered.bottom&&this._renderDown(this._buffered.bottom=!0);this._panDelta.x>=c;)this._renderLeft(),this._panDelta.x-=c;for(;this._panDelta.x<=-c;)this._renderRight(),this._panDelta.x+=c;for(;this._panDelta.y>=d;)this._renderUp(),this._panDelta.y-=d;for(;this._panDelta.y<=-d;)this._renderDown(),this._panDelta.y+=d}},_renderLeft:function(a){for(var b=0;b<this._rendered.height+1;++b)this.moveTileSprite(a?-1:this._rendered.right,a?-1:this._rendered.top+b,this._rendered.left-1,this._rendered.top+b);this._rendered.x--,a&&this._rendered.width++},_renderRight:function(a){for(var b=0;b<this._rendered.height+1;++b)this.moveTileSprite(a?-1:this._rendered.left,a?-1:this._rendered.top+b,this._rendered.right+1,this._rendered.top+b);a||this._rendered.x++,a&&this._rendered.width++},_renderUp:function(a){for(var b=0;b<this._rendered.width+1;++b)this.moveTileSprite(a?-1:this._rendered.left+b,a?-1:this._rendered.bottom,this._rendered.left+b,this._rendered.top-1);this._rendered.y--,a&&this._rendered.height++},_renderDown:function(a){for(var b=0;b<this._rendered.width+1;++b)this.moveTileSprite(a?-1:this._rendered.left+b,a?-1:this._rendered.top,this._rendered.left+b,this._rendered.bottom+1);a||this._rendered.y++,a&&this._rendered.height++},destroy:function(){c.prototype.destroy.call(this),this.clearTiles(!0),this.state=null,this.name=null,this.size=null,this.tileIds=null,this.properties=null,this.type=null,this.position.x=null,this.position.y=null,this.alpha=null,this.visible=null,this.preRender=null,this.chunkSize=null,this._preRendered=null,this._tilePool=null,this._buffered=null,this._panDelta=null,this._rendered=null}}),b.exports=m},{"../display/SpriteBatch":20,"../display/Texture":21,"../geom/Rectangle":37,"../math/Vector":47,"../math/math":48,"../utils/inherit":69,"../utils/support":70,"../utils/utils":71,"./Tile":57,"pixi.js":6}],59:[function(a,b){var c=a("../display/Container"),d=a("./ObjectGroup"),e=a("../display/Sprite"),f=a("../math/Vector"),g=a("../geom/Rectangle"),h=a("./Tilelayer"),i=a("./Tileset"),j=a("../utils/utils"),k=a("../math/math"),l=a("../utils/inherit"),m=function(a,b,k){c.call(this,b),this.state=a,this.game=a.game,this.properties=j.parseTiledProperties(b.properties)||{},this.scale.x=this.properties.scale||1,this.scale.y=this.properties.scale||1,this.tileSize=new f(b.tilewidth,b.tileheight),this.size=new f(b.width,b.height),this.orientation=b.orientation,this.version=b.version,this.backgroundColor=b.backgroundColor,this.tilesets=[],this.scaledTileSize=new f(b.tilewidth*this.scale.x,b.tileheight*this.scale.y),this.realSize=new f(this.size.x*this.scaledTileSize.x,this.size.y*this.scaledTileSize.y);for(var l=0,m=b.tilesets.length;m>l;++l){var n=b.tilesets[l];this.tilesets.push(new i(k[n.name],n))}for(var o=0,p=b.layers.length;p>o;++o){var q;switch(b.layers[o].type){case"tilelayer":q=new h(this,b.layers[o]);break;case"objectgroup":q=new d(this,b.layers[o]);break;case"imagelayer":q=new e(b.layers[o])}this.addChild(q)}this._bounds=new g(0,0,this.realSize.x,this.realSize.y);var r=this.game.state.active.world;r.bounds.width=Math.max(r.bounds.width,this.realSize.x),r.bounds.height=Math.max(r.bounds.height,this.realSize.y)};l(m,c,{getBounds:function(){return this.scaledTileSize.set(this.tileSize.x*this.scale.x,this.tileSize.y*this.scale.y),this.realSize.set(this.size.x*this.scaledTileSize.x,this.size.y*this.scaledTileSize.y),this._bounds.width=k.min(this.realSize.x,this.state.game.width),this._bounds.height=k.min(this.realSize.y,this.state.game.height),this._bounds},getTileset:function(a){for(var b=0,c=this.tilesets.length;c>b;++b)if(this.tilesets[b].contains(a))return this.tilesets[b]},destroy:function(){c.prototype.destroy.call(this),this.game=null,this.properties=null,this.tileSize=null,this.size=null,this.orientation=null,this.version=null,this.backgroundColor=null,this.tilesets=null,this.scaledTileSize=null,this.realSize=null},spawnObjects:function(){for(var a=0,b=this.children.length;b>a;++a){var c=this.children[a];"objectgroup"===c.type&&c.spawn()}return this},despawnObjects:function(){for(var a=0,b=this.children.length;b>a;++a){var c=this.children[a];"objectgroup"===c.type&&c.despawn()}return this},clearTiles:function(){for(var a=0,b=this.children.length;b>a;++a){var c=this.children[a];"tilelayer"===c.type&&c.clearTiles()}return this},onTileEvent:function(a,b,c){this.emit("tile."+a,{tile:b,data:c})},onObjectEvent:function(a,b,c){this.emit("object."+a,{object:b,data:c})},findLayer:function(a){for(var b=0,c=this.children.length;c>b;++b){var d=this.children[b];if(d.name===a)return d}},pan:function(a,b){for(var c=0,d=this.children.length;d>c;++c){var e=this.children[c];e.pan&&e.pan(a,b)}return this},render:function(a,b,c,d){a=a||-this.state.world.position.x,b=b||-this.state.world.position.y,c=c||this.game.width,d=d||this.game.height;for(var e=0,f=this.children.length;f>e;++e){var g=this.children[e];g.render&&g.render(a,b,c,d)}return this}}),m.parseXMLMap=function(a){var b=a.getElementsByTagName("map")[0],c={version:parseFloat(b.attributes.getNamedItem("version").nodeValue,10),width:parseInt(b.attributes.getNamedItem("width").nodeValue,10),height:parseInt(b.attributes.getNamedItem("height").nodeValue,10),tilewidth:parseInt(b.attributes.getNamedItem("tilewidth").nodeValue,10),tileheight:parseInt(b.attributes.getNamedItem("tileheight").nodeValue,10),orientation:b.attributes.getNamedItem("orientation").nodeValue,layers:[],properties:{},tilesets:[]},d=0,e=0,f=b.getElementsByTagName("properties");for(d=0,e=f.length;e>d;++d)if(f[d].parentNode===b){f=f.getElementsByTagName("property");for(var g=0;g<f.length;++g)c.properties[f[g].attributes.getNamedItem("name").nodeValue]=f[g].attributes.getNamedItem("value").nodeValue;break}var h=b.childNodes;for(d=0,e=h.length;e>d;++d){var i=h[d];if("layer"===i.nodeName){var j=i,k={type:"tilelayer",name:j.attributes.getNamedItem("name").nodeValue,width:parseInt(j.attributes.getNamedItem("width").nodeValue,10)||c.width,height:parseInt(j.attributes.getNamedItem("height").nodeValue,10)||c.height,visible:j.attributes.getNamedItem("visible")?"1"===j.attributes.getNamedItem("visible").nodeValue:!0,opacity:j.attributes.getNamedItem("opacity")?parseFloat(j.attributes.getNamedItem("opacity").nodeValue,10):1,encoding:"base64",compression:"",rawData:"",data:"",x:0,y:0},l=j.getElementsByTagName("data")[0];if(k.encoding=l.attributes.getNamedItem("encoding").nodeValue,k.rawData=l.firstChild.nodeValue.trim(),l.attributes.getNamedItem("compression")){k.compression=l.attributes.getNamedItem("compression").nodeValue;var n=m._decompressBase64LayerData(k.rawData,k.encoding,k.compression);k.data=new Uint32Array(n.buffer,0,n.length/4)}else if("base64"===k.encoding){var o=m._decodeBase64LayerData(k.rawData);k.data=new Uint32Array(o.buffer,0,o.length/4)}c.layers.push(k)}else if("objectgroup"===i.nodeName){for(var p=i,q={type:"objectgroup",draworder:"topdown",name:p.attributes.getNamedItem("name").nodeValue,width:0,height:0,objects:[],visible:p.attributes.getNamedItem("visible")?"0"===p.attributes.getNamedItem("visible").nodeValue:!0,opacity:p.attributes.getNamedItem("opacity")?parseFloat(p.attributes.getNamedItem("opacity").nodeValue,10):1,x:0,y:0},r=p.getElementsByTagName("object"),s=0;s<r.length;++s){var t=r[s],u={gid:t.attributes.getNamedItem("gid")?parseInt(t.attributes.getNamedItem("gid").nodeValue,10):null,name:t.attributes.getNamedItem("name")?t.attributes.getNamedItem("name").nodeValue:"",type:t.attributes.getNamedItem("type")?t.attributes.getNamedItem("type").nodeValue:"",width:t.attributes.getNamedItem("width")?parseFloat(t.attributes.getNamedItem("width").nodeValue,10):0,height:t.attributes.getNamedItem("height")?parseFloat(t.attributes.getNamedItem("height").nodeValue,10):0,rotation:t.attributes.getNamedItem("rotation")?parseFloat(t.attributes.getNamedItem("rotation").nodeValue,10):0,visible:t.attributes.getNamedItem("visible")?"1"===t.attributes.getNamedItem("visible").nodeValue:!0,x:parseFloat(t.attributes.getNamedItem("x").nodeValue,10),y:parseFloat(t.attributes.getNamedItem("y").nodeValue,10),properties:{}};null===u.gid&&delete u.gid;var v=t.getElementsByTagName("properties");if(v.length){v=v.getElementsByTagName("property");for(var w=0;w<v.length;++w)u.properties[v[w].attributes.getNamedItem("name").nodeValue]=v[w].attributes.getNamedItem("value").nodeValue}q.objects.push(u)}c.layers.push(q)}}var x=b.getElementsByTagName("tileset");for(d=0,e=x.length;e>d;++d){var y=x[d],z=y.getElementsByTagName("tile"),A={name:y.attributes.getNamedItem("name").nodeValue,firstgid:parseInt(y.attributes.getNamedItem("firstgid").nodeValue,10),tilewidth:parseInt(y.attributes.getNamedItem("tilewidth").nodeValue,10),tileheight:parseInt(y.attributes.getNamedItem("tileheight").nodeValue,10),margin:0,spacing:0,tileoffset:{x:0,y:0},terrains:[],properties:{},tileproperties:{},tiles:{}},B=y.attributes.getNamedItem("spacing");B&&(A.spacing=parseInt(B.nodeValue,10));var C=y.attributes.getNamedItem("margin");C&&(A.margin=parseInt(C.nodeValue,10));for(var D=y.getElementsByTagName("properties"),E=0;E<D.length;++E)if(D[E].parentNode===y){if(D=D.getElementsByTagName("property"),D.length)for(var F=0;F<D.length;++F){var G=D[F];A.properties[G.attributes.getNamedItem("name").nodeValue]=G.attributes.getNamedItem("value").nodeValue}break}for(var H=0;H<z.length;++H){var I=z[H],J=I.attributes.getNamedItem("id").nodeValue,K=I.getElementsByTagName("image");A.tiles[J]={};for(var L=0;L<I.attributes.length;++L){var M=I.attributes[L];if("id"!==M.name)switch(M.name){case"terrain":A.tiles[J].terrain=M.value.sply(",");break;case"probability":A.tiles[J].probability=parseFloat(M.value,10)}}K.length&&(A.tiles[J]=A.tiles[J]||{},A.tiles[J].image=K[0].attributes.getNamedItem("source").nodeValue);var N=I.getElementsByTagName("properties");if(N.length){A.tileproperties[J]={},N=N[0].getElementsByTagName("property");for(var O=0;O<N.length;++O){var P=N[O];A.tileproperties[J][P.attributes.getNamedItem("name").nodeValue]=P.attributes.getNamedItem("value").nodeValue}}}var Q=y.getElementsByTagName("terraintypes");if(Q.length){Q=Q[0].getElementsByTagName("terrain");for(var R=0;R<Q.length;++R)A.terrains.push({name:Q[R].attributes.getNamedItem("name").nodeValue,tile:parseInt(Q[R].attributes.getNamedItem("tile").nodeValue,10)})}var S=y.getElementsByTagName("tileoffset");S.length&&(A.tileoffset.x=parseInt(S[0].attributes.getNamedItem("x").nodeValue,10),A.tileoffset.y=parseInt(S[0].attributes.getNamedItem("y").nodeValue,10));var T=y.getElementsByTagName("image");1===T.length&&T[0].parentNode===y&&(A.image=T[0].attributes.getNamedItem("source").nodeValue,A.imagewidth=parseInt(T[0].attributes.getNamedItem("width").nodeValue,10),A.imageheight=parseInt(T[0].attributes.getNamedItem("height").nodeValue,10)),c.tilesets.push(A)}return c},m._decodeBase64LayerData=function(a){return new Uint8Array(window.atob(a).split("").map(m._mapCharactersToCodes))},m._mapCharactersToCodes=function(a){return a.charCodeAt(0)},m._decompressBase64LayerData=function(b,c,d){var e,f=a("zlibjs"),g=m._decodeBase64LayerData(b);switch(d){case"gzip":e=new f.gunzipSync(g);break;case"zlib":e=new f.inflateSync(g)}return e},b.exports=m},{"../display/Container":16,"../display/Sprite":19,"../geom/Rectangle":37,"../math/Vector":47,"../math/math":48,"../utils/inherit":69,"../utils/utils":71,"./ObjectGroup":56,"./Tilelayer":58,"./Tileset":60,zlibjs:7}],60:[function(a,b){var c=a("../utils/utils"),d=a("../utils/inherit"),e=a("../math/math"),f=a("../display/Texture"),g=a("../math/Vector"),h=a("pixi.js"),i=function(a,b){a instanceof Array?(this.multi=!0,f.call(this,a[0].baseTexture)):f.call(this,a.baseTexture||a),this.firstgid=b.firstgid||1,this.name=b.name,this.tileSize=new g(b.tilewidth,b.tileheight),this.spacing=b.spacing||0,this.margin=b.margin||0,this.tileoffset=new g(b.tileoffset?b.tileoffset.x:0,b.tileoffset?b.tileoffset.y:0),this.numTiles=this.multi?a.length:new g(e.floor((this.baseTexture.source.width-this.margin)/(this.tileSize.x-this.spacing)),e.floor((this.baseTexture.source.height-this.margin)/(this.tileSize.y-this.spacing))),this.lastgid=this.firstgid+(this.multi?a.length:this.numTiles.x*this.numTiles.y||1)-1,this.properties=b.properties||{},this.tileproperties=b.tileproperties||{},this.size=this.multi?g.ZERO:new g(b.imagewidth||this.baseTexture.source.width,b.imageheight||this.baseTexture.source.height),this.textures=this.multi?a:[],this.properties=c.parseTiledProperties(this.properties);for(var d in this.tileproperties)this.tileproperties[d]=c.parseTiledProperties(this.tileproperties[d]);if(!this.multi)for(var i=0,j=this.lastgid-this.firstgid+1;j>i;++i){var k=e.floor(i/this.numTiles.x),l=i-k*this.numTiles.x;l=l*this.tileSize.x+l*this.spacing+this.margin,k=k*this.tileSize.y+k*this.spacing+this.margin,this.textures.push(new f(this.baseTexture,new h.Rectangle(l,k,this.tileSize.x,this.tileSize.y)))}};d(i,f,{getTileProperties:function(a){if(!a)return null;var b=i.FLAGS,c=a&b.FlippedX,d=a&b.FlippedY,e=a&b.RotatedCW;if(a=(a&~i.FLAGS.ALL)-this.firstgid,0>a)return null;var f=this.tileproperties[a]?this.tileproperties[a]:this.tileproperties[a]={collidable:!1,breakable:!1};return f.flippedX=c,f.flippedY=d,f.rotatedCW=e,f},getTileTexture:function(a){return a?(a=(a&~i.FLAGS.ALL)-this.firstgid,0>a?null:this.textures[a]):null},contains:function(a){return a?(a&=~i.FLAGS.ALL,a>=this.firstgid&&a<=this.lastgid):!1}}),i.FLAGS={FlippedX:2147483648,FlippedY:1073741824,RotatedCW:536870912};var j=0;for(var k in i.FLAGS)j|=i.FLAGS[k];i.FLAGS.ALL=j,b.exports=i},{"../display/Texture":21,"../math/Vector":47,"../math/math":48,"../utils/inherit":69,"../utils/utils":71,"pixi.js":6}],61:[function(a,b){var c=a("./inherit"),d=a("../constants"),e=a("../display/Texture"),f=a("../display/BaseTexture"),g=a("../text/BitmapText"),h=a("../tilemap/Tilemap"),i=a("pixi.js"),j=function(a){this.game=a,this._canvases={},this._images={},this._sounds={},this._text={},this._tilemaps={},this.addDefaultImage()};c(j,Object,{addCanvas:function(a){this._canvases[a.key]=a},addSpriteSheet:function(a){var b=a.key;i.BaseTextureCache[b]=new f(a.image),i.TextureCache[b]=new e(i.BaseTextureCache[b]),a.texture=i.TextureCache[b],a.textures=e.fromSpritesheet(a),this._images[b]=a},addTilemap:function(a){a.format===d.FILE_FORMAT.XML&&(a.xmlData=a.data,a.data=h.parseXMLMap(a.data));var b,c,g=a.data.tilesets,j=null,k="";a.textures={};for(var l=0,m=g.length;m>l;++l)if(j=g[l],k=j.name,b=a.key+"_"+k,j.image)i.BaseTextureCache[b]=new f(a.images[j.image]),i.TextureCache[b]=new e(i.BaseTextureCache[b]),a.textures[k]=i.TextureCache[b];else if(j.tiles){a.textures[k]=[];for(var n in j.tiles)c=b+"_"+n,i.BaseTextureCache[c]=new f(a.images[j.tiles[n].image]),i.TextureCache[c]=new e(i.BaseTextureCache[c]),a.textures[k][n]=i.TextureCache[c]}this._tilemaps[a.key]=a},addTextureAtlas:function(a){var b=a.key;i.BaseTextureCache[b]=new f(a.image),i.TextureCache[b]=new e(i.BaseTextureCache[b]),a.texture=i.TextureCache[b],a.format===d.ATLAS_FORMAT.JSON_ARRAY||a.format===d.ATLAS_FORMAT.JSON_HASH?a.textures=e.fromJSON(b,a.data,a.texture.baseTexture):a.format===d.ATLAS_FORMAT.STARLING_XML&&(a.textures=e.fromXML(b,a.data,a.texture.baseTexture)),this._images[b]=a},addBitmapFont:function(a){var b=a.key;i.BaseTextureCache[b]=new f(a.image),i.TextureCache[b]=new e(i.BaseTextureCache[b]),a.texture=i.TextureCache[b],a.font=g.parseXMLFont(b,a.data,a.texture),this._images[b]=a},addImage:function(a){var b=a.key;i.BaseTextureCache[b]=new f(a.image),i.TextureCache[b]=new e(i.BaseTextureCache[b]),a.texture=i.TextureCache[b],this._images[b]=a},addAudio:function(a){var b=a.key;a.webAudio||(a.decoded=!0),a.isDecoding=!1,this._sounds[b]=a},updateSound:function(a,b,c){this._sounds[a]&&(this._sounds[a][b]=c)},addText:function(a){this._text[a.key]=a},addDefaultImage:function(){var a="__default",b=new f;b.width=0,b.height=0,b.hasLoaded=!0,i.BaseTextureCache[a]=b,i.TextureCache[a]=new e(b),e.__default=i.TextureCache[a],this._images[a]={texture:i.TextureCache[a]}},getCanvas:function(a){return this._canvases[a]?this._canvases[a].canvas:void 0},getImage:function(a){return this._images[a]?this._images[a].image:void 0},getTexture:function(a){return this._images[a]?this._images[a].texture:void 0},getTextures:function(a){return this._images[a]?this._images[a].textures:void 0},getBitmapFont:function(a){return this._images[a]?this._images[a].font:void 0},getTilemap:function(a){return this._tilemaps[a]},getAudio:function(a){return this._sounds[a]},getAudioData:function(a){return this._sounds[a]?this._sounds[a].data:void 0},getText:function(a){return this._text[a]?this._text[a].data:void 0},removeCanvas:function(a){delete this._canvases[a]},removeImage:function(a){delete this._images[a]},removeSound:function(a){delete this._sounds[a]},removeText:function(a){delete this._text[a]},destroy:function(){this.game=null,this._canvases=null,this._images=null,this._sounds=null,this._text=null,this._tilemaps=null}}),b.exports=j},{"../constants":11,"../display/BaseTexture":15,"../display/Texture":21,"../text/BitmapText":54,"../tilemap/Tilemap":59,"./inherit":69,"pixi.js":6}],62:[function(a,b){var c=a("./inherit"),d=function(){this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1,this.timer=window.performance&&window.performance.now?window.performance:Date};c(d,Object,{now:function(){return this.timer.now()},start:function(){return this.startTime=this.oldTime=this.now(),this.running=!0,this},stop:function(){return this.getElapsedTime(),this.running=!1,this},reset:function(){return this.elapsedTime=0,this.startTime=this.oldTime=this.now(),this},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var a=0;if(this.running){var b=this.now();a=.001*(b-this.oldTime),this.oldTime=b,this.elapsedTime+=a}return a}}),b.exports=d},{"./inherit":69}],63:[function(a,b){var c=a("./inherit"),d=a("../math/math"),e=function(a,b,c,d){this._color=0,this._rgba={r:0,g:0,b:0,a:255},1===arguments.length?"number"==typeof a?this.color=a:this.rgba=a:this.setRgba(a,b,c,d)};c(e,Object,{setRgba:function(a,b,c,d){this._rgba.r=a||0,this._rgba.g=b||0,this._rgba.b=c||0,this._rgba.a=d||255,this._color=(this._rgba.r<<16)+(this._rgba.g<<8)+this._rgba.b}}),Object.defineProperty(e.prototype,"rgba",{get:function(){return this._rgba},set:function(a){a=a||{},this._rgba.r=a.r||0,this._rgba.g=a.g||0,this._rgba.b=a.b||0,this._rgba.a=a.a||255,this._color=(this._rgba.r<<16)+(this._rgba.g<<8)+this._rgba.b}}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(a){this._color=a,this._rgba.r=(16711680&a)>>16,this._rgba.g=(65280&a)>>8,this._rgba.b=255&a}}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._rgba.a},set:function(a){this._rgba.a=d.clamp(a,0,255)}}),b.exports=e},{"../math/math":48,"./inherit":69}],64:[function(a,b){var c=function(){this._events=this._events||{},this.addEventListener=this.on=function(a,b){if("function"!=typeof b)throw new TypeError("listener must be a function");return this._events||(this._events={}),this._events[a]?"object"==typeof this._events[a]?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,this},this.dispatchEvent=this.emit=function(a){this._events||(this._events={});var b,c,d,e=this._events[a],f=arguments.length,g=typeof e;if("undefined"===g)return!1;if("function"===g)switch(f){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:for(b=new Array(f-1),c=1;f>c;++c)b[c-1]=arguments[c];e.apply(this,b)}else if("object"===g){for(b=new Array(f-1),c=1;f>c;++c)b[c-1]=arguments[c];for(f=e.length,d=e.slice(),c=0;f>c;++c)d[c].apply(this,b)}return this},this.removeEventListener=this.off=function(a,b){var c,d,e,f;if("function"!=typeof b)throw new TypeError("listener must be a function");if(!this._events[a])return this;if(c=this._events[a],e=c.length,d=-1,c===b||"function"==typeof c.listener&&c.listener===b)delete this._events[a];else if("object"==typeof c){for(f=e;f-->0;)if(c[f]===b||c[f].listener&&c[f].listener===b){d=f;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1)}return this},this.once=function(a,b){function c(){this.off(a,c),d||(d=!0,b.apply(this,arguments))}if("function"!=typeof b)throw new TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this}};b.exports=c},{}],65:[function(a,b){var c=a("./inherit"),d=a("../display/Sprite"),e=a("../tilemap/Tilemap"),f=a("../geom/Rectangle"),g=a("../text/BitmapText"),h=function(a,b){this.state=a,this.game=a.game,this.parent=b};c(h,Object,{obj:function(a){return this.parent.addChild(a)},sprite:function(a,b,c){var e,f=this.game;return"string"==typeof a&&(a=b||0===b?f.cache.getTextures(a)[b]:f.cache.getTexture(a)),a||(a=f.cache.getTexture("__default")),e=new d(a),(c||void 0===c)&&e.enablePhysics(this.state.physics),this.parent.addChild(e)},audio:function(a,b){return this.state.audio.add(a,b)},tilemap:function(a,b){var c=this.game.cache.getTilemap(a)||{},d=new e(this.state,c.data,c.textures);return b&&this.state.camera.constrain(new f(0,0,d.realSize.x,d.realSize.y)),d.render(-this.state.world.position.x,-this.state.world.position.x,this.game.width,this.game.height),d._cachekey=a,this.parent.addChild(d)},bitmaptext:function(a,b,c){return"string"==typeof b&&(b=this.game.cache.getBitmapFont(b)),this.parent.addChild(new g(a,b,c))}}),b.exports=h},{"../display/Sprite":19,"../geom/Rectangle":37,"../text/BitmapText":54,"../tilemap/Tilemap":59,"./inherit":69}],66:[function(a,b){var c=a("./inherit"),d=function(a,b){this.type=a,this.pool=[],this.parent=b};c(d,Object,{create:function(){var a=this.pool.pop();return a||(a=this._construct(this.type,arguments),this.parent&&this.parent.addChild(a)),a.__allocated=!0,a},free:function(a){a.__allocated&&(a.__allocated=!1,this.pool.push(a))},_construct:function(a,b){function c(){return a.apply(this,b)}return c.prototype=a.prototype,new c}}),b.exports=d},{"./inherit":69}],67:[function(a,b){var c=a("./inherit"),d=function(){this.data=[],this.index=0};c(d,Object,{enqueue:function(a){this.data.push(a)},dequeue:function(){if(0!==this.data.length){var a=this.data[this.index];return 2*++this.index>=this.data.length&&(this.data=this.data.slice(this.index),this.index=0),a}},peek:function(){return this.data.length>0?this.data[this.index]:void 0}}),Object.defineProperty(d.prototype,"length",{get:function(){return this.data.length-this.index}}),Object.defineProperty(d.prototype,"empty",{get:function(){return 0===this.data.length}}),b.exports=d},{"./inherit":69}],68:[function(a,b){var c=a("./inherit"),d=a("../display/Sprite"),e=function(a){this.types={},this.game=a,this.add("_default",d)};c(e,Object,{add:function(a,b){return this.types[a]=b},has:function(a){return!!this.types[a]},create:function(a,b,c){return a&&this.types[a]||(a="_default"),new this.types[a](b,c)},free:function(){}}),b.exports=e},{"../display/Sprite":19,"./inherit":69}],69:[function(a,b){var c=function(a,b,c){c=c||{};var d={};[a.prototype,c].forEach(function(a){Object.getOwnPropertyNames(a).forEach(function(b){d[b]=Object.getOwnPropertyDescriptor(a,b)})}),d.constructor={value:a,enumerable:!1,writable:!0,configurable:!0},a.prototype=Object.create(b.prototype,d)};b.exports=c},{}],70:[function(a,b){var c={ua:window.navigator?window.navigator.userAgent.toLowerCase():"nodejs",canvas:!!function(){try{return window.CanvasRenderingContext2D&&document.createElement("canvas").getContext("2d")}catch(a){return!1}}(),webgl:!!function(){try{var a=document.createElement("canvas");return window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),crypto:!!window.crypto&&!!window.crypto.getRandomValues,workers:!!window.Worker,blobUrls:!!window.Blob&&!!window.URL&&!!window.URL.createObjectURL,typedArrays:!!window.ArrayBuffer,fileapi:!!(window.File&&window.FileReader&&window.FileList&&window.Blob),webAudio:!!window.AudioContext||!!window.webkitAudioContext||!!window.mozAudioContext,htmlAudio:!!document.createElement("audio").canPlayType&&!!window.Audio,localStorage:!!window.localStorage,touch:!!("createTouch"in document||"ontouchstart"in window||navigator.isCocoonJS),gamepad:!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||-1!==navigator.userAgent.indexOf("Firefox/")};if(c.htmlAudio){var d=new Audio;c.codec={mp3:!!d.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!d.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!d.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!d.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),m4a:!!(d.canPlayType("audio/x-m4a;")||d.canPlayType("audio/aac;")).replace(/^no$/,""),webm:!!d.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")}
}b.exports=c},{}],71:[function(a,b){var c=a("../math/Vector"),d=a("../geom/Circle"),e=a("../geom/Rectangle"),f=a("../geom/Polygon"),g={_arrayDelim:/[|,]/,noop:function(){},getAbsoluteUrl:function(a){var b=document.createElement("a");return b.href=a,b.href},ajax:function(a){if(a=a||{},a.method=a.method||"GET",a.dataType=a.dataType||"text",!a.url)throw new TypeError("Undefined URL passed to ajax");a.progress=a.progress||g.noop,a.load=a.load||g.noop,a.error=a.error||g.noop,a.abort=a.abort||g.noop,a.complete=a.complete||g.noop;var b=g.createAjaxRequest(),c=g.getAbsoluteUrl(a.url).split("/")[0];return b.onreadystatechange=function(){if(4===b.readyState){var d=b.response||b.responseText,e=null;if("file:"!==c&&200!==b.status&&(e="Non-200 status code returned: "+b.status),!e&&"string"==typeof d)if("json"===a.dataType)try{d=JSON.parse(d)}catch(f){e=f}else if("xml"===a.dataType)try{d=g.parseXML(d)}catch(f){e=f}e?a.error&&a.error.call(b,e):a.load&&a.load.call(b,d)}},b.open(a.method,a.url,!0),b.responseType="arraybuffer"===a.dataType?"arraybuffer":"text",b.send(),b},createAjaxRequest:function(){var a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new XMLHttpRequest:!1;for(var b=0;b<a.length;b++)try{return new window.ActiveXObject(a[b])}catch(c){}},setValues:function(a,b){if(b){for(var d in b){var e=b[d];if(void 0!==e&&d in a){var f=a[d];if("number"==typeof f&&"string"==typeof e){var h;h=0===e.indexOf("0x")?parseInt(e,16):parseInt(e,10),isNaN(h)||(a[d]=h)}else if(f instanceof c&&e instanceof Array)f.set(parseFloat(e[0],10)||0,parseFloat(e[1],10)||parseFloat(e[0],10)||0);else if(f instanceof c&&"string"==typeof e){var i=e.split(g._arrayDelim,2);f.set(parseFloat(i[0],10)||0,parseFloat(i[1],10)||parseFloat(i[0],10)||0)}else if(f instanceof c&&"number"==typeof e)f.set(e,e);else if(f instanceof Array&&"string"==typeof e){a[d]=e.split(g._arrayDelim);for(var j=0,k=a[d].length;k>j;++j){var l=a[d][j];isNaN(l)||(a[d][j]=parseFloat(l,10))}}else a[d]=e}}return a}},extend:function(){var a,b,c,d,e,f,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"!=typeof h&&"function"!=typeof h&&(h={});j>i;i++)if(e=arguments[i],null!==e&&void 0!==e)for(d in e)a=h[d],c=e[d],h!==c&&(k&&c&&(g.isPlainObject(c)||(b=Array.isArray(c)))?(b?(b=!1,f=a&&Array.isArray(a)?a:[]):f=a&&g.isPlainObject(a)?a:{},h[d]=g.extend(k,f,c)):void 0!==c&&(h[d]=c));return h},isPlainObject:function(a){if("object"!=typeof a||a.nodeType||a===a.window)return!1;try{if(a.constructor&&!Object.hasOwnProperty.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0},getOffset:function(a){var b=a.getBoundingClientRect(),d=a.clientTop||document.body.clientTop||0,e=a.clientLeft||document.body.clientLeft||0,f=window.pageYOffset||a.scrollTop||document.body.scrollTop,g=window.pageXOffset||a.scrollLeft||document.body.scrollLeft;return new c(b.left+g-e,b.top+f-d)},parseHitArea:function(a){var b;if(a.length%2!==0&&3!==a.length)throw new RangeError("Strange number of values for hitArea! Should be a flat array of values, like: [x,y,r] for a circle, [x,y,w,h] for a rectangle, or [x,y,x,y,...] for other polygons.");return b=3===a.length?new d(a[0],a[1],a[2]):4===a.length?new e(a[0],a[1],a[2],a[3]):new f(0,0,a)},parseTiledProperties:function(a){if(!a||a.__tiledparsed)return a;for(var b in a){var c=a[b],d=parseFloat(c,10);if(0===d||d)a[b]=d;else if("true"===c)a[b]=!0;else if("false"===c)a[b]=!1;else try{c=JSON.parse(c),a[b]=c}catch(e){}}return a.hitArea&&(a.hitArea=g.parseHitArea(a.hitArea)),("static"===a.body||a.sensor)&&(a.mass=1/0,a.inertia=1/0),a.__tiledparsed=!0,a},_logger:window.console||{},log:function(){g._logger.log&&g._logger.log.apply(g._logger,arguments)},warn:function(){g._logger.warn&&g._logger.warn.apply(g._logger,arguments)},error:function(){g._logger.error&&g._logger.error.apply(g._logger,arguments)}};"undefined"!=typeof window.DOMParser?g.parseXML=function(a){return(new window.DOMParser).parseFromString(a,"text/xml")}:"undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")?g.parseXML=function(a){var b=new window.ActiveXObject("Microsoft.XMLDOM");return b.async="false",b.loadXML(a),b}:(g.warn("XML parser not available, trying to parse any XML will result in an error."),g.parseXML=function(){throw new Error("Trying to parse XML, but not XML parser is available in this environment")}),b.exports=g},{"../geom/Circle":34,"../geom/Polygon":36,"../geom/Rectangle":37,"../math/Vector":47}]},{},[14])(14)});
//# sourceMappingURL=gf.min.map